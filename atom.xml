<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>楼兰</title>
  
  
  <link href="https://trevoewu.github.io/atom.xml" rel="self"/>
  
  <link href="https://trevoewu.github.io/"/>
  <updated>2024-05-30T10:54:56.036Z</updated>
  <id>https://trevoewu.github.io/</id>
  
  <author>
    <name>楼兰</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>论文致谢部分记录</title>
    <link href="https://trevoewu.github.io/2024/05/30/%E8%AE%BA%E6%96%87%E8%87%B4%E8%B0%A2%E9%83%A8%E5%88%86%E8%AE%B0%E5%BD%95/"/>
    <id>https://trevoewu.github.io/2024/05/30/%E8%AE%BA%E6%96%87%E8%87%B4%E8%B0%A2%E9%83%A8%E5%88%86%E8%AE%B0%E5%BD%95/</id>
    <published>2024-05-30T07:00:18.000Z</published>
    <updated>2024-05-30T10:54:56.036Z</updated>
    
    <content type="html"><![CDATA[<p>能够写论文的致谢部分，说明我已经完成了论文，回望这段经历，百分之八十的时间都是在漫无目的的追着什么，像是一个个矩阵变换叠加的向量那无序的乱舞，像是反常积分看不到收敛。直到真正看见什么值得追的东西，才算是矩阵变换求出了特征向量，黎曼积分的和有了正值。</p><span id="more"></span><p>这里我要感谢在论文完成过程中给予我相当大帮助的导师和学长们。导师程媛是相当善解人意的老师，在我不知道论题的研究方向时，提供了做相同领域研究方向的姜昊彤学长，是他告诉我应该先学什么基础知识来打好研究的基础。他向我推荐的《交通时空大数据，分析挖掘与可视化》一书，极大的帮助我厘清研究方向。我自己找到的数据集总是残缺，或是不能满足要求，亦或是数据不合理，一直无法找到可靠的，较新的出租车轨迹数据时，导师程媛向我介绍了程宇学长，并我提供了项目需要的的基础数据集。一个可靠，足量，时间跨度大的数据集是项目研究的核心和基础。在我为考研和毕设的决定担忧时，导师程媛也会安慰我不用着急，先把毕设好好做完。给了我很大的心理稳定。这可能很奇怪，但我还是像感谢chatgpt，即使他是一个大语言模型，但永远是耐心的回答我的问题，在我代码出bug时能帮我排除问题，面对全新的领域，学习未知的知识，永远事无巨细的解释每一个概念，回答我的疑惑，以至于每次我都想对他说声谢谢，即使这不会使他给我的答案更加准确。也许更应该感谢这个时代，感谢为大语言模型付出的研究人员，他们带来了这个终将改变世界的产品，庆幸这个时代的我们可以拥有这样的工具。最后，我希望感谢自己，感谢自己能接受自己，感谢自己能感谢自己，也从迷茫中走来，也会继续走下去。下面是一些写致谢时的思想琐碎，就一齐留在这里。</p><p>之前我是对毕业设计抱有幻想的，想着这是一个可以自己大展拳脚的地方，就像高中的我憧憬着大学的自由一样，憧憬着可以借着毕业设计的机会，做一些自己喜欢的东西。当然，我这不是在说大学没有那般的不自由，毕业论文也没有那般的打破我的幻想。毕竟走到事件的尽头，回首还是会发现这也是一段美好的旅程。</p><p>大多数学生可能都幻想着毕业设计做一个游戏，我也这样想过，毕竟这个主题对于这个年纪的我们来说有着难以抵抗的诱惑。如果说不小一部分选择计算机专业的学生就是想着做游戏来的，我相信远不能说这不是事实。</p><p>最终是这个结果名为“移动轨迹数据的分析平台”的论题，这也是我消极处理的结果，不意外的一个被随机分配的论题，它起初的论题是“移动轨迹数据的聚类分析”没有一个名词是我熟悉的。</p><p>从小的我总是被动的接受，接受发生在我身边的结果。即使自己可以稍微动一动身子去带来些许改变，我选择站在一旁，让一切发生。无论是中学时期被随机的分配座位，被随机的分配班级，还是班级旅行，小组任务的小团体分配，我等待着事情来到一个无法避免的结果，然后去接受它，只在心里幻想着这个结果或许不差。不过事实大部分都得不到想要的结果。我等着座位都被人选完，等着同学们纷纷组成自己的小团体，若是还有剩余的座位，那就是我的书包会放置的地方，或是等着被老师分配到空缺的位置。</p><p>这也许是我们会喜欢上游戏的原因吧，毕竟游戏可以二周目，可以去一步步到达自己想要的结果。这也不免让我觉得人生的遗憾不是一辈子太短，而是只有一辈子。人们不断寻求能够时间旅行的方式，多重宇宙的存在，时间的轮回，宇宙可以重开。我们怀念过去，即使我们是随着成长越来愈幸福。怀念回到过去的自己，改变那些早已尘埃落定的结果。这一次，即使没有完成作业我也不会乖乖的伸出手来忍受老师的鞭打；这一次，我会勇敢的坐在喜欢的女孩的旁边，不害怕同学的奚落；这一次我会告诉远方打工的父母，给我一个放学后可以称作家的地方。</p><p>过去是既定的，未来是不确定的。事物发展的很快，理想的标杆愈来愈高。即使回望三年前的自己，现在的我已经脱变，依旧是恨现在这个无能的自己。若是告诉高一的我，那时候的我英语从来没有能及格，现在的我已经拥有了上万词汇，自由的阅读英文作品，我一定会觉得那已经是不可思议的自己。不断的学习开阔了眼界，也越发感受到自己的渺小，越发恨自己为什么不能做得更好。即使我们不在监狱，我们也建起了自己内心的圆形监狱，建起了监视的高塔。没人挥舞着鞭子命令你努力，但这个世界的大家，似乎都在内心鞭打自己，要去达到怎么样的一个人。似乎这就是正确的，理想的，我们应该达成的结果。</p><p>这是我焦虑的来源，为不够努力的自己焦虑，为明天的不确定焦虑，却又放任其发展。论题早在去年冬天就以确定，即使完全从零开始，时间也是足够的。我有充分的理由不去管它，我在准备考研，即使我知道我已经考不上了，但这也意味着我可以完全心安理得的不去理会它。就如同他们总是说考研可以暑假结束之后开始也来得及，他们也说毕业设计四月份开始准备就可以。也许确实是这样，就像后辈向我抱怨期末考试要挂科了，我也说大学期末考试，认真准备肯定会过的。不是谎言，也不能说是真相。因为我们不会告诉你，如果你从暑假结束才开始准备考研，你会陷在追赶进度的泥潭里，如果考试前一周才开始突击，这一周你得不到多少个可以安眠的夜晚。同样的，我的毕业设计从四月份才开始设计。</p><p>若是一切都随着理想发展，那么这段时光或许格外闲逸。找到工作的每天打打游戏，闲下来就做做毕设项目，或是有女友的四处旅行。考试研究生或许会更加安逸，这将是是一段难得的空白时光。若是像我，既没去找工作考研也失败，会是怎样的心情呢，我也说不上来。也许是考研有着魔力，一旦踏上了就很难离开，也许是害怕去工作的不确定性，我选择了二战考研。</p><p>一股风吹，水就会流动，两股不同的风，就会纠缠成旋风。若是我在准备考研复习，我就会想着毕设要怎么办，若是转身去设计毕设项目，就会觉得考研复习的时间被耽搁。若是我复习时能做对题，毕设时知道自己要什么，能做什么。这或许给我极大的兴致，恰是做什么都永远在碰壁，做什么都不知道如何开始，才让人无能的焦虑。</p><p>我看着论题“移动轨迹数据的聚类分析”，每一个字我都不知所云。开题答辩时，老师问我，“这个论题是要出一个什么东西出来呢？”。我也只好绕着弯子的说是在分析各种聚类算法，优化聚类算法之类的。老师又问“你就只是分析现有的聚类算法能算毕业设计吗？你得自己设计一个出来吧。没有一个具体的成果，到时候毕业答辩时，你总不能给我们看你在打着台灯读论文的照片吧。”老师很风趣，我却很难受。我并不觉得我是能设计出一个聚类算法的人，甚至去分析这些聚类算法都是一个相当大的挑战，若是能读懂理解这些算法，我都得感慨感慨自己的智慧，何谈自己设计一个出来呢。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;能够写论文的致谢部分，说明我已经完成了论文，回望这段经历，百分之八十的时间都是在漫无目的的追着什么，像是一个个矩阵变换叠加的向量那无序的乱舞，像是反常积分看不到收敛。直到真正看见什么值得追的东西，才算是矩阵变换求出了特征向量，黎曼积分的和有了正值。&lt;/p&gt;</summary>
    
    
    
    <category term="必要的记录" scheme="https://trevoewu.github.io/categories/%E5%BF%85%E8%A6%81%E7%9A%84%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="必要的记录" scheme="https://trevoewu.github.io/tags/%E5%BF%85%E8%A6%81%E7%9A%84%E8%AE%B0%E5%BD%95/"/>
    
    <category term="论文" scheme="https://trevoewu.github.io/tags/%E8%AE%BA%E6%96%87/"/>
    
  </entry>
  
  <entry>
    <title>上帝的梦（钱钟书）</title>
    <link href="https://trevoewu.github.io/2024/05/13/%E4%B8%8A%E5%B8%9D%E7%9A%84%E6%A2%A6%EF%BC%88%E9%92%B1%E9%92%9F%E4%B9%A6%EF%BC%89/"/>
    <id>https://trevoewu.github.io/2024/05/13/%E4%B8%8A%E5%B8%9D%E7%9A%84%E6%A2%A6%EF%BC%88%E9%92%B1%E9%92%9F%E4%B9%A6%EF%BC%89/</id>
    <published>2024-05-13T08:13:30.000Z</published>
    <updated>2024-05-13T12:57:44.640Z</updated>
    
    <content type="html"><![CDATA[<p>​那时侯，我们的世界已经给科学家、哲学家和政治家训练得服服贴贴，沿着创化论、进化论、层化论、优生学、新生运动的规律、日新月进。今天淘汰了昨天的生活方式，下午提高了上午的文化程度。生活和文明瞬息万变，变化多得历史不胜载，快到预言不及说。</p><span id="more"></span><p>那时侯，人生历程的单位是用“步”来计算;不说“过了一年”，而说又进了一 步，不说“寿终”，说“行人止步”，不说“哀悼某人逝世”，说“五十步笑百步”——笑他没有向前多进几步。</p><p>在男女结合的集会上。宾客只说“双⻜”，不说:“双宿”;只有少数守旧的人还祝这对夫妇“保持五分钟热度”，这就等于我们现在说“白头偕老”，明知是不可能的希冀。但是这种进步的世界，有一个美中不足。一切近百年史，五十年来之文化检讨，日记，年谱，自传，“我的几分之一生”，以及其它含有讣告性的作品，都失掉了它们的效用。</p><p>亏得那时候的人压根就没工夫看书。至于写这类读物的作者呢?他们运气好，早抢先在二十世纪初叶投了胎，生了，写了，死了，有人读了，没人读了，给人忘了。</p><p><strong>进化的定律是后来居上</strong>。时间空间演化出无机体，无机体进而为动植物，从固定的植物里变出了文静，缠着人不放的女人，从活泼的动物里变出粗鲁，敢冒险的男人;男人女人创化出小孩子;小孩子<strong>推演</strong>出洋娃娃。</p><p>所以，至高无上的上帝该是进化最后的产物。不过，要出产个上帝谈何容易。哪个历史上的伟人不在娘胎里住过十个月才肯出世的?象现在四万万互相残害的子孙的⻩帝，就累他母亲怀了足足二十个月的孕;正位为太上道德真君的老子也在娘胎里住了八十年然后呱呱下地，真是名符其实的“老子”了。所以当天演的力量，经过数不清的年头，创化出一位上帝时，人类已在这世界里绝迹了——也许就为“双⻜”而不“双宿”的缘故。</p><p>甚至进化论者也等不及了。因此，这个给物质塞满的世界同时⻅的空洞，宛如一个放大了无数倍的愚人的头脑。  正在深夜，古旧的黑暗温厚地掩覆着衰老的世界，仿佛沉重的眼皮盖在需要休息的眼睛上。上帝被天演的力量从虚无里直推出来，进了时空间，开始觉得自己的存在。到此刻，自古以来神学家和玄学家的证明，情人，战士，农夫，跟孤儿寡妇的祈祷，才算有个主儿。</p><p>但是，这许多虔诚的表示，好比家人寄给流浪者的信，父母生前对遗腹子的愿望，上帝丝毫没有收到。他张开眼睛，什么都瞧不⻅。身子周围的寂静，无边，无底。已逝去的人类的遗习，在上帝的本能里半醒过来，他象小孩子般害怕要啼哭，然而这寂静久未被人声打破，结成了胶，不容声音在中间流动。</p><p>上帝悟到这身外的寂静和心里的恐怖都是黑暗孵庇的。他从此恨黑暗，要求他所未⻅过，不知名的光明。这要求一 刻强于一刻，过了不知多少时间忽然黑暗薄了一层，夜减少了它的压力，隐隐露出高山峡谷的轮廓，眼睛起了作用，视线有了收获。这使上帝开始惊奇自己愿力的伟大。他想，他不要黑暗，黑暗就知趣让步，这还不够!本来望出去什么也没有，现在他眼睛所到，黑暗就生出东⻄，庞大地迎合自己的目光。以前人类赞美万能创世的歌声，此时在上帝的意识层下似乎又颤动着遗音和回响。</p><p>上帝毕竟还保留人的脾气，知道了有权力就喜欢滥使。他想索性把黑暗全部驱除，瞧它听不听命令。咦!果然一会儿东方从灰转白，白里透红，出了太阳。上帝十分快乐，他觉得这是他要求的，听他的分附。他给日光射花的眼睛，自动地闭上，同时心里想:“好厉害的家伙，暂时不要它。”</p><p>说也奇怪，果然眼前一切立即消灭，又自造成一团息息不停地泛出红色的黑暗。到此地步。上帝对自己的本领和权力不能再怀疑了。既然闭上眼睛便能去掉光明，这光明定从他眼睛里产生的;不信，试张开眼睛，你瞧，这不是太阳?那不是山和水?都千依百顺地自献在眼里。</p><p>从前公鸡因为太阳非等他啼不敢露脸，对母鸡昂然夸口，又对着太阳引吭高叫，自鸣得意。比公鸡伟大无数倍的上帝，这时侯心理上也就跟他相去不远，只恨天演的历程没化生出相当于母鸡的东⻄来配他，听他夸口。这可不是天演的缺陷，有他科学上的根据。正象一切优生学配合出来的动物譬如骡)，或者至高无上的独裁元首(譬如希特勒)，</p><p>上帝是不传种的，无须配偶。 不过，公鸡般的得意⻓鸣，还是免不了的。所以上帝不由自主的哈哈大笑，这笑在旷野 空谷里起了回声，使上帝佩服自己的声音能变得这样多，放得这样大，散得这样远。  这位上帝真不愧进化出来的。他跟原始人绝然不同。他没有野蛮人初发现宇宙时的迷信和敬畏。他还保持着文明人“唯我独尊”的自信心。野蛮人随地疑心有神道，向它屈服和崇拜。这种思想，在上帝心里，影子也无。他只发现了自己的伟大，觉得自己能指挥万物，无须依赖任何人。世界随他的视线蜿蜒地伸出去。脚走到那里，地会跟到那里，只有地平线向后退，这也表示它对自己的畏缩。一切都足以增进他的骄傲，培养他的虚荣。</p><p>他忽然需要一个伴侣。这广漠的世界，独住了怪乏味的!要一个伴侣来崇拜，赞美自己，好打破现在的沉寂。</p><p>上帝因此思索着这伴侣该具有的资格。他的结论虽没有 下面所说的那样明白，大意是相同的。</p><ul><li>第一，这伴侣要能对自己了解。不过，这种了解只好象批评家对天才的了解，能知而不能行。他的了解不会使他如法创造跟自己来比赛，只够使他中肯地赞美，妙入心坎地拍⻢;因为——</li><li>第二，这个伴侣的作用就为满足自己的的虚荣心。他该对自己无休歇地，不分皂白地颂赞，象富人家养的清客，被收买的政治家，受津贴的报纸编辑。不过，上帝并没有 贿赂他，这颂赞是出于他自动的感激悦服;所以——</li><li>第三，这个伴侣该对自己忠实，虔诚，象——象什么呢?不但天真未凿的上帝不会知道，就是我们饱经世故，看过父子，兄弟，男女，主仆，上司和下属，领袖和爱戴的人⺠间种种关系，也还不知道象什么。</li></ul><h1>上帝的梦(03)</h1><p>有些人，临睡稍一思索，就会失眠。另有些人，清醒时若胡思乱想，便会沈沈睡着。上帝也许是后一种人演化出来的;他模糊地因想成梦。这驯服的世界也跟着他进了梦里。</p><p>他梦中看⻅的依然是荒山野水，水里照有自己的像。他顿时有了灵感，向石⻣棱棱的山身上，拣比较丰肥处挖一团泥，对自己的像，捏成人坯子，吹口气，这坯子就活动起来，向脚边俯伏叫着:“全知全能的主宰呀!我将无休息地歌颂你。”上帝这时侯又惊又喜的心情，简直不可拟议。假使我们是小女孩子，忽听得手里抱的洋娃娃赶着自己叫“妈妈”，或者是女大学生，忽⻅壁上贴的好莱坞男明星在照相里对自己做眼，低声唱 “妹妹，我爱你!”也许我们能揣度，想象他此时心情的万分之一。只可惜我们都不是!</p><p>一切宗教的圣经宝典关于⻩土搏人的记载，在此时上帝的梦里才算证实了是预言。 上帝并不明白自己在作梦，或者梦在作弄自己。他不知道这团水泥分析起来压根就是梦的质料。他捏一团梦作成人，仿佛有人会捏鼻子做梦。上帝以为真有一个凑趣助兴的 人，从此以后，赞美不必出自己的口，而能称自己的心。因为对自己最好的赞颂，是好象心上要说的，而偏是耳朵听来的，有自赞那样的周到和中肯，而又出诸傍人的贡献。 这个理想，我们人人都有，也许都曾在梦里造个人来实现;不幸得很，醒时要凭空造这 样一个人，可没那么容易，我们只能把现成的人料改造，至多将迎合自己的小人增修成大人物，总不象做梦时的随心如意。</p><p>上帝在人类灭绝后才出世，不知不觉中占有许多便宜。譬如两个⺠族相斗争时，甲族人虔诚地要求惩罚乙族，乙族真挚地望他毁灭甲族，使聪明正直的他左右为难。这种困难，此时决不会发生。即如他的梦里造人，若世间还有文人，就是极好的笔战题目。</p><p>据他将烂泥捏人一点看来，上帝无疑有自然主义的写实作⻛，因为他把人性看得这样卑污，向下层觅取材料。同时，他当然充得古典派的作家，因为听说“一切创造基于模仿”，试看万能的他，也免不了模仿着水里的印象才能创造第一个人。不过，不知道是古典派的理论不准确呢，是上帝的手工粗劣呢，还是上帝的相貌丑陋呢，他照自己样子造成的人，看来实在不中意。他想这怕由于泥坯太粗，也许初次动手，手段还没纯熟。于是他选取最细软的泥——恰是无数年前林黛玉葬花的土壤，仔细拣去砂砾，和上在山谷阴处未干的朝露，对着先造的人型，精心观察他的⻓处短处，然后用已有经验的手指， 捏塑新调的泥，减削去肢体上的盈余，来弥补美观上的缺陷。他从流水的波纹里，采取了曲线来做这新模型的体态，从朝霞的嫩光里，挑选出绮红来做它的脸色，向晴空里提炼了蔚蓝，缩入它的眼睛，最后，他收住一阵轻飘浮动的⻛，灌注进这个泥型，代替自己吹气。</p><p>⻛的性子是膨胀而流动的，所以这模型活起来，第一椿事就是伸个软软的懒腰，打个⻓⻓的哈欠，为天下伤春的少女定下了榜样。这第二个模型正是女人。他是上帝根据第一个模型而改良的制造品。男人只是上帝初次的尝试，女人才是上帝最后的成功。这可以解释为什么爱漂亮的男子都模仿女气，逼得时髦的女子只好另出心裁，带着妖气。</p><h1>上帝的梦(4)</h1><p>从此，上帝有了事做。为这对男女，上帝费尽心思，造各种各样家畜，家禽，果子，蔬菜，给他们享受，利用。每造一样东⻄，他总沾沾自喜地问男人和女人道“我又为你们发明了新东⻄，你们看我的本领大不大?”于是那一对⻬声歌颂:“仁慈救世的上帝!”</p><p>这样好多次后，这一对看惯了他的奇迹，感谢得也有些厌了，反嫌他碍着两口子间的体己。同时上帝也诧异，何以他俩的态度渐渐冷淡，不但颂赞的声音确减少了高朗， 而且俯伏时的膝盖和背脊似乎不如以前弯得灵便。于是，上帝有个不快意的发现。自从制造人以来，他发明的东⻄是不少了，但是有发现还算是第一次。  这发现就是:</p><blockquote><p>每涉及到男女间关系的时侯，“三”是个少不了而又要不得的数目。假使你是新来凑上的第三者，你当然自以为少不了，那两人中的一人也会觉得你少不了， 还有余下的一人定以为你要不得，你更以为他或她要不得。假使你是原来的退作第三者，你依然觉得自己少不了，那两人却都以为你要不得，你也许对两人中的一人还以为 她或他少不了，对余下的一人当然以为她或他要不得。</p></blockquote><p>据数学家说，一只三⻆形里不能有两只钝⻆。不过，在男女三⻆形的关系里，总有一只钝⻆。上帝发现这钝⻆并不是那粗坯的男人，反而是自己，不识趣地监临着他俩。这真是气得死人——不，气得死上帝!他最初造女人，并非要为男人添个伴侣。他只因为冷清清地无聊，制造个玩具来遣闷，而第一个坯子做得不满意所以又造一个。谁知道他俩要好起来，反把他撇在一边。 他奇怪着，这女人何以对高高在上的自己老是敬而远之，倒喜欢跟那下等的男人接近。 于是，上帝又有一个不快意的发现。这一次的发现不是数学上的，而是物理学上的。  这发现就是:</p><blockquote><p>宇宙间有地心吸力那一回事。因为地心吸力的关系，一切东⻄都喜欢 向下掉，包括牛顿所看⻅的苹果。所以下等人这样多，上等人那么希罕，并且上等人也 常有向下层压迫的趋势。⻘年人那么容易堕落;世道人心那么每况愈下——这全是一个道理。</p></blockquote><p>上帝在造女人的时侯，又调露水，又仿波纹，无意中证实了“女人水性”那句古语，没提防另有一句古语说:“水性就下”。假使树上掉下的苹果恰砸痛了牛顿的头，或砸破了他的鼻子，那么牛顿虽因此而发现吸力的定律，准会觉得这吸力的例子未免咄咄逼人。</p><p>同样上帝虽参透了人情物理，心上老是不自在，还觉得女人的情感离奇不可解。 他甚至恨自己的伟大是个障碍，不容他们来接近，造了这一对男女，反把自己的孤寂增进了;衬着他们的亲密，自己愈觉被排斥的无聊。可气的是，他们有不能满足的需要时，又会来求来讨好。譬如水果烂了，要结新的，家畜吃腻了，要换口味，他俩就会缠住上帝，又亲又热，哄到上帝答应。一到如愿以偿他们又好一会要把上帝撇在脑后。上帝只变了他们的用人，这使他大大的生气。原来要他们爱自己，非先使他们爱新果子或口味不可，自己不就身分降低，只等于果子或口味么?他们这样存心，若还让他们有求必遂，那么自己真算得果子中的傻瓜，口味里的呆⻦了!</p><p>因此上帝下个决心，不再允许他们的吁请。但是，上帝是给他们罩上正直慈祥的头衔的，怎好借小事跟他们为难?只 能静候机会，等他们提出无理的要求时，给他们一个干脆的拒绝，稍泄胸中的闷气。妙在上帝是⻓生不死的，随你多么⻓的时期，都熬得住等待。</p><h1>上帝的梦(05)</h1><p>一天，女人独来向上帝请安。她坐在他脚边，仰面看着他的脸，蓝液体的眼睛，象两汪地中海的水，娇声说:“真宰啊!你心最好，能力最大，我真不知怎样来感谢你!”</p><p>上帝用全力抵抗住她眼睛的闪电战术，猜疑地问:“你有什么要求?”  女人陪小心似的媚笑，这笑扩充到肩背腰腹，使她全身丰腴的曲线增添了波折，说的话仿佛被笑从心底下泛上来的，每个字都载沉载浮在笑声里:“你真是全知全晓的造物主哪!什么事情都瞒不过你，我真怕你。其实我没有什么要求;你待我们太好了，一切都已满足。那个算不得要求。”</p><p>“‘那个’是什么呢?快说。”上帝不耐烦地说，同时心给希冀逗得跳着，想也许是机会来了。</p><p>女人把后备着的娇态全部动员，扭着身子说:“伟大的天公啊!我最佩服你的无所不能。你只无所容心的一举手，已够使我们赞美。我并不要新奇的东⻄，我只奉恳你”—— 说时，她将脸贴住上帝漠无所感的腿，懒洋洋地向远远在山谷里的男人做个手势——“我只奉恳你再造一个象他样子的人。不，不完全象他，比他坯子细腻些，面貌⻓的英俊些。慈悲的主啊!好不好?”  上帝听了，直跳起来，险把脚边腻着的女人踢出去，急忙问:“要我再造一个男人的 理由呢?”  女人一手自拍着胸，一手抚摸着脸说:“吓死我了!神奇的上帝啊!你的力气真大，行动真急!你看，我的脸都给你碰痛了——那没有关系。你不是问我理由么?我男人需要个朋友，他老跟我作伴，怪闷的。你再造一个男人，可以免得他整日守着我，对不对?”  “也可以免得你整夜守着他，是不是?”上帝的怒声，唤起了晴空隐隐的雷声，“女人啊!你怎敢向我提这样的要求呢?你对一切东⻄都贪多，浪费，甚至对于男人，在指定的配给以外，还要奢侈品。那还了得!快回去，我饶赦你初次，你若再抱非分的欲望， 我会责罚你，把你现在有的男人都毁灭了他。”  最后一句话，大有效力。女人⻜红了脸，咕嘟着嘴，起身去了，一路上喃喃自语: “我不过说着玩儿，亏你就会拿腔作样。老实说，我早看破你没本领造一个比他好的男人!”这些话幸而上帝没听到。他这时因为如愿以偿，出了心头恶气，乐的不得了;怕笑容给女人看⻅了，自己不好意思，所以将脸躲在黑云堆里。他嘻开嘴，白牙⻮的磁光在 黑云里露出来，女人恰回头看⻅，她没⻅过牙膏商标上画的黑人，误以为电光。上帝努力忍住的“哈哈”笑声，在躯壳里一阵阵的掀动，女人远听着，以为就是打雷。她想上帝在施展恐怖手段，又气又怕，三脚两步，跑到男人那里。上帝才恐吓过她，要剥夺她这 个唯一的男人，所以她对他又恢复了占有的热情。她坐在他头边，吻醒了他，拥抱住他，说话中每一个字上都印着吻，染着她嘴唇的潮润:“我只有你，我只爱你。我没有你不能活。我不许你给人夺去…”男人酣睡初醒，莫名其妙，听到女人重申占领决心的宣 言，愈感到局促不安，因为他刚做一个梦，心里有⻤。女人跑得累了，情感紧张得倦了，好容易才沈沈睡着。他偷偷地立起来，挑了两块吃剩的肥肉，去祭献上帝。</p><h1>上帝的梦(06)</h1><p>“弘恩大量的主人翁啊!求你垂鉴我的虔诚接受这微末的孝敬。我们一切原是你赐予的，这东⻄也就是你的，我们所能贡献在你脚下的，只是一片真心。”男人如是说。  上帝方才的高兴此时更增加了。他想，人来献祭，这还是第一次。准是那女人愧悔心萌，没脸相⻅，所以差男人来求情的。不过，若让自己的喜悦，在脸上流露，未免给他们小看了。于是默然不答，只向男人做出一种表情——法国和⻄班牙小说家用下面的记号来传达的表情:<br>“?”<br>男人⻅上帝脸色不难看，便鼓起勇气说:“我向主人要求一椿小事。”  这使上帝恍然大悟那两块肥肉的作用，原来男人的礼物相当于女人的巧笑媚眼，都是有所请求时的贿赂。亏得没把男人造得美丽，否则他也不必送礼了!同时吩咐男人说明他的要求。</p><p>“我求你为我另造一个女人——”</p><p>“女人刚来向我作同样的要求，”上帝截断他的话。  上帝此时又失望又生气。但是那昏头的男人，听了上帝的话，惊喜交集。他想:“女人真是⻤精灵儿!我做的梦，她怎会知道?怪不得她那一会儿抱了我说那些话，原来她甘心牺牲她自己的利益，已经代向上帝要求，但又有些舍不得我给新造的女人抢去。 唉!她这样大度，这样体贴，我怎忍得完全抛弃她呢?”一面心上想，一面向上帝涎着脸道:“是呀，她也觉得生活单调，希望有个同性的人来伴她解闷。”</p><p>“你错了!她不是要求我造个同性的人，她是向我提出同性质的要求。她要求我另造个男人，要比你这蠢物⻓得好，你知道么?”  这时侯男人的失望不亚于那时的上帝，赶快问:“主呀!你允许她没有?”  上帝觉得有一种怒气发泄的痛快，厉声骂说:“我懊悔没允许了她。你们俩真没配错，好一对混蛋!快替我滚开。你不小心，看我把女人都毁了”——似乎这恐吓的力量还不够大，上帝又加上说:“并且把你吃的肉全都剥夺!”男人在这威胁之下，抖作一 团，战栗地回去。上帝叹口气，感慨着何以造的人这样不成器?但是转念一想，这两个人坏得这样平衡，这样对称，这样的象两句骈文或一联律诗，又不得不佩服自己艺术的精细。所以，上帝心安理得了。</p><p>男人和女人向上帝都泄露了个人的秘密，结果一无所得。同时男人怕上帝把自己的请求告诉女人，女人不知道上帝已经告诉了男人她的要求，所以双方不约而同地对上帝怨恨之外，还加上猜忌和提防。男人说:“我们日用的东⻄也将就得过了，可以不必去找 上帝。”女人说:“他本领怕也用尽了，就是求他也变不出什么新花样来，倒去看他的 脸!真讨厌。”男女同声说:“我们都远着他，别理他，只当他没有。”于是神人间的距离更远;上帝要他们来亲近的目的，依然不能达到。上帝因此想出一个旁敲侧击的妙法。 他们生活太容易，要让他们遭遇些困难和危险，那时侯他们“穷则呼天”，会知道自己不好得罪的。</p><h1>上帝的梦(07)</h1><p>这晚上，男人和女人在睡梦中惊醒，听⻅一种洪大的吼声。向来只有人吃荤腥，此外畜生象牛、羊、猪等都⻓斋持素，受了上帝的感化，抱着“宁人吃我，我只吃草”的伟大精神。现在人以外，添了吃荤的动物，不但要夺人的⻝，并且人肉也和它们的口味， 全不知道人肉好比猫肉，狗肉以及其他吃大荤的畜生的肉，一概是不中吃的——唐僧的肉所以惹得山精水怪馋涎欲滴，无非因为他是十世不破荤的和尚!</p><p>男女俩听⻅的声音， 正是饿狮子觅⻝不耐烦的叫。他们本能地战栗着，觉得这吼声里含有敌性。两人四周蜷伏的家畜，此时霍然耸立，竖起耳朵，屏住气息，好象在注意什么。这愈增加两人的不安。狮子叫几声后住了，它吼声所裂开的夜又合拢来，好一会，家畜等仿佛明白危险暂时已过，都透了口气，态度松懈下去。男人伸手抚摸身边偃卧的羊，发现羊毛又湿又热，象刚出过汗的。女人打个寒噤，低声说:“定是上帝和我们捣乱，我想还是找个山洞去睡。我害怕在露天过夜。”两人起来把牲口赶进山谷，然后躲入就近的洞里躺下。身和心渐渐地溶解，散开去，沉下去，正要消失在睡眠里，忽然勒住，两人顿时清醒过来。 一阵无名的恐怖冰冷地从心上散布到四肢，冻结住他俩的身体和喉舌。这恐怖的原因象在黑暗里窥伺着，估计着他们。</p><p>两人不敢动，不敢透大气，一身冷汗直淋。时间也象给恐怖凝固住了，不复过去。突然间，恐怖不知到哪里去了，空气也仿佛释却负担，天明的曙光已向洞口试探。同时山洞左右，一头猪狂叫，只叫了半声，以下声息全无，声音 收束得给快刀划断似的干脆。猪的叫声彻底解除了洞里的紧张。男人伸胳臂给女人枕着，让她睡在自己怀里;他们俩相处以来，从未象这样的没有欲望的需要彼此。</p><p>到天大亮，两人分头出去。男人点家畜，少了一头猪，其余的牛羊等也象经过大打击的，无精 打采。正在猜测着缘故，去打水的女人气急败坏地跑回哭诉。她过树林时，看⻅一条大蟒蛇蟠着——吞了猪后，正作助消化的饭后睡觉。水边沙滩上，横着一条鳄⻥，昂头向 天张着大口;她幸而跑回得快，没给它瞧⻅。看来四处都有危险潜伏，两人不能再无忧无虑地生活了。“一夜之间怎会添出这许多怕人的东⻄呢?”两人讨论道，“无疑是我们尊称他为上帝的造来害我们的。这样，他不是上帝，他只是魔⻤，万恶的魔⻤。我们没有眼睛，给他哄到如今。好了!好了!也有看破他真相这一天!”这几句话无形中解决了自古以来最难解答的问题:“这世界既是全能至善的上帝造的，何以又有恶魔那般猖狂?” 原来上帝只是发善心时的魔⻤，肯把旁的东⻄给我们吃，而魔⻤也就是没好气时的上 帝，要把我们去喂旁的东⻄。他们不是两个对峙的势力，是一个势力的两个方面，两种名称，好比疯子一名天才，强盗就是好汉，情人又叫冤家。</p><h1>上帝的梦(08)</h1><p>男女间的窃窃私语，上帝竟没听⻅。他还以为自己独一无二，不知道上帝唯一的“一”，早给男女俩看成中国古时医生开方子在药味下注的“一–二分半”。缘故是他虽然全知全 能，毕竟是个上等人物，不屑亲管被窝里的事，⻔背后的话。他此时搓着双手，只等有好戏看。果然两人垂头丧气，想不出个办法，但也不来求教上帝。一会儿，蟒蛇肚子里消化了猪，狮子和老⻁开始在邻近吼叫，男人拉女人慌忙跑到洞里把石头垛住进口。只苦了余下的家畜四而乱窜，向山罅里觅藏身之处。</p><p>上帝想:“妙啊!看野兽把你们家畜吃完了你们自会来哀求我。那时候，哼…”谁知道，天下事固不能尽如人意，人间事也未必尽如天意。</p><p>上帝这种消耗策略，并未使人屈服。因为野兽总是野兽，欠缺文明的修养。譬如那蟒蛇没受过教育，不知道颠扑不破的那句古话:“羊肉没吃着，惹得一身膻”，所以它吃过猪后，想换换口味，囫囵吞了一头大羊，一段凸出的身子象害着大头颈的病，又象通货膨胀的国家。但是，羊有⻆的，刺破它的咽喉，羊肉算是到口，却赔了 性命。狮子和老⻁也是小家子相得很，不知道吃饭的礼貌，吃牛肉吃得抢起来，打作一 团，结果老⻁死了，狮子负伤到溪边去喝水。这溪里的鳄⻥是个文盲，没念过韩昌黎有名的祭鳄文，所以不去吃⻥虾，反要尝狮子的肉。那狮子不吃人家的肉也罢了，那肯割舍自己的肉，又跟鳄⻥性命相搏，打得难分难解，你死我也不活。</p><p>男人和女人给洞外惨厉的呼声吓得半死。听得野兽声没了，从洞口石缝里张出去，早有家畜三三两两在吃草。两人放心出洞，，知道毒虫野兽都死完了，家畜并没有损失多少。他们兴高采烈， 把打死的老⻁等开剥，从此他们洞里有皮毯子，女人有了皮大氅，男人有几天新鲜口味吃。女人还没给美国名厂纺织的沙⻥皮耀花眼睛，所以剥下的鳄⻥皮已经够使她喜欢的了。只恨那大蛇不是从中国古书里爬出来的，⻣节里没有明珠。幸而那猛兽也不是从中国古书出来的，否则女人吃了狮子心和大虫胆，在妖媚之外又添上凶悍，男人的日子就 不好过啦!不过，他们也没多少日子好过了。</p><p>上帝看⻅他们因祸得福，又羞又恨。他了解要跟人为难，必须造些无皮可剥，无肉可吃的东⻄。于是皮毯子，皮大氅以及家畜身 上的毛里忽然有了虫。晚上满空都是毒蚊子。两人吃东⻄时，苍蝇象大点下投的黑雨。 还有无孔不入，无法防御的微生虫。不出上帝所料，两人同时病倒，不多时，都吐口气死了，实现了一切情人“同年同月同日死”的盟誓。苍蝇还不放松地工作着，更一会儿， 两人尸骸上有了又肥又白的蛆。吃牛，羊，猪甚至老⻁和狮子肉的人，给那些小东⻄吃得剩些残⻣。</p><p>上帝造这些虫豸，注视着它们工作的精密和效率的迅速，十分快意，看出了神，忘掉原不要这一对男女死，只要他们吃苦后来向自己屈服，自己还要留着他们的。到蛆虫吃完人肉，要钻吸⻣髓时，他才醒悟，懊悔已来不及。不知是微生虫做事太神速呢，还是男女俩⻅事太晚，至少上帝没有得到他们悔罪的表示。他造了东⻄来实现自己的计划，象人，象猛兽，象微生虫，结果何以总不是他最初愿望的一回事呢?上帝 恨着–睁开眼来，只看⻅下午的太阳无力地懒在山头。适才的事，原来是梦。自己主宰一切，要作就作，而梦境偏有治外法权，不受他管领，这也够可气了!但是，这梦安知不是预兆?造人来作伴的事，大可斟酌。自己是永生的，无边无底的岁月孤独一个怎 样度呢?上帝伸着懒腰，对这死气沉沉的落日，生意已尽的世界，⻓⻓地打个厌倦的呵 欠，张大了嘴，好象要一口吞却那无穷无尽，难消遣的光阴。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;​	那时侯，我们的世界已经给科学家、哲学家和政治家训练得服服贴贴，沿着创化论、进化论、层化论、优生学、新生运动的规律、日新月进。今天淘汰了昨天的生活方式，下午提高了上午的文化程度。生活和文明瞬息万变，变化多得历史不胜载，快到预言不及说。&lt;/p&gt;</summary>
    
    
    
    <category term="必要的记录" scheme="https://trevoewu.github.io/categories/%E5%BF%85%E8%A6%81%E7%9A%84%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="留档，散文" scheme="https://trevoewu.github.io/tags/%E7%95%99%E6%A1%A3%EF%BC%8C%E6%95%A3%E6%96%87/"/>
    
  </entry>
  
  <entry>
    <title>被小孩累死</title>
    <link href="https://trevoewu.github.io/2024/01/01/2024-1-1/"/>
    <id>https://trevoewu.github.io/2024/01/01/2024-1-1/</id>
    <published>2024-01-01T13:59:11.000Z</published>
    <updated>2024-01-01T14:28:07.170Z</updated>
    
    <content type="html"><![CDATA[<p>​元旦家里来了小孩，感觉就像来个了小祖宗啊。服了，爸爸妈妈叫我陪他玩。我拿出我的switch，想看他玩塞尔达。因为看新人玩塞尔达真的很有趣，结果他没有一点兴趣。</p><p>​便问我想玩手机了。我的老旧iPhone se也没法玩。结果自己去把我的平板找到了，也不是不给他玩，我是真的忘了我还有平板了。到手就下载和平精英，便问他还玩什么什么游戏，他说“就玩这个，这个游戏这么好玩干嘛要玩其他的游戏。”有点被震惊了，他要是玩什么蛋仔派对，王者荣耀什么的，我还能勉强陪他玩玩，这游戏我是真没一点兴趣了。看他在游戏里和我炫耀自己的白龙马，还可以敲锣打鼓什么的。感觉这游戏以及和吃鸡没什么关系了啊，花里胡哨的。</p><p>​还是想带他玩点真正的游戏的，可惜我的switch里面没什么派对游戏，落泪了，没有朋友一起玩的我。找到了之前星之卡比的demo，以前玩了一会，老是说我玩得很开心，结果其中一个小孩说这个游戏好无聊，一直在问什么时候结束，他要去玩和平精英了。哎～，不行我得找个好玩的给他。就去淘宝租了一个账号，想着一起玩马里奥赛车。结果加速器死活连不上，这个点了了游戏还没下载玩。好心疼我的钱啊。</p><p>​好累不想陪小孩了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​	元旦家里来了小孩，感觉就像来个了小祖宗啊。服了，爸爸妈妈叫我陪他玩。我拿出我的switch，想看他玩塞尔达。因为看新人玩塞尔达真的很有趣，结果他没有一点兴趣。&lt;/p&gt;
&lt;p&gt;​	便问我想玩手机了。我的老旧iPhone se也没法玩。结果自己去把我的平板找到了，也不是不给</summary>
      
    
    
    
    <category term="日记" scheme="https://trevoewu.github.io/categories/%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="日记" scheme="https://trevoewu.github.io/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>2023年度总结</title>
    <link href="https://trevoewu.github.io/2023/12/31/2023%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/"/>
    <id>https://trevoewu.github.io/2023/12/31/2023%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/</id>
    <published>2023-12-31T14:48:03.000Z</published>
    <updated>2024-01-01T15:02:20.553Z</updated>
    
    <content type="html"><![CDATA[<p>​</p><h2 id="开始阅读英语原著：">开始阅读英语原著：</h2><p>​现在回过头来看，真的很神奇。一开始我甚至是连神奇树屋都看不懂的。那些简单的单词，组成的句子我竟然看不懂。以前只记得每个单词的意思，做题的话在脑海里翻译成中文就能做了。现在看书上这些口语话的表达这招就不管用了，真的是单纯认识却不知道意思了，更何况这些句子都是一些简单句，也不存在语法障碍。看来是真的缺少native那种儿童口语化英语英文输入了。</p><p>​后来慢慢的也适应了，陆陆续续看了十几本神奇树屋，虽说是给小孩子看的，但内容还算有趣，更何况领会到了很多简单的单词组合在一起所传达的意思我开始能够体会了，也能去想象这些动作的发生。后来又读了the Magic finger 很薄一本，不到一百页，还有插画，读起来非常轻松。极大的给我了自信，便去挑战<em>查理与巧克力工厂</em>了，给了我很大的打击，好多生词啊。不过最终还是慢慢读完了。没啥感觉的书，可能因为大部分我还不是很理解吧。</p><img src="847FEE8E-87B5-4122-8730-9369C87C4A7D.jpeg" alt="847FEE8E-87B5-4122-8730-9369C87C4A7D" style="zoom:20%;" loading="lazy"><p>从<em>神奇树屋</em>系列到<em>The giver</em></p><p>最喜欢的是</p><ul><li>number the star,</li></ul><p>​坐船逃走的那一夜真的看得自己好紧张，作者文字好优美，没什么很难得单词却能让人身临其境。</p><ul><li><p>the giver,</p><p>第一部读的反乌托邦小说，很好读。作者选词真的很完美啊，用release来代替杀人，strring形容爱情。要不是作者说这个世界没有颜色，我都完全没注意到。虽然是一本反乌托邦小说，但我感觉里面的世界真的蛮好的，人们都很幸福。</p></li><li><p>夏洛特的网。</p><p>夏洛特去世那一段真的有点感动到我了，自然的衰老死亡，却让人感到悲凉。</p></li><li><p>绘本:Circle</p><p>好羡慕那些小孩子能看到这么有趣的绘本，要是我小时候也有绘本看就好了。</p><p>If you close your eyes, what shape do you picture?</p><p>好喜欢这句话。</p><p><img src="image-20231231225932067.png" alt="image-20231231225932067" loading="lazy"></p></li></ul><h2 id="去长白山旅游——第一次教训">去长白山旅游——第一次教训</h2><ul><li>没能看到天池</li><li>车被擦了，赔了好多钱。</li><li>最破费的一次，再也不想旅游了呜呜呜呜</li><li>不过也算是难忘的记忆</li></ul><h2 id="Her">Her</h2><ul><li>朋友 or 暗恋对象<ul><li>时而发疯的喜欢她，时而平淡？我不知道如何形容这种感情。</li></ul></li><li>有时候和她聊天有一种恋爱的感觉，好幸福</li><li>关于她的梦终于美好起来了，以前的梦感觉自己像个loser…</li><li>Confess  love ?<ul><li>有时非常想告诉她，不过以我对自己的认知来说，我是不可能告白的</li></ul></li><li>她的JK照真的很好看！不过平时的化妆风格我是有点欣赏不来了，感觉眼影画得太浓了，有一点吓人。还是喜欢画得自然一点的她。</li><li>鼓起勇气送了她圣诞礼物，她不收的话我真的会伤心的。因为生日礼物我感觉自己好敷衍哈哈哈</li></ul><p>​恋爱，有时候还是很向往的的啊，不过就这样吧，大部分时间还是觉得一个人蛮好的。有时候聊聊天也有在恋爱的感觉。</p><h2 id="Animation">Animation</h2><p>今年真的好多好看的番剧啊</p><p>第一次体会到最原创番的乐趣，是<strong>MyGo It’s my dream!!!</strong>  求求你再让我看一集MyGO吧，我什么都会做的。</p><p>笑的最开心的番剧：<strong>别当欧尼酱</strong>。要觉醒femboy了</p><p>最舒适的感看体验：<strong>葬送的芙莉莲</strong> ，看着真的好舒服，和相合之物一样，那种平静的生活气息。看着身心都放松了。</p><p>个人最佳op：<strong>innocent arrogance</strong></p><p>最佳ED：<strong>Anytime Anywhere</strong> 葬送的芙莉莲的ed，不过勇者现在听来也蛮好听的，越听越顺耳了。第一次听真的感觉很这个番很不搭，不如无职转身的spiral。无职转生也好可惜，第一季是真的好看，第二季真的感觉差了好多。作为爱丽丝和</p><h2 id="考研">考研</h2><p>​没复习完，还是我开始得太晚了。听信了网上说暑假开始准备考研完全来得急，没想到11408内容这么多啊啊啊啊。二战，会怎么样呢？ 为自己担忧啊。到家置办了好多东西，想着要在家学习，买了手冲咖啡套装，买了自己喜欢的图书馆的那种桌子花了700，想着要去楼平弄烧烤吃花了露营座椅套装花了150，要猫猫买了各种猫猫用品又花了很多钱，2000块没了，真的感觉自己花钱好吓人。不敢找父母要钱了，受制于人好难受。</p><p>​如果今年依旧考不上的话，自己真的会接受吗？好难啊，虽说父母一直说没关系，考不上也没事。但走了了考研这条路，事到如今再去找工作真的不好办了啊，自己已经好久没有敲过代码了。真的很想继续读书，感觉自己是个废物一样，只有知识能让我安心了。</p>]]></content>
    
    
    <summary type="html">读英文原著，再也不想去旅游了，relationship？看番看番，考研。</summary>
    
    
    
    <category term="必要的记录" scheme="https://trevoewu.github.io/categories/%E5%BF%85%E8%A6%81%E7%9A%84%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="跨年" scheme="https://trevoewu.github.io/tags/%E8%B7%A8%E5%B9%B4/"/>
    
    <category term="2023" scheme="https://trevoewu.github.io/tags/2023/"/>
    
    <category term="new year，考研" scheme="https://trevoewu.github.io/tags/new-year%EF%BC%8C%E8%80%83%E7%A0%94/"/>
    
    <category term="英文学习" scheme="https://trevoewu.github.io/tags/%E8%8B%B1%E6%96%87%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>回到过去，我会对自己说</title>
    <link href="https://trevoewu.github.io/2023/11/09/%E7%BB%99%E5%AD%A6%E5%BC%9F%E5%AD%A6%E5%A6%B9%E4%BB%AC%E7%9A%84%E5%BB%BA%E8%AE%AE/"/>
    <id>https://trevoewu.github.io/2023/11/09/%E7%BB%99%E5%AD%A6%E5%BC%9F%E5%AD%A6%E5%A6%B9%E4%BB%AC%E7%9A%84%E5%BB%BA%E8%AE%AE/</id>
    <published>2023-11-09T04:07:08.000Z</published>
    <updated>2023-11-09T10:59:14.758Z</updated>
    
    <content type="html"><![CDATA[<p>这是很难想象的事，大学生活就这么快结束了。这篇文章本来是学校要求写的给学弟学妹的建议，但对这样一个没什么并不成功的我来说，我想我是没什么资格建议的。</p><h2 id="回到大一，现在的我又会对自己说什么呢？">回到大一，现在的我又会对自己说什么呢？</h2><p>我起初想告诉自己：你要去学会“翻墙”学会在广阔的互联网中学习知识，掌握一门计算机语言，坚持英语学习。你要学会使用vscode，vim，markdown，docker，git，terminal。学会租一个服务器，买一个域名，在github上搭建自己的仓库，建立自己的博客。你要好好学高等数学，现代代数，概率论，离散数学，计算机网络，数据结构，操作系统，编译原理，计算机组成原理这些课程。</p><p>我常常怪自己，怪自己为什么没有早点学会这些技能，了解这些课程的重要性。以至于让自己在无意义的洪流中忙忙碌碌，却收获甚微。上个月，南京大学的jyy在b站上传了一个课程的录播。是讲给江苏ioer看的。视频中jyy告诉同学们为什么竞赛的电脑系统全部变成了linux系统，教他们基本的linux命令，使用技巧，配置编程环境。看着这个视频，我心生羡慕，羡慕他们能这么早接触到Linux，羡慕他们能有像jyy这样的老师告诉他们，你们不要仅仅依赖window的图像界面，哪些ide强大的功能其实也是这样一些基本像gnu这样的小程序组成的。</p><p>大一的自己还在笨拙的使用codeblock这样的古老ide，还在CSDN，Baidu这样的垃圾堆里啃食，对一个两重for循环挠破头，面对冒泡排序始终没有头绪。即使这样，但我也不会苛责自己，不会要求自己一定要怎么样。因为我知道，那时候的我刚从高中毕业，沉没在高中应试教育的泥潭中，对这个世界的一切一无所知。没有人告诉我，你应该去做什么，你应该学会哪些工具。大学，对我来说是一个未知的地方，一个用高中三年苦行僧似的生活所换来的入场券。刚踏入这个未知的领域的我，对大学生活充满希望，向往着一切的美好。我去参加了社团，参加了大学的辩论队。积极的结交朋友，幻想着”大学出道“。保有高中好学生的心态，参加早操，不缺席每一堂课，就这样的不停息的转动着。</p><p>我不会责怪自己，因为我知道，在这样的环境下，我已经足够努力了。我不会要求那时候的自己去掌握那些工具，如果真有希望那时候的自己能知道的，我想告诉自己的是：<strong>不要放弃学习英语，去买台Mac，学会逃课</strong>。</p><h2 id="大一大二两年，放弃了自己高中一直背单词的习惯，是我目前唯一遗憾的事">大一大二两年，放弃了自己高中一直背单词的习惯，是我目前唯一遗憾的事</h2><p>那时候的我不知道，英语，对我去打开了解世界的窗，在优质且丰富的网络资源中学习是多么有用的能力。这也是一个遗憾，一个作为中文母语者的遗憾。在互联网上，优质的中文资源实在太少，简体中文互联网并不是没有优质资源，而是像一个朋友圈一样，我们无法通过搜索引擎检索到这些优质内容，导致Baidu内容充斥着广告和垃圾信息。一两年前，我刚学会使用GitHub的时候，看到一位程序员在自己的项目中的readme文档中，写到：希望大家都去写中文的readme文档，一起建立良好的中文编程环境。这真的是一个悲哀，中文在互联网的占比真的太小了。在一个统计报告中，中文内容的占比只有百分之一点几，虽然不会觉得会有英语那样统治级的地位，但中国十三亿人口，十亿网民输出到互联网的中文内容竟然只有百分之一，这比不过日语，俄语，法语也就算了，竟被越南语给超过了。来到AIGC的时代，这一痛点带来的影响似乎开始显露。互联网中文内容的低质量和缺少，导致AI模型训练数据的低质量和缺少。而AI训练，恰好是急需要优质的训练数据，不然就是垃圾进垃圾出了。算力资源被锁死，中文内容稀缺且低质量，在下一个AI时代，中国会走到哪里不经让人担心起来。</p><h2 id="去买Mac，这是一个危险的建议">去买Mac，这是一个危险的建议</h2><p>互联网上的所有数码up主，所有评论都不会推荐你去买Mac，他们甚至会嘲笑，贬低。你会看到Mac跑不了C4D，跑不了工业软件，没有生产力，Mac能做到事windows也能做，而windows能做到事mac却不都能做，加之使用mac也基本上告别了游戏。知名百万粉丝数码up主“笔吧评测室”也会举例说：如果老师钉钉上发给你某个古老的软件，要用这个软件做实验，Mac就只能干瞪眼了。且周围都是使用windows的同学，老师不会为了专门去照顾使用Mac的同学教你如何在Mac上找到替代品。</p><p>他们说的都是真的，我也必须承认，但我始终推荐每一个计算机的学生，买Mac。国内cs教学Mac不友好是真的，不过问题应该是为什么学校要使用那些古老的32位windows软件教学呢？这些大多数软件已经不更新了，或者是有更新更好的替代产品。MIT有一个非常著名的课程，叫The Missing Semester of Your CS Education。就是教学生使用工具的，这是我国本科教育所欠缺的，我们从来没有一门课去教学生去使用Linux command进行信息处理，vim（这个有争议，但是我觉得还很有用的）编辑文档，markdown编写readme，git（非常重要，cs人必须掌握）这样的工具。课程网站上提到一个观点：学会使用工具比学会知识更重要。上面这些工具，在Mac（类unix）或者说linux这样的电脑上才有，或者是使用体验更好的。能做和做好区别很大。相较于中国，国外学校的对mac的使用环境更好，不仅老师会使用mac上课，实验指导书也会为使用mac的同学提供环境配置指导。</p><p>这些也给我使用mac带来了很多困难，学习计算机网络的时候，老师发给我们的软件是一个华为的包追踪实验模拟器。mac并没有这个软件。这就必须去找一个替代品，且老师教授软件的使用也是基于这个软件的，你就不得不去寻找替代软件的使用方法。不过搜索后，你很快就会发现，有个叫Cisco Packet Tracer的软件功能完全一样，且在网上能找到大量的教程。你不仅找到了替代品，还锻炼了自己网络信息检索的能力，主动学习的能力，也了解到计算机网络领域，有华为，思科这样的科技公司。学习oracle数据库的时候，mac平台甚至都没有这个数据库软件，也没法说找mysql，mongodb这样做替代品。我为在mac上如何配置oracle花了大量的功夫，想了很多办法，为此我还特地写了篇博客介绍了这些方法，希望对其他的mac学生有所帮助。在这个过程中，我学会了使用ssh连接到室友的电脑，使用他电脑安装的oracle软件，不仅可以一起做项目，也完全不用我安装任何其他软件。学会了在Azure租一台服务器，开一个虚拟机，在虚拟机里安装oracle环境，通过ssh连接到虚拟机，远程使用oracle。使用ssh的私钥和公钥来进行端点鉴别，加深了我对计算机网络的理解。也了解到像docker这样神奇的软件，用docker安装oracle镜像，不过那时候docker还没有oracle的基于M1的Mac镜像。</p><h2 id="Mac究竟带了什么呢？">Mac究竟带了什么呢？</h2><p>Mac带来了的是一个类linux环境，让你不再为配置编程环境烦恼。我记得大二的我使用Windows给vscode配置C语言环境的痛苦，我配置了整整一个星期，最后虽然配置好了，但中途也会出现各种bug。这对一个刚跨入计算机领域的学生来说，是一个极大的折磨。mac带来了脱离鼠标的体验，轻薄和可以让你使用一整天的续航。这些带给你的，是你可以随心所欲的带出门，不用特地携带鼠标和鼠标垫，不用带适配器充电，安安静静地运行，不会打扰到任何人。我们学校有一点我觉得做得非常好，会白天断电。鼓励学生们走出寝室。走出寝室，去自习室，去图书馆，去咖啡厅带来的学习效率的提升和在寝室是完全不一样的。寝室并不是一个适合学习的地方。但对于使用windows笔记本的同学来说，把笔记本带出门就变的十分痛苦了。特别是使用游戏本的人来说，你想着你要带充电器，带鼠标和鼠标垫（这个也可以不带），还要考虑去的地方有没有插座供电，可能就不愿意带电脑出门了。对计算机专业的学生来说，没带电脑很多东西都做不了，一想到这些，最终你就不想出寝室了，觉得在寝室也能学。恰好我们学校图书馆教室都是不提供插座供电的（严格的来说有，不过一间教室往往只有头尾有两个，很明显是不够的）。</p><h2 id="大学究竟给我带来了什么呢？或者是大学给我提供了什么？">大学究竟给我带来了什么呢？或者是大学给我提供了什么？</h2><p>我时常痛恨我国的大学教育，特别是本科教育，大学这四年，我并没有感受到大学对我的指导性帮助，反而给我带来了很多障碍和误导。这和我高中对大学的憧憬带来了恐怖的落差，时常觉得，我高中拼搏的三年，究竟值得吗？某国内AI巨头创始人在上海交通大学本科毕业时，对学弟学妹们对一封建议书中说“我国的本科教育不是濒临崩溃，而是已经崩溃”。虽然有些夸张，但也反映我国本科教育的存在的很多问题。这些不仅是本科教育存在的问题，也是我国教育系统存在的问题。b站上宋浩老师的高等数学课程截至目前已经获得了1.2亿的播放量，大家都调侃是宋浩拯救了我的高等数学。（不过我不得不说，教授我高等数学的吴海燕老师是我认为大学教学最好的老师，甚至整个数学系的老师，包括教我线性代数和离散数学的老师教课都非常好。但我教授我计算机相关专业的课程的老师每一个都让我失望）。</p><p>大多数为本科教学质量差的辩护都是认为大学不仅是教育机构，更是承担着科研任务。教授考核指标也不是你的教学质量，而是你论文发了多少，影响因子多少。这些才是大学教授最关心的，所以大多数老师对教学只看作工作，这也不外乎大多数的老师拿着十几年前教材提供的ppt照本宣科。当然，这并不是我国存在的问题，全世界的大学都有这样的问题，给教工和教授的经费严重不平衡。上了大学真的很少看见有老师有着对教学的热情。让我时常不感激我的中小学老师，他们是真的热爱教书，真的是希望学生能取得更好的未来。一开始我也认为这样确实是这样的原因，但最近看到一位多伦多大学的数学博士这样认为，“研究和教学并不冲突。教授学生知识是一个自利利他的行为，不仅是传递知识，更是提升自己对知识结构的掌握。教学的最大受益人永远是老师自己。且诸多你能在定理中看见他的名字的数学家，比如欧拉，都是著名的教育家，教出过很好的学生。”</p><p>老师不愿意认真对待教学，学校的实验实践也完全随意设置。不仅没考虑学生的学习进度，学习进度和实验进度不匹配。也不考虑实际的学生能力，不管什么计算机课都要来一个全栈系统，oracle要做一个图书管理系统，要有前端有后端。web要做一个学生管理系统也要有前端有后端，java有，c#有，mysql有，实践课有，实验课有。实验指导书不能叫做实验指导书，完全没用指导意义。多数实验只给出一个实验要求。学生拿到实验报告不知道怎么做，最终也只能去网上copy一份。我们学数据库就应该操心数据库的东西，学前端就应该去设计前端的网站，利用已经编写好的后端接口，而不用去担心后端CRUD代码的编写。这不仅是真正锻炼了学生，也是实际的工作中的流程。我当然不是认为试着做一个全栈系统不好，恰恰相反，我认为你去真真正正独立完成一个全栈系统的搭建，学到的东西是非常多，且非常值得的。但这样的内容应该放在一个单独的设计实践中去，并给同学们大量的时间。似乎老师不知道独立做一个全栈系统所耗费的时间，不在于难，而在于多。需要大量的时间投入，往往是一个月的投入才能做好一个全栈系统。相比之下，我自学的Computer Networking: a Top-Down Approach课程的实验就非常详尽，实验指导书详细指导了你应该怎样编写代码，所有的函数都是书上讲过的。在编写传输层的代码时，我不需要去实现整个五层架构的代码，只需要认真编写传输层的代码。应用层和其下的网络层代码已经实现，我们只需要拿到应用层的PDU，做传输层应该做的任务，打包成一个对应的的SDU。交给其下的网络层就可以了，只要我把缺失的代码编写好，整个系统就可以完美的跑起来。不仅如此，实验提供的代码还有完备的readme文档，方便的debug信息，你可能遇到的问题都会有一一解答，可以说，你只要认真的学会了本章的内容，就可以完成实验，做完了这个实验，你才会感叹计算机网络五层架构的设计意义。</p><h2 id="另一个本科教育的问题，是我国优质教材的缺失">另一个本科教育的问题，是我国优质教材的缺失</h2><p>大家抨击的比较多的教材是复旦大学的线性代数教材，从行列式讲起，导致学生学完了线性代数都不知道这个科目是干什么呢，为什么要学。只会算行列式，矩阵。考试也只考这些。（我校的线性代数教材是自编教材，更差，删掉了很多内容，完全就是一本应付考试的书）。这些我也深有体会，线性代数的重要性不言而喻。我们的世界是连续的，很多计算机领域，工程领域的问题本质上都是线性代数的问题。国外最有名的线性代数教材是Gilbert Strang编写的《Introduction to Linear Algebra》这位教授同时也在MIT教授这门课，讲得非常有感染力且激情，这门课也被誉为线性代数的经典。CMU的镇校之课CS15-213，是一门教授学生计算机基础的课程，设计汇编语言、体系结构、操作系统、编译链接、并行、网络等，作为系统入门课，兼具深度和广度。同时这个课程也带来了《Introduction to Computer System》，国内翻译版本《深入理解计算机系统》，这本经典的教材。但这本书并不是一开始就有的，而是在教授的过程中，老师不断完善讲义，最终出版的一本教材。所以我国优秀教材的缺失，和本科教学质量的低下本质上是一个原因。好的教材是在教学过程中产生的，而不一蹴而就的。正是老师不愿意去认真对待教学，导致了优秀教材的缺失。优秀教材的缺失有反过来导致其他老师没有一本指导性教学教材而很难去进行教学。</p><h2 id="我时常希望能有一个纯粹的时间，一个不被打扰的时间，供我学习">我时常希望能有一个纯粹的时间，一个不被打扰的时间，供我学习</h2><p>我并不是苛求所有课程，学校的活动都必须有意义，而没用意义的活动则必须是能够自我满足的，带来愉悦的。只会带来痛苦的活动，毫无意义，完全没有价值去做。我不知道出早操的价值在哪里，不知道军训站军姿的价值在哪里，我不知道去听讲座的意义在哪里。它既不会让我开心，也不会教会我什么。吃苦是福，但并不是什么苦都要吃的。也许这些活动的唯一意义不是之于学生，而是之于学校。</p><p>学校形式主义的泛滥，并不是大学才有的，他贯穿我的整个学习生涯。但确实在大学最泛滥的，中小学主要还是以学习为目的。我的朋友圈变成了青年大学习的垃圾站，要是这些所谓的大学习真能学到点什么有意义的东西，我还是很肯定他的正面意义的。大学生真的还需要学习太多的东西，很多大学没有教授的内容确实需要让学生们了解。明明可以去填补这一份空白，我相信学生至少是我，也愿意看。不然，也不至于变成青年大截图。</p><p>这学期学校开设了一门叫计算机导论的课，起初看到这个课我非常的开心。觉得学校终于知道需要一门导论课来让学生对整个计算机领域有个大概的了解，虽然这门课应该大一或者大二开设。结果我开开心心的去上课后听到的却是老师在讲什么爱情啊，事业啊什么的。就这些内容，甚至还要写一份报告。这样，学生就算修完了计算机导论课。哇，我真的，非常生气。</p><p>这样的案列，真的太多了，各种意义不明的报告，不仅没用，也没人去详细告诉你，报告要怎么写，给个报告模版，要的就只是有一个报告而已，至于报告了什么，没人在乎。写到这里，我真的非常生气，为什么我们的教育变成了这样了。</p><p>我希望有个理想中的大学圣殿，我对我的大学极度的不满意。我选择了考研，寄希望于研究生教育能有什么改变。一个普通人，应该也有获得优质教育的机会，至少是一个优质的环境让我自己学习。</p>]]></content>
    
    
    <summary type="html">我起初想告诉自己：你要去学会“翻墙”学会在广阔的互联网中学习知识，掌握一门计算机语言，坚持英语学习。你要学会使用vscode，vim，markdown，docker，git，terminal。学会租一个服务器，买一个域名，在github上搭建自己的仓库，建立自己的博客。你要好好学高等数学，现代代数，概率论，离散数学，计算机网络，数据结构，操作系统，编译原理，计算机组成原理这些课程。</summary>
    
    
    
    <category term="杂谈" scheme="https://trevoewu.github.io/categories/%E6%9D%82%E8%B0%88/"/>
    
    
    <category term="建议" scheme="https://trevoewu.github.io/tags/%E5%BB%BA%E8%AE%AE/"/>
    
  </entry>
  
  <entry>
    <title>📔iDictionary</title>
    <link href="https://trevoewu.github.io/2023/10/10/iDictionary/"/>
    <id>https://trevoewu.github.io/2023/10/10/iDictionary/</id>
    <published>2023-10-10T13:14:49.000Z</published>
    <updated>2023-10-11T05:10:06.878Z</updated>
    
    <content type="html"><![CDATA[<p>📔</p><h2 id="Upset">Upset</h2><h3 id="Upset-n">Upset n.</h3><ol><li><strong>an unhappy and worried mental stateup😭</strong><br>she didn’t realize the upset she caused me</li></ol><p><em>synonymous</em>： <strong>disturbance</strong>, <strong>perturbation</strong></p><ol start="2"><li>==the act of <strong>disturbing</strong> the mind or body==<br>his carelessness could have caused an ecological upset</li></ol><p><em>synonymous</em>： <strong>derangement</strong>, <strong>overthrow</strong></p><p><img src="data:image/png;base64,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" alt="Ecological catastrophe sad man for internet Vector Image" loading="lazy"></p><ol start="3"><li><strong>condition in which there is a disturbance of normal functioning</strong><br>everyone gets stomach upsets from time to time</li></ol><p><img src="data:image/png;base64,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" alt="How to Calm Nervous &amp; Upset Stomach When Anxious" loading="lazy"></p><p><em>synonymous</em>： disorder</p><ol start="4"><li><p>a tool used to thicken or spread metal (the end of a bar or a rivet etc.) by <strong>forging</strong> or <strong>hammering</strong> or <strong>swaging</strong></p><img src="5c5e80be6839dfa92a7391ed0f182e1d_z.jpg" alt="Upset Stretching Device - Standard/Profi 70 mm - Complete Device incl. Upset+Stretching  Tool" style="zoom:25%;" loading="lazy"></li></ol><p><em>synonymous</em>： swage</p><ol start="5"><li><strong>the act of upsetting something</strong><br>he was badly bruised by the upset of his sled at a high speed</li></ol><p><em>synonymous</em>： overturn, turnover</p><p><img src="data:image/jpeg;base64,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" alt="The anti-abortion SLED argument is no Rosebud" loading="lazy"></p><ol start="6"><li><strong>an improbable and unexpected victory</strong><br>the biggest upset since David beat Goliath</li></ol><p><em>synonymous</em>： overturn</p><p><img src="data:image/jpeg;base64,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" alt="David and Goliath" loading="lazy"></p><h3 id="upset-v">upset v.</h3><ol><li><p><strong>disturb the balance or stability of</strong><br>The <strong>hostile</strong> talks upset the peaceful relations between the two countries</p></li><li><p><strong>cause to lose one’s composure</strong></p></li></ol><p><em>synonymous</em>： discompose, untune, disconcert, discomfit</p><ol start="3"><li><strong>move deeply[深深的打动]</strong><br>This book upset me</li></ol><p><em>synonymous</em>： disturb, trouble</p><ol start="4"><li><p><strong>cause to overturn from an upright or normal position</strong></p><img src="image-20231010214409000.png" alt="image-20231010214409000" style="zoom:25%;" loading="lazy"></li></ol><p><em>synonymous</em>： overturn, tip over, turn over, knock over, bowl over, tump over</p><ol start="5"><li><strong>defeat suddenly and unexpectedly</strong><br>The foreign team upset the local team</li></ol><h3 id="upset-adj">upset adj.</h3><ol><li><strong>afflicted with or marked by anxious uneasiness or trouble or grief</strong><br>too upset to say anything</li></ol><p><em>synonymous</em>： disquieted, distressed, disturbed, worried</p><ol start="2"><li><strong>thrown into a state of disarray or confusion</strong><br>with everything so upset</li></ol><p><em>synonymous</em>： broken, confused, disordered</p><ol start="3"><li><strong>used of an unexpected defeat of a team favored to win</strong><br>the Bills’ upset victory over the Houston Oilers</li></ol><ul><li><p><strong>mildly physically distressed</strong><br>an upset stomach</p></li><li><p><strong>having been turned so that the bottom is no longer the bottom</strong><br>the upset pitcher of milk</p></li></ul><p><img src="images-20231011125107384.jpeg" alt="Never Give Up Hope Concept Stock Photo - Download Image Now - Upside Down,  Flower Pot, Accidents and Disasters - iStock" loading="lazy"></p><p><em>synonymous</em>： overturned, upturned</p><h2 id="Justice">Justice</h2><img src="11-justice.png" alt="Justice Tarot Card Meanings | Biddy Tarot" style="zoom:25%;" loading="lazy"><h3 id="justice-n">justice n.</h3><ol><li><strong>the quality of being just or fair</strong></li></ol><p>synonymous： justness</p><ol start="2"><li><strong>the administration of law; the act of determining rights and assigning rewards or punishments</strong><br>justice <strong>deferred</strong> is justice denied</li></ol><p>synonymous： judicature</p><ol start="3"><li><strong>a public official authorized to decide questions brought before a court of justice</strong></li></ol><p>synonymous： judge, jurist, magistrate</p><h2 id="Ethical">Ethical</h2><h3 id="ethical-adj">ethical adj.</h3><ol><li><strong>of or relating to the philosophical study of ethics</strong><br>==ethical codes==<br>==ethical theories==</li><li><strong>conforming to accepted standards of social or professional behavior</strong><br>an ethical lawyer<br>ethical medical practice<br>an ethical problem<br>had no ethical objection to drinking<br>Ours is a world of nuclear giants and ethical infants</li><li><strong>adhering to ethical and moral principles</strong><br>it seems ethical and right</li></ol><p>synonymous： honorable, honourable, moral</p><h2 id="Legitim-acy">Legitim-acy</h2><blockquote><p>词根&quot;legitim&quot;来自拉丁语&quot;legitimus&quot;，意为&quot;合法的&quot;或&quot;正当的&quot;。这个词根指示了legitimacy的基本含义，即合法性或合理性。</p><p>词缀&quot;-acy&quot;是一个名词后缀，用于将一个形容词转化为一个名词。</p></blockquote><ol><li><strong>合法性，合法地位</strong><br>近义词：validity, legality<br>反义词：illegitimacy<br>例句：</li></ol><ul><li>The government’s legitimacy was questioned after <strong>allegations</strong> of electoral <strong>fraud</strong>.</li><li>The court’s decision confirmed the legitimacy of the contract.</li></ul><h2 id="Con-duct">Con-duct</h2><blockquote><p>词根：conduct的词根是“con-”，它源自拉丁语中的“conducere”，意为“引导、带领”。这个词根表达了行为或过程中引导、带领的意义。</p><p>词源：conduct的词源可以追溯到拉丁语中的“conductus”，意为“引导、带领”。这个词源进一步来自拉丁语中的“conducere”，意为“带领、引导”，由“con-”（共同）和“ducere”（引导）组成。</p></blockquote><h3 id="conduct-n">conduct n.</h3><ol><li><p><strong>manner of acting or controlling yourself</strong></p><p>==The code of conduct== 行为准则</p></li></ol><p>synonymous： behavior, behaviour, doings</p><ol start="2"><li><strong>(behavioral attributes) the way a person behaves toward other people</strong></li></ol><p>synonymous： <strong>demeanor</strong>, behavior, <strong>deportment</strong></p><h3 id="conduct-v">conduct v.</h3><ol><li><strong>direct the course of; manage or control</strong><br>You cannot conduct business like this</li></ol><p>synonymous： carry on, deal</p><ol start="2"><li><strong>lead, as in the performance of a composition</strong><br>conduct an orchestra<br>Barenboim conducted the Chicago symphony for years</li></ol><p>synonymous： lead, direct</p><ol start="3"><li><strong>behave in a certain manner</strong><br>They conducted themselves well during these difficult times</li></ol><p>synonymous： behave, <strong>acquit</strong>, bear, <strong>deport</strong>, <strong>comport</strong>, carry</p><ol start="4"><li><strong>transmit or serve as the medium for transmission</strong><br>Many metals conduct heat<img src="Types-of-Heat-Transfer-1024x683-20231011104745952.png" alt="Types of Heat Transfer" style="zoom:45%;" loading="lazy"></li></ol><p>synonymous： transmit, convey, carry, channel</p><ol start="5"><li><strong>take somebody somewhere</strong><br>He conducted us to the palace</li></ol><p>synonymous： lead, take, direct, guide</p><ol start="6"><li><strong>lead musicians in the performance of</strong><br>Bernstein conducted Mahler like no other conductor<br>she cannot conduct modern pieces</li></ol><h2 id="Judic-iary">Judic-iary</h2><img src="organiazation-of-the-judiciary.jpg" alt="Organization Of The Judiciary - Political Science" style="zoom:45%;" loading="lazy"><blockquote><p>词根&quot;judic-“，来自拉丁语词根&quot;iudicium”，意为&quot;裁定、判决、判断&quot;。&quot;Judic-“作为一个词根，常在与法律、司法等领域的词汇中出现，例如&quot;judge”（法官）、“judgment”（判决、判断）等。</p><p>词缀&quot;-ary&quot;，表示&quot;与…有关的&quot;或&quot;某个领域的&quot;。在这个单词中，&quot;-ary&quot;表明&quot;judiciary&quot;是与司法系统相关的事物，是指法院、法官、法庭和其他司法机构的集合。</p></blockquote><ol><li>中文意思：司法（机构/部门）</li></ol><ul><li><p>近义词：法官团队</p></li><li><p>反义词：行政部门</p></li><li><p>例句：</p></li><li><p>The judiciary plays a vital role in <strong>upholding</strong> <strong>the rule of law.</strong></p></li><li><p>The appointment of judges is a <strong>crucial</strong> decision for the judiciary.（“法官团队”意义下的使用）</p></li></ul><h2 id="sub-ject">sub-ject</h2><blockquote><p>subject源自拉丁语的“subjectus”，意为“被置于下方的”。在拉丁语中，这个词形容一种被征服或被控制的状态。</p><ol><li><p>词根“sub-”表示“在下方”，次级的意思。在subject中，词根“sub-”表达了被置于或受控制的状态。</p></li><li><p>词缀“-ject”表示“投掷”或“放置”。在subject中，词缀“-ject”表示某人或某事被放置或安置在某种情况或条件之下。</p></li></ol></blockquote><h3 id="subject-n">subject n.</h3><ol><li><strong>the subject matter of a conversation or discussion</strong><br>he didn’t want to discuss that subject</li></ol><p>synonymous： topic, theme</p><ol start="2"><li><strong>a branch of knowledge</strong><br>teachers should be well trained in their subject</li></ol><p>synonymous： <strong>discipline</strong>, subject area, subject field, field, field of study, study, <strong>bailiwick</strong>, branch of knowledge</p><ol start="4"><li><strong>something (a person or object or scene) selected by an artist or photographer for graphic representation</strong><br>a moving picture of a train is more dramatic than a still picture of the same subject</li></ol><p>synonymous： content, depicted object</p><ol start="5"><li><strong>a person who is subjected to experimental or other observational procedures; someone who is an object of investigation</strong><br>the subjects for this investigation were selected randomly</li></ol><p>synonymous： case, <strong>guinea pig</strong></p><blockquote><p>guinea pig: 豚鼠：一种小型、矮胖、无尾巴的家养啮齿动物（Cavia porcellus），原产于南美洲，通常作为宠物饲养，并广泛用于生物研究。</p><img src="image-20231011101659564.png" alt="image-20231011101659564" style="zoom: 10%;" loading="lazy"></blockquote><ol start="6"><li><p><strong>a person who owes allegiance to that nation[臣民]</strong><br>a monarch has a duty to his subjects</p><img src="image-20231011101819551.png" alt="image-20231011101819551" style="zoom:35%;" loading="lazy"></li></ol><p>synonymous： national</p><ol start="7"><li>(<em>grammar</em>) one of the two main <strong>constituents</strong> of a sentence; the grammatical constituent about which something is <strong>predicated</strong></li><li>(logic) the first term of a proposition</li></ol><h3 id="subject-v">subject v.</h3><ol><li><strong>cause to experience or suffer or make liable or vulnerable to</strong><br>He subjected me to his awful poetry<br>The <strong>sergeant</strong> subjected the new recruits to many <strong>drills</strong><br>People in Chernobyl were subjected to radiation</li><li><strong>make accountable for</strong><br>He did not want to subject himself to the judgments of his superiors</li><li><strong>make subservient; force to submit or subdue</strong></li></ol><p>synonymous： <strong>subjugate</strong></p><ol start="4"><li><strong>refer for judgment or consideration</strong></li></ol><p>synonymous： submit</p><h3 id="subject-adj">subject adj.</h3><ol><li><strong>not exempt from tax</strong><br>the gift will ==be subject to== taxation</li><li><strong>possibly accepting or permitting</strong><br>the time is fixed by the director and players and therefore <strong>subject to much variation</strong></li></ol><p>synonymous： capable, open</p><ol start="3"><li><strong>being under the power or sovereignty of another or others</strong><br>subject peoples</li></ol><p>synonymous： dependent</p><ol start="4"><li><strong>likely to be affected by something (especially something unpleasant)</strong><br>the bond is subject to taxation<br>he is subject to <strong>fits</strong> of depression</li></ol><h2 id="Envision">Envision</h2><h3 id="envision-v">envision v.</h3><ol><li><strong>imagine; conceive of; see in one’s mind</strong></li></ol><p>synonymous： visualize, visualise, project, fancy, see, figure, picture, image</p><ol start="2"><li><strong>picture to oneself; imagine possible</strong><br>I cannot envision him as President</li></ol><p>synonymous： foresee</p><h2 id="Cultivate">Cultivate</h2><img src="Cultivate.jpg" alt="Cultivate.jpg" style="zoom:50%;" loading="lazy"><p>cultivate | ˈkʌltɪveɪt | verb <em>[with object]</em></p><ol><li><p><strong>prepare and use (land) for crops or gardening:</strong></p><p><em>the peasants who cultivated the land became its owners</em>.</p><p>• <strong>break up (soil) in preparation for sowing or planting</strong>:</p><p>(as adjective, with submodifier cultivated) : <em>damp, well-cultivated soil</em>.</p><p><strong>• raise or grow (plants), especially on a large scale for commercial purposes:</strong></p><p><em>they were encouraged to cultivate basic food crops</em> |</p><p><em>walnuts were cultivated for salad oil</em>.</p><p><strong>• <em>Biology</em> grow or maintain (living cells or tissue) in culture</strong></p><p>: <em>blood cells that can be most easily cultivated are macrophages</em>.</p></li><li><p><strong>try to acquire or develop (a quality or skill)</strong></p></li></ol><p>: <em>he cultivated <strong>an air of indifference</strong></em>.</p><p><strong>• try to win the friendship or favour of (someone):</strong></p><pre><code>*it helps if you go out of your way to cultivate the local people*.**• try to improve or develop (one's mind).**</code></pre><h2 id="Ideology">Ideology</h2><p><img src="Destutt_de_Tracy.jpg" alt="undefined" loading="lazy"></p><p>An <strong>ideology</strong> is a set of <a href="https://en.wikipedia.org/wiki/Belief">beliefs</a> or philosophies attributed to a person or group of persons, especially those held for reasons that are not purely <a href="https://en.wikipedia.org/wiki/Epistemic">epistemic</a>, in which &quot;practical elements are as prominent as theoretical ones.&quot;Formerly applied primarily to <a href="https://en.wikipedia.org/wiki/Economy">economic</a>, <a href="https://en.wikipedia.org/wiki/Political_philosophy">political</a>, or <a href="https://en.wikipedia.org/wiki/Religion">religious</a> theories and policies, in a tradition going back to <a href="https://en.wikipedia.org/wiki/Karl_Marx">Karl Marx</a> and <a href="https://en.wikipedia.org/wiki/Friedrich_Engels">Friedrich Engels</a>, more recent use treats the term as mainly condemnatory</p><p>意识形态是归因于一个人或一群人的一套信仰或哲学，特别是那些出于非纯粹认识论的原因而持有的信仰或哲学， 其中“实践因素与理论因素一样突出”。 以前主要应用于经济，政治或宗教理论和政策，其传统可以追溯到卡尔马克思和弗里德里希恩格斯，<strong>最近的使用将这个词视为主要是谴责性的。</strong></p><p>The term was coined by <a href="https://en.wikipedia.org/wiki/Antoine_Destutt_de_Tracy">Antoine Destutt de Tracy</a>, a <a href="https://en.wikipedia.org/wiki/French_people">French</a> <a href="https://en.wikipedia.org/wiki/Age_of_Enlightenment">Enlightenment</a> <a href="https://en.wikipedia.org/wiki/Aristocracy_(class)">aristocrat</a> and <a href="https://en.wikipedia.org/wiki/Philosopher">philosopher</a>, who conceived it in 1796 as the “science of ideas” to develop a rational system of ideas to oppose the irrational impulses of the mob. In <a href="https://en.wikipedia.org/wiki/Political_science">political science</a>, the term is used in a <a href="https://en.wikipedia.org/wiki/Linguistic_description">descriptive</a> sense to refer to <a href="https://en.wikipedia.org/wiki/List_of_political_ideologies">political belief systems</a></p><p>这个词是由法国启蒙运动贵族和哲学家安托万·德斯图特·德·特雷西（Antoine Destutt de Tracy）创造的，他在1796年将其设想为“思想科学”，以发展一种理性的思想体系，以反对暴民的非理性冲动。在政治学中，该术语用于描述性意义，指代政治信仰体系。</p><h2 id="Bound">Bound</h2><h3 id="Examples">Examples</h3><ul><li><p><strong>The</strong> <strong>company</strong> <strong>is</strong> <strong>growing</strong> <strong>by</strong> ==leaps and bounds this year==.</p><p>今年公司==突飞猛进==<strong>.</strong></p></li><li><p><strong>Even</strong> <strong>though</strong> <strong>she</strong> <strong>was</strong> <strong>fully</strong> <strong>aware</strong> <strong>of</strong> <strong>the</strong> <strong>risks</strong>, <strong>Susan</strong> <strong>refused</strong> <strong>to</strong> <strong>take</strong> <strong>the</strong> <strong>necessary</strong> <strong>precautions</strong> <strong>to</strong> <strong>prevent</strong> <strong>the</strong> <strong>spread</strong> <strong>of</strong> <strong>a</strong> <strong>contagious</strong> <strong>disease</strong>, <strong>proving</strong> <strong>that</strong> ==selfishness knows no bound==</p><p>尽管苏珊充分意识到风险，但她拒绝采取必要的预防措施来防止传染病的传播，证明自私是无止境的</p></li></ul><h3 id="bound-v">bound v.</h3><ol><li><strong>to leap or spring forward with energy and enthusiasm, often with all four feet leaving the ground simultaneously</strong></li></ol><img src="original.jpeg" alt="to bound definition and meaning" style="zoom:33%;" loading="lazy"><p>synonyms : jump leap spring</p><ul><li><strong>place limits on (extent or amount or access)</strong></li></ul><img src="original-20231011121151323.jpeg" alt="to bound definition and meaning" style="zoom:33%;" loading="lazy"><p>synonyms : confine limit restrict <strong>throttle</strong> <strong>trammel</strong></p><ul><li><p><strong>form the boundary of; be contiguous to</strong></p><p>synonyms : border</p></li><li><p><strong>spring back; spring away from an impact</strong></p></li></ul><p>synonyms : bounce <strong>rebound</strong> <strong>recoil</strong> <strong>resile reverberate ricochet spring take a hop</strong></p><h3 id="bound-adj">bound adj.</h3><ul><li><strong>held with another element, substance or material in chemical or physical union</strong><br>confined by bonds<br>bound and gagged hostages</li></ul><p><img src="images.jpeg" alt="X 上的FullMetalPanicAttack：「Sango and Natalie (client's OC) have been  kidnapped! Commission for @Jayon36421958 https://t.co/nwQGtxvhLi  https://t.co/iykLCSVnGo」 / X" loading="lazy"></p><ul><li><strong>secured with a cover or binding; often used as a combining form</strong><br>bound volumes<br>leather-bound volumes</li></ul><img src="thumb_36794_Product_zoomed.jpeg" alt="Europe During the Middle Ages 3 Leather Bound Volumes - Books & Ephemera -  Hemswell Antique Centres" style="zoom:25%;" loading="lazy"><ul><li><strong>(usually followed by `to’) governed by fate</strong><br>bound to happen</li></ul><p>synonymous： destined</p><ul><li>covered or wrapped with a bandage<br>an injury bound in fresh gauze</li></ul><p><img src="images-20231011123753154.jpeg" alt="How Long do Bandages Last? | EFAS" loading="lazy"></p><p>synonymous： bandaged</p><ul><li>headed or intending to head in a certain direction; often used as a combining form as in `college-bound students’<br>children bound for school</li></ul><p><img src="images-20231011123945400.jpeg" alt="School-bound car rams into vehicle, six kids hurt | Kolkata News - Times of  India" loading="lazy"></p><p>synonymous： destined</p><ul><li><strong>bound by an oath</strong><br>a bound official<br>bound by contract</li></ul><p>synonymous： apprenticed, articled, indentured</p><ul><li>confined in the bowels<br>he is bound in the belly</li></ul><h3 id="bound-n">bound n.</h3><ul><li><strong>a line determining the limits of an area</strong></li></ul><p>synonymous： boundary, edge</p><p><img src="data:image/jpeg;base64,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" alt="Boundaries and Boundary Violations | Follow Your Heart Counseling" loading="lazy"></p><ul><li><strong>the greatest possible degree of something</strong><br>what he did was beyond the bounds of acceptable behavior</li></ul><p>synonymous： limit, boundary</p><ul><li>a light, self-propelled movement upwards or forwards</li></ul><p>synonymous： leap, leaping, spring, saltation, bounce</p><p><img src="images-20231011124358573.jpeg" alt="Make a Leap on Behalf of Your Association | Webinars, Webcasts, LMS,  eLearning Marketing Platform" loading="lazy"></p><h2 id="Accountable">Accountable</h2><h3 id="accountable-əˈkaʊntəbl-adjective">accountable | əˈkaʊntəbl | adjective</h3><ol><li><strong>required or expected to justify actions or decisions; responsible:</strong></li></ol><p><em>ministers are *accountable to* Parliament</em></p><p>| <em>parents cannot be *held accountable for* their children’s actions</em>.</p><ol start="2"><li>**able to be explained or understood: **</li></ol><p>the delayed introduction of characters’ names is accountable, if we consider that names have a low** priority*.</p><h2 id="shape-ʃˈe‍ɪp">shape /ʃˈe‍ɪp/</h2><h3 id="shape-n">shape n.</h3><ul><li><strong>any spatial attributes (especially as defined by outline)</strong><br>he could barely make out their shapes</li></ul><p>synonymous： form, configuration, contour, conformation</p><ul><li>the spatial arrangement of something as distinct from its substance<br>geometry is the mathematical science of shape</li></ul><p>synonymous： form<br>alternative names for the body of a human being</p><p>synonymous： human body, physical body, material body, soma, build, figure, physique, anatomy, bod, chassis, frame, form, flesh<br>a concrete representation of an otherwise nebulous concept</p><p>synonymous： embodiment<br>the visual appearance of something or someone</p><p>synonymous： form, cast<br>the state of (good) health (especially in the phrases <code>in condition' or </code>in shape’ or <code>out of condition' or </code>out of shape’)</p><p>synonymous： condition<br>the supreme headquarters that advises NATO on military matters and oversees all aspects of the Allied Command Europe</p><p>synonymous： Supreme Headquarters Allied Powers Europe<br>a perceptual structure</p><p>synonymous： form, pattern<br>shape v.<br>shape or influence; give direction to</p><p>synonymous： determine, mold, influence, regulate<br>make something, usually for a specific function<br>shape a figure</p><p>synonymous： form, work, mold, mould, forge<br>give shape or form to<br>shape the dough</p><p>synonymous： form</p>]]></content>
    
    
    <summary type="html">一本自己的词书，相遇来自考研词汇</summary>
    
    
    
    <category term="考研" scheme="https://trevoewu.github.io/categories/%E8%80%83%E7%A0%94/"/>
    
    
    <category term="考研" scheme="https://trevoewu.github.io/tags/%E8%80%83%E7%A0%94/"/>
    
    <category term="英语学习" scheme="https://trevoewu.github.io/tags/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>必要的记录-别停下来</title>
    <link href="https://trevoewu.github.io/2023/09/10/%E5%BF%85%E8%A6%81%E7%9A%84%E8%AE%B0%E5%BD%95/"/>
    <id>https://trevoewu.github.io/2023/09/10/%E5%BF%85%E8%A6%81%E7%9A%84%E8%AE%B0%E5%BD%95/</id>
    <published>2023-09-10T14:35:27.000Z</published>
    <updated>2023-09-17T14:39:53.780Z</updated>
    
    <content type="html"><![CDATA[<p>早上起床，我想也不能称之为早上，发现昨天开始的症状并没有减轻。昨天早上开始，屁股眼里的肌肉便开始不受控制的的筋挛，好像在昭示自己的存在般。虽不严重，但总让我心烦，完全没法沉浸在眼前的学习中。</p><p>上次这种情况出现是在我一段生活极其不规律的时光，但，这段时间我我的生活相当规律吧。每天一点睡，早上十点起，应该对于一个大学生来说相当好了。</p><p>但情况依旧发生了，早上去了图书馆，做不了几分钟便被干扰得心烦意乱。彻底放下笔，背着书包离开了图书馆。想着做点什么运动，我确实也好久没运动了。做点什么呢，突然感觉很遗憾，没什么运动可做啊。我会的也就只有羽毛球和乒乓球。现在，羽毛球没有拍，乒乓球场馆就没见学校开过几次，真不知道学校修这么豪华的体育馆有什么用了。利用率最高的时候恐怕是疫情时候被用来做核酸吧。</p><hr><p>Dear Wilbur,</p><p><strong>I am thrilled to learn of</strong> your interest in <strong>seeking employment opportunities</strong> in my country, China, which <strong>is undergoing rapid development and brimming with possibilities</strong>. <strong>I have a few suggestions that I would like to share with you.</strong></p><p><strong>Primarily</strong>, <strong>ensure that you pursue a profession that suits your preferences.</strong> <strong>China being a vast and diversified economy</strong>, you can certainly find a job that <strong>aligns with your interests</strong>. Additionally, try to <strong>exhibit a positive attitude</strong> while <strong>presenting your resume</strong>. If you receive no response after submitting a document to a <strong>prospective</strong> employer, it may <strong>leave you feeling perplexed and rejected</strong>. However, do not lose heart and continue to <strong>hone the skills you lack</strong>, and <strong>persist in your pursuit of employment</strong>. Congratulations when you receive an offer! The employer and you <strong>are bound to</strong> <strong>find their match in each other</strong>. Finally, maintain a <strong>healthy lifestyle</strong> while <strong>tackling</strong> the challenges that <strong>lie in store for</strong> you.</p><p>Besides work, China offers a <strong>plethora</strong> of fantastic <strong>cuisine</strong> and social activities. Do not forget to <strong>savour life’s little pleasures!</strong></p><p>Sincerely,</p><p>Li Ming.</p><hr><p>This picture depicts that the son feels discouraged by peers comments that opera is not enjoyable at all, but the father thinks it is enough if you and yourself like opera in your heart.</p><p>Children always pay attention to peers’ thoughs unduly when they trying to something them want to do but compare peers  that behaviors are relative strange. Thus children are  easily be influented cause them finally give the thing them loved up. It is important for a yong children to offer them confience and courage when they were confused and though themselves were perculiar.</p><hr><p>The depicted picture portrays a disheartened son who has been discouraged by his peers’ negative opinions on opera. His father, on the other hand, believes that it is enough for one to enjoy opera in their own heart, regardless of what others think.</p><p>It is common for children to be overly concerned with the opinions of their peers, especially when it comes to pursuing interests that may not be widely accepted. However, comparing oneself to others is a peculiar behavior that can ultimately lead to feeling influenced and giving up on what is truly loved. Thus, it is crucial for young children to be instilled with confidence and bravery during moments of confusion or doubt, even in seemingly odd situations.</p><hr><p>The image presented shows a despondent son who has been disheartened by the negative opinions of his peers regarding opera. In contrast, his father believes that it is paramount for an individual to derive pleasure from opera within themselves, irrespective of the views of others.</p><p>Peer pressure is a common phenomenon that affects children, and it can be particularly challenging when a child is interested in something that is not generally applauded. Comparing oneself to peers is a strange habit that often leads to conformity and abandoning what one truly loves. Hence, it is essential to instill self-confidence and bravery in children, particularly when they are unsure of themselves in unusual situations.</p><p>It is imperative to teach children to believe in themselves and follow their hearts, even when others do not understand or approve of their interests. Encouraging children to embrace their passions, hobbies, and talents can help them grow into more fulfilled adults who are capable of pursuing their dreams despite any form of negativity around them.</p><p>In conclusion, children must be taught to follow their aspirations and be brave enough to <strong>march to the beat of their drum</strong>. By doing so, they are more likely to develop a sense of self-awareness, self-love, and self-confidence that will stay with them for life. The depicted image serves as a gentle reminder that it is vital to believe in oneself and live life by one’s own terms.</p>]]></content>
    
    
    <summary type="html">别停下来，让奇迹发生。</summary>
    
    
    
    <category term="必要的记录" scheme="https://trevoewu.github.io/categories/%E5%BF%85%E8%A6%81%E7%9A%84%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="日记" scheme="https://trevoewu.github.io/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Writing Your Own Unix Shell</title>
    <link href="https://trevoewu.github.io/2023/07/09/Writing-Your-Own-Unix-Shell/"/>
    <id>https://trevoewu.github.io/2023/07/09/Writing-Your-Own-Unix-Shell/</id>
    <published>2023-07-09T08:26:25.000Z</published>
    <updated>2023-09-10T14:35:39.194Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Introduce">Introduce</h2><p>这个任务的目的是让你更加熟悉进程控制和信号传递的概念。你将通过编写一个简单的Unix shell程序来实现作业控制。</p><span id="more"></span><h2 id="使用说明">使用说明</h2><ol><li><p>输入命令 <code>tar xvf shlab-handout.tar</code> 解压 tarfile文件。</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">tar</span> xvf shlab-handout.tar</code></pre></li><li><p>键入 make 命令以编译和链接一些测试例程。</p></li><li><p>查看 tsh.c 文件，它包含一个简单 Unix shell 的函数框架。为了帮助你入门，我们已经实现了一些不那么有趣的函数。你的任务就是完成下列函数。为了让你进行一次合理性检查，我们列出了我们参考解决方案中每个函数的大致代码行数（包括大量注释）。</p><ol><li>eval: 解析和解释命令行的 Main 例程. [70 行]</li><li>builtin cmd: 识别和解释内置命令: quit，fg，bg，and jobs [25 行]</li><li>do_bgfg: Implements the bg and fg built-in commands. [50 lines]</li><li>waitfg: 等待前台作业完成。[20 行]</li><li>sigchld handler: 捕捉 SIGCHILD 信号。[80 行]</li><li>sigint handler: 捕获SIGINT（ctrl-c）信号。[15行]</li><li>sigtstp handler: 捕捉 SIGTSTP (ctrl-z)信号。[15 行]</li></ol></li><li><p>每次修改 tsh.c 文件时，输入 make 重新编译它。要运行 shell，在命令行中输入 <code>./tsh</code>:</p><pre class="language-bash" data-language="bash"><code class="language-bash">unix<span class="token operator">></span> ./tsh</code></pre></li></ol><h2 id="tsh-规范">tsh 规范</h2><p>您的 tsh shell 应该具有以下特性:</p><ul><li>提示符应该是字符串“ tsh &gt;”。</li><li>用户输入的命令行应该包含一个名称，零个或多个参数，所有参数都由一个或多个空格分隔。 如果 name 是一个内置命令，那么 tsh 应该立即处理它并等待下一个命令行。否则，tsh 应该 假定 name 是一个可执行文件的路径，它在一个初始子进程的上下文中加载并运行该文件(在这个上下文中，术语 job 指的是这个初始子进程)。</li><li>tsh 不需要支持管道(|)或 i/o 重定向(&lt; 和 &gt;)。</li><li>键入 ctrl-c (ctrl-z)应该导致将 SIGINT (SIGTSTP)信号发送到前台作业，以及该作业的任何后代(例如，它分叉的任何子进程)。如果没有前台作业，那么该信号应该没有作用。</li><li>如果命令行以 &amp; 结尾，那么 tsh 应该在后台运行作业。否则，它应该在前台运行作业。</li><li>每个作业可以由进程 ID (PID)或作业 ID (JID)标识，后者是由 tsh 分配的一个正整数。Jid 应该 在命令行中用前缀“%”表示。例如，“% 5”表示 JID 5，“5”表示 PID 5。(我们已经为您提供了 操纵工作列表所需的所有例程）</li><li>tsh 应该支持以下内置命令:<ul><li>Quit 命令终止 shell。</li><li>Jobs 命令列出了所有的后台工作。</li><li>Bg &lt; job &gt; 命令通过发送 SIGCONT 信号重启 &lt; job &gt; ，然后在后台运行。参数 &lt; job &gt; 可以是 PID 或 JID。</li><li>fg &lt; job &gt; 命令通过发送 SIGCONT 信号重新启动 &lt; job &gt; ，然后在前台运行它。参数 &lt; job &gt; 可以是 PID 或 JID。</li><li>tsh 应该回收所有的僵尸子进程。如果有任何作业因接收到未捕获的信号而终止，那么 tsh 应该识别此事件，并打印一条包含作业的 PID 和触发信号描述的消息。</li></ul></li></ul><h2 id="检查你的程序">检查你的程序</h2><p>我们提供了一些工具来帮助你检查你的程序。</p><p><strong>参考解决方案。</strong></p><p>Linux 可执行文件 tshref 是该 Shell 的参考解决方案。运行此程序以解答您对您的 Shell 应如何行为的任何疑问。您的 Shell 应生成与参考解决方案完全相同的输出（当然，除了进程ID，因为它们在每次运行时会变化）。</p><p><strong>Shell 驱动程序</strong></p><p>sdriver.pl程序将shell作为子进程执行，根据跟踪文件的指示发送命令和信号，并捕获并显示shell的输出。</p><p><strong>使用 -h 参数查找 <a href="http://sdriver.pl">sdriver.pl</a> 的用法:</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">-<span class="token operator">></span> ./sdriver.pl <span class="token parameter variable">-h</span>Usage: ./sdriver.pl <span class="token punctuation">[</span>-hv<span class="token punctuation">]</span> <span class="token parameter variable">-t</span> <span class="token operator">&lt;</span>trace<span class="token operator">></span> <span class="token parameter variable">-s</span> <span class="token operator">&lt;</span>shellprog<span class="token operator">></span> <span class="token parameter variable">-a</span> <span class="token operator">&lt;</span>args<span class="token operator">></span>Options:  <span class="token parameter variable">-h</span>            Print this message  <span class="token parameter variable">-v</span>            Be <span class="token function">more</span> verbose  <span class="token parameter variable">-t</span> <span class="token operator">&lt;</span>trace<span class="token operator">></span>    Trace <span class="token function">file</span>  <span class="token parameter variable">-s</span> <span class="token operator">&lt;</span>shell<span class="token operator">></span>    Shell program to <span class="token builtin class-name">test</span>  <span class="token parameter variable">-a</span> <span class="token operator">&lt;</span>args<span class="token operator">></span>     Shell arguments  <span class="token parameter variable">-g</span>            Generate output <span class="token keyword">for</span> autograder</code></pre><p>我们还提供了16个跟踪文件（trace{01-16}.txt），您将与Shell驱动程序一起使用这些文件来测试您的Shell的正确性。较低编号的跟踪文件执行非常简单的测试，而较高编号的测试执行更复杂的测试。</p><p>您可以通过输入以下命令，在您的Shell上使用trace文件trace01.txt来运行Shell驱动程序：</p><p>- a“-p”参数告诉你的 shell 忽略提示信息</p><pre class="language-bash" data-language="bash"><code class="language-bash">unix<span class="token operator">></span> ./sdriver.pl <span class="token parameter variable">-t</span> trace01.txt <span class="token parameter variable">-s</span> ./tsh <span class="token parameter variable">-a</span> <span class="token string">"-p"</span> </code></pre><p>或者</p><pre class="language-bash" data-language="bash"><code class="language-bash">unix<span class="token operator">></span> <span class="token function">make</span> test01</code></pre><p>类似地，您可以通过输入以下命令来运行跟踪驱动程序，并将其应用于参考Shell，以将结果与参考Shell进行比较：</p><pre class="language-bash" data-language="bash"><code class="language-bash">./sdriver.pl <span class="token parameter variable">-t</span> trace01.txt <span class="token parameter variable">-s</span> ./tshref <span class="token parameter variable">-a</span> <span class="token string">"-p"</span></code></pre><p>或者</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">make</span> rtest01</code></pre><p>tshref.out提供了参考解决方案在所有跟踪文件上的输出。这可能比您手动在所有跟踪文件上运行Shell驱动程序更方便。</p><p>跟踪文件的好处在于，它们生成的输出与您以交互方式运行Shell时获得的输出相同（除了一个标识跟踪的初始注释）。</p><p>例如：</p><pre class="language-bash" data-language="bash"><code class="language-bash">bass<span class="token operator">></span> <span class="token function">make</span> test15./sdriver.pl <span class="token parameter variable">-t</span> trace15.txt <span class="token parameter variable">-s</span> ./tsh <span class="token parameter variable">-a</span> <span class="token string">"-p"</span> <span class="token comment">#</span><span class="token comment"># trace15.txt - Putting it all together</span><span class="token comment">#</span>tsh<span class="token operator">></span> ./bogus./bogus: Command not found.tsh<span class="token operator">></span> ./myspin <span class="token number">10</span>Job <span class="token punctuation">(</span><span class="token number">9721</span><span class="token punctuation">)</span> terminated by signal <span class="token number">2</span>tsh<span class="token operator">></span> ./myspin <span class="token number">3</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9723</span><span class="token punctuation">)</span> ./myspin <span class="token number">3</span> <span class="token operator">&amp;</span>tsh<span class="token operator">></span> ./myspin <span class="token number">4</span> <span class="token operator">&amp;</span><span class="token number">5</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9725</span><span class="token punctuation">)</span> ./myspin <span class="token number">4</span> <span class="token operator">&amp;</span>tsh<span class="token operator">></span> <span class="token function">jobs</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9723</span><span class="token punctuation">)</span> Running ./myspin <span class="token number">3</span> <span class="token operator">&amp;</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9725</span><span class="token punctuation">)</span> Running ./myspin <span class="token number">4</span> <span class="token operator">&amp;</span> tsh<span class="token operator">></span> <span class="token function">fg</span> %1Job <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9723</span><span class="token punctuation">)</span> stopped by signal <span class="token number">20</span> tsh<span class="token operator">></span> <span class="token function">jobs</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9723</span><span class="token punctuation">)</span> Stopped<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9725</span><span class="token punctuation">)</span> Runningtsh<span class="token operator">></span> <span class="token function">bg</span> %3%3: No such jobtsh<span class="token operator">></span> <span class="token function">bg</span> %1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9723</span><span class="token punctuation">)</span> ./myspin <span class="token number">3</span> <span class="token operator">&amp;</span>tsh<span class="token operator">></span> <span class="token function">jobs</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9723</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9725</span><span class="token punctuation">)</span>tsh<span class="token operator">></span> <span class="token function">fg</span> %1tsh<span class="token operator">></span> quitbass<span class="token operator">></span></code></pre><h2 id="提示：">提示：</h2><ul><li><p>仔细阅读教材第8章（异常控制流）的每一个词。</p></li><li><p>使用跟踪文件指导您的Shell的开发。从trace01.txt开始，确保您的Shell产生与参考Shell完全相同的输出。然后继续处理trace02.txt，以此类推。</p></li><li><p><code>waitpid</code>、<code>kill</code>、<code>fork</code>、<code>execve</code>、<code>setpgid</code>和<code>sigprocmask</code>函数将非常有用。<code>waitpid</code>的<code>WUNTRACED</code>和<code>WNOHANG</code>选项也很有用。</p></li><li><p>在实现信号处理程序时，请确保使用<code>kill</code>函数的参数中的<code>&quot;-pid&quot;</code>而不是<code>&quot;pid&quot;</code>，向整个前台进程组发送<code>SIGINT</code>和<code>SIGTSTP</code>信号。<code>sdriver.pl</code>程序会检查此错误。</p></li><li><p>任务的一个棘手部分是决定<code>waitfg</code>和<code>sigchld</code>处理函数之间的工作分配。我们推荐以下方法：</p><ul><li><p>在<code>waitfg</code>中，使用<code>sleep</code>函数周围的忙等待循环。</p></li><li><p>在<code>sigchld</code>处理程序中，只调用一次<code>waitpid</code>。</p></li></ul></li></ul><p>虽然还有其他可能的解决方案，比如在waitfg和sigchld处理程序中都调用waitpid，但这可能非常令人困惑。在处理程序中完成所有的收集工作更简单。</p><ul><li><p>在<code>eval</code>中，父进程在<code>fork</code>子进程之前必须使用<code>sigprocmask</code>阻塞<code>SIGCHLD</code>信号，然后在将子进程添加到作业列表中时，通过调用<code>addjob</code>后再解除阻塞。由于子进程继承了其父进程的阻塞向量，因此子进程在执行新程序之前必须确保解除阻塞<code>SIGCHLD</code>信号。</p><p>父进程以这种方式阻塞<code>SIGCHLD</code>信号，以避免在父进程调用<code>addjob</code>之前，子进程被<code>sigchld</code>处理程序收回（从而从作业列表中移除）的竞争条件。</p></li><li><p>诸如<code>more</code>、<code>less</code>、<code>vi</code>和<code>emacs</code>之类的程序会对终端设置进行奇怪的操作。不要从您的Shell中运行这些程序。坚持使用简单的基于文本的程序，例如<code>/bin/ls</code>、<code>/bin/ps</code>和<code>/bin/echo</code>。</p></li><li><p>当您从标准Unix Shell运行您的Shell时，您的Shell正在运行在前台进程组中。如果您的Shell创建了一个子进程，默认情况下，该子进程也将成为前台进程组的成员。由于键入ctrl-c会向前台组中的每个进程发送SIGINT信号，因此键入ctrl-c将向您的Shell发送SIGINT信号，以及您的Shell创建的每个进程，这显然是不正确的。</p><p>以下是解决方法：</p><p>在fork之后但在execve之前，子进程应调用setpgid(0, 0)，这将子进程放入一个新的进程组，其组ID与子进程的PID相同。这确保前台进程组中只有一个进程，即您的Shell。当您键入ctrl-c时，Shell应捕获生成的SIGINT信号，然后将其转发给相应的前台作业（更确切地说，包含前台作业的进程组）。</p><h2 id="评估">评估</h2><p>根据以下分配，您的得分将计为最高90分中的一部分：</p><ol><li><p>80分 正确性：</p></li><li><p>16个跟踪文件，每个文件5分。</p></li><li><p>10分 风格分。</p></li></ol><p>我们期望您有良好的注释（5分），并检查每个系统调用的返回值（5分）。</p><p>您的解决方案将在Linux机器上进行正确性测试，使用与实验目录中包含的Shell驱动程序和跟踪文件相同的工具。您的Shell应在这些跟踪文件上产生与参考Shell完全相同的输出，只有两个例外：<br>• PID可能会不同（会变化）。<br>• trace11.txt、trace12.txt和trace13.txt中/bin/ps命令的输出会因每次运行而有所不同。然而，在/bin/ps命令的输出中，mysplit进程的运行状态应保持一致。</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Introduce&quot;&gt;Introduce&lt;/h2&gt;
&lt;p&gt;这个任务的目的是让你更加熟悉进程控制和信号传递的概念。你将通过编写一个简单的Unix shell程序来实现作业控制。&lt;/p&gt;</summary>
    
    
    
    <category term="csapp" scheme="https://trevoewu.github.io/categories/csapp/"/>
    
    
    <category term="lab" scheme="https://trevoewu.github.io/tags/lab/"/>
    
    <category term="csapp" scheme="https://trevoewu.github.io/tags/csapp/"/>
    
  </entry>
  
  <entry>
    <title>学习杂谈：持久层框架那些链接数据库的操作</title>
    <link href="https://trevoewu.github.io/2023/06/10/%E5%AD%A6%E4%B9%A0%E6%9D%82%E8%B0%88%EF%BC%9A%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6%E9%82%A3%E4%BA%9B%E9%93%BE%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%93%8D%E4%BD%9C/"/>
    <id>https://trevoewu.github.io/2023/06/10/%E5%AD%A6%E4%B9%A0%E6%9D%82%E8%B0%88%EF%BC%9A%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6%E9%82%A3%E4%BA%9B%E9%93%BE%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%93%8D%E4%BD%9C/</id>
    <published>2023-06-10T11:26:53.000Z</published>
    <updated>2023-06-11T11:53:02.194Z</updated>
    
    <content type="html"><![CDATA[<p>为了进行数据的持久化，和数据库操作是必须的操作。 本文探讨不同的持久层框架链接数据库的操作。</p><span id="more"></span><h2 id="JDBC">JDBC</h2><p>JDBC 为多个不同的数据库实现提供了同一的接口，使得我们可以通过JDBC来操作不同的数据库，而不需要担心数据库的具体实现。</p><p>要在Java项目中使用JDBC，首先需要引进jar包。假设我们需要链接的数据库是mysql，则需要引进mysql相关的jar包。</p><p>使用Maven是进行包管理是相当便捷的做法，要使用maven，首先我们需要新建一个Maven的项目或者模块。这里就用Java唯一指定IDE IntlliJ IDEA 来演示。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--        mysql --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>8.0.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>要链接数据库，自然少不了要链接数据库的参数，比如Driver，URL，以及Username，Password等等。所以我们需要新建一个properties 来存放这些数据，而不是写死在Java代码中。</p><pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">DRIVER</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.cj.jdbc.Driver</span><span class="token key attr-name">URL</span><span class="token punctuation">=</span><span class="token value attr-value">mysql://localhost:3306/demo?useUnicode=true&amp;characterEncoding=utf-8</span><span class="token key attr-name">USERNAME</span><span class="token punctuation">=</span><span class="token value attr-value">root</span><span class="token key attr-name">PASSWORD</span><span class="token punctuation">=</span><span class="token value attr-value">root</span></code></pre><ol><li>加载驱动</li></ol><p>数据库有着不同的实现，mysql，oracle，monogDB，SQL Server等等，而每个数据库都提供一个驱动程序，驱动程序是与数据库系统进行通信的软件组件。每种数据库系统都有自己的驱动程序，这是因为不同数据库系统采用不同的协议和通信方式。</p><p><strong>驱动程序充当Java程序与数据库之间的桥梁</strong>，负责处理与数据库的连接、执行SQL语句以及获取和处理查询结果等任务。它们提供了一组标准的接口和方法，使得Java程序能够通过统一的方式与不同数据库进行交互，而不需要了解底层数据库的具体实现细节。</p><p>加载数据库驱动程序的常用方式是使用<code>Class.forName()</code>方法，例如：</p><p>在这里，我们需要加载mysql的驱动程序，MySQL数据库的驱动程序类名为<code>com.mysql.jdbc.Driver</code>（旧版）或<code>com.mysql.cj.jdbc.Driver</code>（新版）。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 加载MySQL驱动程序</span></code></pre><p>一旦数据库驱动程序加载成功，就可以通过JDBC建立与数据库的连接并执行相关操作。</p><ol start="2"><li>建立数据库连接</li></ol><p>要和数据库进程操作，我们需要和数据库建立一个会话关系，就像在web中一样，在web中，这个会话被称为httpSession, 而在数据库中，也同样存在着这个会话。</p><p>一个会话代表了客户端与数据库之间的通信通道，它允许客户端应用程序与数据库服务器进行交互。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">// 2.连接数据库</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在JDBC中，通过<code>DriverManager.getConnection()</code>方法建立数据库连接时，实际上是在建立一个会话。该方法返回一个<code>Connection</code>对象，表示与数据库的连接。这个<code>Connection</code>对象封装了与数据库服务器的底层通信细节，包括连接信息、会话状态和数据传输等。</p><p>通过会话，可以在连接期间执行多个SQL语句，保持数据库连接的状态。这样可以避免每次执行SQL语句都重新建立连接，提高性能和效率。当不再需要连接时，可以调用<code>Connection</code>对象的<code>close()</code>方法关闭连接，释放相关资源。</p><ol start="3"><li>创建执行SQL语句的对象</li></ol><p>有了链接，我们就可以通过<code>Connection</code>对象的<code>createStatement()</code>方法创建<code>Statement</code>对象或<code>prepareStatement()</code>方法创建<code>PreparedStatement</code>对象。</p><p><code>Statement</code>用于执行静态的SQL语句，而<code>PreparedStatement</code>用于执行预编译的SQL语句，可以提高性能和安全性，防止SQL注入。</p><ol start="4"><li>执行SQL语句：</li></ol><p>通过<code>Statement</code>或<code>PreparedStatement</code>对象的<code>executeQuery()</code>方法执行查询语句，返回一个<code>ResultSet</code>对象，其中包含查询结果；通过<code>executeUpdate()</code>方法执行更新语句（如插入、更新、删除），返回受影响的行数。</p><ol start="5"><li>处理结果集：</li></ol><p>但是仅仅是往数据库中传SQL语句，显然是不够的，我们还需要接受数据库返回的数据。</p><p>数据库的操作有四种，我们将其称为CRUD，即CREATE, READ, UPDATE and DELETE，也就是我们常说的增删改查。其中查询操作返回一个结果集Result，其他的操作都返回一个int类型的整数，代表受影响的行数。</p><p>所以，我们只需要编写两个函数，处理这两种不同的操作。</p><p>对于查询操作</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//执行查询, 返回结果集</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ResultSet</span> <span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span><span class="token class-name">String</span> query<span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">&#123;</span>    <span class="token class-name">ResultSet</span> resultSet <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>query<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> params <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//预处理</span>        <span class="token class-name">PreparedStatement</span> statement <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> params<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//设置SQL 语句中的参数</span>            statement<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//执行</span>        resultSet <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> resultSet<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>对于更新删除，增加操作：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//执行更新， 返回影响行数</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span><span class="token class-name">String</span> query<span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> affectedRows <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>query<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> params <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//预处理</span>        <span class="token class-name">PreparedStatement</span> statement <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> params<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//设置SQL 语句中的参数</span>            statement<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//执行</span>         affectedRows <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> affectedRows<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><ol start="6"><li>关闭连接和资源</li></ol><p>使用完<code>ResultSet</code>、<code>Statement</code>和<code>Connection</code>等对象后，需要调用它们的<code>close()</code>方法来关闭连接和释放资源，以免造成内存泄漏和资源浪费。</p><p>我们可以编写一个函数来专门关闭这些资源，但这不是必须的，你也可以手动关闭。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//释放链接资源</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">PreparedStatement</span> pstmt<span class="token punctuation">,</span> <span class="token class-name">ResultSet</span> resSet<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>resSet <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>resSet<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>pstmt <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>pstmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>果然好麻烦，但是还没有结束，查询操作返回了一个结果集，我们还需要对这个结果集进行ORM处理，即Object Relationship Mapping。把数据库中的entity映射到一个bean上，这是最麻烦的。因为我们需要一一个处理这些字段和属性的对应关系。</p><p>下面这段代码就是一个一个例子，可以看到，对于每一个对象的属性值，我们需要一一的找到对应的字段值。这还只是查询一张表，在多表联合查询的过程中，我们需要封装的对象数量更多。我们不应该花太多时间处理这些重复而又无意义的事。</p><p>下面介绍的持久层框架，就是对JDBC的二次封装，免去了我们编写ORM的代码。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>id<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token class-name">ResultSet</span> set<span class="token punctuation">;</span>    sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM smbms_user,smbms_role Where smbms_user.userRole = smbms_role.id and smbms_user.id = ?"</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        conn <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        set <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">,</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>set <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                user<span class="token punctuation">.</span><span class="token function">setUserRoleName</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"roleName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setUserPassword</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userPassword"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setUserCode</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userCode"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setBirthday</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Date</span><span class="token punctuation">)</span> set<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"birthday"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setPhone</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setIdPicPath</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"idPicPath"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setUserRole</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"userRole"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setCreatedBy</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"createdBy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setCreationDate</span><span class="token punctuation">(</span> set<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"creationDate"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setModifyBy</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"modifyBy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setModifyDate</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"modifyDate"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setWorkPicPath</span><span class="token punctuation">(</span><span class="token string">"workPicPath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//关闭链接和结果集</span>        <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> user<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h2 id="MyBatis">MyBatis</h2><p>MyBatis是一个优秀的持久层框架，是对JDBC的二次封装。该框架大大简化了ORM过程，MyBatis可以通过字段和属性名自动进行ORM操作。</p><ol><li>要使用MyBatis，当然需要引入相关的jar包：</li></ol><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.5.13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><ol start="2"><li>编写MyBatis配置文件，这个配置文件我们可以从官网中拿到对应的模版，这是mybatis的核心配置文件，通过编写配置文件，我们可以得到mybatis的不同表现。</li></ol><p>最好将这个配置文件编写在根路径下，放在资源文件有是再好不过的选择</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">configuration</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Config 3.0//EN"</span>        <span class="token string">"https://mybatis.org/dtd/mybatis-3-config.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--    从db.properties读取数据库属性--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>db.properties<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;DRIVER&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;URL&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;USERNAME&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span></code></pre><p>在这个配置文件中，我们只配置的数据源，后续的配置随着讲解的深入再一一添加</p><ol start="2"><li><p>编写bean</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> major<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre></li><li><p>编写接口</p></li></ol><p>和JDBC一样，我们需要编写接口，在接口中定义方法。面向接口编程可以大大降低层与层之间的耦合度。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Student</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Param</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StudentMapper</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Student</span> <span class="token function">getStudent</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>不同的是，由于不需要编写接口实现类了，Mybatis会通过反射的方式在程序运行时生成实现类。所以我们需要使用<code>@Param</code>注解来指定参数，如果参数只有一个则不需要显式的给出，参数类型是复杂类型如java bean时也不需要显式的给出。</p><ol start="4"><li>编写mapper</li></ol><p>没有了实现了类，但是我们还需要编写mapper文件，其实也可以直接使用注解的方式定义SQL语句，但是这样对于较为复杂的SQL语句代码的可读性将大大降低。所以我们还是基于xml的的方式。</p><p>mapper使用xml格式，且需要保证与接口名称相同。 在mapper中，要指定命名空间，这个命名空间指向接口类，使用接口类的全限定名。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>        <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cn.loulan.dao.StudentMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getStudent<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cn.loulan.bean.Student<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select * from student where id=#&#123;id&#125;;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></code></pre><p>和JDBC一样，我们需要和数据库建立连接，拿到会话，在Mybatis中，这个会话被称为Sql Session要拿到这个SqlSession, 还有点麻烦，这里Mybatis使用了一个设计模式，叫做建造者模式。这是GOF23种设计模式的创造型设计模式之一。要理解建造者模式，我们需要首先了解工厂模式。</p><p>工厂模式在spring中有着大量的运用，比如动态代理中Bean的实例化就是工厂模式的一个运用。每一个bean都对应一个工厂，用来生成这个bean。这里的工厂模式确实的说是静态工厂模式，也叫做简单工厂模式，这个设计模式并不在GOF23种设计模式之内，但是运用的也比较多，而且简单工厂模式其实算得上是工厂模式的一个特例。</p><p>要理解工厂模式，首先我们需要知道为什么需要工厂模式？</p><p>面向对象有七大设计原则，第一个便是单一职责原则。顾名思义就是一个类只负责一个职责。我们使用一个类，不需要担心这个是如何被创建出来的，就像在生活中我们买一台电脑不需要关心这个电脑是如何生产出来的。电脑的生产由生产这个电脑的工厂负责。相较于自己造一台电脑，显然去买一台工厂生产的电脑更为现实。</p><p>简单工厂模式就是这样思想的一种体验，在软件开发过程中，我们往往需要实例化一些来着同一个父类的对象, 这个父类定义了这个工厂下所以对象的通用方法。为此专门提供一个工厂来帮我们实例化这个对象，我们只需要提供不同的参数，就可以得到不同的实例化对象，在Java开发中，我们常常把工厂类的实例化这个对象的方法定义为一个静态方法，这样，我们就不需要实例化这个类就可以调用这个方法了，这也就是静态工厂模式名字的来源。</p><p>简单工厂模式包含三个重要的角色：</p><ol><li>工厂 Factory:  工厂模式的核心角色，这个角色提供了一个静态方法，这个方法负责实例化对象并返回，返回类型为抽象产品。</li><li>抽象产品 Product： 抽象产品是工厂建造的所以具体对象的父类，负责描述所以实例化对象的公共接口。它的引入使得系统更加灵活，在工厂类中只需要定义一个方法，因为所以的具体产品对象都是其子类对象。</li><li>具体产品 ConcreteProduct： 简单工厂模式的创建目标，是抽象产品的具体表现，需要实现抽象产品中定义的方法。</li></ol><!--to do... 补充工厂模式，建造者模式--><p>在Mybatis中，便使用工厂模式这一思想。要拿到sqlsession，我们需要先拿到工厂对象，通过读取配置文件，MyBatis会创建一个SqlSessionFactory对象。通过工厂对象的openSession我们就可以拿到这个Sql Session了。SqlSession是与数据库进行交互的主要接口，它封装了数据库会话和执行SQL操作的方法。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Student</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSession</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactory</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactoryBuilder</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestStudent</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetStudent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1. 加载mybatis配置文件</span>        <span class="token class-name">InputStream</span> resourceAsStream <span class="token operator">=</span> <span class="token class-name">TestStudent</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"mybatis.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//2. 拿到工厂对象</span>        <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>resourceAsStream<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//3. sqlSession对象</span>        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//4. 拿到接口实现类</span>        <span class="token class-name">StudentMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//5. 关闭sql session释放资源</span>        sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//6. 输出查询结果</span>        <span class="token class-name">Student</span> student <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">getStudent</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><!--饿了，吃饭去了--><!--我来了，继续继续。哎，越来越搞不懂自己了，一躺在床上就会想瑟瑟。感觉午觉睡了根没睡一样，很奇怪啊，一躺下就忍不住想Moon。我也不知道我喜欢她什么，高中时期的暗恋对象能持续这么久的影响我。她都邀请我去她家玩了，虽然确实很想去，但是自己想去的动机总感觉不纯。而且也怪不好意思的，她姐姐我也不熟，去她家玩的话自己也会很难办。且不说往返的机票钱就不是一个小数目，为什么要跑到这么远上大学呢，我又开始怀疑自己了。要是在上海读书的话就方便很多了。哎～加上还有准备考研，准备考研，一直都在准备，准备着准备着，到目前也没什么进度，感觉就像默认自己已经要二战了一样。好可悲啊，哪有还没考就想着下一次的啊，怎么说呢，也不能讨厌这样的自己。要和自己和平相处，不要和自己为敌。假期把CSAPP搞定，一定要加油！--><p>到这里Mybatis链接数据库的操作就结束了，虽然还有很多没有设计，比如事务管理，对象关系映射啊，但是这又不是Mybatis教程，要看mybatis教程的话移步博客文章mybatis。</p><p>总得来说，mybatis确实相较于直接用JDBC方便很多，自己再也不用处理令人头疼的结果集了，只需要写些配置文件就好了，效率提高了很多。但是听说到了spring boot就更方便了，总感觉学不完啊。</p><h2 id="Spring集成Mybatis框架">Spring集成Mybatis框架</h2><p>接下来就是spring集成mybatis框架了，集成spring可以通过依赖注入（Dependency Injection）来降低层与层之间的耦合度，具体来说就是对象不需要我们自己new了，对象间关系的维护也不需要我们自己维护了，全部交给Spring来管理。</p><p>spring集成mybatis框架感觉就是把mybatis配置移到了Spring的配置中去，以前是mybatis通过反射实例化对象，变成了spring和mybatis共同完成了。</p><ol><li>MyBatis部分：MyBatis通过Mapper接口的代理方式来执行SQL操作。在MyBatis中，通过配置映射文件（Mapper XML）来定义SQL语句和映射关系。MyBatis会根据映射文件中的配置，动态生成Mapper接口的代理对象，实现了Mapper接口中定义的方法。</li><li>Spring部分：Spring负责管理和配置应用程序中的各个组件，包括Mapper接口的实例化和依赖注入。在集成MyBatis时，Spring会扫描指定的包路径，检测并实例化Mapper接口的代理对象。Spring提供了<code>@MapperScan</code>注解来自动扫描和实例化Mapper接口。</li></ol><p>当Spring实例化Mapper接口时，它会使用MyBatis提供的<code>MapperProxyFactory</code>类来创建Mapper接口的代理对象。该代理对象在执行方法时，会委托给MyBatis的底层实现来执行相应的SQL操作。</p><p>通过Spring和MyBatis的协作，实现了Mapper接口的实例化和使用，使得开发者可以在Spring中轻松地使用MyBatis进行数据库操作。同时，Spring还负责管理事务、数据源配置等与数据库相关的事务处理和连接管理工作，与MyBatis相结合提供了更完整的数据库访问解决方案。</p><p>以上内容全由chatGPT生成，我是不会的。</p><p>继续。</p><p>照例，先引入jar包</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>druid<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2.16<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-tx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>6.0.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>6.0.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        MyBatis--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.5.13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-context<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>6.0.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>差不多就这些了，主要包括spring框架的依赖，mybatis依赖，spring集成mybatis的依赖，德鲁伊的依赖。</p><p>累了，不想写了。下次补充。。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;为了进行数据的持久化，和数据库操作是必须的操作。 本文探讨不同的持久层框架链接数据库的操作。&lt;/p&gt;</summary>
    
    
    
    <category term="杂谈" scheme="https://trevoewu.github.io/categories/%E6%9D%82%E8%B0%88/"/>
    
    
    <category term="杂谈" scheme="https://trevoewu.github.io/tags/%E6%9D%82%E8%B0%88/"/>
    
    <category term="mybatis" scheme="https://trevoewu.github.io/tags/mybatis/"/>
    
    <category term="JDBC" scheme="https://trevoewu.github.io/tags/JDBC/"/>
    
    <category term="JDBCtemplate" scheme="https://trevoewu.github.io/tags/JDBCtemplate/"/>
    
  </entry>
  
  <entry>
    <title>手写简易Spring框架</title>
    <link href="https://trevoewu.github.io/2023/06/09/%E6%89%8B%E5%86%99%E7%AE%80%E6%98%93Spring%E6%A1%86%E6%9E%B6/"/>
    <id>https://trevoewu.github.io/2023/06/09/%E6%89%8B%E5%86%99%E7%AE%80%E6%98%93Spring%E6%A1%86%E6%9E%B6/</id>
    <published>2023-06-09T06:10:22.000Z</published>
    <updated>2023-06-09T06:11:33.799Z</updated>
    
    <content type="html"><![CDATA[<h2 id="手写Spring框架">手写Spring框架</h2><p>Spring底层是通过反射机制来实例化对象，以及属性注入的，在手写Spring框架之前，我们需要了解反射机制。</p><blockquote><p>JAVA反射机制是在运行状态中，对于任意一个类，都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意一个方法和属性；这种动态获取的信息以及动态调用对象的方法的功能称为java语言的反射机制。Java反射机制在框架设计中极为广泛，需要深入理解。</p></blockquote><p>通过反射，我们可以拿到类的属性，方法。 回顾Spring框架，我们需要编写一个spring的配置文件例如：spring.xml，在这个配置文件中，我们注册一个类，并注入属性值。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sonetto<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>123456<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>points<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>12.3<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>isActive<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.UserDao<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.UserService<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span></code></pre><p>在实例化一个对象时，我们通过<code>ClassPathXmlApplicationContext()</code>，传入我们的配置文件，拿到一个<code>ApplicationContext</code>对象，通过<code>ApplicationContext</code>对象调用<code>getBean（）</code>方法来获取对象, 最终调用对象发方法，来使用Bean。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"mySpring.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"userService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        userService<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>我们的最终目的就是调用对象的方法，而一个指定一个方法需要四要素： 什么对象（对象的全限定类名是什么？）什么方法（方法名），什么参数（参数的类型和数量），返回什么值。</p><p>指定来这方法的四个要素，我们就可以唯一的确定一个方法，然后调用该方法。</p><p>在spring的配置文件中，注册一个Bean时，我们需要提供这个Bean的全限定类名，也就是Bean标签内的class属性的内容。有了全限定类名，我们就可以通过反射机制调用<code>class.forName()</code>拿到这个对象的类。更进一步，通过这个类拿到构造方法，实例化对象。拿到我们需要的目标方法，最终调用这个目标方法。</p><p>有了整个大概的全景图，我们就可以开始编写我们自己的Spring框架了。</p><ol><li>首先，让我们先编写一个<code>ApplicationContext</code> 接口类，这个类定义了<code>getBean()</code>方法</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>spring</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApplicationContext</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><ol start="2"><li>然后编写该接口的实现类<code>ClassPathXmlApplicationContext</code> 我们正是通过这个类来实例化一个<code>ApplicationContext</code> 对象。回顾<code>ApplicationContext context = new ClassPathXmlApplicationContext(&quot;mySpring.xml&quot;);</code> 这段代码，实例化这个类时，我们需要一个参数——Spring配置文件，这个参数对应一个构造方法，所以我们的<code>ClassPathXmlApplicationContext</code>也需要提供这个构造方法。</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">String</span> resource<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></code></pre><ol start="3"><li><p>我们需要读取使用这个框架的配置文件，并拿到所有的Bean标签。要拿到这个xml文件并读取里面的标签已经属性，我们可以借助<code>SAXReader</code> 这个类来完成。通过Maven我们可以轻松的引入这个jar包。同时，我们还需要解析这个xml文件，通过<code>Document</code> 来完成。所以我还需要dom4j的依赖。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--        dom4j依赖--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.dom4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>dom4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.1.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        jaxen的依赖，因为要使用它解析XML文件--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>jaxen<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jaxen<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>接下来就是愉快的编写代码啦！</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>spring</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">Document</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">DocumentException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">Element</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">Node</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">SAXReader</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Constructor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassPathXmlApplicationContext</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContext</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span>beans <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">String</span> resource<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1. 拿到这个xml配置文件</span>        <span class="token class-name">SAXReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SAXReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Document</span> document <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            document <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 获取所有的bean标签</span>            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">></span></span> beanNodes <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">"//bean"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 遍历集合</span>            beanNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>beanNode <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Element</span> beanElt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> beanNode<span class="token punctuation">;</span>                <span class="token comment">// 获取id</span>                <span class="token class-name">String</span> id <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 获取className</span>                <span class="token class-name">String</span> className <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"id->"</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">" className->"</span><span class="token operator">+</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">//通过反射拿到class</span>                    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// 获得class的构造器</span>                    <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> constructor <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// 实例化对象</span>                    <span class="token class-name">Object</span> o <span class="token operator">=</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"实例化对象->"</span><span class="token operator">+</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// 暴露bean，放在map（缓存）</span>                    beans<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//再次遍历bean，给属性赋值（DI）</span>            beanNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>beanNode <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Element</span> beanElt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> beanNode<span class="token punctuation">;</span>                <span class="token comment">// 获取id</span>                <span class="token class-name">String</span> id <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 获取className</span>                <span class="token class-name">String</span> className <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 获取实例化对象</span>                <span class="token class-name">Object</span> bean <span class="token operator">=</span> beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>                logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"获取实例化对象"</span><span class="token operator">+</span>bean<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//拿到properties</span>                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">></span></span> properties <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">"property"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                properties<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>property <span class="token operator">-></span><span class="token punctuation">&#123;</span>                    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"获取property-> "</span> <span class="token operator">+</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">Element</span> element <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> property<span class="token punctuation">;</span>                    <span class="token class-name">String</span> name <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> arg <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> ref <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"ref"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> methodName <span class="token operator">=</span> <span class="token string">"set"</span><span class="token operator">+</span>name<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"methodName="</span><span class="token operator">+</span>methodName<span class="token operator">+</span><span class="token string">" arg="</span><span class="token operator">+</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">Object</span> actualValue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                        <span class="token comment">//获得属性</span>                        <span class="token class-name">Field</span> field <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token class-name">Method</span> method <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>methodName<span class="token punctuation">,</span> field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"参数类型->"</span><span class="token operator">+</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>ref <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                            <span class="token comment">//如果参数是引用数据类型</span>                            method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span>beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> arg <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                            <span class="token comment">//参数是简单数据类型</span>                            <span class="token keyword">switch</span> <span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                                <span class="token keyword">case</span> <span class="token string">"boolean"</span><span class="token punctuation">,</span><span class="token string">"Boolean"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token function">parseBoolean</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"byte"</span><span class="token punctuation">,</span><span class="token string">"Byte"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Byte</span><span class="token punctuation">.</span><span class="token function">parseByte</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"short"</span><span class="token punctuation">,</span><span class="token string">"Short"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Short</span><span class="token punctuation">.</span><span class="token function">parseShort</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"int"</span><span class="token punctuation">,</span><span class="token string">"Integer"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"long"</span><span class="token punctuation">,</span> <span class="token string">"Long"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"float"</span><span class="token punctuation">,</span><span class="token string">"Float"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"double"</span><span class="token punctuation">,</span><span class="token string">"Double"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"char"</span><span class="token punctuation">,</span><span class="token string">"Character"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> arg<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"String"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> arg<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                            method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span>actualValue<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre></li></ol><p>代码很长，别急我们一步步分析：</p><p>这段代码做三件事：</p><ol><li><p>通过 <code>document = reader.read(ClassLoader.getSystemClassLoader().getResourceAsStream(resource));</code>拿到配置文件。</p></li><li><p>拿到所以的bean标签,获取标签的name属性和和class属性值，name属性值是这个bean的id，class是这个类的全限定类名。</p></li><li><p>通过反射机制实例化对象，并放到map集合中。</p><p>这一步相当于把bean放入二级缓存中，提前暴露bean。map集合就是二级缓存，其中key存放对象的name或id，value存放这个实例化的对象。</p></li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//1. 拿到这个xml配置文件</span><span class="token class-name">SAXReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SAXReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Document</span> document <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    document <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 获取所有的bean标签</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">></span></span> beanNodes <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">"//bean"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 遍历集合</span>    beanNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>beanNode <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Element</span> beanElt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> beanNode<span class="token punctuation">;</span>        <span class="token comment">// 获取id</span>        <span class="token class-name">String</span> id <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 获取className</span>        <span class="token class-name">String</span> className <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"id->"</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">" className->"</span><span class="token operator">+</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//通过反射拿到class</span>            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 获得class的构造器</span>            <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> constructor <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 实例化对象</span>            <span class="token class-name">Object</span> o <span class="token operator">=</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"实例化对象->"</span><span class="token operator">+</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 暴露bean，放在map（缓存）</span>            beans<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>实例化bean之后，接下里就是依赖注入了（Dependency Injection）。我们需要再次遍历每一个bean节点，一个bean节点相当于一个bean对象。对于每一个bean对象，再次遍历bean对象的<property>标签，这对于这些bena对象的属性值，对于这些属性值，我们需要通过set注入的方法给属性赋值。</property></p><p>这时候就是调用对象的set方法了，还记得调用方法的四要素吗？没错，我们需要方法所属的对象，方法名，方法参数，以及返回值类型。</p><p>其中，对象我们可以通过二级缓存拿到，也就是上一部分的map集合。方法参数也是属性值，在property标签的value属性值指明。返回值就更轻松了，set方法的返回值都是void。</p><p>那么剩下的，就是方法名了，按照Java命名规范规范，set方法名有set加上属性名的首字母大小组成，符合驼峰命名规范。我们拿到了属性值，就可以通过拼接字符串的方法来得到方法名。</p><p>但是还有一个问题，属性值有普通类型和引用类型两种，对应引用类型，我们的做法很简单，通过二级缓存拿到引用对象，再通过set方法注入就好啦。但是普通类型就比较麻烦了。</p><p>首先，普通类型太多，而我们从配置文件中拿到的数据都是字符串类型，如果目标属性是String类型的话很直接，直接调用set方法即可。但是如果属性类型是int类型，或者bool类型，我们就需要把String类型转换成对应的类型。</p><p>好在这些普通类都有对应的包装类型，通包装类型我们可以轻松的实现字符串类型的转换，所以我们需要的就是匹配每一个普通类型，对这样的类型做类型转换即可。</p><p>普通类型太多，出于学习的目的，假设我们的Spring框架只支持其中部分类型。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//再次遍历bean，给属性赋值（DI）</span>beanNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>beanNode <span class="token operator">-></span> <span class="token punctuation">&#123;</span>  <span class="token class-name">Element</span> beanElt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> beanNode<span class="token punctuation">;</span>  <span class="token comment">// 获取id</span>  <span class="token class-name">String</span> id <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 获取className</span>  <span class="token class-name">String</span> className <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 获取实例化对象</span>  <span class="token class-name">Object</span> bean <span class="token operator">=</span> beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>  logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"获取实例化对象"</span><span class="token operator">+</span>bean<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//拿到properties</span>  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">></span></span> properties <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">"property"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  properties<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>property <span class="token operator">-></span><span class="token punctuation">&#123;</span>      logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"获取property-> "</span> <span class="token operator">+</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">Element</span> element <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> property<span class="token punctuation">;</span>      <span class="token class-name">String</span> name <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">String</span> arg <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">String</span> ref <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"ref"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">String</span> methodName <span class="token operator">=</span> <span class="token string">"set"</span><span class="token operator">+</span>name<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"methodName="</span><span class="token operator">+</span>methodName<span class="token operator">+</span><span class="token string">" arg="</span><span class="token operator">+</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">Object</span> actualValue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>          <span class="token comment">//获得属性</span>          <span class="token class-name">Field</span> field <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">Method</span> method <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>methodName<span class="token punctuation">,</span> field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"参数类型->"</span><span class="token operator">+</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">if</span><span class="token punctuation">(</span>ref <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>              <span class="token comment">//如果参数是引用数据类型</span>              method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span>beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> arg <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>              <span class="token comment">//参数是简单数据类型</span>              <span class="token keyword">switch</span> <span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                  <span class="token keyword">case</span> <span class="token string">"boolean"</span><span class="token punctuation">,</span><span class="token string">"Boolean"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token function">parseBoolean</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"byte"</span><span class="token punctuation">,</span><span class="token string">"Byte"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Byte</span><span class="token punctuation">.</span><span class="token function">parseByte</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"short"</span><span class="token punctuation">,</span><span class="token string">"Short"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Short</span><span class="token punctuation">.</span><span class="token function">parseShort</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"int"</span><span class="token punctuation">,</span><span class="token string">"Integer"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"long"</span><span class="token punctuation">,</span> <span class="token string">"Long"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"float"</span><span class="token punctuation">,</span><span class="token string">"Float"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"double"</span><span class="token punctuation">,</span><span class="token string">"Double"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"char"</span><span class="token punctuation">,</span><span class="token string">"Character"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> arg<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"String"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> arg<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>              <span class="token punctuation">&#125;</span>              method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span>actualValue<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span></code></pre><p>最后，提供一个getBean方法的接口，用于活动实例化的bean</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>到这里，我们的Spring框架就算编写完了，打包发布吧！</p><img src="image-20230609140316257.png" alt="image-20230609140316257" style="zoom:30%;" loading="lazy"><h3 id="测试自己的Spring框架">测试自己的Spring框架</h3><p>创建一个Maven模块，并引入刚刚打包好的jar包吧</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>cn.loulan<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>MySpring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>首先，我们需要一个Bean类</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">float</span> points<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isActive<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setIsActive</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> active<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        isActive <span class="token operator">=</span> active<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>然后是Spring配置文件</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>beans<span class="token punctuation">></span></span>    <span class="token generics"><span class="token punctuation">&lt;</span>beans<span class="token punctuation">></span></span>        <span class="token operator">&lt;</span>bean name<span class="token operator">=</span><span class="token string">"user"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bean.User"</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"id"</span> value<span class="token operator">=</span><span class="token string">"1"</span><span class="token operator">/</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"username"</span> value<span class="token operator">=</span><span class="token string">"sonetto"</span><span class="token operator">/</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"password"</span> value<span class="token operator">=</span><span class="token string">"123456"</span><span class="token operator">/</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"points"</span> value<span class="token operator">=</span><span class="token string">"12.3"</span><span class="token operator">/</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"isActive"</span> value<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>        <span class="token operator">&lt;</span>bean name<span class="token operator">=</span><span class="token string">"userDao"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bean.UserDao"</span><span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span>bean name<span class="token operator">=</span><span class="token string">"userService"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bean.UserService"</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"userDao"</span> ref<span class="token operator">=</span><span class="token string">"userDao"</span><span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">></span></code></pre><p>编写测试类：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">ClassPathXmlApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">DefaultSingletonBeanRegistry</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestBean</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"mySpring.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><img src="image-20230609140900802.png" alt="image-20230609140900802" loading="lazy"></p><p>跑起来了！</p>]]></content>
    
    
    <summary type="html">在实例化一个对象时，我们通过`ClassPathXmlApplicationContext()`，传入我们的配置文件，拿到一个`ApplicationContext`对象，通过`ApplicationContext`对象调用`getBean（）`方法来获取对象, 最终调用对象发方法，来使用Bean。</summary>
    
    
    
    <category term="spring" scheme="https://trevoewu.github.io/categories/spring/"/>
    
    <category term="java" scheme="https://trevoewu.github.io/categories/spring/java/"/>
    
    <category term="javaweb" scheme="https://trevoewu.github.io/categories/spring/java/javaweb/"/>
    
    
    <category term="spring" scheme="https://trevoewu.github.io/tags/spring/"/>
    
  </entry>
  
  <entry>
    <title>Spring 学习笔记</title>
    <link href="https://trevoewu.github.io/2023/06/03/Spring-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>https://trevoewu.github.io/2023/06/03/Spring-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2023-06-03T07:49:54.000Z</published>
    <updated>2023-06-10T08:43:20.933Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Spring概述">Spring概述</h2><ul><li><p><strong>Spring框架</strong>是<a href="https://zh.wikipedia.org/wiki/Java">Java</a>平台的一个<a href="https://zh.wikipedia.org/wiki/%E5%BC%80%E6%94%BE%E6%BA%90%E4%BB%A3%E7%A0%81">开源</a>的全栈（<a href="https://zh.wikipedia.org/wiki/%E5%85%A8%E6%A0%88">full-stack</a>）<a href="https://zh.wikipedia.org/wiki/%E8%BD%AF%E4%BB%B6%E6%A1%86%E6%9E%B6">应用程式框架</a>和<a href="https://zh.wikipedia.org/wiki/%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC">控制反转</a>容器实现，一般被直接称为Spring。</p></li><li><p><strong>Spring</strong>是一个轻量级的控制<strong>反转(IoC)<strong>和面向</strong>切面(AOP)<strong>的</strong>容器框架</strong>。</p></li><li><p>Spring最初的出现是为了解决EJB臃肿的设计，以及难以测试等问题。</p></li><li><p>Spring为简化开发而生，让程序员只需关注核心业务的实现，尽可能的不再关注非业务逻辑代码（事务控制，安全日志等）。</p></li></ul><h2 id="Spring特点">Spring特点</h2><ol><li><p>轻量</p></li><li><ol><li>从大小与开销两方面而言Spring都是轻量的。完整的Spring框架可以在一个大小只有1MB多的JAR文件里发布。并且Spring所需的处理开销也是微不足道的。</li><li>Spring<strong>是非侵入式</strong>的：Spring应用中的对象不依赖于Spring的特定类。</li></ol></li><li><p><strong>控制反转</strong></p></li><li><ol><li>Spring通过一种称作控制反转（IoC）的技术促进了松耦合。当应用了IoC，一个对象依赖的其它对象会通过被动的方式传递进来，而不是这个对象自己创建或者查找依赖对象。你可以认为IoC与JNDI相反——不是对象从容器中查找依赖，而是容器在对象初始化时不等对象请求就主动将依赖传递给它。</li></ol></li><li><p><strong>面向切面</strong></p></li><li><ol><li>Spring提供了面向切面编程的丰富支持，允许通过分离应用的业务逻辑与系统级服务（例如审计（auditing）和事务（transaction）管理）进行内聚性的开发。应用对象只实现它们应该做的——完成业务逻辑——仅此而已。它们并不负责（甚至是意识）其它的系统级关注点，例如日志或事务支持。</li></ol></li><li><p>容器</p></li><li><ol><li>Spring包含并管理应用对象的配置和生命周期，在这个意义上它是一种容器，你可以配置你的每个bean如何被创建——基于一个可配置原型（prototype），你的bean可以创建一个单独的实例或者每次需要时都生成一个新的实例——以及它们是如何相互关联的。然而，Spring不应该被混同于传统的重量级的EJB容器，它们经常是庞大与笨重的，难以使用。</li></ol></li><li><p>框架</p></li><li><ol><li>Spring可以将简单的组件配置、组合成为复杂的应用。在Spring中，应用对象被声明式地组合，典型地是在一个XML文件里。Spring也提供了很多基础功能（事务管理、持久化框架集成等等），将应用逻辑的开发留给了你。</li></ol></li></ol><p>所有Spring的这些特征使你能够编写更干净、更可管理、并且更易于测试的代码。它们也为Spring中的各种模块提供了基础支持。</p><h2 id="Spring对IOC的实现">Spring对IOC的实现</h2><ul><li><blockquote><p>控制反转（Inversion of Control，IoC）是面向对象编程中的一种设计思想，可以用来降低代码之间的耦合度，符合<strong>依赖倒置原则</strong>。</p><p>控制反转的核心是：<strong>将对象的创建权交出去，将对象和对象之间关系的管理权交出去，由第三方容器来负责创建与维护</strong>。</p><p>控制反转常见的实现方式：依赖注入（Dependency Injection，简称DI）</p></blockquote></li><li></li></ul><p><strong>Spring通过依赖注入的方式来完成Bean管理的。</strong></p><p><strong>Bean管理说的是：Bean对象的创建，以及Bean对象中属性的赋值（或者叫做Bean对象之间关系的维护）。</strong></p><p>依赖注入：</p><ul><li><p>依赖指的是对象和对象之间的关联关系。</p></li><li><p>注入指的是一种数据传递行为，通过注入行为来让对象和对象产生关系。</p><ul><li>依赖注入常见的实现方式包括两种：set注入 构造注入</li></ul><h3 id="set注入">set注入</h3><p><strong>原理：</strong></p><ol><li><p>通过<code>property</code>标签获取到属性名：userDao</p></li><li><p>通过属性名推断出set方法名：setUserDao</p></li><li><p>通过反射机制调用setUserDao()方法给属性赋值</p></li></ol><p><code>property</code>标签的name是属性名。</p><p><code>property</code>标签的ref是要注入的bean对象的id。</p><p><strong>(通过ref属性来完成bean的装配，这是bean最简单的一种装配方式。装配指的是：创建系统组件之间关联的动作)</strong></p><p>==set注入的核心实现原理：通过反射机制调用set方法来给属性赋值，让两个对象之间产生关系。==</p><p>TeacherService往往需要依赖TeacherMapper/Dao 对象， 为了降低类与类，层与层之间的耦合度，我们通常采用面向接口编程。把对象的创建权交出去，交给Spring容器来管理。由Spring容器来创建对象和维护对象与对象之间的关系。</p><p>通过在spring配置文件（如spring-config.xml）中，注册Bean，以及Bean与Bean的关系，Bean的属性值，来让Spring去创建和注入Bean。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherMapper<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mapper.teacher.TeacherMapperImpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--    基于setter的外部Bean注入--></span><span class="token comment">&lt;!--    &lt;property> 标签内的name属性是对应setter方法的方法名去掉setter，首字母小写--></span><span class="token comment">&lt;!--    在规范的Bean setter 方法中，这个值就等于Bean的属性名称--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>service.teacher.TeacherService<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherMapper<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherMapper<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre><p>在这个配置文件中，我们注册了两个Bean，<code>teacherMapper</code>和<code>teacherService</code> ，并通过set注入来给属性负责。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestTeacherService</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTeacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>          <span class="token class-name">ApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"spring.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">TeacherService</span> teacherService <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"teacherService"</span><span class="token punctuation">,</span> <span class="token class-name">TeacherService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          teacherService<span class="token punctuation">.</span><span class="token function">getTeachers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>这样，我们就可以通过<code>applicatContext</code>对象得到，<code>applicationContext</code>对象通过读取配置文件得到。</p><p>调用<code>applicatonContext.getBean(&quot;Bean id&quot;)</code>我们就可以得到实例化的Bean了。</p><h3 id="构造注入">构造注入</h3><p>==通过调用构造方法来给属性赋值。==</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    基于构造方法注入--></span><span class="token comment">&lt;!--    要求对应Bean中要有对应的构造方法--></span><span class="token comment">&lt;!--    可以通过&lt;constructor-arg>标签 注入属性值--></span><span class="token comment">&lt;!--    其中，name属性通过属性名完成注入，值为value--></span><span class="token comment">&lt;!--    index 使用属性值下标完成注入，从0开始--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>unveil a new cd<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>regulus<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>description<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>new cd<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre></li></ul><h2 id="set注入专题">set注入专题</h2><h3 id="注入外部Bean和内部Bean">注入外部Bean和内部Bean</h3><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    基于setter的外部Bean注入--></span><span class="token comment">&lt;!--    &lt;property> 标签内的name属性是对应setter方法的方法名去掉setter，首字母小写--></span><span class="token comment">&lt;!--    在规范的Bean setter 方法中，这个值就等于Bean的属性名称--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>service.teacher.TeacherService<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherMapper<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherMapper<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--    同样，我们可以基于内部Bean注入--></span><span class="token comment">&lt;!--    内部Bean就是在&lt;bean> 标签里嵌套定义的Bean--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherService2<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>service.teacher.TeacherService<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherMapper<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mapper.teacher.TeacherMapperImpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre><h3 id="注入简单类型">注入简单类型</h3><p>==如果给简单类型赋值，使用value属性或value标签。而不是ref。==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> gender<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>person<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Person<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>20<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gender<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>female<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sonetto<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>&lt;/bean</code></pre><p><strong>简单类型包括哪些呢？</strong></p><p>可以通过Spring的源码来分析一下：BeanUtils类</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanUtils</span><span class="token punctuation">&#123;</span>  <span class="token comment">//.......</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isSimpleValueType</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Void</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">!=</span> type <span class="token operator">&amp;&amp;</span> <span class="token keyword">void</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">!=</span> type <span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span><span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">isPrimitiveOrWrapper</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span><span class="token class-name">Enum</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span><span class="token class-name">CharSequence</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span><span class="token class-name">Number</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span><span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span><span class="token class-name">Temporal</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span><span class="token constant">URI</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">==</span> type <span class="token operator">||</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">==</span> type <span class="token operator">||</span><span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">==</span> type <span class="token operator">||</span><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">==</span> type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>        <span class="token comment">//........</span><span class="token punctuation">&#125;</span></code></pre><p>通过源码分析得知，简单类型包括：</p><ul><li>基本数据类型(int,char)</li><li>基本数据类型对应的包装类(String, Interger)</li><li>String或其他的CharSequence子类</li><li>Number子类</li><li>Date子类</li><li>Enum子类</li><li>URI</li><li>URL</li><li>Temporal子类</li><li>Locale</li><li>Class</li><li>另外还包括以上简单值类型对应的数组类型。</li></ul><h3 id="注入集合数组">注入集合数组</h3><h4 id="数组">数组</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> tags<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Person</span> person<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    注入数组--></span><span class="token comment">&lt;!--    1. 数组元素是简单类型--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Article<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tags<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>array</span> <span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>mac<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>c++<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>app recommend<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>array</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        数组元素是引用类型--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>person<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>array</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>person<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>array</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre><p><strong>要点：</strong></p><ul><li><strong>如果数组中是简单类型，使用value标签。</strong></li><li><strong>如果数组中是非简单类型，使用ref标签。</strong></li></ul><h4 id="集合">集合</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Library</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">></span></span> bookList<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> classifications<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">></span></span> bookSet<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    注入集合--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>library<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Library<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        注入List集合--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookList<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Book<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>爱丽丝梦游仙境<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ISBN<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1192-2313-31-13<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Book<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>追风筝的人<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ISBN<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1192-2343-34-33<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        注入set集合--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookSet<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">></span></span>               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Book<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>爱丽丝梦游仙境<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ISBN<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1192-2313-31-13<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Book<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>追风筝的人<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ISBN<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1192-2343-34-33<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        注入简单类型 String--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>classifications<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>array</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>小说<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>教育<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>array</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre><p><strong>注入List集合的时候使用list标签，如果List集合中是简单类型使用value标签，反之使用ref标签。</strong></p><p><strong>set集合中元素是简单类型的使用value标签，反之使用ref标签。</strong></p><h4 id="map">map</h4><p>==使用<map>标签和<entry key value>嵌套==</entry></map></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Color</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">></span></span> colorMap<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    注入map--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Color<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>colorMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>RED<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>255,0,255<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>GREEN<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0,255,0<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BLUE<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0,0,255<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre><h3 id="注入Propertis">注入Propertis</h3><p>==使用<props>标签嵌套<prop>标签完成。==</prop></props></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBC</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Properties</span> properties<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--注入properties--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.JDBC<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>properties<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>props</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DRIVER<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>com.mysql.jdbc.Driver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>URL<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>jdbc:mysql://localhost:3306/demo?useUnicode=true<span class="token entity named-entity" title="&amp;">&amp;amp;</span>characterEncoding=utf-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>USERNAME<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>root<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PASSWORD<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>password<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>props</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre><h3 id="注入空字符串和NULL">注入空字符串和NULL</h3><p>不注入就是<code>null</code>，空字符串可以设置<code>value=&quot;&quot;</code>注入</p><p>除此之外，还可以使用<code>&lt;value/&gt;</code>这个自闭和标签注入空字符串，以及使用<code>&lt;null/&gt;</code>标签注入null。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--空串的第一种方式--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token comment">&lt;!--空串的第二种方式--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--注入null--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vipBean<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.powernode.spring6.beans.Vip<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>null</span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre><h3 id="注入特殊符号">注入特殊符号</h3><p>XML中有5个特殊字符，分别是：&lt;、&gt;、'、&quot;、&amp;</p><p>以上5个特殊符号在XML中会被特殊对待，会被当做XML语法的一部分进行解析，如果这些特殊符号直接出现在注入的字符串当中，会报错。</p><p>解决方案包括两种：</p><ul><li>第一种：特殊符号使用转义字符代替。</li><li>第二种：将含有特殊符号的字符串放到：<!--[CDATA[]]--> 当中。因为放在CDATA区中的数据不会被XML文件解析器解析。</li></ul><p>5个特殊字符对应的转义字符分别是：</p><table><thead><tr><th><strong>特殊字符</strong></th><th><strong>转义字符</strong></th></tr></thead><tbody><tr><td>&gt;</td><td>&amp;gt;</td></tr><tr><td>&lt;</td><td>&amp;lt;</td></tr><tr><td>’</td><td>&amp;apos;</td></tr><tr><td>&quot;</td><td>&amp;quot;</td></tr><tr><td>&amp;</td><td>&amp;amp;</td></tr></tbody></table><h2 id="Bean的实例化方式">Bean的实例化方式</h2><ol><li><p>通过构造方法实例化</p></li><li><p>通过简单工厂模式实例化</p></li><li><p><strong>通过factory-bean实例化</strong></p></li><li><p>通过factoryBean接口实例化</p></li></ol><h3 id="通过构造方法实例化Bean">通过构造方法实例化Bean</h3><p>通过构造方法实例化Bean时，默认情况下Spring会在加载配置文件的时候，也就是我们调用</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">ApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"spring.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>这段代码时，Spring调用目标Bean的无参构造方法实例化Bean。</p><h3 id="通过简单工厂模式实例化Bean">通过简单工厂模式实例化Bean</h3><p>在Spring框架中，你可以使用简单工厂模式来实例化Bean。</p><ol><li>创建一个工厂类，该类负责实例化Bean并返回实例化后的对象。这个工厂类可以是一个<strong>普通的Java类，不需要实现特定的接口</strong>。</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">MyBean</span> <span class="token function">createBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 在这里进行实例化Bean的逻辑</span>        <span class="token class-name">MyBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 可以进行一些初始化操作</span>        bean<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Example Bean"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 返回实例化后的Bean对象</span>        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>在上面的示例中，<code>MyBean</code>是要实例化的Bean类，你可以根据实际情况替换为你自己的Bean类。在<code>createBean()</code>方法中，你可以根据需要进行Bean的实例化，并对其进行一些初始化操作。</p><ol start="2"><li>在你的Spring配置文件中，可以使用工厂方法来创建Bean的实例。通过在配置文件中声明一个工厂方法，Spring将调用该方法来获取Bean的实例。</li></ol><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myBean<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.BeanFactory<span class="token punctuation">"</span></span> <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>createBean<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><p>在上面的示例中，<code>id</code>属性指定了Bean的ID，<code>class</code>属性指定了工厂类的全限定名，<code>factory-method</code>属性指定了工厂类中用于创建Bean实例的方法名。</p><p>现在，当Spring容器启动时，它将使用工厂方法来实例化<code>myBean</code>。你可以通过从容器中获取该Bean来使用它。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">MyBean</span> bean <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MyBean</span><span class="token punctuation">)</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"myBean"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>通过这种方式，你可以使用简单工厂模式来实例化Bean，并将其集成到Spring框架中。</p><blockquote><p>简单工厂模式（Simple Factory Pattern）是一种创建型设计模式，它提供了一种集中化的方法来创建对象，而不需要在客户端代码中直接实例化具体的对象。</p><p>简单工厂模式由三个主要组件组成：</p><ol><li>工厂类（Factory Class）：负责创建对象的类。它包含一个或多个创建对象的静态方法，这些方法根据传入的参数或条件确定要创建的具体对象类型，并返回相应的对象实例。</li><li>产品类（Product Class）：被工厂类创建的对象。它们共享一个共同的父类或接口，并定义了一组共同的行为和属性。</li><li>客户端（Client）：使用工厂类创建对象的代码。客户端通过调用工厂类的方法来获取所需的对象，而无需直接实例化具体的产品类。</li></ol><p>简单工厂模式的工作原理如下：</p><ol><li>客户端通过调用工厂类的方法请求创建对象。</li><li>工厂类根据传入的参数或条件确定要创建的对象类型。</li><li>工厂类实例化相应的对象，并返回给客户端。</li><li>客户端使用返回的对象进行后续操作。</li></ol><p>简单工厂模式的优点包括：</p><ul><li>将对象的创建逻辑集中在工厂类中，客户端无需知道具体的对象实现。</li><li>简化了客户端代码，客户端只需要关注如何使用对象，而不需要关注对象的创建过程。</li><li>通过工厂类可以轻松添加新的产品类，无需修改客户端代码。</li></ul><p>然而，简单工厂模式也有一些局限性：</p><ul><li>如果需要添加新的产品类，需要修改工厂类的代码，违背了开闭原则。</li><li>工厂类的职责较重，可能会导致类的职责不够单一。</li><li>客户端只能通过工厂类提供的方法来创建对象，缺乏灵活性。</li></ul><p>简单工厂模式适用于对象的创建逻辑相对简单、对象类型较少且不经常变化的情况。对于复杂的对象创建逻辑或对象类型频繁变化的情况，可以考虑使用其他创建型设计模式，如工厂方法模式或抽象工厂模式。</p></blockquote><h3 id="Bean的生命周期">Bean<strong>的生命周期</strong></h3><ol><li>五步<ol><li>实例化Bean。默认使用无参数构造方法new一个Bean</li><li>注入Bean。通过Settet方法给属性赋值</li><li>初始化Bean。调用Bean的init方法，这个方法需要程序员自己编写，下destoy方法同。</li><li>使用Bean。</li><li>销毁Bean。调用bean的destroy方法。</li></ol></li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"1. new cat is instantiated"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">miao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"4. cat: miao miao miao...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"2. bean resign properties"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"3. cat is initialized"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"5. cat is destroyed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cat<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Cat<span class="token punctuation">"</span></span> <span class="token attr-name">init-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>init<span class="token punctuation">"</span></span> <span class="token attr-name">destroy-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>destroy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Mio<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre><p><img src="image-20230605164041553.png" alt="image-20230605164041553" loading="lazy"></p><ol><li><p><strong>七步（需要掌握）</strong></p><ol><li>实例化Bean。默认使用无参数构造方法new一个Bean</li><li>注入Bean。通过Settet方法给属性赋值</li><li>==Bean后处理器Before方法执行==</li><li>初始化Bean。调用Bean的init方法，这个方法需要程序员自己编写，下destoy方法同。==←在这里插入==</li><li>==Bean后处理器的After方法执行==</li><li>使用Bean。</li><li>销毁Bean。调用bean的destroy方法。</li></ol><p>在以上的5步中，第3步是初始化Bean，如果你还想在初始化前和初始化后添加代码，可以加入“Bean后处理器”。</p><p>编写一个类实现BeanPostProcessor类，并且重写before和after方法：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">BeansException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">BeanPostProcessor</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"------------------------>beforeInitialization"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">BeanPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"------------------------>afterInitialization"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">BeanPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>在spring.xml文件中配置“Bean后处理器”：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    在spring.xml文件中配置“Bean后处理器”：--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.PostProcessor<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><p>==一定要注意：在spring.xml文件中配置的Bean后处理器将作用于当前配置文件中所有的Bean。==</p></li><li><p>十步</p><ol><li><p>实例化Bean。默认使用无参数构造方法new一个Bean</p></li><li><p>注入Bean。通过Settet方法给属性赋值</p></li><li><p>==检查Bean是否实现了Aware相关接口，并设置相关依赖。==</p></li><li><p>Bean后处理器Before方法执行</p></li><li><p>==检查Bean是否实现了InitializingBean接口 &amp; 调用接口方法。==</p></li><li><p>初始化Bean。调用Bean的init方法，这个方法需要程序员自己编写，下destoy方法同。</p></li><li><p>Bean后处理器的After方法执行</p></li><li><p>使用Bean。</p></li><li><p>==检查Bean是否实现了DisposableBean接口，并调用接口方法==</p></li><li><p>销毁Bean。调用bean的destroy方法。</p></li></ol></li></ol><p>Aware相关的接口包括：BeanNameAware、BeanClassLoaderAware、BeanFactoryAware</p><ul><li>当Bean实现了BeanNameAware，Spring会将Bean的名字传递给Bean。</li><li>当Bean实现了BeanClassLoaderAware，Spring会将加载该Bean的类加载器传递给Bean。</li><li>当Bean实现了BeanFactoryAware，Spring会将Bean工厂对象传递给Bean。</li></ul><p>测试以上10步，可以让User类实现5个接口，并实现所有方法：</p><ul><li>BeanNameAware</li><li>BeanClassLoaderAware</li><li>BeanFactoryAware</li><li>InitializingBean</li><li>DisposableBean</li></ul><h2 id="Bean的循环依赖问题">Bean的循环依赖问题</h2><h3 id="Overview">Overview</h3><p>Bean的循环依赖指的是在Spring容器中存在相互依赖的Bean实例。这种循环依赖会导致Bean的创建过程陷入死循环或无法完成，从而导致应用程序无法正常启动或出现其他异常。</p><p>循环依赖通常发生在以下情况下：</p><ol><li><strong>构造函数循环依赖</strong>：一个Bean的构造函数参数依赖于另一个Bean，而另一个Bean的构造函数参数又依赖于第一个Bean。这种情况下，当容器尝试实例化其中一个Bean时，它需要先实例化另一个Bean，而后者又依赖于前者，从而导致循环依赖。</li><li><strong>属性循环依赖</strong>：一个Bean的属性依赖于另一个Bean，而另一个Bean的属性又依赖于第一个Bean。这种情况下，当容器尝试为一个Bean注入属性时，它需要先实例化另一个Bean，而后者又依赖于前者，从而导致循环依赖。</li></ol><p>Spring框架通过使用<strong>三级缓存</strong>来解决Bean的循环依赖问题。在实例化Bean的过程中，如果发现循环依赖，Spring会先创建一个尚未完成初始化的早期对象并缓存起来，然后继续完成当前Bean的实例化和初始化。当其他Bean需要访问当前Bean时，将返回该早期对象。待当前Bean初始化完成后，Spring会将其设置到早期对象中，从而解决循环依赖。</p><p>然而，需要注意的是，循环依赖可能会导致潜在的问题，如死锁或不确定性状态。因此，应该尽量避免循环依赖的产生，合理设计Bean之间的依赖关系，或者考虑通过重构代码来消除循环依赖。</p><h3 id="Spring的三级缓存">Spring的三级缓存</h3><p>Spring为什么可以解决set + singleton模式下循环依赖？</p><p>==根本的原因在于：这种方式可以做到将“实例化Bean”和“给Bean属性赋值”这两个动作分开去完成。==</p><p>实例化Bean的时候：调用无参数构造方法来完成。<strong>此时可以先不给属性赋值，可以提前将该Bean对象“曝光”给外界。</strong></p><p>给Bean属性赋值的时候：调用setter方法来完成。</p><p>两个步骤是完全可以分离开去完成的，并且这两步不要求在同一个时间点上完成。</p><p>也就是说，Bean都是单例的，我们可以先把所有的单例Bean实例化出来，放到一个集合当中（我们可以称之为缓存），所有的单例Bean全部实例化完成之后，以后我们再慢慢的调用setter方法给属性赋值。这样就解决了循环依赖的问题。</p><p>那么在Spring框架底层源码级别上是如何实现的呢？请看：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultSingletonBeanRegistry</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleAliasRegistry</span> <span class="token keyword">implements</span> <span class="token class-name">SingletonBeanRegistry</span> <span class="token punctuation">&#123;</span>   <span class="token comment">/** Maximum number of suppressed exceptions to preserve. */</span>   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">SUPPRESSED_EXCEPTIONS_LIMIT</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span><span class="token comment">// 1. 一级缓存 单例对象缓存池</span>   <span class="token comment">/** Cache of singleton objects: bean name to bean instance. */</span>   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> singletonObjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 3. 三级缓存 原始对象缓存池</span>   <span class="token comment">/** Cache of singleton factories: bean name to ObjectFactory. */</span>   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ObjectFactory</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span><span class="token punctuation">></span></span> singletonFactories <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2. 二级缓存 早期对象缓存池</span>   <span class="token comment">/** Cache of early singleton objects: bean name to bean instance. */</span>   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> earlySingletonObjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>Spring的三级缓存（Three-Level Cache）是Spring框架在处理Bean实例化和循环依赖时使用的一种机制。它是为了解决Bean的循环依赖问题而引入的。</p><p>三级缓存在Spring容器的Bean生命周期中扮演重要角色，它包含了以下三个层次的缓存：</p><ol><li><p>第一级缓存：单例对象缓存池（Singleton Cache）。</p><ul><li>第一级缓存是Spring容器中的单例Bean缓存。</li><li><strong>当Spring容器创建一个单例Bean时，会首先尝试从第一级缓存中获取已经创建的实例。</strong></li><li>如果能够找到实例，则直接返回给调用者，避免重复实例化相同的单例Bean。</li><li>第一级缓存的键值对结构为 <code>&lt;Bean名称, Bean实例&gt;</code>。</li></ul></li><li><p>第二级缓存：早期对象缓存池（Early-Stage Object Cache）。</p><ul><li><strong>第二级缓存用于解决Bean的循环依赖问题。</strong></li><li>当Bean实例化过程中存在循环依赖时，Spring会将已经创建但尚未完成初始化的Bean对象放入第二级缓存中。</li><li>早期对象指的是在Bean实例化过程中已经创建出来但尚未完全初始化的对象。</li><li>通过第二级缓存，Spring能够在后续的Bean初始化阶段中解决循环依赖，将依赖的Bean设置到早期对象中。</li><li>第二级缓存的键值对结构为 <code>&lt;Bean名称, 早期对象&gt;</code>。</li></ul></li><li><p>第三级缓存：原始对象缓存池（Raw Object Cache）。</p><ul><li><p>第三级缓存是最底层的缓存，用于存储尚未经过任何处理的原始Bean对象。</p></li><li><p>当容器创建Bean时，如果无法从第一级和第二级缓存中获取Bean实例，Spring会将正在创建的Bean放入第三级缓存中，作为缓存的最后一道防线。</p></li><li><p>原始对象指的是尚未经过任何处理的初始对象，尚未进行依赖注入等操作。</p></li><li><p>通过第三级缓存，Spring可以确保在解决循环依赖后，将原始对象进行进一步的初始化操作。</p></li><li><p>第三级缓存的键值对结构为 <code>&lt;Bean名称, 原始对象&gt;</code>。</p></li></ul></li></ol><p>在Bean的实例化过程中，Spring框架会依次尝试从三级缓存中获取Bean的实例，以满足依赖注入和循环依赖的需求。这种缓存机制使得Spring能够高效地处理复杂的Bean依赖关系，保证了Bean的正确创建和初始化。</p><p>需要注意的是，<strong>三级缓存仅在处理单例（Singleton）作用域的Bean时使用，对于其他作用域（如原型Prototype）的Bean，不会使用三级缓存。每次请求原型Bean时，Spring都会创建一个新的实例，避免了循环依赖的问题。</strong></p><h2 id="手写Spring框架">手写Spring框架</h2><p>Spring底层是通过反射机制来实例化对象，以及属性注入的，在手写Spring框架之前，我们需要了解反射机制。</p><blockquote><p>JAVA反射机制是在运行状态中，对于任意一个类，都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意一个方法和属性；这种动态获取的信息以及动态调用对象的方法的功能称为java语言的反射机制。Java反射机制在框架设计中极为广泛，需要深入理解。</p></blockquote><p>通过反射，我们可以拿到类的属性，方法。 回顾Spring框架，我们需要编写一个spring的配置文件例如：spring.xml，在这个配置文件中，我们注册一个类，并注入属性值。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sonetto<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>123456<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>points<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>12.3<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>isActive<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.UserDao<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.UserService<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span></code></pre><p>在实例化一个对象时，我们通过<code>ClassPathXmlApplicationContext()</code>，传入我们的配置文件，拿到一个<code>ApplicationContext</code>对象，通过<code>ApplicationContext</code>对象调用<code>getBean（）</code>方法来获取对象, 最终调用对象发方法，来使用Bean。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"mySpring.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"userService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        userService<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>我们的最终目的就是调用对象的方法，而一个指定一个方法需要四要素： 什么对象（对象的全限定类名是什么？）什么方法（方法名），什么参数（参数的类型和数量），返回什么值。</p><p>指定来这方法的四个要素，我们就可以唯一的确定一个方法，然后调用该方法。</p><p>在spring的配置文件中，注册一个Bean时，我们需要提供这个Bean的全限定类名，也就是Bean标签内的class属性的内容。有了全限定类名，我们就可以通过反射机制调用<code>class.forName()</code>拿到这个对象的类。更进一步，通过这个类拿到构造方法，实例化对象。拿到我们需要的目标方法，最终调用这个目标方法。</p><p>有了整个大概的全景图，我们就可以开始编写我们自己的Spring框架了。</p><ol><li>首先，让我们先编写一个<code>ApplicationContext</code> 接口类，这个类定义了<code>getBean()</code>方法</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>spring</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApplicationContext</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><ol start="2"><li>然后编写该接口的实现类<code>ClassPathXmlApplicationContext</code> 我们正是通过这个类来实例化一个<code>ApplicationContext</code> 对象。回顾<code>ApplicationContext context = new ClassPathXmlApplicationContext(&quot;mySpring.xml&quot;);</code> 这段代码，实例化这个类时，我们需要一个参数——Spring配置文件，这个参数对应一个构造方法，所以我们的<code>ClassPathXmlApplicationContext</code>也需要提供这个构造方法。</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">String</span> resource<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></code></pre><ol start="3"><li><p>我们需要读取使用这个框架的配置文件，并拿到所有的Bean标签。要拿到这个xml文件并读取里面的标签已经属性，我们可以借助<code>SAXReader</code> 这个类来完成。通过Maven我们可以轻松的引入这个jar包。同时，我们还需要解析这个xml文件，通过<code>Document</code> 来完成。所以我还需要dom4j的依赖。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--        dom4j依赖--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.dom4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>dom4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.1.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        jaxen的依赖，因为要使用它解析XML文件--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>jaxen<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jaxen<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>接下来就是愉快的编写代码啦！</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>spring</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">Document</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">DocumentException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">Element</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">Node</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">SAXReader</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Constructor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassPathXmlApplicationContext</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContext</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span>beans <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">String</span> resource<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1. 拿到这个xml配置文件</span>        <span class="token class-name">SAXReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SAXReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Document</span> document <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            document <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 获取所有的bean标签</span>            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">></span></span> beanNodes <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">"//bean"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 遍历集合</span>            beanNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>beanNode <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Element</span> beanElt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> beanNode<span class="token punctuation">;</span>                <span class="token comment">// 获取id</span>                <span class="token class-name">String</span> id <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 获取className</span>                <span class="token class-name">String</span> className <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"id->"</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">" className->"</span><span class="token operator">+</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">//通过反射拿到class</span>                    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// 获得class的构造器</span>                    <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> constructor <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// 实例化对象</span>                    <span class="token class-name">Object</span> o <span class="token operator">=</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"实例化对象->"</span><span class="token operator">+</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// 暴露bean，放在map（缓存）</span>                    beans<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//再次遍历bean，给属性赋值（DI）</span>            beanNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>beanNode <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Element</span> beanElt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> beanNode<span class="token punctuation">;</span>                <span class="token comment">// 获取id</span>                <span class="token class-name">String</span> id <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 获取className</span>                <span class="token class-name">String</span> className <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 获取实例化对象</span>                <span class="token class-name">Object</span> bean <span class="token operator">=</span> beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>                logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"获取实例化对象"</span><span class="token operator">+</span>bean<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//拿到properties</span>                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">></span></span> properties <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">"property"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                properties<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>property <span class="token operator">-></span><span class="token punctuation">&#123;</span>                    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"获取property-> "</span> <span class="token operator">+</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">Element</span> element <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> property<span class="token punctuation">;</span>                    <span class="token class-name">String</span> name <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> arg <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> ref <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"ref"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> methodName <span class="token operator">=</span> <span class="token string">"set"</span><span class="token operator">+</span>name<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"methodName="</span><span class="token operator">+</span>methodName<span class="token operator">+</span><span class="token string">" arg="</span><span class="token operator">+</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">Object</span> actualValue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                        <span class="token comment">//获得属性</span>                        <span class="token class-name">Field</span> field <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token class-name">Method</span> method <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>methodName<span class="token punctuation">,</span> field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"参数类型->"</span><span class="token operator">+</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>ref <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                            <span class="token comment">//如果参数是引用数据类型</span>                            method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span>beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> arg <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                            <span class="token comment">//参数是简单数据类型</span>                            <span class="token keyword">switch</span> <span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                                <span class="token keyword">case</span> <span class="token string">"boolean"</span><span class="token punctuation">,</span><span class="token string">"Boolean"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token function">parseBoolean</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"byte"</span><span class="token punctuation">,</span><span class="token string">"Byte"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Byte</span><span class="token punctuation">.</span><span class="token function">parseByte</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"short"</span><span class="token punctuation">,</span><span class="token string">"Short"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Short</span><span class="token punctuation">.</span><span class="token function">parseShort</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"int"</span><span class="token punctuation">,</span><span class="token string">"Integer"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"long"</span><span class="token punctuation">,</span> <span class="token string">"Long"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"float"</span><span class="token punctuation">,</span><span class="token string">"Float"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"double"</span><span class="token punctuation">,</span><span class="token string">"Double"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"char"</span><span class="token punctuation">,</span><span class="token string">"Character"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> arg<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"String"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> arg<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                            method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span>actualValue<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre></li></ol><p>代码很长，别急我们一步步分析：</p><p>这段代码做三件事：</p><ol><li><p>通过 <code>document = reader.read(ClassLoader.getSystemClassLoader().getResourceAsStream(resource));</code>拿到配置文件。</p></li><li><p>拿到所以的bean标签,获取标签的name属性和和class属性值，name属性值是这个bean的id，class是这个类的全限定类名。</p></li><li><p>通过反射机制实例化对象，并放到map集合中。</p><p>这一步相当于把bean放入二级缓存中，提前暴露bean。map集合就是二级缓存，其中key存放对象的name或id，value存放这个实例化的对象。</p></li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//1. 拿到这个xml配置文件</span><span class="token class-name">SAXReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SAXReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Document</span> document <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    document <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 获取所有的bean标签</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">></span></span> beanNodes <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">"//bean"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 遍历集合</span>    beanNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>beanNode <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Element</span> beanElt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> beanNode<span class="token punctuation">;</span>        <span class="token comment">// 获取id</span>        <span class="token class-name">String</span> id <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 获取className</span>        <span class="token class-name">String</span> className <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"id->"</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">" className->"</span><span class="token operator">+</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//通过反射拿到class</span>            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 获得class的构造器</span>            <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> constructor <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 实例化对象</span>            <span class="token class-name">Object</span> o <span class="token operator">=</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"实例化对象->"</span><span class="token operator">+</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 暴露bean，放在map（缓存）</span>            beans<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>实例化bean之后，接下里就是依赖注入了（Dependency Injection）。我们需要再次遍历每一个bean节点，一个bean节点相当于一个bean对象。对于每一个bean对象，再次遍历bean对象的<property>标签，这对于这些bena对象的属性值，对于这些属性值，我们需要通过set注入的方法给属性赋值。</property></p><p>这时候就是调用对象的set方法了，还记得调用方法的四要素吗？没错，我们需要方法所属的对象，方法名，方法参数，以及返回值类型。</p><p>其中，对象我们可以通过二级缓存拿到，也就是上一部分的map集合。方法参数也是属性值，在property标签的value属性值指明。返回值就更轻松了，set方法的返回值都是void。</p><p>那么剩下的，就是方法名了，按照Java命名规范规范，set方法名有set加上属性名的首字母大小组成，符合驼峰命名规范。我们拿到了属性值，就可以通过拼接字符串的方法来得到方法名。</p><p>但是还有一个问题，属性值有普通类型和引用类型两种，对应引用类型，我们的做法很简单，通过二级缓存拿到引用对象，再通过set方法注入就好啦。但是普通类型就比较麻烦了。</p><p>首先，普通类型太多，而我们从配置文件中拿到的数据都是字符串类型，如果目标属性是String类型的话很直接，直接调用set方法即可。但是如果属性类型是int类型，或者bool类型，我们就需要把String类型转换成对应的类型。</p><p>好在这些普通类都有对应的包装类型，通包装类型我们可以轻松的实现字符串类型的转换，所以我们需要的就是匹配每一个普通类型，对这样的类型做类型转换即可。</p><p>普通类型太多，出于学习的目的，假设我们的Spring框架只支持其中部分类型。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//再次遍历bean，给属性赋值（DI）</span>beanNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>beanNode <span class="token operator">-></span> <span class="token punctuation">&#123;</span>  <span class="token class-name">Element</span> beanElt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> beanNode<span class="token punctuation">;</span>  <span class="token comment">// 获取id</span>  <span class="token class-name">String</span> id <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 获取className</span>  <span class="token class-name">String</span> className <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 获取实例化对象</span>  <span class="token class-name">Object</span> bean <span class="token operator">=</span> beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>  logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"获取实例化对象"</span><span class="token operator">+</span>bean<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//拿到properties</span>  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">></span></span> properties <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">"property"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  properties<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>property <span class="token operator">-></span><span class="token punctuation">&#123;</span>      logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"获取property-> "</span> <span class="token operator">+</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">Element</span> element <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> property<span class="token punctuation">;</span>      <span class="token class-name">String</span> name <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">String</span> arg <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">String</span> ref <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"ref"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">String</span> methodName <span class="token operator">=</span> <span class="token string">"set"</span><span class="token operator">+</span>name<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"methodName="</span><span class="token operator">+</span>methodName<span class="token operator">+</span><span class="token string">" arg="</span><span class="token operator">+</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">Object</span> actualValue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>          <span class="token comment">//获得属性</span>          <span class="token class-name">Field</span> field <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">Method</span> method <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>methodName<span class="token punctuation">,</span> field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"参数类型->"</span><span class="token operator">+</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">if</span><span class="token punctuation">(</span>ref <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>              <span class="token comment">//如果参数是引用数据类型</span>              method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span>beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> arg <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>              <span class="token comment">//参数是简单数据类型</span>              <span class="token keyword">switch</span> <span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                  <span class="token keyword">case</span> <span class="token string">"boolean"</span><span class="token punctuation">,</span><span class="token string">"Boolean"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token function">parseBoolean</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"byte"</span><span class="token punctuation">,</span><span class="token string">"Byte"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Byte</span><span class="token punctuation">.</span><span class="token function">parseByte</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"short"</span><span class="token punctuation">,</span><span class="token string">"Short"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Short</span><span class="token punctuation">.</span><span class="token function">parseShort</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"int"</span><span class="token punctuation">,</span><span class="token string">"Integer"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"long"</span><span class="token punctuation">,</span> <span class="token string">"Long"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"float"</span><span class="token punctuation">,</span><span class="token string">"Float"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"double"</span><span class="token punctuation">,</span><span class="token string">"Double"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"char"</span><span class="token punctuation">,</span><span class="token string">"Character"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> arg<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"String"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> arg<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>              <span class="token punctuation">&#125;</span>              method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span>actualValue<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span></code></pre><p>最后，提供一个getBean方法的接口，用于活动实例化的bean</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>到这里，我们的Spring框架就算编写完了，打包发布吧！</p><img src="image-20230609140316257.png" alt="image-20230609140316257" style="zoom:30%;" loading="lazy"><h3 id="测试自己的Spring框架">测试自己的Spring框架</h3><p>创建一个Maven模块，并引入刚刚打包好的jar包吧</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>cn.loulan<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>MySpring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>首先，我们需要一个Bean类</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">float</span> points<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isActive<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setIsActive</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> active<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        isActive <span class="token operator">=</span> active<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>然后是Spring配置文件</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>beans<span class="token punctuation">></span></span>    <span class="token generics"><span class="token punctuation">&lt;</span>beans<span class="token punctuation">></span></span>        <span class="token operator">&lt;</span>bean name<span class="token operator">=</span><span class="token string">"user"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bean.User"</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"id"</span> value<span class="token operator">=</span><span class="token string">"1"</span><span class="token operator">/</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"username"</span> value<span class="token operator">=</span><span class="token string">"sonetto"</span><span class="token operator">/</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"password"</span> value<span class="token operator">=</span><span class="token string">"123456"</span><span class="token operator">/</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"points"</span> value<span class="token operator">=</span><span class="token string">"12.3"</span><span class="token operator">/</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"isActive"</span> value<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>        <span class="token operator">&lt;</span>bean name<span class="token operator">=</span><span class="token string">"userDao"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bean.UserDao"</span><span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span>bean name<span class="token operator">=</span><span class="token string">"userService"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bean.UserService"</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"userDao"</span> ref<span class="token operator">=</span><span class="token string">"userDao"</span><span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">></span></code></pre><p>编写测试类：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">ClassPathXmlApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">DefaultSingletonBeanRegistry</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestBean</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"mySpring.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><img src="image-20230609140900802.png" alt="image-20230609140900802" loading="lazy"></p><p>跑起来了！</p><h2 id="Spring-集成MyBatis框架">Spring 集成MyBatis框架</h2><h3 id="Overview-2">Overview</h3><ol><li><p>需要的依赖</p><ol><li>Spring-context(关联引入Spring-aop)</li><li>Spring-MyBatis（Spring 集成MyBatis）</li><li>Mysql-connetor(Mysql驱动)</li><li>Spring-jdbc（链接数据库）</li><li>MyBatis</li><li>Junit（单元测试）</li><li>druid(数据源)</li><li>Lombok</li></ol></li><li><p>配置数据库</p><ol><li>account表，字段act_no,banlance</li></ol></li><li><p>项目结构搭建</p><ol><li><p>Bean(pojo)</p><ol><li>Account</li></ol></li><li><p>mapper</p><ol><li>AccountMapper</li><li>AccountMapper.xml</li></ol></li><li><p>Service</p><ol><li>AccountService</li><li>AccountServiceImpl</li></ol></li><li><p>resources</p><ol><li><p>Spring核心配置文件Spring.xml</p><ol><li>组建扫描</li><li>事务管理器</li></ol></li><li><p>MyBatis核心配置文件MyBatis.xml</p><ol><li>注册Mapper</li><li>类别名</li><li>设置日志实现</li></ol></li><li><ul><li>该文件可以没有，大部分的配置可以转移到spring配置文件中。</li><li>如果遇到mybatis相关的系统级配置，还是需要这个文件。</li></ul></li><li><p>DB.propertis</p><ol><li>Driver→com.mysql.jdbc.Driver</li><li>url→jdbc:mysql://localhost:3307/class?useUnicode=true&amp;characterEncoding=utf-8</li><li>username→root</li><li>Password→root</li></ol></li><li><p>编写测试类</p></li></ol></li></ol></li></ol><h3 id="编写mapper">编写mapper</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Account</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountMapper</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Account</span> account<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">String</span> actNo<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Account</span> account<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Account</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">String</span> actNo<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">></span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>        <span class="token string">"https://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cn.loulan.mapper.AccountMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>insert<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        Insert into account values(#&#123;actNo&#125;,#&#123;balance&#125;)    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>update<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Account<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        update account set balance = #&#123;balance&#125; where act_no = #&#123;actNo&#125;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>delete<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>        delete account where act_no = #&#123;actNo&#125;;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delete</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getById<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Account<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select * from account where act_no =#&#123;actNo&#125;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getAll<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Account<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select * from account;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></code></pre><h3 id="Service">Service</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Account</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">boolean</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Account</span> account<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">boolean</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">String</span> actNo<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">boolean</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token class-name">Account</span> account<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Account</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">String</span> actNo<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">></span></span> <span class="token function">getAllAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">boolean</span> <span class="token function">transaction</span><span class="token punctuation">(</span><span class="token class-name">String</span> from<span class="token punctuation">,</span> <span class="token class-name">String</span> <span class="token keyword">to</span><span class="token punctuation">,</span><span class="token keyword">double</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Account</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">AccountMapper</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Transactional</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">"accountService"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Transactional</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AccountService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">AccountMapper</span> accountMapper<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMapper</span><span class="token punctuation">(</span><span class="token class-name">AccountMapper</span> mapper<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>accountMapper <span class="token operator">=</span> mapper<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Account</span> account<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       accountMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">String</span> actNo<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        accountMapper<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>actNo<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token class-name">Account</span> account<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        accountMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Account</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">String</span> actNo<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> accountMapper<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>actNo<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">></span></span> <span class="token function">getAllAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> accountMapper<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">transaction</span><span class="token punctuation">(</span><span class="token class-name">String</span> from<span class="token punctuation">,</span> <span class="token class-name">String</span> <span class="token keyword">to</span><span class="token punctuation">,</span> <span class="token keyword">double</span> amount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Account</span> fromAccount <span class="token operator">=</span> accountMapper<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Account</span> toAccount <span class="token operator">=</span> accountMapper<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>fromAccount<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> amount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"余额不足"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        fromAccount<span class="token punctuation">.</span><span class="token function">setBalance</span><span class="token punctuation">(</span>fromAccount<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span>  amount<span class="token punctuation">)</span><span class="token punctuation">;</span>        toAccount<span class="token punctuation">.</span><span class="token function">setBalance</span><span class="token punctuation">(</span>toAccount<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> count <span class="token operator">=</span> accountMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>fromAccount<span class="token punctuation">)</span><span class="token punctuation">;</span>         count <span class="token operator">+=</span> accountMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>toAccount<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"异常"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> count <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="resources">resources</h3><p>数据配置文件</p><pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token comment">#DRIVER=com.mysql.jdbc.Driver</span><span class="token key attr-name">DRIVER</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.cj.jdbc.Driver</span><span class="token key attr-name">URL</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3306/demo?useUnicode=true&amp;characterEncoding=utf-8</span><span class="token key attr-name">USERNAME</span><span class="token punctuation">=</span><span class="token value attr-value">root</span><span class="token key attr-name">PASSWORD</span><span class="token punctuation">=</span><span class="token value attr-value">root</span></code></pre><p>MyBatis核心配置文件：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">configuration</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Config 3.0//EN"</span>        <span class="token string">"https://mybatis.org/dtd/mybatis-3-config.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--日志实现--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logImpl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>STDOUT_LOGGING<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Account<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cn.loulan.bean.Account<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span></code></pre><p>Spring核心配置文件</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>tx</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/tx<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment">&lt;!--开启组件自动扫描--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cn.loulan.service<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token comment">&lt;!--    加载数据库配置文件--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DB.properties<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token comment">&lt;!--    配置数据源--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.alibaba.druid.pool.DruidDataSource<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driverClassName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;DRIVER&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;URL&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;USERNAME&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;PASSWORD&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--Mapper扫描器--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.mybatis.spring.mapper.MapperScannerConfigurer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>basePackage<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cn.loulan.mapper<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--SqlSessionFactoryBean--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.mybatis.spring.SqlSessionFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!--mybatis核心配置文件路径--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>configLocation<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mybatis.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token comment">&lt;!--注入数据源--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token comment">&lt;!--起别名--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>typeAliasesPackage<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cn.loulan.bean<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--事务管理器--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>txManager<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--开启事务注解--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>annotation-driven</span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>txManager<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span></code></pre><h3 id="编写测试类">编写测试类</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Account</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">AccountMapper</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">MybatisUtil</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSession</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">ClassPathXmlApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">mapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">MybatisUtil</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">AccountMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">AccountMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        mapper.insert(new Account("123",500.00));</span>        mapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token string">"234"</span><span class="token punctuation">,</span><span class="token number">500.00</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSpring</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"spring.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">AccountService</span> accountService <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"accountService"</span><span class="token punctuation">,</span> <span class="token class-name">AccountService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">></span></span> allAccounts <span class="token operator">=</span> accountService<span class="token punctuation">.</span><span class="token function">getAllAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        allAccounts<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>account <span class="token operator">-></span><span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"spring.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">AccountService</span> accountService <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"accountService"</span><span class="token punctuation">,</span> <span class="token class-name">AccountService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        accountService<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token string">"234"</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="总结">总结</h3><p>配置文件还是要写好多，而且完全靠记忆嘛。简单整理一下这些配置文件，主要分为两部分，spring的配置文件和mybatis的配置文件。spring配置文件中主要的配置有：</p><ol><li>注册bean，在用注解开发时开启组建自动扫描</li><li>加载数据库配置文件。</li><li>配置数据源。包括数据库的一下配置信息，驱动器啊url之类的。</li><li>Mapper扫描器。相当于在mybatis中注册mapper，使用包名扫描这个包下的所有mapper。</li><li>配置sqlSessionFactoryBean在这个bean中价值mybatis的核心配置文件，以及价值数据源，类型别名等等可以在mybatis中配置的内容都可以通过这个bean来配置。</li><li>配置事务管理器</li><li>开启事务注解</li></ol><p>这样在MyBatis配置文件的内容就少很多了，甚至可以不配或者没有。这个案例中，我们配置了日志实现和类型别名。</p><p>感觉好乱，课程的这一段讲得太快了，老杜是不是赶着吃饭啊。</p><p>Spring框架下的mybatis还是和直接用mybatis有很大区别。Spring中，我们不需要一个工具类用于价值mybatis配置文件以便获取sqlsession对象了。事务的处理也不需要管了，虽然简化了很多代码，但是总有一种项目莫名其妙就跑起来的感觉，终极还是我了解得不够多了吧。</p>]]></content>
    
    
    <summary type="html">spring 学习笔记</summary>
    
    
    
    <category term="java EE" scheme="https://trevoewu.github.io/categories/java-EE/"/>
    
    
    <category term="Spring" scheme="https://trevoewu.github.io/tags/Spring/"/>
    
    <category term="Java" scheme="https://trevoewu.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>MyBatis学习笔记</title>
    <link href="https://trevoewu.github.io/2023/05/27/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>https://trevoewu.github.io/2023/05/27/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2023-05-27T10:14:52.000Z</published>
    <updated>2023-06-09T04:41:45.731Z</updated>
    
    <content type="html"><![CDATA[<h2 id="入门之环境搭建">入门之环境搭建</h2><ol><li><p>导入依赖的jar包</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.5.13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre></li><li><p>*解决Maven静态资源过滤问题 导致生成的target文件不包含xml，导致IO错误</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>src/main/java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>**/*.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>**/*.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filtering</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filtering</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>src/main/resources<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>**/*.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>**/*.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filtering</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filtering</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">></span></span></code></pre></li><li><p>新建MyBatis配置文件→<code>mybatis-config.xml</code>, 放在<code>resource</code>目录下.</p><p>理论上放在哪里都可以, 文件名叫什么也随意, 但是按照规范来能让代码更规范, 更具有可读性.</p><p>标签:   <code> &lt;properties resource=&quot;db.properties&quot;/&gt;</code>指代数据库的属性, 用于读取<code>properties</code>, 这样我们就配置数据库的属性比如Driver, URL时直接使用配置文件中的变量.</p><p>注意 XML 头部的声明，它用来验证 XML 文档的正确性。</p><p>environment 元素体中包含了事务管理和连接池的配置。mappers 元素则包含了一组映射器（mapper），这些映射器的 XML 映射文件包含了 SQL 代码和映射定义信息。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">configuration</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Config 3.0//EN"</span>        <span class="token string">"https://mybatis.org/dtd/mybatis-3-config.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--    从db.properties读取数据库属性--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>db.properties<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;DRIVER&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;URL&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;USERNAME&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;PASSWORD&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dao.book.BookMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span></code></pre></li><li><p>编写实体类</p></li><li><p>编写dao层接口</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BookMapper</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Book</span> <span class="token function">getRelativeBook</span><span class="token punctuation">(</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"bookDesc"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> bookDesc<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre></li></ol><p>这段代码用于模糊查询同类书籍, <code>@Param</code>注解用于指明参数, 指明参数也可以通过xml文档在指明</p><ol start="5"><li><p>编写SQL</p><p>一个语句既可以通过 XML 定义，也可以通过注解定义。我们先看看 XML 定义语句的方式</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>        <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--namespace：绑定一个对应的Dao/Mapper接口--></span><span class="token comment">&lt;!--        dao.book.BookMapper--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dao.book.BookMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--select查询语句--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getRelativeBook<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Bean.Book<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select * from smbms_provider where proDesc like #&#123;bookDesc&#125;  and id != #&#123;id&#125; limit 1;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></code></pre><ul><li><p><code>Namespace</code>: 指明接口类的命名空间, 用接口类的权限定名</p><p>命名空间的作用有两个，一个是利用更长的全限定名来将不同的语句隔离开来，同时实现了接口绑定。 将命名空间置于合适的 Java 包命名空间之中，你的代码会变得更加整洁，也有利于你更方便地使用 MyBatis。</p></li><li><p><code>select</code>便签: 用于查询语句</p></li><li><p><code>id</code>: 在命名空间中唯一的标识符，可以被用来引用这条语句. 对应接口类的方法名, <strong>必须和接口类的方法名一致</strong></p></li><li><p><code>resultType</code>: 期望从这条语句中返回结果的<strong>类全限定名或别名</strong>。 注意，<strong>如果返回的是集合，那应该设置为集合包含的类型，而不是集合本身的类型</strong>。 resultType 和 resultMap 之间只能同时使用一个.</p></li><li><p><code>parameterType</code>: 将会传入这条语句的参数的<strong>类全限定名或别名</strong>。这个属性是<strong>可选</strong>的，因为 MyBatis 可以根据语句中实际传入的参数计算出应该使用的类型处理器（TypeHandler），默认值为未设置（unset）。</p></li></ul><p>为了这个简单的例子，我们似乎写了不少配置，但其实并不多。<strong>在一个 XML 映射文件中，可以定义无数个映射语句</strong>，这样一来，XML 头部和文档类型声明部分就显得微不足道了。文档的其它部分很直白，容易理解。 它在命名空间 <code>dao.book.BookMapper </code>中定义了一个名为 <code>selectBlog</code> 的映射语句</p></li><li><p>注册Mapper</p><p>在mybatis-config.xml中注册Mapper</p><pre class="language-markup" data-language="markup"><code class="language-markup"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        方式1： 通过resource注册mapper--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dao/book/BookMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span></code></pre><ol start="7"><li><p>编写获取数据库连接的工具类Util</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MybatisUtil</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span><span class="token comment">//          从 XML 文件中构建 SqlSessionFactory 的实例</span>            <span class="token class-name">String</span> resource <span class="token operator">=</span> <span class="token string">"mybatis-config.xml"</span><span class="token punctuation">;</span>            inputStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>            sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SqlSession</span> <span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>每个基于 MyBatis 的应用都是以一个<code>SqlSessionFactory</code>的实例为核心的。<code>SqlSessionFactory </code>的实例可以通过 <code>SqlSessionFactoryBuilder</code> 的<code>build</code>方法获得。而<code>SqlSessionFactoryBuilder</code>则可以从 XML 配置文件或一个预先配置的 Configuration 实例来构建出 <code>SqlSessionFactory</code> 实例。(<strong>工厂模式</strong>)</p><blockquote><p>工厂模式是一种创建型设计模式，用于封装对象的创建过程。它通过定义一个共同的接口或基类来创建对象，但具体的对象创建逻辑被移到工厂类中。这样，客户端代码只需要与工厂类交互，而不需要直接创建对象，从而降低了代码的耦合性。</p><p>通过工厂模式，代码实现了对象的创建与使用的分离，使得代码更具可维护性和扩展性。如果将来需要修改 <code>SqlSessionFactory</code> 对象的创建逻辑，只需修改 <code>MybatisUtil</code> 类中的代码，而不需要修改客户端代码。同时，工厂模式也隐藏了具体对象的创建细节，使得客户端代码更加简洁和可读。</p></blockquote><p>代码通过静态代码块在类加载时初始化了一个全局的 <code>SqlSessionFactory</code> 对象，并提供了一个公共的静态方法用于获取 <code>SqlSession</code> 实例。这样其他类在使用 MyBatis 进行数据库操作时，可以通过调用 <code>MybatisUtil.getSqlSession()</code> 方法来获取 <code>SqlSession</code> 对象，从而简化了 MyBatis 的配置和使用过程。</p><p><code>SqlSession </code>提供了在数据库执行 SQL 命令所需的所有方法。你可以通过 SqlSession 实例来直接执行已映射的 SQL 语句.</p></li><li><p>编写测试类</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetRelativeBook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">MybatisUtil</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token class-name">BookMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">BookMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token class-name">Book</span> relativeBook <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">getRelativeBook</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">"%计算机%"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>relativeBook<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></code></pre></li></ol></li></ol><h3 id="参数">参数</h3><ol><li><p>对于大多数简单的使用场景，你都不需要使用复杂的参数，比如：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUsers<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  select id, username, password from users where id = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>参数类型（parameterType）会被自动设置为 <code>int</code>，这个参数可以<strong>随意命名</strong>。原始类型或简单数据类型（比如 <code>Integer</code> 和 <code>String</code>）因为没有其它属性，会用它们的值来作为参数.</p></li><li><p>然而，如果传入一个<strong>复杂的对象</strong>，行为就会有点不一样了。比如</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>insertUser<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  insert into users (id, username, password)  values (#&#123;id&#125;, #&#123;username&#125;, #&#123;password&#125;)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span></code></pre><p>如果 User 类型的参数对象传递到了语句中，会查找 id、username 和 password 属性，然后将它们的值传入预处理语句的参数中。<strong>如果参数类型是具体的类, 参数可以直接通过属性名直接得到, 即使属性是私有的.</strong></p></li><li><p>参数类型是HashMap</p><p>这时候, 参数名会被映射为Map中的key.</p></li><li><p>@Param注解用于给方法参数起一个名字。以下是总结的使用原则：</p><ul><li>在方法只接受一个参数的情况下，可以不使用@Param。</li><li>在方法接受多个参数的情况下，建议一定要使用@Param注解给参数命名。</li><li><strong>如果参数是 JavaBean ， 则不能使用@Param。</strong></li><li>不使用@Param注解时，参数只能有一个，并且是Javabean。</li></ul></li></ol><h4 id="字符串替换">字符串替换</h4><p>默认情况下，使用 <code>#&#123;&#125;</code> 参数语法时，MyBatis 会创建 <code>PreparedStatement</code> 参数占位符，并通过占位符安全地设置参数（就像使用 <code>?</code> 一样）。 这样做更安全，更迅速，通常也是首选做法，不过有时你就是想直接在 SQL 语句中直接插入一个不转义的字符串。 比如 ORDER BY 子句，这时候你可以：</p><pre class="language-none"><code class="language-none">ORDER BY $&#123;columnName&#125;</code></pre><p>这样，MyBatis 就不会修改或转义该字符串了。</p><p>当 SQL 语句中的元数据（如表名或列名）是动态生成的时候，字符串替换将会非常有用。 举个例子，如果你想 <code>select</code> 一个表任意一列的数据时，不需要这样写：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from user where id = #&#123;id&#125;"</span><span class="token punctuation">)</span><span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from user where name = #&#123;name&#125;"</span><span class="token punctuation">)</span><span class="token class-name">User</span> <span class="token function">findByName</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from user where email = #&#123;email&#125;"</span><span class="token punctuation">)</span><span class="token class-name">User</span> <span class="token function">findByEmail</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"email"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 其它的 "findByXxx" 方法</span></code></pre><p>而是可以只写这样一个方法：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from user where $&#123;column&#125; = #&#123;value&#125;"</span><span class="token punctuation">)</span><span class="token class-name">User</span> <span class="token function">findByColumn</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"column"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> column<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>其中 <code>$&#123;column&#125;</code> 会被直接替换，而 <code>#&#123;value&#125;</code> 会使用 <code>?</code> 预处理。 这样，就能完成同样的任务：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">User</span> userOfId1 <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">findByColumn</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">User</span> userOfNameKid <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">findByColumn</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"kid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">User</span> userOfEmail <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">findByColumn</span><span class="token punctuation">(</span><span class="token string">"email"</span><span class="token punctuation">,</span> <span class="token string">"noone@nowhere.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>这种方式也同样适用于替换表名的情况。</p><blockquote><p><strong>提示</strong> :</p><p>用这种方式接受用户的输入，并用作语句参数是不安全的，会导致潜在的 SQL 注入攻击。因此，要么不允许用户输入这些字段，要么自行转义并检验这些参数。</p></blockquote><h2 id="XML配置解析">XML配置解析</h2><p>MyBatis 的配置文件包含了会深深影响 MyBatis 行为的设置和属性信息。</p><ul><li>能配置的内容如下：</li></ul><pre class="language-properties" data-language="properties"><code class="language-properties">configuration（配置）properties（属性）settings（设置）typeAliases（类型别名）typeHandlers（类型处理器）objectFactory（对象工厂）plugins（插件）environments（环境配置）environment（环境变量）transactionManager（事务管理器）dataSource（数据源）databaseIdProvider（数据库厂商标识）mappers（映射器）<span class="token key attr-name">&lt;!--</span> <span class="token value attr-value">注意元素节点的顺序！顺序不对会报错 --></span></code></pre><h3 id="environments">environments</h3><p>environments 元素定义了如何配置环境。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>...<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>...<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transactionManager</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;driver&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;url&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;username&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;password&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">></span></span></code></pre><p>注意一些关键点:</p><ul><li><p>默认使用的环境 ID（比如：default=“development”）。</p><p>环境，将SQL映射到多个不同的数据库上，**不过要记住：尽管可以配置多个环境，但每个 SqlSessionFactory 实例只能选择一种环境。**必须指定其中一个为默认运行环境（通过default指定）</p><p>环境可以随意命名，但务必保证默认的环境 ID 要匹配其中一个环境 ID。</p></li><li><p>事务管理器的配置（比如：type=“JDBC”）。</p><blockquote><p>在 MyBatis 中有两种类型的事务管理器（也就是 type=“[JDBC|MANAGED]”）：</p><ul><li>JDBC – 这个配置直接使用了 JDBC 的提交和回滚功能</li><li>MANAGED – 这个配置几乎没做什么。它从不提交或回滚一个连接，而是让容器来管理事务的整个生命周期（比如 JEE 应用服务器的上下文）。 默认情况下它会关闭连接。</li></ul><p>如果你正在使用 Spring + MyBatis，则没有必要配置事务管理器，因为 Spring 模块会使用自带的管理器来覆盖前面的配置。</p></blockquote></li><li><p>数据源的配置（比如：type=“POOLED”）。</p><p>dataSource 元素使用标准的 JDBC 数据源接口来配置 JDBC 连接对象的资源。</p></li><li><p>数据源是必须配置的。</p></li><li><p>有三种内建的数据源类型</p><pre class="language-none"><code class="language-none">type&#x3D;&quot;[UNPOOLED|POOLED|JNDI]&quot;）</code></pre></li><li><p>unpooled：</p><p>这个数据源的实现会每次请求时打开和关闭连接。虽然有点慢，但对那些数据库连接可用性要求不高的简单应用程序来说，是一个很好的选择。 性能表现则依赖于使用的数据库，对某些数据库来说，使用连接池并不重要，这个配置就很适合这种情形。</p></li><li><p><strong>pooled</strong>：</p><p>这种数据源的实现利用“池”的概念将 JDBC 连接对象组织起来 , 避免了创建新的连接实例时所必需的初始化和认证时间。 这种处理方式很流行，能使并发 Web 应用快速响应请求。</p></li><li><p>jndi：</p><p>这个数据源的实现是为了能在如 Spring 或应用服务器这类容器中使用，容器可以集中或在外部配置数据源，然后放置一个 JNDI 上下文的引用。</p></li></ul><h3 id="映射器（mappers）">映射器（mappers）</h3><p>我们需要告诉 MyBatis 到哪里去找到这些语句。 在自动查找资源方面，Java 并没有提供一个很好的解决方案，所以最好的办法是直接告诉 MyBatis 到哪里去找映射文件。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- 使用相对于类路径的资源引用 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org/mybatis/builder/AuthorMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org/mybatis/builder/BlogMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org/mybatis/builder/PostMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- 使用完全限定资源定位符（URL） --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file:///var/mappers/AuthorMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file:///var/mappers/BlogMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file:///var/mappers/PostMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- 使用映射器接口实现类的完全限定类名 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.mybatis.builder.AuthorMapper<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.mybatis.builder.BlogMapper<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.mybatis.builder.PostMapper<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- 将包内的映射器接口全部注册为映射器 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.mybatis.builder<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span></code></pre><p>⚠️注意: 使用将包内的映射器接口全部注册为映射器时, 必须保证接口和对应的mapper.xml文件名一致</p><h3 id="类型别名（typeAliases）">类型别名（typeAliases）</h3><p>类型别名可为 Java 类型设置一个缩写名字。 它仅用于 XML 配置，用于降低冗余的全限定类名书写。例如：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>domain.blog.Author<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>domain.blog.Blog<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Comment<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>domain.blog.Comment<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>domain.blog.Post<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Section<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>domain.blog.Section<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Tag<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>domain.blog.Tag<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">></span></span></code></pre><p>当这样配置时，<code>Blog</code> 可以用在任何使用 <code>domain.blog.Blog</code> 的地方。</p><p>也可以指定一个包名，MyBatis 会在包名下面搜索需要的 Java Bean，比如：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>domain.blog<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">></span></span></code></pre><p>每一个在包 <code>domain.blog</code> 中的 Java Bean，<strong>在没有注解的情况下，会使用 Bean 的首字母小写的非限定类名来作为它的别名</strong>。 比如 <code>domain.blog.Author</code> 的别名为 <code>author</code>；若有注解，则别名为其注解值.</p><h2 id="作用域（Scope）和生命周期">作用域（Scope）和生命周期</h2><p>作用域和生命周期类别是至关重要的，因为错误的使用会导致非常严重的<strong>并发问题。</strong></p><h3 id="SqlSessionFactoryBuilder">SqlSessionFactoryBuilder</h3><p>这个类可以被实例化、使用和丢弃，<strong>一旦创建了 SqlSessionFactory，就不再需要它了</strong>。因此 SqlSessionFactoryBuilder 实例的最佳作用域是方法作用域（也就是<strong>局部方法变量</strong>）。</p><h3 id="SqlSessionFactory">SqlSessionFactory</h3><p><strong>SqlSessionFactory 一旦被创建就应该在应用的运行期间一直存在</strong>，<strong>没有任何理由丢弃它或重新创建另一个实例</strong>。 使用 SqlSessionFactory 的最佳实践是在应用运行期间不要重复创建多次，多次重建 SqlSessionFactory 被视为一种代码“坏习惯”。因此 SqlSessionFactory 的最佳作用域是<strong>应用作用域(Application)</strong>。 有很多方法可以做到，最简单的就是使用<strong>单例模式</strong>或者<strong>静态单例模式。</strong></p><blockquote><p>单例模式是一种创建型设计模式，用于确保一个类只有一个实例，并提供一个全局访问点来访问该实例。它通常适用于需要在整个应用程序中共享状态或资源的情况，以及需要对实例进行严格控制的情况。</p><p>实现单例模式的关键是将类的构造函数私有化，这样就无法通过常规的方式创建类的实例。然后，通过一个静态方法或属性来创建并返回类的唯一实例。每次调用这个方法时，都会返回同一个实例。</p><p>静态单例模式是单例模式的一种变体，它使用静态变量来保存单例实例，并提供一个静态方法来获取该实例。在静态单例模式中，实例的创建和获取方法都是静态的，因此可以通过类名直接调用，无需实例化类。</p><p><strong>单例模式示例：</strong></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token operator">></span>javaCopy code<span class="token operator">></span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span>   <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       <span class="token comment">// 私有化构造函数</span>   <span class="token punctuation">&#125;</span>   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>           instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>       <span class="token keyword">return</span> instance<span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token comment">// 其他方法...</span><span class="token operator">></span><span class="token punctuation">&#125;</span></code></pre></blockquote><h3 id="SqlSession">SqlSession</h3><p><strong>每个线程都应该有它自己的 SqlSession 实例</strong>。SqlSession 的实例不是线程安全的，因此是不能被共享的，所以<strong>它的最佳的作用域是请求或方法作用域</strong>。</p><p>如果说 SqlSessionFactory 相当于数据库连接池，那么 SqlSession 就相当于一个数据库连接（Connection 对象），你可以在一个事务里面执行多条 SQL，然后通过它的 commit、rollback 等方法，提交或者回滚事务。<strong>所以它应该存活在一个业务请求中，处理完整个请求后，应该关闭这条连接，让它归还给 SqlSessionFactory，否则数据库资源就很快被耗费精光，系统就会瘫痪</strong>，所以用 try…catch…finally… 语句来保证其正确关闭。</p><p>比如 Servlet 框架中的 HttpSession, 每次收到 HTTP 请求，就可以打开一个 SqlSession，返回一个响应后，就关闭它。</p><h3 id="映射器-Mapper-实例">映射器(Mapper)实例</h3><p>映射器实例的生命周期与 SqlSession 相关联，作用域是每个 SqlSession。它们在每个 SqlSession 中创建，并在 SqlSession 关闭时销毁。可以通过依赖注入等方式实现映射器实例在不同 SqlSession 中的重用。这样可以确保映射器实例的正确性和资源的有效利用。</p><h2 id="ResultMap">ResultMap</h2><h4 id="问题引出">问题引出</h4><p>类属性名property和数据库字段名column名不一致的问题:</p><p>如果我们更改实体类的属性名把proName改为BookName, 再次执行查询我们会得到值为null.</p><p>这是因为mybatis会根据这些查询的列名(会将列名转化为小写,数据库不区分大小写) , 去对应的实体类中查找相应列名的set方法设值 , 由于找不到setProName() , 所以返回null .</p><p><img src="image-20230527214201597.png" alt="image-20230527214201597" loading="lazy"></p><p>下面介绍ResultMap来解决这个问题:</p><h4 id="解决">解决</h4><p>**<code>resultMap</code> 元素是 MyBatis 中最重要最强大的元素。它可以让你从 90% 的 JDBC <code>ResultSets</code> 数据提取代码中解放出来。**实际上，在为一些比如连接的复杂语句编写映射代码的时候，一份 <code>resultMap</code> 能够代替实现同等功能的长达数千行的代码.</p><p>ResultMap 的设计思想是，对于简单的语句根本不需要配置显式的结果映射，而对于复杂一点的语句只需要描述它们的关系就行了。</p><p>你已经见过简单映射语句的示例了，但并没有显式指定 <code>resultMap</code>。比如：</p><pre class="language-none"><code class="language-none">&lt;select id&#x3D;&quot;selectUserById&quot; resultType&#x3D;&quot;map&quot;&gt;select id , name , pwd  from user  where id &#x3D; #&#123;id&#125;&lt;&#x2F;select&gt;</code></pre><p>上述语句只是简单地将所有的列映射到 <code>HashMap</code> 的键上，这由 <code>resultType</code> 属性指定。虽然在大部分情况下都够用，但是 HashMap 不是一个很好的模型。你的程序更可能会使用 JavaBean 或 POJO（Plain Old Java Objects，普通老式 Java 对象）作为模型。</p><p><code>ResultMap</code> 最优秀的地方在于，虽然你已经对它相当了解了，但是根本就不需要显式地用到他们。看看下面这个 JavaBean：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>  <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>  <span class="token keyword">private</span> <span class="token class-name">String</span> hashedPassword<span class="token punctuation">;</span><span class="token comment">/** setter and getter...*/</span><span class="token punctuation">&#125;</span></code></pre><p>基于 JavaBean 的规范，上面这个类有 3 个属性：id，username 和 hashedPassword。<strong>这些属性会对应到 select 语句中的列名</strong>。</p><p>这样的一个 JavaBean 可以被映射到 <code>ResultSet</code>，就像映射到 <code>HashMap</code> 一样简单。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUsers<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.someapp.model.User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  select id, username, hashedPassword  from some_table  where id = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>类型别名是你的好帮手。使用它们，你就可以不用输入类的全限定名了。比如：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- mybatis-config.xml 中 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.someapp.model.User<span class="token punctuation">"</span></span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token comment">&lt;!-- SQL 映射 XML 中 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUsers<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  select id, username, hashedPassword  from some_table  where id = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>在这些情况下，MyBatis 会在幕后自动创建一个 <code>ResultMap</code>，再根据属性名来映射列到 JavaBean 的属性上。如果列名和属性名不能匹配上，可以在 SELECT 语句中设置列别名（这是一个基本的 SQL 特性）来完成匹配。比如：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUsers<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  select    user_id             as "id",    user_name           as "userName",    hashed_password     as "hashedPassword"  from some_table  where id = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>在学习了上面的知识后，你会发现上面的例子没有一个需要显式配置 <code>ResultMap</code>，这就是 <code>ResultMap</code> 的优秀之处——你完全可以不用显式地配置它们。 虽然上面的例子不用显式配置 <code>ResultMap</code>。 但为了讲解，我们来看看如果在刚刚的示例中，显式使用外部的 <code>resultMap</code> 会怎样，这也是解决列名不匹配的另外一种方式。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hashed_password<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p>然后在引用它的语句中设置 <code>resultMap</code> 属性就行了（注意我们去掉了 <code>resultType</code> 属性）。比如:</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUsers<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userResultMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  select user_id, user_name, hashed_password  from some_table  where id = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p><strong>如果这个世界总是这么简单就好了。</strong></p><h2 id="日志工厂">日志工厂</h2><p>日志记录是任何优秀软件开发过程的重要组成部分。通过日志记录，您可以检测和修复问题、了解用户的行为. 如果一个 数据库相关的操作出现了问题，我们可以根据输出的SQL语句快速排查问题。</p><p>对于以往的开发过程，我们会经常使用到debug模式来调节，跟踪我们的代码执行过程。但是现在使用Mybatis是基于接口，配置文件的源代码执行过程。因此，我们必须选择日志工具来作为我们开发，调节程序的工具。</p><p>Mybatis内置的日志工厂提供日志功能，具体的日志实现有以下几种工具：</p><ul><li>SLF4J</li><li>Apache Commons Logging</li><li><strong>Log4j 2</strong></li><li>Log4j (3.5.9 起废弃）</li><li>JDK logging</li><li>STDOUT_LOGGING</li><li>NO_LOGGING</li></ul><p>具体选择哪个日志实现工具由MyBatis的内置日志工厂确定。它会使用最先找到的（按上文列举的顺序查找）。如果一个都未找到，日志功能就会被禁用。</p><h3 id="标准日志实现-STDOUT-LOGGING">**标准日志实现 **STDOUT_LOGGING</h3><p>指定 MyBatis 应该使用哪个日志记录实现。如果此设置不存在，则会自动发现日志记录实现。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logImpl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>STDOUT_LOGGING<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">></span></span></code></pre><p>测试，可以看到控制台有大量的输出！我们可以通过这些输出来判断程序到底哪里出了Bug</p><h3 id="Log4j2"><strong>Log4j2</strong></h3><p><strong>简介：</strong></p><ul><li><a href="https://www.scalyr.com/blog/get-started-quickly-java-logging/">Log4j2 是Java</a>语言的日志记录框架，由 Apache 基金会维护。Log4j2 是对其前身 Log4j 的改进。它的主要好处是：<ul><li>API独立于实现</li><li>更好地支持并发</li><li>通过构建自定义组件轻松扩展</li></ul></li></ul><p><strong>使用步骤：</strong></p><p>1、导入log4j2的包</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--      log4j-core- 核心Log4j实现类。--></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>log4j-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.20.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--      log4j-api- 提供实现者创建日志实现所需的适配器组件。--></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>log4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.20.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>2、配置文件编写</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Configuration</span> <span class="token attr-name">status</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Appenders</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Console</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ConsoleAppender<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>SYSTEM_OUT<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%d&#123;HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Console</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>File</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>FileAppender<span class="token punctuation">"</span></span> <span class="token attr-name">fileName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>application-$&#123;date:yyyyMMdd&#125;.log<span class="token punctuation">"</span></span> <span class="token attr-name">immediateFlush</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">append</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%d&#123;yyy-MM-dd HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>File</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Appenders</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Loggers</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>debug<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ConsoleAppender<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>FileAppender<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Root</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Loggers</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Configuration</span><span class="token punctuation">></span></span></code></pre><p>仔细看看我们的配置文件。它首先定义两个 appender，一个称为“FileAppender”，另一个称为“ConsoleAppender”appender 是有效地将日志消息写入其目的地的组件。</p><p>第一个 appender 将 stdout 定义为其目标，而第二个 appender 定义文件名的模式。</p><p>换句话说，第一个 appender 记录到标准输出，而第二个 appender 记录到一个文件。</p><p>然后该文件继续定义记录器。记录器负责实际记录传递给它的消息。每个记录器都可以引用一个或多个附加程序，这正是这里发生的事情。记录器引用了两个附加程序，因此当它被调用时，它将同时记录到标准输出和日志文件中。</p><p>3、setting设置日志实现</p><pre class="language-none"><code class="language-none">&lt;settings&gt;   &lt;setting name&#x3D;&quot;logImpl&quot; value&#x3D;&quot;LOG4J2&quot;&#x2F;&gt;&lt;&#x2F;settings&gt;</code></pre><p>4、在程序中使用Log4j进行输出！</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span></span><span class="token class-name">LogManager</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LogManager</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">App</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">"Hello World!"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span> <span class="token string">"又浪费了一早上， 都在弄这个破log4j fuck!"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"We've just greeted the user!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"We've just greeted the user!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"We've just greeted the user!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"We've just greeted the user!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"We've just greeted the user!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">fatal</span><span class="token punctuation">(</span><span class="token string">"We've just greeted the user!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>5、测试，看控制台输出！</p><ul><li><p>使用Log4j 2输出日志</p><p><img src="image-20230530173545142.png" alt="image-20230530173545142" loading="lazy"></p></li><li><p>可以看到还生成了一个日志的文件 【需要修改file的日志级别】</p></li></ul><p><img src="image-20230530173652533.png" alt="image-20230530173652533" loading="lazy"></p><p>Ref:</p><ul><li><a href="https://www.docs4dev.com/docs/zh/log4j2/2.x/all/manual-webapp.html#Servlet-2.5">在 Web 应用程序中使用 Log4j 2</a></li><li><a href="https://www.dataset.com/blog/maven-log4j2-project/">Log4j2 in a Maven Project: How to Setup, Configure, and Use</a></li></ul><h2 id="多对一处理之高级结果映射">多对一处理之高级结果映射</h2><p>MyBatis 创建时的一个思想是：</p><p>数据库不可能永远是你所想或所需的那个样子。 我们希望每个数据库都具备良好的第三范式或 BCNF 范式，可惜它们并不都是那样。 如果能有一种数据库映射模式，完美适配所有的应用程序，那就太好了，但可惜也没有。 而 ResultMap 就是 MyBatis 对这个问题的答案。</p><blockquote><ol><li><p>第一范式（1NF）：表中的每个属性都是原子的，即不可再分。每个属性只包含单个值，不包含多个值或重复的组合值。</p></li><li><p>第二范式（2NF）：表中的非主键属性必须完全依赖于主键。换句话说，表中的每个非主键属性必须完全依赖于表中的主键，而不是部分依赖于主键的某个子集。</p></li><li><p>第三范式（3NF）：表中的非主键属性之间不应该存在传递依赖关系。换句话说，表中的每个非主键属性应该直接依赖于主键，而不是依赖于其他非主键属性。</p></li></ol><p>通过将表设计为第三范式，可以避免数据冗余和不一致性，提高数据存储的效率和一致性。这样的设计有助于减少数据修改的复杂性，提高数据查询和更新的性能，并支持更好的数据一致性维护。</p><p>然而，需要注意的是，严格遵循第三范式并不一定是最佳选择。在某些情况下，为了满足特定的性能需求或简化复杂查询，可能需要在设计中引入一些冗余数据或非范式化的结构。在数据库设计过程中，需要根据具体需求和性能考虑，权衡范式化和非范式化的设计选择。</p></blockquote><p>先从简单的开始, 老师和学生的关系, 多个学生存在同属于一个老师, 这就是多对一关系, 我们设计以下Java Bean</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> tId<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Teacher</span> teacher<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Teacher</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>如果我们需要查询所有的学生信息以及学生对应的老师, 我们编写SQL</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span>  s<span class="token punctuation">.</span>id<span class="token punctuation">,</span> s<span class="token punctuation">.</span>name <span class="token keyword">as</span> sName<span class="token punctuation">,</span> tid<span class="token punctuation">,</span>t<span class="token punctuation">.</span>name <span class="token keyword">as</span> tName <span class="token keyword">from</span> students s<span class="token punctuation">,</span> teachers t <span class="token keyword">where</span> s<span class="token punctuation">.</span>tid <span class="token operator">=</span> t<span class="token punctuation">.</span>id<span class="token punctuation">;</span></code></pre><p>执行SQL可以得到</p><p><img src="image-20230531151419612.png" alt="image-20230531151419612" loading="lazy"></p><p>但是这样是得不到Teacher对象的值的，只能得到null，所以我需要编写ResutlMap</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span>resultMap id<span class="token operator">=</span><span class="token string">"ST"</span> type<span class="token operator">=</span><span class="token string">"org.example.Bean.Student"</span><span class="token operator">></span>    <span class="token operator">&lt;</span>id property<span class="token operator">=</span><span class="token string">"id"</span> column<span class="token operator">=</span><span class="token string">"id"</span><span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"name"</span> column<span class="token operator">=</span><span class="token string">"sName"</span><span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span>association property<span class="token operator">=</span><span class="token string">"teacher"</span> javaType<span class="token operator">=</span><span class="token string">"org.example.Bean.Teacher"</span><span class="token operator">></span>        <span class="token operator">&lt;</span>id property<span class="token operator">=</span><span class="token string">"id"</span> column<span class="token operator">=</span><span class="token string">"tid"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>id<span class="token operator">></span>        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"name"</span> column<span class="token operator">=</span><span class="token string">"tName"</span><span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>association<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>resultMap</code></pre><p>这段代码是一个 MyBatis 的结果映射配置（resultMap），用于将查询结果映射到 Java 对象。根据给定的配置，它定义了一个名为 “ST” 的结果映射，将查询结果映射到 org.example.Bean.Student 类型的对象。</p><p>该 resultMap 包含三个映射项：</p><ol><li><p>id 映射：将查询结果的 “id” 列映射到 Student 对象的 “id” 属性。<strong>标记出作为 ID 的结果可以帮助提高整体性能</strong></p></li><li><p>name 映射：将查询结果的 “sName” 列映射到 Student 对象的 “name” 属性。</p></li><li><p>association（关联）映射：将查询结果中的部分字段映射到关联的 Teacher 对象。</p><ul><li><p>id 映射：将查询结果的 “tid” 列映射到 Teacher 对象的 “id” 属性。</p></li><li><p>name 映射：将查询结果的 “tName” 列映射到 Teacher 对象的 “name” 属性。</p></li></ul></li></ol><p>通过使用 resultMap，MyBatis 可以根据查询结果自动将数据填充到 Student 对象中，并可通过访问 Student 对象的属性来获取查询结果的值。此外，关联映射允许将关联表的部分字段映射到关联对象中，以便在查询结果中包含关联对象的相关信息。</p><ul><li><p>编写测试类</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapperTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">MybatisUtil</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">StudentMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> students <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">getStudents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Student</span> student <span class="token operator">:</span> students<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>student<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre></li></ul><p>这样我们就可以给Teacher对象赋值了</p><p><img src="image-20230531185420784.png" alt="image-20230531185420784" loading="lazy"></p><p>实际项目中我们可能对多个表进行连表查询，比如，我们如何映射下面这个语句？</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- 非常复杂的语句 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectBlogDetails<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>detailedBlogResultMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  select       B.id as blog_id,       B.title as blog_title,       B.author_id as blog_author_id,       A.id as author_id,       A.username as author_username,       A.password as author_password,       A.email as author_email,       A.bio as author_bio,       A.favourite_section as author_favourite_section,       P.id as post_id,       P.blog_id as post_blog_id,       P.author_id as post_author_id,       P.created_on as post_created_on,       P.section as post_section,       P.subject as post_subject,       P.draft as draft,       P.body as post_body,       C.id as comment_id,       C.post_id as comment_post_id,       C.name as comment_name,       C.comment as comment_text,       T.id as tag_id,       T.name as tag_name  from Blog B       left outer join Author A on B.author_id = A.id       left outer join Post P on B.id = P.blog_id       left outer join Comment C on P.id = C.post_id       left outer join Post_Tag PT on PT.post_id = P.id       left outer join Tag T on PT.tag_id = T.id  where B.id = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>你可能想把它映射到一个智能的对象模型，这个对象表示了一篇博客，它由某位作者所写，有很多的博文，每篇博文有零或多条的评论和标签。 我们先来看看下面这个完整的例子，它是一个非常复杂的结果映射（假设作者，博客，博文，评论和标签都是类型别名）。 不用紧张，我们会一步一步地来说明。虽然它看起来令人望而生畏，但其实非常简单。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- 非常复杂的结果映射 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>detailedBlogResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>idArg</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_id<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_title<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_password<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_email<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bio<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_bio<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>favouriteSection<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_favourite_section<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>posts<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subject<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_subject<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comments<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Comment<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tags<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Tag<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>discriminator</span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>draft<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>case</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DraftPost<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>discriminator</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p><code>resultMap</code> 元素有很多子元素和一个值得深入探讨的结构。 下面是<code>resultMap</code> 元素的概念视图。</p><h4 id="结果映射（resultMap）">结果映射（resultMap）</h4><ul><li><p><code>constructor</code>- 用于在实例化类时，注入结果到构造方法中</p><ul><li><code>idArg</code> - ID 参数；标记出作为 ID 的结果可以帮助提高整体性能</li><li><code>arg</code> - 将被注入到构造方法的一个普通结果</li></ul></li><li><p><code>id</code> – 一个 ID 结果；标记出作为 ID 的结果可以帮助提高整体性能</p></li><li><p><code>result</code> – 注入到字段或 JavaBean 属性的普通结果</p></li><li><p><code>association</code>– 一个复杂类型的关联；许多结果将包装成这种类型</p><ul><li>嵌套结果映射 – 关联可以是 <code>resultMap</code> 元素，或是对其它结果映射的引用</li></ul></li><li><p><code>collection</code>– 一个复杂类型的集合</p><ul><li>嵌套结果映射 – 集合可以是 <code>resultMap</code> 元素，或是对其它结果映射的引用</li></ul></li><li><p><code>discriminator</code>– 使用结果值来决定使用哪个<code>resultMap</code></p><ul><li><code>case</code>– 基于某些值的结果映射<ul><li>嵌套结果映射 – <code>case</code> 也是一个结果映射，因此具有相同的结构和元素；或者引用其它的结果映射</li></ul></li></ul></li></ul><p><strong>ResultMap 的属性列表</strong></p><table><thead><tr><th style="text-align:left">属性</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>id</code></td><td style="text-align:left">当前命名空间中的一个唯一标识，用于标识一个结果映射。</td></tr><tr><td style="text-align:left"><code>type</code></td><td style="text-align:left">类的完全限定名, 或者一个类型别名（关于内置的类型别名，可以参考上面的表格）。</td></tr><tr><td style="text-align:left"><code>autoMapping</code></td><td style="text-align:left">如果设置这个属性，MyBatis 将会为本结果映射开启或者关闭自动映射。 这个属性会覆盖全局的属性 autoMappingBehavior。默认值：未设置（unset）。</td></tr></tbody></table><blockquote><p>最好逐步建立结果映射。单元测试可以在这个过程中起到很大帮助。 如果你尝试一次性创建像上面示例那么巨大的结果映射，不仅容易出错，难度也会直线上升。 所以，从最简单的形态开始，逐步迭代。而且别忘了单元测试！ 有时候，框架的行为像是一个黑盒子（无论是否开源）。因此，为了确保实现的行为与你的期望相一致，最好编写单元测试。 并且单元测试在提交 bug 时也能起到很大的作用。</p></blockquote><h3 id="下一部分将详细说明每个元素。"><strong>下一部分将详细说明每个元素。</strong></h3><h4 id="id-result">id &amp; result</h4><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subject<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_subject<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><p>这些元素是结果映射的基础。<em>id</em> 和 <em>result</em> 元素都将一个列的值映射到一个简单数据类型（String, int, double, Date 等）的属性或字段。</p><p>这两者之间的唯一不同是，<em>id</em> 元素对应的属性会被标记为对象的标识符，在比较对象实例时使用。 这样可以提高整体的性能，尤其是进行缓存和嵌套结果映射（也就是连接映射）的时候。</p><p>两个元素都有一些属性：</p><table><thead><tr><th style="text-align:left"><strong>属性</strong></th><th style="text-align:left"><strong>描述</strong></th></tr></thead><tbody><tr><td style="text-align:left"><strong><code>property</code></strong></td><td style="text-align:left"><strong>映射到列结果的字段或属性。如果 JavaBean 有这个名字的属性（property），会先使用该属性。否则 MyBatis 将会寻找给定名称的字段（field）。 无论是哪一种情形，你都可以使用常见的点式分隔形式进行复杂属性导航。 比如，你可以这样映射一些简单的东西：“username”，或者映射到一些复杂的东西上：“address.street.number”。</strong></td></tr><tr><td style="text-align:left"><strong><code>column</code></strong></td><td style="text-align:left"><strong>数据库中的列名，或者是列的别名。一般情况下，这和传递给 <code>resultSet.getString(columnName)</code> 方法的参数一样。</strong></td></tr><tr><td style="text-align:left"><code>*javaType</code>*</td><td style="text-align:left"><em>一个 Java 类的全限定名，或一个类型别名（关于内置的类型别名，可以参考上面的表格）。 如果你映射到一个 JavaBean，MyBatis 通常可以推断类型。然而，如果你映射到的是 HashMap，那么你应该明确地指定 javaType 来保证行为与期望的相一致。</em></td></tr><tr><td style="text-align:left"><em><code>jdbcType</code></em></td><td style="text-align:left"><em>JDBC 类型</em></td></tr><tr><td style="text-align:left"><em><code>typeHandler</code></em></td><td style="text-align:left"><em>我们在前面讨论过默认的类型处理器。使用这个属性，你可以覆盖默认的类型处理器。 这个属性值是一个类型处理器实现类的全限定名，或者是类型别名。</em></td></tr></tbody></table><h4 id="构造方法">构造方法</h4><p>构造方法注入允许你在初始化时为类设置属性的值，而不用暴露出公有方法。MyBatis 也支持私有属性和私有 JavaBean 属性来完成注入，但有一些人更青睐于通过构造方法进行注入。 <em>constructor</em> 元素就是为此而生的。</p><p>看看下面这个构造方法:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>   <span class="token comment">//...</span>   <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token comment">//...</span>  <span class="token punctuation">&#125;</span><span class="token comment">//...</span><span class="token punctuation">&#125;</span></code></pre><p>为了将结果注入构造方法，MyBatis 需要通过某种方式定位相应的构造方法。 在下面的例子中，MyBatis 搜索一个声明了三个形参的构造方法，参数类型以 <code>java.lang.Integer</code>, <code>java.lang.String</code> 和 <code>int</code> 的顺序给出。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>idArg</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>String<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_int<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor</span><span class="token punctuation">></span></span></code></pre><p>当你在处理一个带有多个形参的构造方法时，很容易搞乱 arg 元素的顺序。 从版本 3.4.3 开始，可以在指定参数名称的前提下，以任意顺序编写 arg 元素。 为了通过名称来引用构造方法参数，你可以添加 <code>@Param</code> 注解。</p><p>下面是一个等价的例子，尽管函数签名中第二和第三个形参的顺序与 constructor 元素中参数声明的顺序不匹配。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>idArg</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_int<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>String<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor</span><span class="token punctuation">></span></span></code></pre><p>如果存在名称和类型相同的可写属性，那么可以省略 <code>javaType</code> 。</p><p>剩余的属性和规则和普通的 id 和 result 元素是一样的。</p><h4 id="关联">关联</h4><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_author_id<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">></span></span></code></pre><p>关联（association）元素处理“有一个”类型的关系。 比如，在我们的示例中，一个博客有一个用户。关联结果映射和其它类型的映射工作方式差不多。 你需要指定目标属性名以及属性的<code>javaType</code>（很多时候 MyBatis 可以自己推断出来）。</p><p>关联的不同之处是，你需要告诉 MyBatis 如何加载关联。MyBatis 有两种不同的方式加载关联：</p><ul><li>嵌套 Select 查询：通过执行另外一个 SQL 映射语句来加载期望的复杂类型。</li><li>嵌套结果映射：使用嵌套的结果映射来处理连接结果的重复子集。</li></ul><p>首先，先让我们来看看这个元素的属性。你将会发现，和普通的结果映射相比，它只在 select 和 resultMap 属性上有所不同。</p><table><thead><tr><th style="text-align:left">属性</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>column</code></td><td style="text-align:left">数据库中的列名，或者是列的别名。一般情况下，这和传递给 <code>resultSet.getString(columnName)</code> 方法的参数一样。</td></tr><tr><td style="text-align:left"><code>javaType</code></td><td style="text-align:left">一个 Java 类的完全限定名，或一个类型别名（关于内置的类型别名，可以参考上面的表格）。 如果你映射到一个 JavaBean，MyBatis 通常可以推断类型。然而，如果你映射到的是 HashMap，那么你应该明确地指定 javaType 来保证行为与期望的相一致。</td></tr><tr><td style="text-align:left"><code>jdbcType</code></td><td style="text-align:left">JDBC 类型</td></tr><tr><td style="text-align:left"><code>typeHandler</code></td><td style="text-align:left"><em>我们在前面讨论过默认的类型处理器。使用这个属性，你可以覆盖默认的类型处理器。 这个属性值是一个类型处理器实现类的完全限定名，或者是类型别名。</em></td></tr><tr><td style="text-align:left"><code>select</code></td><td style="text-align:left">用于加载复杂类型属性的映射语句的 ID，它会从 column 属性中指定的列检索数据，作为参数传递给此 select 语句。具体请参考关联元素。</td></tr><tr><td style="text-align:left"><code>resultMap</code></td><td style="text-align:left">结果映射的 ID，可以将嵌套的结果集映射到一个合适的对象树中。 它可以作为使用额外 select 语句的替代方案。它可以将多表连接操作的结果映射成一个单一的 <code>ResultSet</code>。这样的 <code>ResultSet</code> 将会将包含重复或部分数据重复的结果集。为了将结果集正确地映射到嵌套的对象树中，MyBatis 允许你 “串联”结果映射，以便解决嵌套结果集的问题。想了解更多内容，请参考下面的关联元素。</td></tr><tr><td style="text-align:left"><code>name</code></td><td style="text-align:left">构造方法形参的名字。从 3.4.3 版本开始，通过指定具体的参数名，你可以以任意顺序写入 arg 元素。参看上面的解释。</td></tr></tbody></table><h4 id="关联的嵌套-Select-查询">关联的嵌套 Select 查询</h4><table><thead><tr><th style="text-align:left">属性</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>column</code></td><td style="text-align:left">数据库中的列名，或者是列的别名。一般情况下，这和传递给 <code>resultSet.getString(columnName)</code> 方法的参数一样。 注意：在使用复合主键的时候，你可以使用 <code>column=&quot;&#123;prop1=col1,prop2=col2&#125;&quot;</code> 这样的语法来指定多个传递给嵌套 Select 查询语句的列名。这会使得 <code>prop1</code> 和 <code>prop2</code> 作为参数对象，被设置为对应嵌套 Select 语句的参数。</td></tr><tr><td style="text-align:left"><code>select</code></td><td style="text-align:left">用于加载复杂类型属性的映射语句的 ID，它会从 column 属性指定的列中检索数据，作为参数传递给目标 select 语句。 具体请参考下面的例子。注意：在使用复合主键的时候，你可以使用 <code>column=&quot;&#123;prop1=col1,prop2=col2&#125;&quot;</code> 这样的语法来指定多个传递给嵌套 Select 查询语句的列名。这会使得 <code>prop1</code> 和 <code>prop2</code> 作为参数对象，被设置为对应嵌套 Select 语句的参数。</td></tr><tr><td style="text-align:left"><code>fetchType</code></td><td style="text-align:left">可选的。有效值为 <code>lazy</code> 和 <code>eager</code>。 指定属性后，将在映射中忽略全局配置参数 <code>lazyLoadingEnabled</code>，使用属性的值。</td></tr></tbody></table><p>示例：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_id<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectAuthor<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectBlog<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  SELECT * FROM BLOG WHERE ID = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectAuthor<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  SELECT * FROM AUTHOR WHERE ID = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>就是这么简单。我们有两个 select 查询语句：一个用来加载博客（Blog），另外一个用来加载作者（Author），而且博客的结果映射描述了应该使用 <code>selectAuthor</code> 语句加载它的 author 属性。</p><p>其它所有的属性将会被自动加载，只要它们的列名和属性名相匹配。</p><p><strong>这种方式虽然很简单，但在大型数据集或大型数据表上表现不佳</strong>。这个问题被称为“<strong>N+1 查询问题</strong>”。 概括地讲，N+1 查询问题是这样子的：</p><ul><li>你执行了一个单独的 SQL 语句来获取结果的一个列表（就是“+1”）。</li><li>对列表返回的每条记录，你执行一个 select 查询语句来为每条记录加载详细信息（就是“N”）。</li></ul><p>这个问题会导致成百上千的 SQL 语句被执行。有时候，我们不希望产生这样的后果。</p><p>好消息是，MyBatis 能够对这样的查询进行延迟加载，因此可以将大量语句同时运行的开销分散开来。 然而，如果你加载记录列表之后立刻就遍历列表以获取嵌套的数据，就会触发所有的延迟加载查询，性能可能会变得很糟糕。</p><p>所以还有另外一种方法。</p><h4 id="关联的嵌套结果映射">关联的嵌套结果映射</h4><table><thead><tr><th style="text-align:left">属性</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>resultMap</code></td><td style="text-align:left">结果映射的 ID，可以将此关联的嵌套结果集映射到一个合适的对象树中。 它可以作为使用额外 select 语句的替代方案。它可以将多表连接操作的结果映射成一个单一的 <code>ResultSet</code>。这样的 <code>ResultSet</code> 有部分数据是重复的。 为了将结果集正确地映射到嵌套的对象树中, MyBatis 允许你“串联”结果映射，以便解决嵌套结果集的问题。使用嵌套结果映射的一个例子在表格以后。</td></tr><tr><td style="text-align:left"><code>columnPrefix</code></td><td style="text-align:left">当连接多个表时，你可能会不得不使用列别名来避免在 <code>ResultSet</code> 中产生重复的列名。指定 columnPrefix 列名前缀允许你将带有这些前缀的列映射到一个外部的结果映射中。 详细说明请参考后面的例子。</td></tr><tr><td style="text-align:left"><code>notNullColumn</code></td><td style="text-align:left">默认情况下，在至少一个被映射到属性的列不为空时，子对象才会被创建。 你可以在这个属性上指定非空的列来改变默认行为，指定后，Mybatis 将只在这些列中任意一列非空时才创建一个子对象。可以使用逗号分隔来指定多个列。默认值：未设置（unset）。</td></tr><tr><td style="text-align:left"><code>autoMapping</code></td><td style="text-align:left">如果设置这个属性，MyBatis 将会为本结果映射开启或者关闭自动映射。 这个属性会覆盖全局的属性 autoMappingBehavior。注意，本属性对外部的结果映射无效，所以不能搭配 <code>select</code> 或 <code>resultMap</code> 元素使用。默认值：未设置（unset）。</td></tr></tbody></table><p>之前，你已经看到了一个非常复杂的嵌套关联的例子。 下面的例子则是一个非常简单的例子，用于演示嵌套结果映射如何工作。 现在我们将博客表和作者表连接在一起，而不是执行一个独立的查询语句，就像这样：</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">&lt;</span><span class="token keyword">select</span> id<span class="token operator">=</span><span class="token string">"selectBlog"</span> resultMap<span class="token operator">=</span><span class="token string">"blogResult"</span><span class="token operator">></span>  <span class="token keyword">select</span>    B<span class="token punctuation">.</span>id            <span class="token keyword">as</span> blog_id<span class="token punctuation">,</span>    B<span class="token punctuation">.</span>title         <span class="token keyword">as</span> blog_title<span class="token punctuation">,</span>    B<span class="token punctuation">.</span>author_id     <span class="token keyword">as</span> blog_author_id<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>id            <span class="token keyword">as</span> author_id<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>username      <span class="token keyword">as</span> author_username<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>password      <span class="token keyword">as</span> author_password<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>email         <span class="token keyword">as</span> author_email<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>bio           <span class="token keyword">as</span> author_bio  <span class="token keyword">from</span> Blog B <span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> Author A <span class="token keyword">on</span> B<span class="token punctuation">.</span>author_id <span class="token operator">=</span> A<span class="token punctuation">.</span>id  <span class="token keyword">where</span> B<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token comment">#&#123;id&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">select</span><span class="token operator">></span></code></pre><p>注意查询中的连接，以及为确保结果能够拥有唯一且清晰的名字，我们设置的别名。 这使得进行映射非常简单。现在我们可以映射这个结果：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_title<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_author_id<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>authorResult<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>authorResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_password<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_email<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bio<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_bio<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p>在上面的例子中，你可以看到，博客（Blog）作者（author）的关联元素委托名为 “authorResult” 的结果映射来加载作者对象的实例。</p><p><strong>非常重要： id 元素在嵌套结果映射中扮演着非常重要的角色。你应该总是指定一个或多个可以唯一标识结果的属性。</strong> 虽然，即使不指定这个属性，MyBatis 仍然可以工作，但是会产生严重的性能问题。 只需要指定可以唯一标识结果的最少属性。显然，你可以选择主键（复合主键也可以）。</p><p>现在，上面的示例使用了外部的结果映射元素来映射关联。这使得 Author 的结果映射可以被重用。 然而，如果你不打算重用它，或者你更喜欢将你所有的结果映射放在一个具有描述性的结果映射元素中。 你可以直接将结果映射作为子元素嵌套在内。这里给出使用这种方式的等效例子：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_title<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_password<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_email<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bio<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_bio<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p>那如果博客（blog）有一个共同作者（co-author）该怎么办？select 语句看起来会是这样的：</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">&lt;</span><span class="token keyword">select</span> id<span class="token operator">=</span><span class="token string">"selectBlog"</span> resultMap<span class="token operator">=</span><span class="token string">"blogResult"</span><span class="token operator">></span>  <span class="token keyword">select</span>    B<span class="token punctuation">.</span>id            <span class="token keyword">as</span> blog_id<span class="token punctuation">,</span>    B<span class="token punctuation">.</span>title         <span class="token keyword">as</span> blog_title<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>id            <span class="token keyword">as</span> author_id<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>username      <span class="token keyword">as</span> author_username<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>password      <span class="token keyword">as</span> author_password<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>email         <span class="token keyword">as</span> author_email<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>bio           <span class="token keyword">as</span> author_bio<span class="token punctuation">,</span>    CA<span class="token punctuation">.</span>id           <span class="token keyword">as</span> co_author_id<span class="token punctuation">,</span>    CA<span class="token punctuation">.</span>username     <span class="token keyword">as</span> co_author_username<span class="token punctuation">,</span>    CA<span class="token punctuation">.</span>password     <span class="token keyword">as</span> co_author_password<span class="token punctuation">,</span>    CA<span class="token punctuation">.</span>email        <span class="token keyword">as</span> co_author_email<span class="token punctuation">,</span>    CA<span class="token punctuation">.</span>bio          <span class="token keyword">as</span> co_author_bio  <span class="token keyword">from</span> Blog B  <span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> Author A <span class="token keyword">on</span> B<span class="token punctuation">.</span>author_id <span class="token operator">=</span> A<span class="token punctuation">.</span>id  <span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> Author CA <span class="token keyword">on</span> B<span class="token punctuation">.</span>co_author_id <span class="token operator">=</span> CA<span class="token punctuation">.</span>id  <span class="token keyword">where</span> B<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token comment">#&#123;id&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">select</span><span class="token operator">></span></code></pre><p>回忆一下，Author 的结果映射定义如下：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>authorResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_password<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_email<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bio<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_bio<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p>由于结果中的列名与结果映射中的列名不同。你需要指定 <code>columnPrefix</code> 以便重复使用该结果映射来映射 co-author 的结果。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_title<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span>    <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>authorResult<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>coAuthor<span class="token punctuation">"</span></span>    <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>authorResult<span class="token punctuation">"</span></span>    <span class="token attr-name">columnPrefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>co_<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><h4 id="关联的多结果集（ResultSet）">关联的多结果集（ResultSet）</h4><table><thead><tr><th style="text-align:left">属性</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>column</code></td><td style="text-align:left">当使用多个结果集时，该属性指定结果集中用于与 <code>foreignColumn</code> 匹配的列（多个列名以逗号隔开），以识别关系中的父类型与子类型。</td></tr><tr><td style="text-align:left"><code>foreignColumn</code></td><td style="text-align:left">指定外键对应的列名，指定的列将与父类型中 <code>column</code> 的给出的列进行匹配。</td></tr><tr><td style="text-align:left"><code>resultSet</code></td><td style="text-align:left">指定用于加载复杂类型的结果集名字。</td></tr></tbody></table><p>从版本 3.2.3 开始，MyBatis 提供了另一种解决 N+1 查询问题的方法。</p><p>某些数据库允许存储过程返回多个结果集，或一次性执行多个语句，每个语句返回一个结果集。 我们可以利用这个特性，在不使用连接的情况下，只访问数据库一次就能获得相关数据。</p><p>在例子中，存储过程执行下面的查询并返回两个结果集。第一个结果集会返回博客（Blog）的结果，第二个则返回作者（Author）的结果。</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> BLOG <span class="token keyword">WHERE</span> ID <span class="token operator">=</span> <span class="token comment">#&#123;id&#125;</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> AUTHOR <span class="token keyword">WHERE</span> ID <span class="token operator">=</span> <span class="token comment">#&#123;id&#125;</span></code></pre><p>在映射语句中，必须通过 <code>resultSets</code> 属性为每个结果集指定一个名字，多个名字使用逗号隔开。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectBlog<span class="token punctuation">"</span></span> <span class="token attr-name">resultSets</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogs,authors<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span> <span class="token attr-name">statementType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CALLABLE<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  &#123;call getBlogsAndAuthors(#&#123;id,jdbcType=INTEGER,mode=IN&#125;)&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>现在我们可以指定使用 “authors” 结果集的数据来填充 “author” 关联：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span> <span class="token attr-name">resultSet</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>authors<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_id<span class="token punctuation">"</span></span> <span class="token attr-name">foreignColumn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bio<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bio<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p>你已经在上面看到了如何处理“有一个”类型的关联。但是该怎么处理“有很多个”类型的关联呢？这就是我们接下来要介绍的。</p><h2 id="一对多处理之集合">一对多处理之集合</h2><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>posts<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>domain.blog.Post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subject<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_subject<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_body<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">></span></span></code></pre><p>集合元素和关联元素几乎是一样的，它们相似的程度之高，以致于没有必要再介绍集合元素的相似部分。 所以让我们来关注它们的不同之处吧。</p><p>我们来继续上面的示例，一个博客（Blog）只有一个作者（Author)。但一个博客有很多文章（Post)。 在博客类中，这可以用下面的写法来表示：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Post</span><span class="token punctuation">></span></span> posts<span class="token punctuation">;</span></code></pre><p>要像上面这样，映射嵌套结果集合到一个 List 中，可以使用集合元素。 和关联元素一样，我们可以使用嵌套 Select 查询，或基于连接的嵌套结果映射集合。</p><h4 id="集合的嵌套-Select-查询">集合的嵌套 Select 查询</h4><p>首先，让我们看看如何使用嵌套 Select 查询来为博客加载文章。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>posts<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ArrayList<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectPostsForBlog<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectBlog<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  SELECT * FROM BLOG WHERE ID = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectPostsForBlog<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  SELECT * FROM POST WHERE BLOG_ID = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>你可能会立刻注意到几个不同，但大部分都和我们上面学习过的关联元素非常相似。 首先，你会注意到我们使用的是集合元素。 接<strong>下来你会注意到有一个新的 “ofType” 属性。这个属性非常重要，它用来将 JavaBean（或字段）属性的类型和集合存储的类型区分开来。</strong> 所以你可以按照下面这样来阅读映射：</p><pre class="language-xnl" data-language="xnl"><code class="language-xnl">&lt;collection property&#x3D;&quot;posts&quot; javaType&#x3D;&quot;ArrayList&quot; column&#x3D;&quot;id&quot; ofType&#x3D;&quot;Post&quot; select&#x3D;&quot;selectPostsForBlog&quot;&#x2F;&gt;</code></pre><p>读作： “posts 是一个存储 Post 的 ArrayList 集合”</p><p>在一般情况下，MyBatis 可以推断 javaType 属性，因此并不需要填写。所以很多时候你可以简略成：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>posts<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectPostsForBlog<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><h4 id="集合的嵌套结果映射">集合的嵌套结果映射</h4><p>现在你可能已经猜到了集合的嵌套结果映射是怎样工作的——除了新增的 “ofType” 属性，它和关联的完全相同。</p><p>首先, 让我们看看对应的 SQL 语句：</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">&lt;</span><span class="token keyword">select</span> id<span class="token operator">=</span><span class="token string">"selectBlog"</span> resultMap<span class="token operator">=</span><span class="token string">"blogResult"</span><span class="token operator">></span>  <span class="token keyword">select</span>  B<span class="token punctuation">.</span>id <span class="token keyword">as</span> blog_id<span class="token punctuation">,</span>  B<span class="token punctuation">.</span>title <span class="token keyword">as</span> blog_title<span class="token punctuation">,</span>  B<span class="token punctuation">.</span>author_id <span class="token keyword">as</span> blog_author_id<span class="token punctuation">,</span>  P<span class="token punctuation">.</span>id <span class="token keyword">as</span> post_id<span class="token punctuation">,</span>  P<span class="token punctuation">.</span>subject <span class="token keyword">as</span> post_subject<span class="token punctuation">,</span>  P<span class="token punctuation">.</span>body <span class="token keyword">as</span> post_body<span class="token punctuation">,</span>  <span class="token keyword">from</span> Blog B  <span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> Post P <span class="token keyword">on</span> B<span class="token punctuation">.</span>id <span class="token operator">=</span> P<span class="token punctuation">.</span>blog_id  <span class="token keyword">where</span> B<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token comment">#&#123;id&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">select</span><span class="token operator">></span></code></pre><p>我们再次连接了博客表和文章表，并且为每一列都赋予了一个有意义的别名，以便映射保持简单。 要映射博客里面的文章集合，就这么简单：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_title<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>posts<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subject<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_subject<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_body<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p>再提醒一次，要记得上面 id 元素的重要性，如果你不记得了，请阅读关联部分的相关部分。</p><p>如果你喜欢更详略的、可重用的结果映射，你可以使用下面的等价形式：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_title<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>posts<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogPostResult<span class="token punctuation">"</span></span> <span class="token attr-name">columnPrefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogPostResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subject<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subject<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><h2 id="缓存">缓存</h2><p>MyBatis 内置了一个强大的事务性查询缓存机制，它可以非常方便地配置和定制。 为了使它更加强大而且易于配置，我们对 MyBatis 3 中的缓存实现进行了许多改进。</p><p>默认情况下，只启用了本地的会话缓存，它仅仅对一个会话中的数据进行缓存。 要启用全局的二级缓存，只需要在你的 SQL 映射文件中添加一行：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span><span class="token punctuation">/></span></span></code></pre><p>基本上就是这样。这个简单语句的效果如下:</p><ul><li>映射语句文件中的所有 select 语句的结果将会被缓存。</li><li>映射语句文件中的所有 insert、update 和 delete 语句会刷新缓存。</li><li>缓存会使用最近最少使用算法（LRU, Least Recently Used）算法来清除不需要的缓存。</li><li>缓存不会定时进行刷新（也就是说，没有刷新间隔）。</li><li>缓存会保存列表或对象（无论查询方法返回哪种）的 1024 个引用。</li><li>缓存会被视为读/写缓存，这意味着获取到的对象并不是共享的，可以安全地被调用者修改，而不干扰其他调用者或线程所做的潜在修改。</li></ul><p><strong>提示</strong> 缓存只作用于 cache 标签所在的映射文件中的语句。如果你混合使用 Java API 和 XML 映射文件，在共用接口中的语句将不会被默认缓存。你需要使用 @CacheNamespaceRef 注解指定缓存作用域。</p><p>这些属性可以通过 cache 元素的属性来修改。比如：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span>  <span class="token attr-name">eviction</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>FIFO<span class="token punctuation">"</span></span>  <span class="token attr-name">flushInterval</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>60000<span class="token punctuation">"</span></span>  <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>512<span class="token punctuation">"</span></span>  <span class="token attr-name">readOnly</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><p>这个更高级的配置创建了一个 FIFO 缓存，每隔 60 秒刷新，最多可以存储结果对象或列表的 512 个引用，而且返回的对象被认为是只读的，因此对它们进行修改可能会在不同线程中的调用者产生冲突。</p><p>可用的清除策略有：</p><ul><li><code>LRU</code> – 最近最少使用：移除最长时间不被使用的对象。</li><li><code>FIFO</code> – 先进先出：按对象进入缓存的顺序来移除它们。</li><li><code>SOFT</code> – 软引用：基于垃圾回收器状态和软引用规则移除对象。</li><li><code>WEAK</code> – 弱引用：更积极地基于垃圾收集器状态和弱引用规则移除对象。</li></ul><p>默认的清除策略是 LRU。</p><p>flushInterval（刷新间隔）属性可以被设置为任意的正整数，设置的值应该是一个以毫秒为单位的合理时间量。 默认情况是不设置，也就是没有刷新间隔，缓存仅仅会在调用语句时刷新。</p><p>size（引用数目）属性可以被设置为任意正整数，要注意欲缓存对象的大小和运行环境中可用的内存资源。默认值是 1024。</p><p>readOnly（只读）属性可以被设置为 true 或 false。只读的缓存会给所有调用者返回缓存对象的相同实例。 因此这些对象不能被修改。这就提供了可观的性能提升。而可读写的缓存会（通过序列化）返回缓存对象的拷贝。 速度上会慢一些，但是更安全，因此默认值是 false。</p><p><strong>提示</strong> 二级缓存是事务性的。这意味着，当 SqlSession 完成并提交时，或是完成并回滚，但没有执行 flushCache=true 的 insert/delete/update 语句时，缓存会获得更新。</p><h4 id="使用自定义缓存">使用自定义缓存</h4><p>除了上述自定义缓存的方式，你也可以通过实现你自己的缓存，或为其他第三方缓存方案创建适配器，来完全覆盖缓存行为。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.domain.something.MyCustomCache<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><p>这个示例展示了如何使用一个自定义的缓存实现。type 属性指定的类必须实现 org.apache.ibatis.cache.Cache 接口，且提供一个接受 String 参数作为 id 的构造器。 这个接口是 MyBatis 框架中许多复杂的接口之一，但是行为却非常简单。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Cache</span> <span class="token punctuation">&#123;</span>  <span class="token class-name">String</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> <span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">void</span> <span class="token function">putObject</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">Object</span> <span class="token function">getObject</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">boolean</span> <span class="token function">hasKey</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">Object</span> <span class="token function">removeObject</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>为了对你的缓存进行配置，只需要简单地在你的缓存实现中添加公有的 JavaBean 属性，然后通过 cache 元素传递属性值，例如，下面的例子将在你的缓存实现上调用一个名为 <code>setCacheFile(String file)</code> 的方法：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.domain.something.MyCustomCache<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cacheFile<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/tmp/my-custom-cache.tmp<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cache</span><span class="token punctuation">></span></span></code></pre><p>你可以使用所有简单类型作为 JavaBean 属性的类型，MyBatis 会进行转换。 你也可以使用占位符（如 <code>$&#123;cache.file&#125;</code>），以便替换成在<a href="https://mybatis.org/mybatis-3/zh/configuration.html#properties">配置文件属性</a>中定义的值。</p><p>从版本 3.4.2 开始，MyBatis 已经支持在所有属性设置完毕之后，调用一个初始化方法。 如果想要使用这个特性，请在你的自定义缓存类里实现 <code>org.apache.ibatis.builder.InitializingObject</code> 接口。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">InitializingObject</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>提示</strong> 上一节中对缓存的配置（如清除策略、可读或可读写等），不能应用于自定义缓存。</p><p>请注意，缓存的配置和缓存实例会被绑定到 SQL 映射文件的命名空间中。 因此，同一命名空间中的所有语句和缓存将通过命名空间绑定在一起。 每条语句可以自定义与缓存交互的方式，或将它们完全排除于缓存之外，这可以通过在每条语句上使用两个简单属性来达成。 默认情况下，语句会这样来配置：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">...</span> <span class="token attr-name">flushCache</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">useCache</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">...</span> <span class="token attr-name">flushCache</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">...</span> <span class="token attr-name">flushCache</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">...</span> <span class="token attr-name">flushCache</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><p>鉴于这是默认行为，显然你永远不应该以这样的方式显式配置一条语句。但如果你想改变默认的行为，只需要设置 flushCache 和 useCache 属性。比如，某些情况下你可能希望特定 select 语句的结果排除于缓存之外，或希望一条 select 语句清空缓存。类似地，你可能希望某些 update 语句执行时不要刷新缓存。</p><h4 id="cache-ref">cache-ref</h4><p>回想一下上一节的内容，对某一命名空间的语句，只会使用该命名空间的缓存进行缓存或刷新。 但你可能会想要在多个命名空间中共享相同的缓存配置和实例。要实现这种需求，你可以使用 cache-ref 元素来引用另一个缓存。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache-ref</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.someone.application.data.SomeMapper<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre>]]></content>
    
    
    <summary type="html">MyBatis学习笔记</summary>
    
    
    
    <category term="java web" scheme="https://trevoewu.github.io/categories/java-web/"/>
    
    
    <category term="MyBatis" scheme="https://trevoewu.github.io/tags/MyBatis/"/>
    
    <category term="Java Web" scheme="https://trevoewu.github.io/tags/Java-Web/"/>
    
  </entry>
  
  <entry>
    <title>超市管理系统</title>
    <link href="https://trevoewu.github.io/2023/05/15/%E8%B6%85%E5%B8%82%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"/>
    <id>https://trevoewu.github.io/2023/05/15/%E8%B6%85%E5%B8%82%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/</id>
    <published>2023-05-15T13:15:33.000Z</published>
    <updated>2023-05-19T13:42:46.033Z</updated>
    
    <content type="html"><![CDATA[<h2 id="实战-超市订单管理系统">实战: 超市订单管理系统</h2><p>为了方便表述和理解, 在编写MVC三层对应的代码时, 使用自顶向下, 但在实际的项目中, 编写代码工作往往是自底向上的.</p><h3 id="搭建项目框架">搭建项目框架</h3><p><img src="%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6.png" alt="未命名文件" loading="lazy"></p><h4 id="编写数据库操作的基础公共类DB">编写数据库操作的基础公共类DB</h4><ul><li><p>数据库配置文件，这是一个资源文件，应该创建在maven项目的resources文件中</p><pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">DRIVER</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span><span class="token key attr-name">URL</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3307/smbms?useUnicode=true&amp;characterEncoding=utf-8</span><span class="token key attr-name">USERNAME</span><span class="token punctuation">=</span><span class="token value attr-value">root</span><span class="token key attr-name">PASSWORD</span><span class="token punctuation">=</span></code></pre></li><li><p>使用静态代码块实现初始化参数</p><p>该类为数据库访问工具类，提供了获取数据库连接、执行查询和更新等常用操作的方法。</p><ol><li><p>类名：DB</p></li><li><p>属性：</p></li></ol><ul><li>DRIVER：String类型，表示数据库驱动名。</li><li>URL：String类型，表示数据库连接地址。</li><li>USERNAME：String类型，表示连接数据库的用户名。</li><li>PASSWORD：String类型，表示连接数据库的密码。</li></ul><ol start="3"><li>方法：</li></ol><ul><li>close：用于释放数据库连接、预处理语句和结果集资源。</li><li>getConnection：用于获取数据库连接。</li><li>executeQuery：用于执行查询操作，返回一个结果集。</li><li>executeUpdate：用于执行更新操作，返回受影响的行数。</li></ul><ol start="4"><li>方法的参数：</li></ol><ul><li>conn：Connection类型，表示数据库连接。</li><li>pstmt：PreparedStatement类型，表示预处理语句。</li><li>resSet：ResultSet类型，表示结果集。</li><li>query：String类型，表示要执行的SQL语句。</li><li>params：Object[]类型，表示SQL语句中的参数值。</li></ul><p>在类中还定义了一个静态代码块，该代码块在类加载时会被执行。静态代码块中的主要作用是读取配置文件中的数据库连接参数，并将其赋值给类的静态属性。具体实现如下：</p><ul><li>创建Properties对象。</li><li>通过类加载器加载配置文件为字节输入流。</li><li>使用Properties对象的load()方法加载字节输入流中的内容。</li><li>从Properties对象中获取数据库连接参数，并将其赋值给类的静态属性。</li></ul><p>通过这种方式，可以在不修改Java代码的情况下，更改数据库连接参数，提高了代码的灵活性和可维护性。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DB</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">DRIVER</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">URL</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">USERNAME</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">PASSWORD</span><span class="token punctuation">;</span>    <span class="token comment">//静态代码块， 类加载的时候执行</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//读取配置文件</span>        <span class="token comment">//1、创建properties对象</span>        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2、通过类加载器加载资源文件为字节输入流</span>        <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"db.properties"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token constant">DRIVER</span> <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"DRIVER"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">URL</span> <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"URL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">USERNAME</span> <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"USERNAME"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">PASSWORD</span> <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"PASSWORD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre></li><li><p>编写数据库操作的公共方法</p><p>该类为数据库访问工具类，提供了获取数据库连接、执行查询和更新等常用操作的方法。</p><ol><li><p>类名：DB</p></li><li><p>属性：</p></li></ol><ul><li>DRIVER：String类型，表示数据库驱动名。</li><li>URL：String类型，表示数据库连接地址。</li><li>USERNAME：String类型，表示连接数据库的用户名。</li><li>PASSWORD：String类型，表示连接数据库的密码。</li></ul><ol start="3"><li>方法：</li></ol><ul><li>close：用于释放数据库连接、预处理语句和结果集资源。</li><li>getConnection：用于获取数据库连接。</li><li>executeQuery：用于执行查询操作，返回一个结果集。</li><li>executeUpdate：用于执行更新操作，返回受影响的行数。</li></ul><ol start="4"><li>方法的参数：</li></ol><ul><li>conn：Connection类型，表示数据库连接。</li><li>pstmt：PreparedStatement类型，表示预处理语句。</li><li>resSet：ResultSet类型，表示结果集。</li><li>query：String类型，表示要执行的SQL语句。</li><li>params：Object[]类型，表示SQL语句中的参数值。</li></ul><p>该类还包含一个静态代码块，用于初始化数据库连接参数，但代码块的内容未给出，需要进行补充。</p><p><em>同时需要注意，该类并没有实现单例模式，每次获取数据库连接都会重新创建一个新的连接，这可能会导致性能问题。</em></p></li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">util</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DB</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">DRIVER</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">URL</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">USERNAME</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">PASSWORD</span><span class="token punctuation">;</span>  <span class="token comment">/*      静态代码块， 类加载的时候执行  */</span>    <span class="token comment">//释放链接资源</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">PreparedStatement</span> pstmt<span class="token punctuation">,</span> <span class="token class-name">ResultSet</span> resSet<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>resSet <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            resSet<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>pstmt <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            pstmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//获取数据库链接</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token constant">DRIVER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token constant">USERNAME</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token constant">PASSWORD</span><span class="token punctuation">;</span>        <span class="token comment">// 2.连接数据库,代表数据库</span>        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span>  connection<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//执行查询, 返回结果集</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ResultSet</span> <span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span><span class="token class-name">String</span> query<span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">&#123;</span>        <span class="token class-name">ResultSet</span> resultSet <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>query<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> params <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//预处理</span>            <span class="token class-name">PreparedStatement</span> statement <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> params<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//设置SQL 语句中的参数</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    statement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Integer</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    statement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    statement<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">//执行</span>            resultSet <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> resultSet<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//执行更新， 返回影响行数</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span><span class="token class-name">String</span> query<span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> affectedRows <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>query<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> params <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//预处理</span>            <span class="token class-name">PreparedStatement</span> statement <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> params<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//设置SQL 语句中的参数</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    statement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Integer</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    statement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    statement<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">//执行</span>             affectedRows <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> affectedRows<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="登录功能实现">登录功能实现</h3><h4 id="前端页面编写">前端页面编写</h4><p>前端页面由kuang提供</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;%-- header--%&gt;&lt;form class&#x3D;&quot;loginForm&quot; action&#x3D;&quot;$&#123;pageContext.request.contextPath&#125;&#x2F;login.do&quot; name&#x3D;&quot;actionForm&quot; id&#x3D;&quot;actionForm&quot; method&#x3D;&quot;post&quot;&gt;  &lt;div class&#x3D;&quot;info&quot;&gt;$&#123;error&#125;&lt;&#x2F;div&gt;  &lt;div class&#x3D;&quot;inputbox&quot;&gt;      &lt;label&gt;用户名：&lt;&#x2F;label&gt;      &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;input-text&quot; id&#x3D;&quot;userCode&quot; name&#x3D;&quot;userCode&quot; placeholder&#x3D;&quot;请输入用户名&quot; required&#x2F;&gt;  &lt;&#x2F;div&gt;  &lt;div class&#x3D;&quot;inputbox&quot;&gt;      &lt;label&gt;密码：&lt;&#x2F;label&gt;      &lt;input type&#x3D;&quot;password&quot; id&#x3D;&quot;userPassword&quot; name&#x3D;&quot;userPassword&quot; placeholder&#x3D;&quot;请输入密码&quot; required&#x2F;&gt;  &lt;&#x2F;div&gt;  &lt;div class&#x3D;&quot;subBtn&quot;&gt;      &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;登录&quot;&#x2F;&gt;      &lt;input type&#x3D;&quot;reset&quot; value&#x3D;&quot;重置&quot;&#x2F;&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;form&gt;&lt;%-- footer--%&gt;</code></pre><h4 id="登录处理Servlet实现">登录处理Servlet实现</h4><p>在前端form表单的action属性值我们可以看到提交的URL, 所以, 我们需要编写对应的Servlet来处理这个请求</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">action&#x3D;&quot;$&#123;pageContext.request.contextPath&#125;&#x2F;login.do&quot;</code></pre><ul><li><p>创建登录处理Servlet</p><p>以下是一个名为“Login”的Java servlet类，用于处理HTTP GET请求。该类包括对“UserService”实例的引用，该实例用于从数据库中检索用户信息。</p><p>在“doGet”方法中，servlet从HTTP请求中检索userCode和password参数。然后它创建一个“UserServiceImpl”类的新实例（该类实现了“UserService”接口），并调用其“findByUserCode”方法，以根据给定的用户代码从数据库中检索用户对象。</p><p>如果用户对象不为null，则servlet检查用户密码是否与给定密码匹配。如果匹配，则servlet使用用户对象设置名为“USER_SESSION”的会话属性，并将用户重定向到“/jsp/frame.jsp”。如果密码不匹配，则servlet使用错误消息设置名为“error”的会话属性，并将用户重定向回“/login.jsp”。</p><p><em>请注意，此代码片段不完整，因为它缺少有关导入，它所依赖的接口和类，以及servlet配置的信息。</em></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Login</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">UserService</span> service<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> userCode <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"userCode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"userPassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        user <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">findByUserCode</span><span class="token punctuation">(</span>userCode<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">,</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>                resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/jsp/frame.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span><span class="token string">"username or password incorrect"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/login.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span></code></pre></li><li><p>映射 servlet</p><p>这段代码是一个 servlet 配置的 XML 部分，它用于将请求的 URL 映射到特定的 servlet 上。这段配置指定了一个名为 “Login” 的 servlet，使用了完整的类名 <code>servlet.Login</code>，并将它映射到 URL “/login.do” 上。</p><p>这意味着，当用户在浏览器中访问 “/login.do” 时，容器将调用 <code>servlet.Login</code> 的 service() 方法来处理该请求。映射 servlet 的操作是 web 应用的一部分，它在 web.xml 文件中进行配置。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>servlet.Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/login.do<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre></li><li><p>编写Service层代码</p><p>该代码是一个 Java 类 <code>UserServiceImpl</code>，实现了一个接口 <code>UserService</code>。该类包含了两个方法：</p><ol><li><code>findByUserCode(String userCode)</code>：查找数据库中对应用户的信息，该方法返回一个 <code>User</code> 对象。</li><li><code>updateUser(Integer id, String key, String value)</code>：更新数据库中用户的信息，该方法返回一个 <code>boolean</code> 类型的值，表示更新是否成功。</li></ol><p>在这个类中，私有成员变量 <code>dao</code> 是一个 <code>UserDao</code> 类型的变量，通过该变量调用 <code>UserDaoImpl</code> 类中的方法来访问数据库。在 <code>findByUserCode</code> 和 <code>updateUser</code> 方法中，都需要先通过 <code>dao</code> 实例化一个 <code>UserDaoImpl</code> 对象来调用相应的方法。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> dao<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findByUserCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> userCode<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        dao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">findByUserCode</span><span class="token punctuation">(</span>userCode<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span>  user<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> value<span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>        dao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        i <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">updateUser</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> i <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre></li><li><p>DAO层代码</p><p>这段代码是一个Dao层的实现类，用于和数据库交互，提供了对User表的查询和更新方法。下面是代码的分析：</p><ul><li><code>findByUserCode(String userCode)</code> 方法：根据传入的用户名参数 <code>userCode</code> 查询对应的用户记录，并返回一个User对象。该方法使用了数据库连接池技术，在执行完查询后会关闭连接。方法中首先初始化参数，然后执行SQL语句查询结果集，遍历结果集将数据封装到User对象中，最后关闭连接和结果集，返回User对象。</li><li><code>updateUser(Integer id, String key,String value)</code> 方法：根据传入的参数更新User表中的数据。该方法也使用了数据库连接池技术，在执行完更新后会关闭连接。方法中首先判断传入的参数是否为空，然后执行SQL语句更新数据，最后关闭连接，返回更新结果的影响行数。</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDao</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Connection</span> conn<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> sql<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findByUserCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> userCode<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//2. 初始化参数</span>        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>userCode<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token class-name">ResultSet</span> set<span class="token punctuation">;</span>        sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM smbms_user Where userCode = ?"</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            conn <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            set <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">,</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>set <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    user<span class="token punctuation">.</span><span class="token function">setUserPassword</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userPassword"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//一大串赋值代码...</span>                    user<span class="token punctuation">.</span><span class="token function">setWorkPicPath</span><span class="token punctuation">(</span><span class="token string">"workPicPath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">//关闭链接和结果集</span>            <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> user<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> affectedRow <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token operator">&amp;&amp;</span> value <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            sql <span class="token operator">=</span> <span class="token string">"UPDATE smbms_user SET "</span><span class="token operator">+</span>key<span class="token operator">+</span><span class="token string">" = ? WHERE id = ? "</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>value<span class="token punctuation">,</span>id<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                conn <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                affectedRow <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> affectedRow<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre></li></ul><h3 id="密码修改实现">密码修改实现</h3><h4 id="前端页面">前端页面</h4><p><strong>JSP部分: 页面显示</strong></p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ page contentType&#x3D;&quot;text&#x2F;html;charset&#x3D;UTF-8&quot; language&#x3D;&quot;java&quot; %&gt;&lt;%@include file&#x3D;&quot;&#x2F;jsp&#x2F;common&#x2F;head.jsp&quot; %&gt;&lt;div class&#x3D;&quot;right&quot;&gt;    &lt;div class&#x3D;&quot;location&quot;&gt;        &lt;strong&gt;你现在所在的位置是:&lt;&#x2F;strong&gt;        &lt;span&gt;密码修改页面&lt;&#x2F;span&gt;    &lt;&#x2F;div&gt;    &lt;div class&#x3D;&quot;providerAdd&quot;&gt;        &lt;form id&#x3D;&quot;userForm&quot; name&#x3D;&quot;userForm&quot; method&#x3D;&quot;post&quot; action&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;jsp&#x2F;user.do&quot;&gt;            &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;method&quot; value&#x3D;&quot;savepwd&quot;&#x2F;&gt;            &lt;!--div的class 为error是验证错误，ok是验证成功--&gt;            &lt;div class&#x3D;&quot;info&quot;&gt;$&#123;message&#125;&lt;&#x2F;div&gt;            &lt;div class&#x3D;&quot;&quot;&gt;                &lt;label for&#x3D;&quot;oldPassword&quot;&gt;旧密码：&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;oldpassword&quot; id&#x3D;&quot;oldpassword&quot; value&#x3D;&quot;&quot;&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;                &lt;label for&#x3D;&quot;newPassword&quot;&gt;新密码：&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;newpassword&quot; id&#x3D;&quot;newpassword&quot; value&#x3D;&quot;&quot;&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;                &lt;label for&#x3D;&quot;newPassword&quot;&gt;确认新密码：&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;rnewpassword&quot; id&#x3D;&quot;rnewpassword&quot; value&#x3D;&quot;&quot;&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div class&#x3D;&quot;providerAddBtn&quot;&gt;                &lt;!--&lt;a href&#x3D;&quot;#&quot;&gt;保存&lt;&#x2F;a&gt;--&gt;                &lt;input type&#x3D;&quot;button&quot; name&#x3D;&quot;save&quot; id&#x3D;&quot;save&quot; value&#x3D;&quot;保存&quot; class&#x3D;&quot;input-button&quot;&gt;            &lt;&#x2F;div&gt;        &lt;&#x2F;form&gt;    &lt;&#x2F;div&gt;&lt;&#x2F;div&gt;&lt;&#x2F;section&gt;&lt;%@include file&#x3D;&quot;&#x2F;jsp&#x2F;common&#x2F;foot.jsp&quot; %&gt;&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;statics&#x2F;js&#x2F;pwdmodify.js&quot;&gt;&lt;&#x2F;script&gt;</code></pre><p>这是一个用 JSP（JavaServer Pages）编写的网页代码，用于修改密码。页面包括一个表单，用户可以在其中输入旧密码、新密码和确认新密码。表单使用POST方法提交到服务器，并使用“/jsp/user.do” URL。</p><p>页面包括一个消息区域，用于显示任何错误消息。页面还包括指向名为“pwdmodify.js”的 JavaScript 文件的链接。这个文件应该包含表单的客户端验证逻辑。</p><p>页面使用 JSP 表达式语言（EL）将动态内容插入到 HTML 中。例如，页面使用表达式 “${pageContext.request.contextPath}/statics/js/pwdmodify.js” 插入一个链接到 CSS 文件。“${pageContext.request.contextPath}” 表达式计算为 web 应用程序的上下文路径，用于构造 CSS 文件的完整 URL。</p><p><strong>JavaScript 表单的客户端验证逻辑</strong></p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> oldpassword <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> newpassword <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> rnewpassword <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> saveBtn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   oldpassword <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#oldpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   newpassword <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#newpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   rnewpassword <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#rnewpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   saveBtn <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#save"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   oldpassword<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>         <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span>         <span class="token literal-property property">url</span><span class="token operator">:</span>path<span class="token operator">+</span><span class="token string">"/jsp/user.do"</span><span class="token punctuation">,</span>         <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">"pwdmodify"</span><span class="token punctuation">,</span><span class="token literal-property property">oldpassword</span><span class="token operator">:</span>oldpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>         <span class="token literal-property property">dataType</span><span class="token operator">:</span><span class="token string">"json"</span><span class="token punctuation">,</span>         <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//旧密码正确</span>               <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//旧密码输入不正确</span>               <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" 原密码输入不正确"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">"sessionerror"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//当前用户session过期，请重新登录</span>               <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" 当前用户session过期，请重新登录"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//旧密码输入为空</span>               <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" 请输入旧密码"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>         <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>         <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//请求出错</span>            <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" 请求错误"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* 请输入原密码"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   newpassword<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* 密码长度必须是大于6小于20"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">5</span>         <span class="token operator">&amp;&amp;</span> newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" 密码输入不符合规范，请重新输入"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   rnewpassword<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* 请输入与上面一致的密码"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">5</span>         <span class="token operator">&amp;&amp;</span> rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token operator">&amp;&amp;</span> newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" 两次密码输入不一致，请重新输入"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   saveBtn<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      oldpassword<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      newpassword<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      rnewpassword<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>         oldpassword<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span> <span class="token operator">&amp;&amp;</span>          newpassword<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span>         <span class="token operator">&amp;&amp;</span> rnewpassword<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">"确定要修改密码？"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#userForm"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>这是一个 JavaScript 代码段，它使用 jQuery 库为一个包含密码修改表单的网页添加了客户端验证逻辑。代码使用 AJAX 技术从服务器获取 JSON 格式的响应数据，以验证用户输入的旧密码是否正确，并在页面上显示相关提示信息。</p><p>代码中首先定义了四个变量，分别是旧密码、新密码、确认新密码和提交按钮的 jQuery 对象。然后使用 $() 函数将代码包装在一个回调函数中，确保代码在文档加载完成后才执行。回调函数内部做了以下工作：</p><ol><li><p>通过选择器获取页面上的旧密码输入框、新密码输入框、确认新密码输入框和提交按钮，并将它们的 jQuery 对象赋值给前面定义的四个变量。</p></li><li><p>为旧密码输入框绑定 blur 事件处理函数，当输入框失去焦点时，使用 $.ajax() 函数向服务器发送 GET 请求，验证用户输入的旧密码是否正确，并根据服务器返回的响应数据显示相应的提示信息。在成功回调函数中，根据 data.result 的值判断旧密码是否正确，并通过 validateTip() 函数显示相应的提示信息。在失败回调函数中，显示请求出错的提示信息。</p></li><li><p>为旧密码输入框绑定 focus 事件处理函数，当输入框获得焦点时，显示输入提示信息。</p></li><li><p>为新密码输入框绑定 focus 和 blur 事件处理函数，当输入框获得焦点时，显示输入提示信息；当输入框失去焦点时，判断用户输入的新密码是否符合规范，如果符合则显示正确提示，否则显示错误提示。</p></li><li><p>为确认新密码输入框绑定 focus 和 blur 事件处理函数，当输入框获得焦点时，显示输入提示信息；当输入框失去焦点时，判断用户输入的确认新密码是否与新密码一致，如果一致则显示正确提示，否则显示错误提示。</p></li><li><p>为提交按钮绑定 click 事件处理函数，当按钮被点击时，先让旧密码、新密码和确认新密码输入框失去焦点，然后判断它们的验证状态是否都为 true，如果是，则显示确认修改密码的提示框，如果用户点击确定，则提交表单，将新密码保存到服务器上。</p></li></ol><h4 id="编写处理Servlet">编写处理Servlet</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDo</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">UserService</span> service<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"savepwd"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">savePwd</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"pwdmodify"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">pwdModify</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">savePwd</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//拿到USer Session , 用于得到用户id</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> newPwd <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"newpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"用户输入的：new password: "</span><span class="token operator">+</span>newPwd<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Session password: "</span><span class="token operator">+</span>user<span class="token punctuation">.</span><span class="token function">getUserPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">", id: "</span><span class="token operator">+</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Integer</span> id <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">boolean</span> flag<span class="token punctuation">;</span>        <span class="token comment">//method 值为  savepwd, 表示用户执行修改密码操作</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>newPwd <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            flag <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">updateUser</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">"userPassword"</span><span class="token punctuation">,</span> newPwd<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//修改成功</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"修改成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span><span class="token string">"密码修改成功， 请重新登录"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//  移除Session</span>                session<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"密码修改失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span><span class="token string">"密码修改失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span><span class="token string">"新密码格式错误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//转发到当前页面, 不用重定向而使用转发是为了传统参数（attribute) 通知前端密码修改结果（by attribute message）</span>        req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"/jsp/pwdmodify.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/*    由ajax发起的密码查询请求， 用户进行密码修改时触发    放回前端json， ajax用于比对旧密码正确性,     */</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">pwdModify</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> user <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUserPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> inputPwd <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"oldpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>inputPwd <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> inputPwd<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//旧密码正确</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>inputPwd<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span><span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">//旧密码不正确</span>                    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span><span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token comment">//密码输入为空</span>                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//session timeout</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span><span class="token string">"sessionerror"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//返回前端json数据</span>        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">JSONArray</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>这段代码是一个Java Web应用程序中的Servlet，用于处理用户密码修改操作。</p><p>在doGet()方法中，根据请求参数&quot;method&quot;的值进行不同的操作。如果&quot;method&quot;的值是&quot;savepwd&quot;，则调用savePwd()方法，保存新密码；如果&quot;method&quot;的值是&quot;pwdmodify&quot;，则调用pwdModify()方法，用于检查旧密码是否正确。</p><p>在savePwd()方法中，首先从Session中获取当前用户的信息，然后获取新密码，并使用UserService接口的实现类UserServiceImpl来更新用户密码。如果更新成功，将信息存储在请求属性中，并移除Session中的用户信息，最后将请求转发到密码修改页面。</p><p>在pwdModify()方法中，首先获取当前用户的信息，然后获取旧密码。如果旧密码不为空，则将输入的旧密码与Session中存储的旧密码进行比较。如果输入的旧密码与Session中的旧密码相同，则返回前端JSON数据，表示旧密码正确；否则返回JSON数据，表示旧密码不正确。</p><p><strong>需要注意的是，在返回JSON数据之前，需要设置响应的Content-Type为&quot;application/json&quot;。</strong></p><h5 id="映射Servlet">映射Servlet</h5><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>userDo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>servlet.UserDo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>userDo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/jsp/user.do<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre><h3 id="用户管理底层实现">用户管理底层实现</h3><h3 id="分页实现">分页实现</h3><ol><li><p>导入分页支持</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">util</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PageSupport</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//当前页码-来自于用户输入， 1表示第一页， 用于sql做limit查询 limit startPage, length</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> currentPageNo <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">//总数量（表）</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> totalCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">//页面容量,每一页展示多少数据</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> pageSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">//总页数: totalCount/pageSize（+1）</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> totalPageCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>      <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCurrentPageNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> currentPageNo<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCurrentPageNo</span><span class="token punctuation">(</span><span class="token keyword">int</span> currentPageNo<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>currentPageNo <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>currentPageNo <span class="token operator">=</span> currentPageNo<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getTotalCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> totalCount<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTotalCount</span><span class="token punctuation">(</span><span class="token keyword">int</span> totalCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>totalCount <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>totalCount <span class="token operator">=</span> totalCount<span class="token punctuation">;</span>            <span class="token comment">//设置总页数</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setTotalPageCountByRs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> pageSize<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPageSize</span><span class="token punctuation">(</span><span class="token keyword">int</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>pageSize <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize <span class="token operator">=</span> pageSize<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getTotalPageCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> totalPageCount<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTotalPageCount</span><span class="token punctuation">(</span><span class="token keyword">int</span> totalPageCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>totalPageCount <span class="token operator">=</span> totalPageCount<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTotalPageCountByRs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>totalCount <span class="token operator">%</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>totalPageCount <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalCount <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>totalCount <span class="token operator">%</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>totalPageCount <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalCount <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>totalPageCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>这段代码是一个用于分页的工具类 <code>PageSupport</code>。它包含了用于处理分页逻辑的属性和方法。</p><p>让我们逐个分析这些属性和方法：</p><ol><li><p><code>currentPageNo</code>（当前页码）: 保存当前页的页码，默认为1（表示第一页）。用户可以通过调用 <code>setCurrentPageNo()</code> 方法来设置当前页码。</p></li><li><p><code>totalCount</code>（总数量）: 表示总的数据量。用户可以通过调用 <code>setTotalCount()</code> 方法来设置总数量。</p></li><li><p><code>pageSize</code>（页面容量）: 每一页显示的数据数量。用户可以通过调用 <code>setPageSize()</code> 方法来设置页面容量。</p></li><li><p><code>totalPageCount</code>（总页数）: 表示总的页数，根据总数量和页面容量计算得出。用户可以通过调用 <code>getTotalPageCount()</code> 方法来获取总页数。</p></li><li><p><code>setTotalPageCountByRs()</code> 方法: 根据总数量和页面容量计算总页数，并将结果设置给 <code>totalPageCount</code> 属性。</p></li></ol><p>此外，对于一些属性的设置，代码中进行了一些限制条件的判断：</p><ul><li><p><code>currentPageNo</code> 和 <code>pageSize</code> 必须大于0，否则将不进行设置。</p></li><li><p><code>totalCount</code> 必须大于0，否则将不进行设置，并且会将 <code>totalPageCount</code> 设置为0。</p></li></ul><p>这个工具类主要用于在分页查询中计算总页数和进行当前页码的设置。</p></li></ol><ul><li><p>前端</p><p><strong>Header下用户管理二级菜单</strong></p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;li&gt;&lt;a href&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;jsp&#x2F;user.do?method&#x3D;query&quot;&gt;用户管理&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</code></pre><p>点击这个菜单, 跳转到<code>/jsp/user.do?method=query</code>这个请求,<code> user.do</code>是对应的处理请求的Servlet, 问号后面是通过请求传递的参数, 为<code>method = query, Servlet</code>可以根据这个参数对请求的不同类型做对应的处理, 实现Servlet的复用.</p><p><strong>用户管理界面:</strong></p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">    &lt;div class&#x3D;&quot;search&quot;&gt;        &lt;form method&#x3D;&quot;get&quot; action&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;jsp&#x2F;user.do&quot;&gt;            &lt;input name&#x3D;&quot;method&quot; value&#x3D;&quot;query&quot; class&#x3D;&quot;input-text&quot; type&#x3D;&quot;hidden&quot;&gt;            &lt;span&gt;用户名：&lt;&#x2F;span&gt;            &lt;input name&#x3D;&quot;queryname&quot; class&#x3D;&quot;input-text&quot; type&#x3D;&quot;text&quot; value&#x3D;&quot;$&#123;queryUserName &#125;&quot;&gt;            &lt;span&gt;用户角色：&lt;&#x2F;span&gt;            &lt;select name&#x3D;&quot;queryUserRole&quot;&gt;                &lt;c:if test&#x3D;&quot;$&#123;roleList !&#x3D; null &#125;&quot;&gt;                    &lt;option value&#x3D;&quot;0&quot;&gt;--请选择--&lt;&#x2F;option&gt;                    &lt;c:forEach var&#x3D;&quot;role&quot; items&#x3D;&quot;$&#123;roleList&#125;&quot;&gt;                        &lt;option &lt;c:if test&#x3D;&quot;$&#123;role.id &#x3D;&#x3D; queryUserRole &#125;&quot;&gt;selected&#x3D;&quot;selected&quot;&lt;&#x2F;c:if&gt;                                value&#x3D;&quot;$&#123;role.id&#125;&quot;&gt;$&#123;role.roleName&#125;&lt;&#x2F;option&gt;                    &lt;&#x2F;c:forEach&gt;                &lt;&#x2F;c:if&gt;            &lt;&#x2F;select&gt;            &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;pageIndex&quot; value&#x3D;&quot;1&quot;&#x2F;&gt;            &lt;input value&#x3D;&quot;查 询&quot; type&#x3D;&quot;submit&quot; id&#x3D;&quot;searchbutton&quot;&gt;        &lt;&#x2F;form&gt;    &lt;&#x2F;div&gt;    &lt;!--用户--&gt;&#x2F;*用户的mapping代码*&#x2F;    &lt;input type&#x3D;&quot;hidden&quot; id&#x3D;&quot;totalPageCount&quot; value&#x3D;&quot;$&#123;totalPageCount&#125;&quot;&#x2F;&gt;    &lt;c:import url&#x3D;&quot;rollpage.jsp&quot;&gt;        &lt;c:param name&#x3D;&quot;totalCount&quot; value&#x3D;&quot;$&#123;totalCount&#125;&quot;&#x2F;&gt;        &lt;c:param name&#x3D;&quot;currentPageNo&quot; value&#x3D;&quot;$&#123;currentPageNo&#125;&quot;&#x2F;&gt;        &lt;c:param name&#x3D;&quot;totalPageCount&quot; value&#x3D;&quot;$&#123;totalPageCount&#125;&quot;&#x2F;&gt;    &lt;&#x2F;c:import&gt;&lt;&#x2F;div&gt;&lt;&#x2F;section&gt;</code></pre></li></ul><p>这段代码展示了一个搜索表单和与分页相关的部分。</p><ol><li><code>&lt;div class=&quot;search&quot;&gt;</code> 标签: 定义一个搜索的区域。</li><li><code>&lt;form&gt;</code> 标签: 定义了一个表单，使用 GET 方法提交到 <code>$&#123;pageContext.request.contextPath&#125;/jsp/user.do</code>。</li><li><code>&lt;input&gt;</code> 标签: 设置了一个隐藏字段 <code>method</code>，值为 <code>&quot;query&quot;</code>，用于指定查询的方法。</li><li><code>&lt;input&gt;</code> 标签: 创建了一个文本输入框，名称为 <code>queryname</code>，值为 <code>$&#123;queryUserName&#125;</code>，显示了之前查询的用户名。</li><li><code>&lt;select&gt;</code> 标签: 创建了一个下拉选择框，名称为 <code>queryUserRole</code>。使用了 JSTL 标签 <code>&lt;c:if&gt;</code> 进行条件判断，如果 <code>roleList</code> 不为 null，将会显示选项。</li><li><code>&lt;option&gt;</code> 标签: 设置了一个默认选项 <code>&lt;option value=&quot;0&quot;&gt;--请选择--&lt;/option&gt;</code>，然后使用 <code>&lt;c:forEach&gt;</code> 遍历 <code>roleList</code> 中的角色，并将角色的名称和 ID 设置为选项的值。使用 <code>&lt;c:if&gt;</code> 判断当前角色是否与 <code>queryUserRole</code> 相等，如果相等，则设置该选项为选中状态。</li><li><code>&lt;input&gt;</code> 标签: 设置了一个隐藏字段 <code>pageIndex</code>，值为 1</li><li><code>&lt;input&gt;</code> 标签: 设置了一个隐藏字段 <code>totalPageCount</code>，值为 <code>$&#123;totalPageCount&#125;</code>。</li><li><code>&lt;c:import&gt;</code> 标签: 导入了一个名为 <code>rollpage.jsp</code> 的页面，并传递了三个参数 <code>totalCount</code>、<code>currentPageNo</code> 和 <code>totalPageCount</code> 的值。</li></ol><p>这段代码展示了一个搜索表单，用户可以输入用户名和选择用户角色进行查询。同时，还包含了与分页相关的部分，包括当前页码、总页数和总数量的显示。</p><p>我们观察这段代码, 这个form表单的一部分代码, 分别展示了提交的目的地 <code>$&#123;pageContext.request.contextPath &#125;/jsp/user.do</code>  以及 一个隐藏域, 包含一个熟悉 <code>method</code> 值为 <code>query</code>, 是不是, 很熟悉, 没错, 这个Servlet和Header菜单进入管理用户界面所发起的请求是一样的, 也就是说, 是一个Servlet的相同处理过程. 为什么会这样呢?  这是因为查询和展示用户信息(未筛选时) 本质是一样的.</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;form method&#x3D;&quot;get&quot; action&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;jsp&#x2F;user.do&quot;&gt;    &lt;input name&#x3D;&quot;method&quot; value&#x3D;&quot;query&quot; class&#x3D;&quot;input-text&quot; type&#x3D;&quot;hidden&quot;&gt;</code></pre><ul><li><p>DAO层</p><p><code>int getUserCount()</code></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getUserCount</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token keyword">int</span> userRole<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token class-name">StringBuffer</span> sql <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"SELECT count(1) as count from smbms_user s, smbms_role r where s.userRole = r.id"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span>  <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>userName <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" and userName like ? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"%"</span><span class="token operator">+</span>userName<span class="token operator">+</span><span class="token string">"%"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>userRole <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" and userRole like ? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"%"</span><span class="token operator">+</span>userRole<span class="token operator">+</span><span class="token string">"%"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"sql----> "</span><span class="token operator">+</span>sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        rs <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            count <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"count"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> count<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>这段代码是一个方法 <code>getUserCount</code>，用于查询符合条件的用户数量。</p><p>让我们逐行解释这段代码：</p><ol><li><p><code>int getUserCount(Connection conn, String userName, int userRole)</code>: 这是一个方法声明，它接受一个数据库连接对象 <code>conn</code>、一个用户名 <code>userName</code> 和一个用户角色 <code>userRole</code> 作为参数，并返回一个整数表示符合条件的用户数量。</p></li><li><p><code>int count = 0;</code>: 初始化一个计数器变量 <code>count</code>，用于存储查询结果的数量。</p></li><li><p><code>StringBuffer sql = new StringBuffer();</code>: 创建一个 <code>StringBuffer</code> 对象 <code>sql</code>，用于构建 SQL 查询语句。</p></li><li><p><code>sql.append(&quot;SELECT count(1) as count from smbms_user s, smbms_role r where s.userRole = r.id&quot;);</code>: 将基本的查询语句添加到 <code>sql</code> 对象中，查询用户表 <code>smbms_user</code> 和角色表 <code>smbms_role</code>，并通过 <code>userRole</code> 字段进行关联。</p></li><li><p><code>ArrayList&lt;Object&gt; list = new ArrayList&lt;Object&gt;();</code>: 创建一个 <code>ArrayList</code> 对象 <code>list</code>，用于存储查询条件的参数值。</p></li><li><p><code>ResultSet rs =  null;</code>: 初始化一个 <code>ResultSet</code> 对象 <code>rs</code>，用于存储查询结果集。</p></li><li><p><code>if(userName != null) &#123; ... &#125;</code>: 如果 <code>userName</code> 不为 null，则将一个条件子句添加到 <code>sql</code> 对象中，使用 <code>LIKE</code> 运算符进行模糊匹配，并将匹配参数添加到 <code>list</code> 中。</p></li><li><p><code>if(userRole &gt; 0) &#123; ... &#125;</code>: 如果 <code>userRole</code> 大于 0，则将另一个条件子句添加到 <code>sql</code> 对象中，同样使用 <code>LIKE</code> 运算符进行匹配，并将匹配参数添加到 <code>list</code> 中。</p></li><li><p><code>System.out.println(&quot;sql----&gt; &quot;+sql.toString());</code>: 打印输出最终生成的 SQL 查询语句，方便调试和查看。</p></li><li><p><code>rs = DB.executeQuery(conn, sql.toString(), list.toArray());</code>: 执行 SQL 查询，并将结果存储在 <code>rs</code> 中。<code>DB.executeQuery()</code> 是一个执行查询语句的方法，接受数据库连接对象、SQL 查询语句和参数值数组作为参数。</p></li><li><p><code>while (rs.next()) &#123; ... &#125;</code>: 遍历查询结果集，将每行的计数值存储到 <code>count</code> 变量中。</p></li><li><p><code>DB.close(null,null,rs);</code>: 关闭结果集、语句和连接对象，释放资源。<code>DB.close()</code> 是一个关闭数据库资源的方法，接受三个参数：结果集、语句和连接对象。</p></li><li><p><code>return count;</code>: 返回符合条件的用户数量。</p></li></ol><p>该方法的作用是查询数据库中符合给定用户名和用户角色条件的用户数量，并将结果返回。</p><p>==getUserList==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> <span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token keyword">int</span> userRole<span class="token punctuation">,</span><span class="token keyword">int</span> currPage<span class="token punctuation">,</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> userList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//准备要使用的对象</span>            <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token class-name">StringBuffer</span> sql <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token comment">//编写sql</span>                sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"SELECT * from smbms_user u ,smbms_role r Where u.userRole = r.id "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//如果用户名不为空， 表示有用户名查询要求，追加限定条件</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>userName <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" AND userName like ? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    params<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"%"</span><span class="token operator">+</span>userName<span class="token operator">+</span><span class="token string">"%"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token comment">//同上...</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>userRole <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" and userRole = ?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    params<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>userRole<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" ORDER BY u.creationDate DESC LIMIT ?,? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//在sql最后追加一个排序和分页</span>                <span class="token comment">//5</span>                <span class="token comment">//1     5</span>                <span class="token comment">//2     10</span>                <span class="token comment">//3     15</span>                currPage <span class="token operator">=</span> <span class="token punctuation">(</span>currPage<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>pageSize<span class="token punctuation">;</span><span class="token comment">//减一的原因就是MYSQL分页的index从0开始</span>                params<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>currPage<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从哪一个下标开始</span>                params<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从currentPageNo连续取几个</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"sql--->"</span><span class="token operator">+</span>sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//执行sql， 返回结果集, ⚠️需要把sql转化为字符串， params 转化为数组</span>                rs <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>params<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>rs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setUserPassword</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userPassword"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setUserCode</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userCode"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setBirthday</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Date</span><span class="token punctuation">)</span> rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"birthday"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setPhone</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setIdPicPath</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"idPicPath"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setUserRole</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"userRole"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setCreatedBy</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"createdBy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setCreationDate</span><span class="token punctuation">(</span> rs<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"creationDate"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setModifyBy</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"modifyBy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setModifyDate</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"modifyDate"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setUserRoleName</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"roleName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        userList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//                        System.out.println(user.toString());</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>                <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> userList<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre></li></ul><p>这段代码是一个方法 <code>getUserList</code>，用于根据给定的用户名、用户角色、当前页码和页面大小获取符合条件的用户列表。</p><p>让我们逐行解释这段代码：</p><ol><li><p><code>public List&lt;User&gt; getUserList(Connection conn, String userName, int userRole, int currPage, int pageSize)</code>: 这是一个方法声明，它接受一个数据库连接对象 <code>conn</code>、一个用户名 <code>userName</code>、一个用户角色 <code>userRole</code>、当前页码 <code>currPage</code> 和页面大小 <code>pageSize</code> 作为参数，并返回一个 <code>List&lt;User&gt;</code> 类型的用户列表。</p></li><li><p><code>List&lt;User&gt; userList = new ArrayList&lt;&gt;();</code>: 创建一个 <code>ArrayList</code> 对象 <code>userList</code>，用于存储用户列表。</p></li><li><p><code>if(conn != null) &#123; ... &#125; else &#123; return null; &#125;</code>: 检查数据库连接对象是否为 null，如果为 null，则直接返回 null。</p></li><li><p><code>ArrayList&lt;Object&gt; params = new ArrayList&lt;&gt;();</code>: 创建一个 <code>ArrayList</code> 对象 <code>params</code>，用于存储查询条件的参数值。</p></li><li><p><code>ResultSet rs = null;</code>: 初始化一个 <code>ResultSet</code> 对象 <code>rs</code>，用于存储查询结果集。</p></li><li><p><code>StringBuffer sql = new StringBuffer();</code>: 创建一个 <code>StringBuffer</code> 对象 <code>sql</code>，用于构建 SQL 查询语句。</p></li><li><p><code>sql.append(&quot;SELECT * from smbms_user u ,smbms_role r Where u.userRole = r.id &quot;);</code>: 将基本的查询语句添加到 <code>sql</code> 对象中，查询用户表 <code>smbms_user</code>，和角色表<code>smbms_role </code>, 这里进行了多表的联合查询, 是为了给user(Bean)的RoleNa m e赋值, 以便前端使用.</p></li><li><p><code>if(userName != null) &#123; ... &#125;</code>: 如果 <code>userName</code> 不为 null，则将一个条件子句添加到 <code>sql</code> 对象中，使用 <code>LIKE</code> 运算符进行模糊匹配，并将匹配参数添加到 <code>params</code> 中。</p></li><li><p><code>if(userRole != 0) &#123; ... &#125;</code>: 如果 <code>userRole</code> 不为 0，则将另一个条件子句添加到 <code>sql</code> 对象中，限定用户角色，并将角色参数添加到 <code>params</code> 中。</p></li><li><p><code>sql.append(&quot; ORDER BY u.creationDate DESC LIMIT ?,? &quot;);</code>: 在查询语句的末尾追加一个排序和分页的部分，按照 <code>creationDate</code> 字段降序排列，并使用 <code>LIMIT</code> 限制查询结果的起始位置和数量。</p></li><li><p><code>currPage = (currPage-1)*pageSize;</code>: 计算实际的起始位置，根据当前页码和页面大小，减一是因为 MYSQL 分页的索引从 0 开始。</p></li><li><p><code>params.add(currPage);</code>: 将起始位置参数添加到 <code>params</code> 中。</p></li><li><p><code>params.add(pageSize);</code>: 将页面大小参数添加到 <code>params</code> 中。</p></li><li><p><code>System.out.println(&quot;sql---&gt;&quot;+sql.toString());</code>: 打印输出最终生成的 SQL 查询语句，方便调试和查看。</p></li><li><p><code>rs = DB.executeQuery(conn, sql.toString(), params.toArray());</code>: 执行 SQL 查询，并将结果存储在 <code>rs</code> 中。`</p></li></ol><p>​==getRoleList==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> <span class="token function">getRolelist</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//prevent roleList</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> roleList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">StringBuffer</span> sql <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//edit sql expression</span>            sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM smbms_role "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//输入0表查询全表， 输入>0 为sql拼接条件， 同时准备参数列表</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" WHERE id = ? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                params<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"sql---->"</span><span class="token operator">+</span>sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            rs <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>rs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">//赋值</span>                    <span class="token class-name">Role</span> role <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Role</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    role<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    role<span class="token punctuation">.</span><span class="token function">setRoleCode</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"roleCode"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    role<span class="token punctuation">.</span><span class="token function">setRoleName</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"roleName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    role<span class="token punctuation">.</span><span class="token function">setCreatedBy</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"createdBy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    role<span class="token punctuation">.</span><span class="token function">setModifyDate</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"creationDate"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    role<span class="token punctuation">.</span><span class="token function">setCreationDate</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"creationDate"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    role<span class="token punctuation">.</span><span class="token function">setModifyBy</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"modifyBy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    roleList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> roleList<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><ul><li><p>Service层</p><p>==getUserCount==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getUserCount</span><span class="token punctuation">(</span><span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token class-name">UserRole</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            conn <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            dao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            count <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">getUserCount</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> userName<span class="token punctuation">,</span> <span class="token class-name">UserRole</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> count<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>==getUserlist==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> <span class="token function">getUserlist</span><span class="token punctuation">(</span><span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token keyword">int</span> userRole<span class="token punctuation">,</span><span class="token keyword">int</span> currPage<span class="token punctuation">,</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> usersList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        usersList <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">getUserList</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> userName<span class="token punctuation">,</span> userRole<span class="token punctuation">,</span>currPage<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> usersList<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>==getRoleList==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> <span class="token function">getRoleList</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> roles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">RoleDao</span> dao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RoleDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        roles <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">getRolelist</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> roles<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre></li><li><p>Servlet层</p><p>类加载读取配置文件： 目前需要读取的数据有：PAGE_SIZE 用于设置页面大小</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//读取配置文件</span>    <span class="token comment">//1、创建properties对象</span>    <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//2、通过类加载器加载资源文件为字节输入流</span>    <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"db.properties"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token constant">PAGE_SIZE</span> <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"PAGE_SIZE"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"savepwd"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">savePwd</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"pwdmodify"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">pwdModify</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"query"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">query</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>这段代码的作用是根据不同的<code>method</code>值调用不同的方法处理GET请求，实现不同的功能操作。</p></li></ul><p>具体实现:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1. 从前端获取用户输入的参数 queryname -> userName，queryUserRole -> userRole,pageIndex</span>        <span class="token class-name">String</span> userName <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"queryname"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> userRole <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"queryUserRole"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> pageIndex <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"pageIndex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 检验参数的合法性</span>        <span class="token keyword">if</span><span class="token punctuation">(</span> userName <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            userName <span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>userRole <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> userRole<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            userRole <span class="token operator">=</span> <span class="token string">"0"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>pageIndex <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> pageIndex<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            pageIndex <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//3. 准备前端需要的参数： queryUserName，queryUserRole ,roleList，userList,</span>        <span class="token class-name">String</span> queryUserName <span class="token operator">=</span> userName<span class="token punctuation">;</span>        <span class="token class-name">String</span> queryUserRole <span class="token operator">=</span> userRole<span class="token punctuation">;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> roleList<span class="token punctuation">;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> userList<span class="token punctuation">;</span>        <span class="token comment">// 以及下列参数： totalPageCount（总页数），totalCount（查询到的用户数），currentPageNo（当前页）</span>        <span class="token comment">// 这些参数的获取需要先调用userService.getUserCount查询用户数， 然后调用PageSupport提供分页支持</span>        <span class="token class-name">UserServiceImpl</span> userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">RoleServiceImpl</span> roleService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RoleServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> totalCount <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUserCount</span><span class="token punctuation">(</span>userName<span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>userRole<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">PageSupport</span> pageSupport <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageSupport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pageSupport<span class="token punctuation">.</span><span class="token function">setPageSize</span><span class="token punctuation">(</span><span class="token constant">PAGE_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pageSupport<span class="token punctuation">.</span><span class="token function">setTotalCount</span><span class="token punctuation">(</span>totalCount<span class="token punctuation">)</span><span class="token punctuation">;</span>        pageSupport<span class="token punctuation">.</span><span class="token function">setTotalPageCountByRs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pageSupport<span class="token punctuation">.</span><span class="token function">setCurrentPageNo</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>pageIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> totalPageCount <span class="token operator">=</span> pageSupport<span class="token punctuation">.</span><span class="token function">getTotalPageCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 查询用户和角色</span>        userList <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUserlist</span><span class="token punctuation">(</span>userName<span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>userRole<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>pageIndex<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">PAGE_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        roleList <span class="token operator">=</span> roleService<span class="token punctuation">.</span><span class="token function">getRoleList</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2. 根据参数返回用户表和角色表</span>        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"roleList"</span><span class="token punctuation">,</span>roleList<span class="token punctuation">)</span><span class="token punctuation">;</span>        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"userList"</span><span class="token punctuation">,</span>userList<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3. 返回用户需要的参数</span>        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"queryUserName"</span><span class="token punctuation">,</span>queryUserName<span class="token punctuation">)</span><span class="token punctuation">;</span>        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"queryUserRole"</span><span class="token punctuation">,</span>queryUserRole<span class="token punctuation">)</span><span class="token punctuation">;</span>        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"totalPageCount"</span><span class="token punctuation">,</span> totalPageCount<span class="token punctuation">)</span><span class="token punctuation">;</span>        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"totalCount"</span><span class="token punctuation">,</span>totalCount<span class="token punctuation">)</span><span class="token punctuation">;</span>        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"currentPageNo"</span><span class="token punctuation">,</span>pageIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//4. 转发到jsp/userlist.jsp， 要使用转发而不是重定向， 便于携带参数</span>        req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"userlist.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>这段代码实现了一个查询用户的功能，以下是代码实现的步骤：</p><ol><li><p>从前端获取用户输入的参数：userName（用户名），userRole（用户角色），pageIndex（当前页码）。</p></li><li><p>根据参数返回用户表和角色表，并将其设置为请求的属性，供jsp文件使用。</p></li><li><p>准备前端需要的参数： queryUserName（查询用户名），queryUserRole（查询用户角色），roleList（角色列表），userList（用户列表）,totalPageCount（总页数），totalCount（查询到的用户数），currentPageNo（当前页）。</p></li><li><p>查询用户数，并设置pageSupport的totalCount，currentPageNo，pageSize属性。</p></li><li><p>查询用户和角色，并将其设置为请求的属性，供jsp文件使用。</p></li><li><p>将前端需要的参数设置为请求的属性，供jsp文件使用。</p></li><li><p>将请求转发到userlist.jsp文件，便于携带参数。</p></li></ol><p>其中，代码中调用了UserService类和RoleService类的方法实现具体的查询操作。同时，代码中也对获取的参数进行了一些合法性的检验和设置默认值的操作。最终，将查询到的结果设置为请求的属性，通过转发的方式返回到jsp文件中供前端展示。</p><h3 id="用户删除实现">用户删除实现</h3><p>在前端页面找到用户删除的按钮(锚), href是: <code>javascript:</code>,</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;td&gt;    &lt;span&gt;&lt;a class&#x3D;&quot;viewUser&quot; href&#x3D;&quot;javascript:;&quot; userid&#x3D;$&#123;user.id &#125; username&#x3D;$&#123;user.userName &#125;&gt;&lt;img src&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;statics&#x2F;images&#x2F;read.png&quot; alt&#x3D;&quot;查看&quot; title&#x3D;&quot;查看&quot;&#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;span&gt;    &lt;span&gt;&lt;a class&#x3D;&quot;modifyUser&quot; href&#x3D;&quot;javascript:;&quot; userid&#x3D;$&#123;user.id &#125; username&#x3D;$&#123;user.userName &#125;&gt;&lt;img src&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;statics&#x2F;images&#x2F;xiugai.png&quot; alt&#x3D;&quot;修改&quot; title&#x3D;&quot;修改&quot;&#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;span&gt;    &lt;span&gt;&lt;a class&#x3D;&quot;deleteUser&quot; href&#x3D;&quot;javascript:;&quot; userid&#x3D;$&#123;user.id &#125; username&#x3D;$&#123;user.userName &#125;&gt;&lt;img src&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;statics&#x2F;images&#x2F;schu.png&quot; alt&#x3D;&quot;删除&quot; title&#x3D;&quot;删除&quot;&#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;span&gt;&lt;&#x2F;td&gt;</code></pre><p>找到对应的javascript</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".deleteUser"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>userObj <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">changeDLGContent</span><span class="token punctuation">(</span><span class="token string">"你确定要删除用户【"</span><span class="token operator">+</span>userObj<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"】吗？"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">openYesOrNoDLG</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>当删除被点击后, js调用函数<code>userObj</code>, 接着我们去看这个函数</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span>      <span class="token literal-property property">url</span><span class="token operator">:</span>path<span class="token operator">+</span><span class="token string">"/jsp/user.do"</span><span class="token punctuation">,</span>      <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">"deluser"</span><span class="token punctuation">,</span><span class="token literal-property property">uid</span><span class="token operator">:</span>obj<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"userid"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token literal-property property">dataType</span><span class="token operator">:</span><span class="token string">"json"</span><span class="token punctuation">,</span>      <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>delResult <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//删除成功：移除删除行</span>            <span class="token function">cancleBtn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            obj<span class="token punctuation">.</span><span class="token function">parents</span><span class="token punctuation">(</span><span class="token string">"tr"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>delResult <span class="token operator">==</span> <span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//删除失败</span>            <span class="token function">changeDLGContent</span><span class="token punctuation">(</span><span class="token string">"对不起，删除用户【"</span><span class="token operator">+</span>obj<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"】失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>delResult <span class="token operator">==</span> <span class="token string">"notexist"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">changeDLGContent</span><span class="token punctuation">(</span><span class="token string">"对不起，用户【"</span><span class="token operator">+</span>obj<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"】不存在"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token function">changeDLGContent</span><span class="token punctuation">(</span><span class="token string">"对不起，删除失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>这段代码是一个 JavaScript 函数，它使用 jQuery 的 <code>$.ajax</code> 方法发送一个 GET 请求到服务器。以下是对代码的分析：</p><ol><li><p><code>function deleteUser(obj)</code>：这是一个命名为 <code>deleteUser</code> 的函数，它接受一个参数 <code>obj</code>，表示要删除的用户对象。</p></li><li><p><code>$.ajax</code>：这是 jQuery 提供的一个函数，用于发送 AJAX 请求到服务器。</p></li><li><p>AJAX 请求的配置选项包括：</p><ul><li><code>type: &quot;GET&quot;</code>：指定请求类型为 GET。</li><li><code>url: path + &quot;/jsp/user.do&quot;</code>：指定请求的 URL 地址，其中 <code>path</code> 是一个变量或常量，表示服务器路径。</li><li><code>data: &#123;method: &quot;deluser&quot;, uid: obj.attr(&quot;userid&quot;)&#125;</code>：指定请求发送的数据，包括 <code>method</code> 和 <code>uid</code> 两个参数。<code>method</code> 的值为 <code>&quot;deluser&quot;</code>，<code>uid</code> 的值通过 <code>obj.attr(&quot;userid&quot;)</code> 获取。</li><li><code>dataType: &quot;json&quot;</code>：指定预期的响应数据类型为 JSON。</li></ul></li><li><p><code>success</code>：这是一个成功回调函数，在服务器成功响应时被调用。它接受一个参数 <code>data</code>，表示从服务器返回的数据。函数内部根据返回的数据执行不同的操作：</p><ul><li>如果 <code>data.delResult</code> 的值为 <code>&quot;true&quot;</code>，表示删除成功。函数调用 <code>cancleBtn()</code> 取消按钮，并移除 <code>obj</code> 对应的父级 <code>&lt;tr&gt;</code> 行。</li><li>如果 <code>data.delResult</code> 的值为 <code>&quot;false&quot;</code>，表示删除失败。函数调用 <code>changeDLGContent</code> 修改对话框的内容，显示删除失败的提示信息。</li><li>如果 <code>data.delResult</code> 的值为 <code>&quot;notexist&quot;</code>，表示用户不存在。函数调用 <code>changeDLGContent</code> 修改对话框的内容，显示用户不存在的提示信息。</li></ul></li><li><p><code>error</code>：这是一个错误回调函数，在请求发生错误时被调用。它接受一个参数 <code>data</code>，表示错误信息。函数调用 <code>changeDLGContent</code> 修改对话框的内容，显示删除失败的提示信息。</p></li></ol><p>这段代码用于通过 AJAX 请求向服务器发送删除用户的请求，并根据服务器返回的结果执行相应的操作。成功时移除对应的行，失败时显示错误提示信息。</p><p>通过这些信息,我们可以得知如何编写我们的后台程序</p><ol><li>编写对应的Servlet, 根据method值不同, 调用delUser函数</li><li>编写请求处理函数delUser</li><li>delUser调用Service删除用户, 并返回结果<ol><li>如果删除用户成功, 返回true或者受影响行数为1, 通过响应向前端返回数据delResult = true</li><li>如果Service返回false或者受影响行数为0, 向前端返回delResult = no exist, 表示删除的用户不存在.</li></ol></li><li>出现异常则返回delResult = false(在这里是用户权限不够时返回会false)</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">delUser</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span><span class="token punctuation">&#123;</span>    <span class="token comment">//1. 获取用户角色， 如果用户不是系统管理员， 则没有删除用户的权限</span>    <span class="token class-name">User</span> o <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">getUserRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> uid <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">boolean</span> res <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">delUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"delResult"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"delResult"</span><span class="token punctuation">,</span> <span class="token string">"notexist"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"delResult"</span><span class="token punctuation">,</span><span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//封装json数据， 并写到前端</span>    <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">JSONArray</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>接下来, 我们还需要编写对应的Service层以及Dao层代码, 由于service实际上并没有做什么事, 这里只展示Dao层代码</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">delUser</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> affectedRow <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"Delete from smbms_user where id = ?"</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>id<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>            affectedRow <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> affectedRow<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>这段代码及其简单, 只需要写一段sql, 然后交给DB去执行就好了, DB这个类会预处理sql, 以及给占位符赋值, 最后执行sql返回结果.</p><h3 id="查看用户实现">查看用户实现</h3><p>和删除用户类似, 找到对应的js请求</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".viewUser"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token comment">//将被绑定的元素（a）转换成jquery对象，可以使用jquery方法</span>   <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token operator">=</span>path<span class="token operator">+</span><span class="token string">"/jsp/user.do?method=view&amp;uid="</span><span class="token operator">+</span> obj<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"userid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>编写Servlet</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span><span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> uid <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">User</span> user <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"/jsp/userview.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>编写dao层, service层实现</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//2. 初始化参数</span>    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>id<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token class-name">ResultSet</span> set<span class="token punctuation">;</span>    sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM smbms_user,smbms_role Where smbms_user.userRole = smbms_role.id and smbms_user.id = ?"</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        conn <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        set <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">,</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>set <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                user<span class="token punctuation">.</span><span class="token function">setUserRoleName</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"roleName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setUserPassword</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userPassword"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setUserCode</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userCode"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setBirthday</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Date</span><span class="token punctuation">)</span> set<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"birthday"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setPhone</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setIdPicPath</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"idPicPath"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setUserRole</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"userRole"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setCreatedBy</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"createdBy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setCreationDate</span><span class="token punctuation">(</span> set<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"creationDate"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setModifyBy</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"modifyBy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setModifyDate</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"modifyDate"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setWorkPicPath</span><span class="token punctuation">(</span><span class="token string">"workPicPath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//关闭链接和结果集</span>        <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> user<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="修改用户实现">修改用户实现</h3><p>重复重复再重复…</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".modifyUser"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token operator">=</span>path<span class="token operator">+</span><span class="token string">"/jsp/user.do?method=modify&amp;uid="</span><span class="token operator">+</span> obj<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"userid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span><span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> uid <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">User</span> user <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"/jsp/usermodify.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>和之前不同的是, 这次修改用户指向一个新的jsp页面, 也就是修改用户的页面. 也就是说, 删除用户的请求提交以后, 我们需要把这个请求转发到<code>/jsp/usermodify.jsp</code>这个URL对应的jsp页面去, 由于这个jsp页面需要修改前的user数据, 我们需要查询对应的id,得到user数据后把数据传递给<code>usermodify.jsp</code>这个jsp页面, jsp页面需要这些数据来向用户展示修改前的数据. 下面我们去看这个jsp页面</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ page contentType&#x3D;&quot;text&#x2F;html;charset&#x3D;UTF-8&quot; language&#x3D;&quot;java&quot; %&gt;&lt;%@include file&#x3D;&quot;&#x2F;jsp&#x2F;common&#x2F;head.jsp&quot;%&gt;&lt;div class&#x3D;&quot;right&quot;&gt;    &lt;div class&#x3D;&quot;location&quot;&gt;        &lt;strong&gt;你现在所在的位置是:&lt;&#x2F;strong&gt;        &lt;span&gt;用户管理页面 &gt;&gt; 用户修改页面&lt;&#x2F;span&gt;    &lt;&#x2F;div&gt;    &lt;div class&#x3D;&quot;providerAdd&quot;&gt;        &lt;form id&#x3D;&quot;userForm&quot; name&#x3D;&quot;userForm&quot; method&#x3D;&quot;post&quot; action&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;jsp&#x2F;user.do&quot;&gt;            &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;method&quot; value&#x3D;&quot;modifyexe&quot;&gt;            &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;uid&quot; value&#x3D;&quot;$&#123;user.id &#125;&quot;&#x2F;&gt;            &lt;div&gt;                &lt;label for&#x3D;&quot;userName&quot;&gt;用户名称：&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;userName&quot; id&#x3D;&quot;userName&quot; value&#x3D;&quot;$&#123;user.userName &#125;&quot;&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;                &lt;label &gt;用户性别：&lt;&#x2F;label&gt;                &lt;select name&#x3D;&quot;gender&quot; id&#x3D;&quot;gender&quot;&gt;                    &lt;c:choose&gt;                        &lt;c:when test&#x3D;&quot;$&#123;user.gender &#x3D;&#x3D; 1 &#125;&quot;&gt;                            &lt;option value&#x3D;&quot;1&quot; selected&#x3D;&quot;selected&quot;&gt;男&lt;&#x2F;option&gt;                            &lt;option value&#x3D;&quot;2&quot;&gt;女&lt;&#x2F;option&gt;                        &lt;&#x2F;c:when&gt;                        &lt;c:otherwise&gt;                            &lt;option value&#x3D;&quot;1&quot;&gt;男&lt;&#x2F;option&gt;                            &lt;option value&#x3D;&quot;2&quot; selected&#x3D;&quot;selected&quot;&gt;女&lt;&#x2F;option&gt;                        &lt;&#x2F;c:otherwise&gt;                    &lt;&#x2F;c:choose&gt;                &lt;&#x2F;select&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;                &lt;label &gt;出生日期：&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;text&quot; Class&#x3D;&quot;Wdate&quot; id&#x3D;&quot;birthday&quot; name&#x3D;&quot;birthday&quot; value&#x3D;&quot;$&#123;user.birthday &#125;&quot;                       readonly&#x3D;&quot;readonly&quot; onclick&#x3D;&quot;WdatePicker();&quot;&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;                &lt;label &gt;用户电话：&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;phone&quot; id&#x3D;&quot;phone&quot; value&#x3D;&quot;$&#123;user.phone &#125;&quot;&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;                &lt;label &gt;用户地址：&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;address&quot; id&#x3D;&quot;address&quot; value&#x3D;&quot;$&#123;user.address &#125;&quot;&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;                &lt;label &gt;用户角色：&lt;&#x2F;label&gt;                &lt;!-- 列出所有的角色分类 --&gt;                &lt;input type&#x3D;&quot;hidden&quot; value&#x3D;&quot;$&#123;user.userRole&#125;&quot; id&#x3D;&quot;rid&quot; &#x2F;&gt;                &lt;select name&#x3D;&quot;userRole&quot; id&#x3D;&quot;userRole&quot;&gt;&lt;&#x2F;select&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div class&#x3D;&quot;providerAddBtn&quot;&gt;                &lt;input type&#x3D;&quot;button&quot; name&#x3D;&quot;save&quot; id&#x3D;&quot;save&quot; value&#x3D;&quot;保存&quot; &#x2F;&gt;                &lt;input type&#x3D;&quot;button&quot; id&#x3D;&quot;back&quot; name&#x3D;&quot;back&quot; value&#x3D;&quot;返回&quot;&#x2F;&gt;            &lt;&#x2F;div&gt;        &lt;&#x2F;form&gt;    &lt;&#x2F;div&gt;&lt;&#x2F;div&gt;&lt;&#x2F;section&gt;&lt;%@include file&#x3D;&quot;&#x2F;jsp&#x2F;common&#x2F;foot.jsp&quot; %&gt;&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;statics&#x2F;js&#x2F;usermodify.js&quot;&gt;&lt;&#x2F;script&gt;</code></pre><p>先观察表单提交的目的地, <code>&#123;pageContext.request.contextPath &#125;/jsp/user.do</code>, 对应一个Servlet, 但是这里并没有提交的按钮, 但是我发现这里有一个<code>usermodify.js</code>的脚本文件, 定位到这个脚本文件</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> userName <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> birthday <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> phone <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> userRole <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> saveBtn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> backBtn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   userName <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#userName"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   birthday <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#birthday"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   phone <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#phone"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   userRole <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#userRole"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   saveBtn <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#save"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   backBtn <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#back"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      userName<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   birthday<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   phone<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   userRole<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span><span class="token comment">//请求类型</span>      <span class="token literal-property property">url</span><span class="token operator">:</span>path<span class="token operator">+</span><span class="token string">"/jsp/user.do"</span><span class="token punctuation">,</span><span class="token comment">//请求的url</span>      <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">"getrolelist"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token comment">//请求参数</span>      <span class="token literal-property property">dataType</span><span class="token operator">:</span><span class="token string">"json"</span><span class="token punctuation">,</span><span class="token comment">//ajax接口（请求url）返回的数据类型</span>      <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//data：返回数据（json对象）</span>         <span class="token keyword">if</span><span class="token punctuation">(</span>data <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">var</span> rid <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#rid"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            userRole<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token string">"&lt;option value=\"0\">请选择&lt;/option>"</span><span class="token punctuation">;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>               <span class="token keyword">if</span><span class="token punctuation">(</span>rid <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> rid <span class="token operator">!=</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">==</span> rid <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                  options <span class="token operator">+=</span> <span class="token string">"&lt;option selected=\"selected\" value=\""</span><span class="token operator">+</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token operator">+</span><span class="token string">"\" >"</span><span class="token operator">+</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>roleName<span class="token operator">+</span><span class="token string">"&lt;/option>"</span><span class="token punctuation">;</span>               <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                  options <span class="token operator">+=</span> <span class="token string">"&lt;option value=\""</span><span class="token operator">+</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token operator">+</span><span class="token string">"\" >"</span><span class="token operator">+</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>roleName<span class="token operator">+</span><span class="token string">"&lt;/option>"</span><span class="token punctuation">;</span>               <span class="token punctuation">&#125;</span>                           <span class="token punctuation">&#125;</span>            userRole<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//当访问时候，404，500 等非200的错误状态码</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>userRole<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo<span class="token operator">+</span><span class="token string">" 获取用户角色列表error"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         userName<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>userName<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* 用户名长度必须是大于1小于10的字符"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>userName<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> userName<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">1</span>             <span class="token operator">&amp;&amp;</span> userName<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>userName<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>userName<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo<span class="token operator">+</span><span class="token string">" 用户名输入的不符合规范，请重新输入"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>         <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      birthday<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>birthday<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* 点击输入框，选择日期"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>birthday<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> birthday<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>birthday<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>birthday<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" 选择的日期不正确,请重新输入"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      phone<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>phone<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* 请输入手机号"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">var</span> patrn<span class="token operator">=</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(13[0-9]|15[0-9]|18[0-9])\d&#123;8&#125;$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>phone<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>patrn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>phone<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>phone<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" 您输入的手机号格式不正确"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      userRole<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>userRole<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* 请选择用户角色"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>userRole<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> userRole<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>userRole<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>userRole<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo<span class="token operator">+</span><span class="token string">" 请重新选择用户角色"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>         <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      saveBtn<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      userName<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      phone<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      birthday<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      userRole<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>userName<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span>          <span class="token operator">&amp;&amp;</span> phone<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span>         <span class="token operator">&amp;&amp;</span> birthday<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span>         <span class="token operator">&amp;&amp;</span> userRole<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">"是否确认要提交数据？"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#userForm"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      backBtn<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token comment">//alert("modify: "+referer);</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>referer <span class="token operator">!=</span> <span class="token keyword">undefined</span>          <span class="token operator">&amp;&amp;</span> <span class="token keyword">null</span> <span class="token operator">!=</span> referer          <span class="token operator">&amp;&amp;</span> <span class="token string">""</span> <span class="token operator">!=</span> referer         <span class="token operator">&amp;&amp;</span> <span class="token string">"null"</span> <span class="token operator">!=</span> referer         <span class="token operator">&amp;&amp;</span> referer<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>       window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> referer<span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>         history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>直接丢给chatGPT分析:</strong></p><ul><li><p>代码的核心部分是以下部分：</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript">$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>  <span class="token literal-property property">url</span><span class="token operator">:</span> path <span class="token operator">+</span> <span class="token string">"/jsp/user.do"</span><span class="token punctuation">,</span>  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"getrolelist"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span>  <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">var</span> rid <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#rid"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      userRole<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token string">"&lt;option value=\"0\">请选择&lt;/option>"</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>rid <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> rid <span class="token operator">!=</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">==</span> rid<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          options <span class="token operator">+=</span> <span class="token string">"&lt;option selected=\"selected\" value=\""</span> <span class="token operator">+</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">"\" >"</span> <span class="token operator">+</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>roleName <span class="token operator">+</span> <span class="token string">"&lt;/option>"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>          options <span class="token operator">+=</span> <span class="token string">"&lt;option value=\""</span> <span class="token operator">+</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">"\" >"</span> <span class="token operator">+</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>roleName <span class="token operator">+</span> <span class="token string">"&lt;/option>"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>      userRole<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">validateTip</span><span class="token punctuation">(</span>userRole<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"color"</span><span class="token operator">:</span> <span class="token string">"red"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> imgNo <span class="token operator">+</span> <span class="token string">" 获取用户角色列表error"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>这部分代码使用了 <code>$.ajax</code> 函数发起一个 GET 请求，请求的目标 URL 是 <code>path + &quot;/jsp/user.do&quot;</code>。请求的数据参数中包含了一个名为 <code>method</code> 的参数，其值为 <code>&quot;getrolelist&quot;</code>。预期的响应数据类型为 JSON。</p><p>在成功回调函数中，首先判断返回的数据 <code>data</code> 是否为非空。如果不为空，则继续执行后续逻辑。</p><p>通过获取 <code>$(&quot;#rid&quot;).val()</code> 获取一个表示角色的 ID 值。</p><p>接下来，清空 <code>userRole</code> 元素的内容，然后使用循环遍历返回的数据数组 <code>data</code>。对于每个数据项，根据其 ID 值和当前选中的角色 ID (<code>rid</code>) 进行比较。如果两者相等，说明该选项应该被选中，否则为普通选项。在循环过程中，动态生成了一段 HTML 字符串 <code>options</code>，包含了所有的选项。</p><p>最后，将生成的选项字符串设置为 <code>userRole</code> 元素的 HTML 内容，从而在页面上显示这些选项。</p><p>在错误回调函数中，对获取用户角色列表出错的情况进行处理，调用 <code>validateTip</code> 函数显示相应的错误提示信息。</p><p>该部分代码的核心功能是通过 AJAX 请求获取用户角色列表，并根据返回的数据动态生成下拉选项，用于用户在表单中选择角色。</p><p>所以, 我们需要一个servlet来处理这段ajax请求, 这个请求需要一个角色表</p></li></ul><p>,整理前端提供的数据, 以及前端需要的数据</p><ul><li><p>提供的数据:</p><ul><li><code>name=&quot;method&quot; value=&quot;modifyexe&quot;</code></li><li><code>name=&quot;uid&quot; value=&quot;$&#123;user.id &#125;</code></li><li><code>name=&quot;userName&quot; value=&quot;$&#123;user.userName &#125;</code></li><li><code>name=&quot;gender&quot;</code></li><li><code>name=&quot;birthday&quot; value=&quot;$&#123;user.birthday &#125;</code></li><li><code>name=&quot;phone&quot; value=&quot;$&#123;user.phone &#125;</code></li><li><code>name=&quot;address&quot;  value=&quot;$&#123;user.address &#125;</code></li><li><code>name=&quot;userRole&quot;</code></li></ul></li><li><p>需要的数据</p><ul><li><code>name=&quot;birthday&quot; value=&quot;$&#123;user.birthday &#125;</code></li><li><code>name=&quot;phone&quot; value=&quot;$&#123;user.phone &#125;</code></li><li><code>name=&quot;address&quot;  value=&quot;$&#123;user.address &#125;</code></li><li><code>name=&quot;uid&quot; value=&quot;$&#123;user.id &#125;</code></li><li><code>name=&quot;userName&quot; value=&quot;$&#123;user.userName &#125;</code></li><li>角色表</li></ul></li></ul><p><strong>下面我们来编写servlet</strong></p><ol><li><p>通过method的值对请求做不同处理, 这里有三个个请求, 分别是</p><ol><li><code>method=modify</code></li><li><code>method = getrolelist</code></li><li><code>metho=modidyexe</code></li></ol></li><li><p><code>method=modify</code> 这个请求当用户点击修改按钮时被触发, 目的是导航到用户修改页面, 以及返回修改用户的信息</p></li><li><p><code>method = getrolelist</code> 这个请求当用户跳转到用户修改页面触发, 目的是通过 AJAX 请求获取用户角色列表，并根据返回的数据动态生成下拉选项，用于用户在表单中选择角色。</p></li><li><p><code>metho=modidyexe</code>, 这个请求当用户提交修改信息的时候触发, 修改数据库内容</p><p>一个复用的Servlet, 用来响应对用户表进行操作的请求. (实际上组合查询了角色表)</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"savepwd"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">savePwd</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"pwdmodify"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">pwdModify</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"query"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">query</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"add"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">addUser</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"getrolelist"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">getRoleList</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"ucexist"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ajax后台验证--userCode是否已存在</span>        <span class="token comment">//    //user.do?method=ucexist&amp;userCode=**</span>        <span class="token function">isUserCodeExit</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"view"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">view</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"deluser"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">delUser</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"modifyexe"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">modifyExe</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"modify"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">modify</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>​       ==getRoleList(req, resp)==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">getRoleList</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">RoleServiceImpl</span> roleService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RoleServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> roleList <span class="token operator">=</span> roleService<span class="token punctuation">.</span><span class="token function">getRoleList</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    resp<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">JSONArray</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>roleList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>​        ==modify(req, resp);==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span><span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> uid <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">User</span> user <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"/jsp/usermodify.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>​        ==modifyExe(req, resp);==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">modifyExe</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 1. 从前端获取参数: userCode userName password gender birthday phone address userRole</span>    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> uid <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"userName"</span><span class="token punctuation">,</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"userName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">,</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">,</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"userRole"</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"userRole"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> birthday <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"birthday"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>birthday<span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"birthday"</span><span class="token punctuation">,</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ParseException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 2. 封装数据</span>    <span class="token class-name">User</span> o <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"modifyBy"</span><span class="token punctuation">,</span>o<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Date</span> modifyDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"modifyDate"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//3. 调用service</span>    service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> map<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">boolean</span> res <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"/jsp/user.do?method=query"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>剩下的编写Service以及Dao层实现对数据库的操作, 整个功能就实现了. 这里不在叙述.</p><h2 id="尾巴">尾巴</h2><p>​到这里, 这个项目的搭建算是告一段落了. 在这个项目中, 我基本上是从零开始搭建. 说来惭愧, 现在大三下下学期已经过半, 学校的JavaEE也结课两周. 我对整个课程却没什么印象, 这当然也和我根本没去上几次课有关系, 除了实验课我基本就不去了. 这也不是我不想学, 只是觉得要是跟着老师学我会更糟. 老师上课完全不顾学生, 只将电脑的idea投屏到投影仪上便能自顾自的讲一节课. 投影仪本来亮度就不高, idea字体又小,完全不知道怎么听. 听过几次我就是在不想去了.</p><p>​加之又有考研的计划, 基本都呆在图书馆学习高数和计算机网络了, JavaEE基本上没怎么碰了, 连分组的实践也是完全丢下给小组其他同学了(小组实践能不能从大学消失啊). 小组其他几个也都是混子, 这留下我的旁边床铺的室友了, 这让我感觉实在很惭愧. 当然最后的结果也是压根没人管这个小组实践了, 直到deadline的前一天晚上, 这事才被重新提起. 当然也只能从github匆匆找一个应付交作业了.</p><p>​那么如果总结这半学期学到了什么的话, 只剩下把计算机网络算是完完整整的学完了, 不过这也是补了之前欠下的债了. 高数我已经接近一个月没有看过了, 现在也已经没什么印象了, 不知道考研要怎么办了.  我也已经做好了二战的准备了.</p><p>​写这个项目的契机, 也是学校又莫名其妙多了个课程设计, 相比学校的什么破实验实践, 我很喜欢学校的课程设计, 上次操作系统的实践设计是关于xv6的, 那次让我对操作系统的理解提升了很多, 现在我都不舍得删掉电脑里的qemu模拟器. 不过这和老师没什么关系, 老师基本上只是把课题扔在那, 我们自己独立完成. 但也同时我有了更多的时间去完成这个课程设计, 没有其他课程任务的干扰, 我可以全心全意的投入到这个课程设计中去. 这很符合我自己的学习习惯, 我更喜欢把一个课程学完了, 或者是一个阶段的任务完成了, 才去开始下一项学习计划. 相比于去课堂上听无意义的课程, 这种把时间留给学生自己的做法, 在这个大学老师基本上起不到什么帮助的破大学里, 显然是更值得的.</p><p>​说回写这个项目的契机, 也是学校的课程设计. 到这个时候所以的课程也已经结束了, 我本以为可以完完全全的开始自己的学习计划的时候, 来这么一个任务一开始我是蛮不开心的. 这次的任务是写一个图书管理系统, 狂神这个课程写了一个超市管理系统, 但是这些什么学生管理系统啊, 图书管理系统之类的, 都没区别, 随便改一改就可以.</p><p>​这次的课程设计分为了几个小组, 和其他小组不同的是, 我们小组的老师要求每个同学独立完成, 这让我很喜这个老师的做法. 而我们每天上课的内容也就是在自习室写自己的项目罢了, 除了早上八点要爬上11楼外, 我没什么抱怨的.</p><p>​接下来的学习计划, 我准备把CSAPP的内容补上, 这个从大一开始便一直计划要学的内容, 到现在也没开始, 我真是废物啊. 如果可以穿越回大一到话, 当然是带着现在的记忆穿越回去, 不然结局也是淹没在大学的无意义的课程中了. 不过带着记忆的话, 与其幻想这个不切实际的梦, 这个幻想其本质和我接下把自己缺失的补上是一样的.</p><p>​即使我对自己的能力不满意, 但我也确实没什么可以抱怨的, 毕竟这就是我, 这才是我. 除了暑假的时间顾着玩了, 大学的生活我的学习步伐一直都是踏踏实实的. 我不得不说我已经够努力了, 靠着我一个人, 在一个远离家乡的城市. 这个指望不上老师的地方, 我做到现在我已经和满意了, 从大一到现在的我, 以及学会了太多太多, 完完全全成长了很多, 学到很多. 剩下的遗憾, 留下没有一个好的环境, 一个良师益友引导我. 不知道这个遗憾能不能在研究生生活中补上呢, 至少现在先考上一个好多大学, 补完这些遗憾吧. 加油啊, 自己.</p><p>以下是改为图书管理系统的字段替换:</p><pre class="language-none"><code class="language-none">供应商表-&gt; 图书ISBN：-&gt;provider.proCode书名：-&gt;provider.proName作者：-&gt;provider.proContact定价：-&gt;provider.proPhone 出版社-&gt;provider.proFax 分类：-&gt;provider.proDesc订单管理-&gt;借阅记录管理未归还 -&gt; queryIsPayment &#x3D;&#x3D; 1 已归还-&gt; queryIsPayment &#x3D;&#x3D; 2 用户：-&gt;queryProductName借阅记录编码-&gt;billCode图书 -&gt;providerName金额-&gt;totalPrice</code></pre></li></ol>]]></content>
    
    
    <summary type="html">写这个项目的契机, 也是学校又莫名其妙多了个课程设计, 相比学校的什么破实验实践, 我很喜欢学校的课程设计, 上次操作系统的实践设计是关于xv6的, 那次让我对操作系统的理解提升了很多, 现在我都不舍得删掉电脑里的qemu模拟器. 不过这和老师没什么关系, 老师基本上只是把课题扔在那, 我们自己独立完成. 但也同时我有了更多的时间去完成这个课程设计, 没有其他课程任务的干扰, 我可以全心全意的投入到这个课程设计中去. 这很符合我自己的学习习惯, 我更喜欢把一个课程学完了, 或者是一个阶段的任务完成了, 才去开始下一项学习计划. 相比于去课堂上听无意义的课程, 这种把时间留给学生自己的做法, 在这个大学老师基本上起不到什么帮助的破大学里, 显然是更值得的.</summary>
    
    
    
    <category term="Java web" scheme="https://trevoewu.github.io/categories/Java-web/"/>
    
    
    <category term="java web" scheme="https://trevoewu.github.io/tags/java-web/"/>
    
    <category term="jsp" scheme="https://trevoewu.github.io/tags/jsp/"/>
    
    <category term="servlet" scheme="https://trevoewu.github.io/tags/servlet/"/>
    
    <category term="jdbc" scheme="https://trevoewu.github.io/tags/jdbc/"/>
    
    <category term="fullstack" scheme="https://trevoewu.github.io/tags/fullstack/"/>
    
    <category term="smbms" scheme="https://trevoewu.github.io/tags/smbms/"/>
    
  </entry>
  
  <entry>
    <title>Java Web 快速入门</title>
    <link href="https://trevoewu.github.io/2023/05/12/Java-Web-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"/>
    <id>https://trevoewu.github.io/2023/05/12/Java-Web-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/</id>
    <published>2023-05-12T09:45:29.000Z</published>
    <updated>2023-06-10T12:58:44.545Z</updated>
    
    <content type="html"><![CDATA[<h2 id="静态web和动态web">静态web和动态web</h2><p>静态Web和动态Web都是Web应用程序的不同类型，它们的主要区别在于页面内容是如何生成和呈现的。</p><p>静态Web是由静态网页组成的Web应用程序，网页的内容在页面请求时已经存在，并且不会随着用户的请求而发生变化。网页内容通常是由HTML、CSS、JavaScript等静态文件组成的，这些文件都是在服务器端预先生成的，当用户访问这些网页时，服务器只需将这些文件发送给用户的浏览器，浏览器将文件解析并显示给用户即可。静态Web通常包含少量的网页，内容不会发生频繁变化，适合于展示企业宣传网站、个人博客等简单的网站。</p><p>动态Web是由动态网页组成的Web应用程序，网页内容是在用户请求时根据请求参数和服务器端的处理生成的。网页内容可以根据用户的不同请求参数、数据库查询结果等实时生成。动态Web需要使用服务器端脚本语言（如Java、PHP、Python Servlet/JSP等）来生成HTML页面内容，通常使用数据库来存储和管理数据。动态Web可以实现更复杂的功能，例如在线商城、社交网络、新闻门户等。</p><p>总的来说，静态Web适合于内容不会频繁变化，网站规模较小的场景，可以使用简单的HTML、CSS、JavaScript等前端技术来实现；而动态Web适合于内容需要频繁变化、网站规模较大的场景，需要使用服务器端脚本语言和数据库来实现。</p><h2 id="web服务器">web服务器</h2><h3 id="Tomcat">Tomcat</h3><p>Web服务器是一种软件程序，主要用于处理客户端和服务器之间的HTTP请求和响应。它可以接收来自客户端（通常是Web浏览器）的HTTP请求，并返回处理后的HTTP响应。Web服务器通常运行在互联网上，提供各种各样的服务，例如Web网站、电子邮件服务、文件传输等。</p><p><img src="image-20230512175355319.png" alt="image-20230512175355319" loading="lazy"></p><p><a href="https://tomcat.apache.org/">Tomcat</a>是一种流行的开源Web服务器，它实现了Java Servlet和JavaServer Pages (JSP) 规范。Tomcat支持多种操作系统，包括Windows、Linux和Mac OS等，它提供了一个简单的、易于使用的管理界面，允许管理员对服务器进行配置和管理。</p><p>Tomcat的主要特点包括：</p><ol><li><p>支持Java Servlet和JSP规范：Tomcat可以运行和处理Java Web应用程序，例如Java Servlet、JSP和JavaServer Faces (JSF) 等。</p></li><li><p>可扩展性：Tomcat支持各种插件和扩展，可以根据需要添加新功能或修改现有功能。</p></li><li><p>易于配置和管理：Tomcat提供了一个简单的管理界面，允许管理员轻松地配置和管理Web服务器，包括添加或删除Web应用程序、配置访问权限等。</p></li><li><p>开源免费：Tomcat是一个开源项目，可以免费使用和修改。这意味着用户可以根据自己的需要进行定制和修改，而不需要支付高昂的授权费用。</p></li></ol><p>总的来说，Tomcat是一种功能强大的Web服务器，非常适合运行Java Web应用程序。它具有可扩展性、易于配置和管理、开源免费等优点，因此在企业和个人用户中非常受欢迎。</p><h4 id="Tomcat文件结构">Tomcat文件结构</h4><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/tomcat //tomcart 安装目录</code></pre><p><img src="image-20230512175943702.png" alt="image-20230512175943702" loading="lazy"></p><p><img src="image-20230512180405774.png" alt="image-20230512180405774" loading="lazy"></p><p>访问测试：<a href="http://localhost:8080">http://localhost:8080</a></p><p>默认端口8080</p><h4 id="配置文件">配置文件</h4><p><img src="image-20230512180642215.png" alt="image-20230512180642215" loading="lazy"></p><ul><li>可以修改配置的启动端口号, 默认为8080</li></ul><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8080<span class="token punctuation">"</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTP/1.1<span class="token punctuation">"</span></span>           <span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>20000<span class="token punctuation">"</span></span>           <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8443<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><ul><li><p>可以配置主机的名称, 默认网站的存放位置</p><ul><li>name=“locahost” 默认主机名对于的ip地址 127.0.0.1</li><li>默认网站存放地址: webapps</li></ul><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Host</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>localhost<span class="token punctuation">"</span></span>  <span class="token attr-name">appBase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>webapps<span class="token punctuation">"</span></span>           <span class="token attr-name">unpackWARs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">autoDeploy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre></li></ul><h4 id="发布一个网站">发布一个网站</h4><ul><li>将自己写的网站，放到服务器(Tomcat)中指定的web应用的文件夹（webapps）下，就可以访问了。</li></ul><h3 id="HTTP">HTTP</h3><p>HTPP 请求</p><pre class="language-json" data-language="json"><code class="language-json">Request URL<span class="token operator">:</span>https<span class="token operator">:</span><span class="token comment">//www.baidu.com/   请求地址</span>Request Method<span class="token operator">:</span>GET    get方法/post方法Status Code<span class="token operator">:</span><span class="token number">200</span> OK    状态码：<span class="token number">200</span>Remote（远程） Address<span class="token operator">:</span><span class="token number">14.215</span>.<span class="token number">177.39</span><span class="token operator">:</span><span class="token number">443</span>Accept<span class="token operator">:</span>text/html  客户端可以接受的语言Accept-Encoding<span class="token operator">:</span>gzip<span class="token punctuation">,</span> deflate<span class="token punctuation">,</span> br 编码Accept-Language<span class="token operator">:</span>zh-CN<span class="token punctuation">,</span>zh;q=<span class="token number">0.9</span>    语言Cache-Control<span class="token operator">:</span>max-age=<span class="token number">0</span> 是否设置缓存Connection<span class="token operator">:</span>keep-alive 是否为持续性链接</code></pre><h2 id="Servlet">Servlet</h2><h3 id="简介">简介</h3><ul><li>Servlet就是sun公司开发动态web的一门技术。</li><li>Sun在这些API中提供一个接口叫做：Servlet，如果你想开发一个Servlet程序，只需要完成两个小步骤：<ul><li>编写一个类，实现Servlet接口。</li><li>把开发好的Java类部署到web服务器中。</li></ul></li><li><strong>把实现了Servlet接口的Java程序叫做，Servlet</strong>。</li></ul><h3 id="第一个Servlet程序-HelloServlet">第一个Servlet程序 HelloServlet</h3><ol><li>修改web.xml为最新的</li></ol><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://xmlns.jcp.org/xml/ns/javaee<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://xmlns.jcp.org/xml/ns/javaee                      http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd<span class="token punctuation">"</span></span>         <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4.0<span class="token punctuation">"</span></span>         <span class="token attr-name">metadata-complete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">></span></span></code></pre><ol start="2"><li>编写一个Servlet程序。</li></ol><p><img src="image-20230512182111384.png" alt="image-20230512182111384" loading="lazy"></p><ol start="3"><li><p>编写一个普通类Bean</p></li><li><p>实现servlet接口, 这里我们直接继承HttpServlet</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 由于get或post只是请求实现的不同的方式，可以相互调用，业务逻辑都是一样；</span>  <span class="token comment">//HttpServletRequest代表客户端的请求，用户通过Http协议访问服务器，</span><span class="token comment">//HTTP请求中的所有信息会被封装到HttpServletRequest，</span><span class="token comment">//通过这个HttpServletRequest的方法，获得客户端的所有信息；</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 响应流</span>        writer<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Hello,Serlvet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span></code></pre></li></ol><h4 id="write-和println">write( )和println( )</h4><p><code>servletResponse.getWriter().write()``servletResponse.getWriter().println()</code>都是用于将字符串写入到HTTP响应中的方法，但是它们之间有一些关键的区别。</p><p><code>servletResponse.getWriter().write()</code>方法是将指定的字符串写入到HTTP响应输出流中，它不会在字符串末尾添加任何换行符或其他字符。如果需要在输出的字符串后面添加换行符或其他字符，就需要在字符串后面显式添加这些字符。</p><p><code>servletResponse.getWriter().println()</code>方法也是将指定的字符串写入到HTTP响应输出流中，但是它会在字符串末尾自动添加一个换行符。这个换行符的样式和操作系统相关，通常是<code>\n</code>或<code>\r\n</code>。使用<code>println()</code>方法可以让每个输出的字符串都独占一行，使得输出更易于阅读和处理。</p><p>因此，<code>write()</code>方法适合于需要将多个字符串写入到同一行的情况，例如输出CSV格式的数据或者HTML代码的片段。而<code>println()</code>方法适合于需要输出多行字符串的情况，例如输出日志信息或HTML代码的整个页面。</p><p>需要注意的是，无论使用哪种方法，都需要在使用完之后调用<code>servletResponse.getWriter().flush()</code>方法将输出流刷新并将数据发送到客户端。如果不调用<code>flush()</code>方法，可能会导致响应数据无法正常发送到客户端。</p><ol start="5"><li><p>编写Servlet的映射</p><ul><li>为什么需要映射：我们写的是JAVA程序，但是要通过浏览器访问，而浏览器需要连接web服务器，所以我们需要再web服务中注册我们写的Servlet，还需给他一个浏览器能够访问的路径；</li></ul><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--注册Servlet--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>cn.loulan.servlet.HelloServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--Servlet的请求路径--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre></li></ol><h4 id="Servlet-Mapping">Servlet Mapping</h4><ol><li><p>一个Servlet可以指定一个映射路径。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre></li><li><p>一个Servlet可以指定多个映射路径。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/hello2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/hello3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/hello4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/hello5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre></li><li><p>一个Servlet可以指定通用映射路径。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/hello/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre></li><li><p>默认请求路径。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--默认请求路径--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre></li><li><p>指定一些后缀或者前缀等等….</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- 可以自定义后缀实现请求映射     注意点，*前面不能加项目映射的路径     hello/subei.github    --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>*.github<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre></li><li><p>优先级问题。</p><ul><li>指定了固有的映射路径优先级最高，如果找不到就会走默认的处理请求；</li></ul></li></ol><h3 id="Servlet-Context">Servlet Context</h3><ul><li>web容器在启动的时候，它会为每个web程序都创建一个对应的ServletContext对象，它代表了当前的web应用(Application)；</li></ul><p>ServletContext是Java Web应用程序的一个接口，它提供了一个Web应用程序的运行环境，可以访问应用程序的配置信息、资源、请求和会话等。每个Web应用程序都有一个ServletContext实例，可以通过getServletContext()方法获取。</p><p>ServletContext提供了以下功能：</p><ol><li><p>应用程序作用域：ServletContext对象是一个应用程序级别的对象，可以在整个应用程序范围内共享数据。</p></li><li><p>应用程序配置信息：ServletContext对象提供了访问Web应用程序的配置信息的方法，例如Web.xml中配置的上下文参数，初始化参数等。</p></li><li><p>资源访问：ServletContext对象提供了一些方法，例如getRealPath()和getResourceAsStream()，可以访问Web应用程序中的资源文件。</p></li><li><p>请求转发：ServletContext对象提供了getRequestDispatcher()方法，可以将请求转发到其他Web组件，例如Servlet或JSP。</p></li><li><p>会话管理：ServletContext对象提供了创建和管理会话的方法，例如getSession()和getSessionCookieConfig()。</p></li></ol><p>ServletContex为Java Web应用程序提供了一个环境，使开发人员可以访问应用程序的配置信息、资源、请求和会话等，并且可以将请求转发到其他Web组件。这使得Java Web应用程序开发变得更加容易和灵活。</p><h4 id="利用servletContext实现不同Servlet之前的数据共享">利用servletContext实现不同Servlet之前的数据共享</h4><ul><li>在这个Servlet中保存的数据，可以在另外一个servlet中拿到；</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServletContext</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">"学习超好"</span><span class="token punctuation">;</span>   <span class="token comment">// 数据</span>        context<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GetServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServletContext</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>context<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"名字:"</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><h4 id="利用Servlet获取初始化参数">利用Servlet获取初始化参数</h4><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- 配置一些Web应用初始化参数 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>context-param</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>url<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>jdbc:mysql://localhost:3306/mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context-param</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>gp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>com.github.servlet.ServletDemo03<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>gp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/gp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletDemo03</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServletContext</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> url <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getInitParameter</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><h4 id="实现请求的转发">实现请求的转发</h4><ol start="2"><li>利用ServletContext实现请求的转发</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletDemo04</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServletContext</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        调用forward实现请求转发;</span><span class="token comment">//        requestDispatcher.forward(req,resp);</span>      context<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><h4 id="用来读取资源文件">用来读取资源文件</h4><ul><li><p>在resources目录下新建properties</p></li><li><p>思路：需要一个文件流；</p></li></ul><pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">username</span><span class="token punctuation">=</span><span class="token value attr-value">"楼兰"</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletDemo05</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>       <span class="token class-name">InputStream</span> stream <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"WEB-INF/classes/db.properties"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Properties</span> prop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        prop<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">String</span> user <span class="token operator">=</span> prop<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        但是如果配置文件中如果包含中文，就会出现乱码，所以可以通过中转的形式优化一下：</span>        prop<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><h3 id="HttpServletResponse">HttpServletResponse</h3><ul><li>web服务器接收到客户端的http请求，针对这个请求，分别创建一个代表请求的HttpServletRequest对象，代表响应的一个HttpServletResponse；<ul><li>如果要获取客户端请求过来的参数：找HttpServletRequest；</li><li>如果要给客户端响应一些信息：找HttpServletResponse。</li></ul></li></ul><h4 id="1-简单分类">1.简单分类</h4><ul><li>负责向浏览器发送数据的方法。</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">ServletOutputStream</span> <span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">PrintWriter</span> <span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>负责向浏览器发送响应头的方法。</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token class-name">String</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">String</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>响应的状态码。</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> <span class="token constant">SC_OK</span> <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token constant">SC_MOVED_PERMANENTLY</span> <span class="token operator">=</span> <span class="token number">301</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token constant">SC_NOT_FOUND</span> <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token constant">SC_INTERNAL_SERVER_ERROR</span> <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span></code></pre><ul><li>200 - 请求成功</li><li>301 - 资源（网页等）被永久转移到其它URL</li><li>404 - 请求的资源（网页等）不存在</li><li>500 - 内部服务器错误</li></ul><h4 id="2-下载文件">2.下载文件</h4><ol><li>向浏览器输出消息；</li><li>下载文件：<ol><li>要获取下载文件的路径；</li><li>下载的文件名是啥？</li><li>设置想办法让浏览器能够支持下载我们需要的东西；</li><li>获取下载文件的输入流；</li><li>创建缓冲区；</li><li>获取OutputStream对象；</li><li>将FileOutputStream流写入到buffer缓冲区；</li><li>使用OutputStream将缓冲区中的数据输出到客户端！</li></ol></li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FIleServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span><span class="token comment">//        1. 获取下载文件的路径；</span>    <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"/Users/trevorwu/Maven_03/HelloServlet/src/main/resources/Peekaboo.png"</span><span class="token punctuation">;</span><span class="token comment">//        2. 获取文件名</span>        <span class="token class-name">String</span> fileName <span class="token operator">=</span> <span class="token string">"downFile.png"</span><span class="token punctuation">;</span><span class="token comment">//        3. 让浏览器能够支持下载我们需要的东西；</span><span class="token comment">//        这段代码是用来设置 HTTP 响应头，将服务器返回的内容作为文件附件（attachment）下载，而非直接在浏览器中打开。</span><span class="token comment">//        具体地，`resp.setHeader()` 方法设置了一个名为 "Content-Disposition" 的响应头，</span><span class="token comment">//        其值为 "attachment;filename=xxxxx"，其中 "xxxxx" 是要下载的文件名。</span><span class="token comment">//        这个文件名可以是服务器上的文件名，也可以是通过代码生成的文件名。</span><span class="token comment">//        这个文件名决定了用户下载得到的文件名， 而非服务器上的文件名， 服务器的文件名在下载文件的地址中指定</span>        resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span><span class="token string">"attachment;filename="</span>                <span class="token operator">+</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        4. 获取下载文件的输入流；</span>        <span class="token class-name">FileInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        5. 创建缓冲区；</span>        <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span> buffer<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//        6. 获取OutputStream对象；</span>        <span class="token class-name">ServletOutputStream</span> out <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        7. 将FileOutputStream流写入到buffer缓冲区；</span><span class="token comment">//        这段代码是将输入流 `in` 中的数据读取到缓冲区 `buffer` 中，再通过输出流 `out` 输出到目标位置。</span><span class="token comment">//        具体地，循环读取操作会在输入流中读取数据，并将数据写入到缓冲区中，</span><span class="token comment">//        当读取到的数据长度为0时，说明已经读取完毕，退出循环。</span><span class="token comment">//在每次循环中，通过调用 `out.write(buffer, 0, len)` 方法，将缓冲区中的数据写入输出流中。</span><span class="token comment">// 这里的 `buffer` 是一个字节数组，`len` 是每次读取的字节数。</span><span class="token comment">// 第二个参数 `0` 表示从缓冲区的第一个字节开始写入，而不是从数组的第一个元素开始写入。</span><span class="token comment">//通过这段代码，我们可以实现从输入流中读取数据，然后将数据输出到目标位置的操作，通常用于文件下载或数据传输等场景。</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len<span class="token operator">=</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token comment">//        close input output stream</span>        in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><h4 id="3-验证码功能">3.验证码功能*</h4><ul><li>验证怎么来的？<ul><li>前端实现；</li><li>后端实现，需要用到 Java 的图片类，生产一个图片。</li></ul></li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImageServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span><span class="token comment">//        如何让浏览器3秒自动刷新一次;</span>        resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"refresh"</span><span class="token punctuation">,</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        在内存中创建一个图片</span>        <span class="token class-name">BufferedImage</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedImage</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token class-name">BufferedImage</span><span class="token punctuation">.</span><span class="token constant">TYPE_INT_RGB</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        得到图片,笔</span>        <span class="token class-name">Graphics2D</span> g <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Graphics2D</span><span class="token punctuation">)</span> image<span class="token punctuation">.</span><span class="token function">getGraphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        设置图片的背景颜色</span>        g<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">;</span>        g<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        给图片写数据</span>        g<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token constant">RED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        g<span class="token punctuation">.</span><span class="token function">setFont</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Font</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token class-name">Font</span><span class="token punctuation">.</span><span class="token constant">BOLD</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        g<span class="token punctuation">.</span><span class="token function">drawString</span><span class="token punctuation">(</span><span class="token function">makeNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        告诉浏览器，这个请求用图片的方式打开</span>        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"image/jpeg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        网站存在缓存，不让浏览器缓存</span>        resp<span class="token punctuation">.</span><span class="token function">setDateHeader</span><span class="token punctuation">(</span><span class="token string">"expires"</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Cache-Control"</span><span class="token punctuation">,</span><span class="token string">"no-cache"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Pragma"</span><span class="token punctuation">,</span><span class="token string">"no-cache"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        把图片写给浏览器</span>        <span class="token class-name">ImageIO</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span><span class="token string">"jpg"</span><span class="token punctuation">,</span> resp<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">//    生成随机数</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">makeNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> num <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">9999999</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token class-name">StringBuffer</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token operator">-</span>num<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        num <span class="token operator">=</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> num<span class="token punctuation">;</span>        <span class="token keyword">return</span> num<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><h4 id="4-实现重定向">4.实现重定向</h4><p>之前我们学过利用Servlet实现请求的转发, 这里我们利用response来实现请求重定向</p><ol><li>重定向和转发的区别</li></ol><p>重定向和转发是在Java Servlet编程中常用的两种将请求从一个Servlet转发到另一个Servlet或JSP的方式，它们有一些关键的区别。</p><p>重定向（Redirect）是指当一个Servlet收到一个请求时，它会发送一个HTTP响应告诉浏览器发送一个新的请求到指定的URL。这个URL可以是一个Servlet、JSP、HTML页面或其他任何类型的资源。因此，重定向会导致浏览器向指定的URL发起一个全新的请求，而这个新请求的路径是由浏览器在重定向时自动发送的，不再是原始请求的路径。在重定向中，所有请求参数都会丢失，因此需要通过查询字符串或Session等方式传递参数。重定向可以用于将用户重定向到一个新的页面，或者将用户从一个应用程序重定向到另一个应用程序。</p><p>转发（Forward）是指当一个Servlet收到一个请求时，它会将请求转发到另一个Servlet或JSP来处理。在转发中，请求和响应对象是同一个，只是Servlet容器将请求转发给了另一个资源来生成响应。因此，在转发中，所有请求参数都会保留，并且可以在目标Servlet或JSP中访问。转发通常用于将请求从一个Servlet传递到另一个Servlet或JSP来生成响应，以便可以在请求和响应之间共享数据。</p><p>因此，重定向和转发都可以将请求从一个Servlet转发到另一个Servlet或JSP来生成响应，但它们的区别在于重定向会发送一个新的请求到指定的URL，而转发则将请求转发到另一个Servlet或JSP来处理，响应由目标Servlet或JSP生成。重定向导致的性能开销比转发更高，因为它需要向浏览器发送一个新的请求，而转发则在服务器内部进行，无需向浏览器发送任何内容。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedirectServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/response/img"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 重定向</span>    <span class="token punctuation">&#125;</span></code></pre><h4 id="5-简单实现登录重定向">5.简单实现登录重定向</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Log</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>这段代码用于Java Servlet编程中，将一个请求从一个Servlet转发到同一Web应用程序中的另一个Servlet或JSP（Java服务器页面）。</p><p><code>getRequestDispatcher()</code>方法的参数是请求转发到的资源的相对或绝对路径。在本例中，路径为“/hello”，这是另一个Servlet.</p><p>然后调用<code>RequestDispatcher</code>对象的<code>forward()</code>方法，传递<code>req</code>和<code>resp</code>参数。这些是传递到原始Servlet的<code>doGet()</code>或<code>doPost()</code>方法中的<code>HttpServletRequest</code>和<code>HttpServletResponse</code>对象。<code>forward()</code>方法将这些对象发送到指定的资源，并允许该资源生成要发送回客户端的响应。</p><p>总之，这段代码将一个请求从当前Servlet转发到同一Web应用程序中的另一个Servlet或JSP，同时传递<code>HttpServletRequest</code>和<code>HttpServletResponse</code>对象。目标资源将生成要发送回客户端的响应。</p><h3 id="HttpServletRequest">HttpServletRequest</h3><ul><li>HttpServletRequest代表客户端的请求，用户通过Http协议访问服务器，HTTP请求中的所有信息会被封装到HttpServletRequest，通过这个HttpServletRequest的方法，获得客户端的所有信息；</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//        HttpServletRequest代表客户端的请求，用户通过Http协议访问服务器，</span><span class="token comment">//        HTTP请求中的所有信息会被封装到HttpServletRequest，</span><span class="token comment">//        通过这个HttpServletRequest的方法，获得客户端的所有信息；</span>        <span class="token class-name">String</span> username <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> host <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"Host"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"username:"</span><span class="token operator">+</span>username<span class="token operator">+</span><span class="token string">" password:"</span><span class="token operator">+</span>password<span class="token operator">+</span><span class="token string">" host:"</span><span class="token operator">+</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        `req.getContextPath()` 是一个 Java Servlet API 中的方法，它返回当前 Servlet 的上下文路径。</span><span class="token comment">//        上下文路径是指 Web 应用程序的 URL 中，主机名和端口号后的第一个路径。</span><span class="token comment">//例如，如果 Web 应用程序的 URL 是 `http://example.com:8080/myapp/index.jsp`，</span><span class="token comment">// 那么上下文路径就是 `/myapp`。</span>        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Context path"</span><span class="token operator">+</span>req<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       </code></pre><h3 id="保存会话的两种技术">保存会话的两种技术</h3><h4 id="Cookies">Cookies</h4><img src="https://cdn4.iconfinder.com/data/icons/web-hosting-pack-vol-1/512/HTTP_Cookie-512.png" alt="Cookie, http, cookies, internet cookies, web cookies icon - Download on  Iconfinder" style="zoom:25%;" loading="lazy"><p><strong>HTTP cookie</strong>，简称<strong>cookie</strong>，又称“<strong>网站／浏览＋魔饼／魔片</strong>”等，是浏览<a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E7%AB%99">网站</a>时由<a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%99%A8">网络服务器</a>创建并由<a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E9%A1%B5%E6%B5%8F%E8%A7%88%E5%99%A8">网页浏览器</a>存放在用户计算机或其他设备的小文本文件。</p><p>Cookie使Web服务器能在用户的设备存储状态信息（如添加到在线商店购物车中的商品）或跟踪用户的浏览活动（如点击特定按钮、登录或记录历史.</p><p>cookie 是服务器在 HTTP 响应中发送的一段数据。客户端（可选）存储 cookie 并在后续请求中返回它。这允许客户端和服务器共享状态。要设置 cookie，服务器会在响应中包含一个 Set-Cookie 标头。cookie 的格式是名称-值对，带有可选属性。例如：</p><pre class="language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Set-Cookie</span>: session-id=1234567</code></pre><p>这是一个带有属性的示例：</p><pre class="language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Set-Cookie</span>: session-id=1234567<span class="token punctuation">;</span> max-age=86400<span class="token punctuation">;</span> domain=example<span class="token punctuation">.</span>com<span class="token punctuation">;</span> path=<span class="token operator">/</span><span class="token punctuation">;</span></code></pre><p>为了向服务器返回 cookie，客户端在以后的请求中包含一个 Cookie 标头。</p><pre class="language-bash" data-language="bash"><code class="language-bash">Cookie: session-id<span class="token operator">=</span><span class="token number">1234567</span></code></pre><p><img src="image1.png" alt="HTTP Cookies in ASP.NET Web API - ASP.NET 4.x | Microsoft Learn" loading="lazy"></p><h4 id="利用Cookies记录用户上一次登录时间">利用Cookies记录用户上一次登录时间</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cookie</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span><span class="token comment">//get all cookies</span>        <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>Cookie</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cookies <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>Cookie</span> cookie <span class="token operator">:</span> cookies<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> name <span class="token operator">=</span> cookie<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"lastLoginTime"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token class-name">String</span> value <span class="token operator">=</span> cookie<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">long</span> parseLong <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>cookie<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>parseLong<span class="token punctuation">)</span><span class="token punctuation">;</span>                resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"lastLoginTime: "</span><span class="token operator">+</span>date<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>Cookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>Cookie</span><span class="token punctuation">(</span><span class="token string">"lastLoginTime"</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><h4 id="session"><strong>session</strong></h4><p>在<a href="https://zh.wikipedia.org/wiki/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6">计算机科学</a>领域来说，尤其是在<a href="https://zh.wikipedia.org/wiki/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C">网络</a>领域，<strong>会话</strong>（英语：session，<a href="https://zh.wikipedia.org/wiki/Microsoft_Windows">Microsoft Windows</a>译作<strong>工作阶段</strong>、<strong>连线阶段</strong>）是一种持久网络协议，在用户（或用户代理）端和服务器端之间创建关联，从而起到交换数据包的作用机制，session在<a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE">网络协议</a>（例如<a href="https://zh.wikipedia.org/wiki/Telnet">telnet</a>或<a href="https://zh.wikipedia.org/wiki/FTP">FTP</a>）中是非常重要的部分。</p><p>在不包含<a href="https://zh.wikipedia.org/wiki/%E4%BC%9A%E8%AF%9D%E5%B1%82">会话层</a>（例如<a href="https://zh.wikipedia.org/wiki/%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%8D%8F%E8%AE%AE">UDP</a>）或者是无法长时间驻留会话层（例如<a href="https://zh.wikipedia.org/wiki/HTTP">HTTP</a>）的传输协议中，会话的维持需要依靠在传输数据中的高级别程序。例如，在浏览器和远程主机之间的HTTP传输中，HTTP cookie就会被用来包含一些相关的信息，例如session ID，参数和权限信息等。</p><ul><li><p>服务器技术，利用这个技术，可以保存用户的会话信息？ 我们可以把信息或者数据放在Session中！</p></li><li><p>服务器会给每一个用户（浏览器）创建一个Seesion对象；</p></li><li><p>一个Seesion独占一个浏览器，只要浏览器没有关闭，这个Session就存在；</p></li><li><p>用户登录之后，整个网站它都可以访问！–&gt; 保存用户的信息；保存购物车的信息……</p></li></ul><h4 id="Session和cookie的区别：">Session和cookie的区别：</h4><p>Cookie和Session是Web应用程序中常用的两种用于保存用户状态信息的机制。</p><p>相同点：</p><ol><li><p>都是用于在Web应用程序中保存用户状态信息的机制。</p></li><li><p>都可以在多个请求之间保持用户的状态信息，使用户在浏览网站时能够保持状态的连续性。</p></li><li><p>都可以在一定程度上提高Web应用程序的性能，减少对服务器的负载。</p></li></ol><p>不同点：</p><ol><li><p>存储位置不同：Cookie保存在客户端的浏览器中，而Session保存在服务器端的内存或者硬盘中。</p></li><li><p>存储容量不同：Cookie的存储容量比Session小。</p></li><li><p>安全性不同：由于Session数据存储在服务器端，因此相对于Cookie更加安全，Cookie数据容易被篡改或盗用。</p></li><li><p>过期时间不同：Session的过期时间可以由开发人员在代码中设置，而Cookie的过期时间可以在创建Cookie时设置，也可以在浏览器中手动删除。</p></li><li><p>使用场景不同：Cookie适用于需要长期保存用户状态信息的场景，例如保存用户的登录状态、偏好设置等；而Session适用于需要在短时间内保存用户状态信息的场景，例如购物车、会话信息等。</p></li></ol><h4 id="利用Session返回客户端一个Person对象-并在浏览器上打印">利用Session返回客户端一个Person对象, 并在浏览器上打印</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Session</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"person"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"Alice@gmail.com"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"Session id"</span><span class="token operator">+</span>session<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"person"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token operator">+</span>person<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>          <span class="token comment">//client 每次访问服务器都会在服务器端维护一个Session, 并向用户以Cookie的方式，发送Session id,</span><span class="token comment">//        但是对于client而言， 这个Session id 是以Cookie的形式存储在浏览器上的， 所以更换浏览器访问后Cookie改变了</span><span class="token comment">//        所以，服务器会认为这是一个新的Session.</span><span class="token comment">//        下一次用户再次访问的时候就会拿着这个Session id 访问Serve， Server就知道这个客户的信息</span><span class="token comment">//        1. 拿到Session， 这个Cookie是由客户端发送给服务器的</span><span class="token comment">//        Session 可以使用setAttribute方法来保存信息</span><span class="token comment">//        不同于Cookie，Session 可以保存一个对象(Object)， 而不是仅仅是一个String</span></code></pre><p><strong>会话自动过期：web.xml配置</strong>！</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--设置Session默认的失效时间--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>session-config</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--15分钟后Session自动失效，以分钟为单位--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>session-timeout</span><span class="token punctuation">></span></span>15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>session-timeout</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>session-config</span><span class="token punctuation">></span></span></code></pre><h3 id="JSP-Java-Server-Pages">JSP (Java Server Pages)</h3><p><strong>JSP</strong>（全称<strong>J</strong>akarta <strong>S</strong>erver <strong>P</strong>ages，曾称为<strong>J</strong>ava<strong>S</strong>erver <strong>P</strong>ages）是由<a href="https://zh.wikipedia.org/wiki/Sun_Microsystems">Sun Microsystems</a>公司主导创建的一种动态网页技术标准。</p><p><strong>Java Server Pages ： Java服务器端页面，也和Servlet一样，用于动态Web技术！</strong></p><ul><li>最大的特点：<ul><li>写JSP就像在写HTML；</li><li>区别：<ul><li>HTML只给用户提供静态的数据；</li><li>JSP页面中可以嵌入JAVA代码，为用户提供动态数据；</li></ul></li></ul></li></ul><h4 id="JSP原理">JSP原理</h4><p>思路：JSP到底怎么执行的！</p><ul><li><p>服务器内部工作：</p><ul><li>tomcat中有一个work目录；</li></ul></li><li><p>IDEA中使用Tomcat的会在IDEA的tomcat中生产一个work目录；</p><p>IDEA会为每个Tomcat Webapps创建一个文件夹,用来存放这个APP的配置文件, 工作路径, 在我的MAC路径<code>/Users/trevorwu/Library/Caches/JetBrains/IntelliJIdea2022.3/tomcat/47ad80c0-0fbd-41b1-a4ae-e036ca41705b</code></p><p>我们进入这个路径的最深处</p><p>`cd Catalina/localhost/ROOT/org/apache/jsp</p><p><img src="image-20230512202849320.png" alt="image-20230512202849320" loading="lazy"></p><p>可以看到这里面有两个文件, 一个是<code>index_jsp.class</code> 另一个是<code>index_jsp.java` 很明显, `index_jsp.class`就是</code>index_jsp.java` 编译生成的class文件.</p><p>这是只有一个这样的class, 也就是我们的主页index.jsp</p><img src="image-20230512203239731.png" alt="image-20230512203239731" style="zoom:33%;" loading="lazy"></li></ul><p>也就是说, 如果我们访问index.jsp, 相当于访问根目录<code>localhost:8080/</code> 服务器就会生成对应的.java文件, 以及.class文件用来处理请求. 这个.java文件本质上就是Servlet. 如果这时候我们访问别的页面, 就会生成新的Servlet.</p><ul><li><strong>浏览器向服务器发送请求，不管访问什么资源，其实都是在访问Servlet！</strong></li><li>JSP最终也会被转换成为一个Java类！</li><li><strong>JSP 本质上就是一个Servlet</strong>！</li></ul><p><img src="watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ2MTUzOTQ5,size_16,color_FFFFFF,t_70.png" alt="在这里插入图片描述" loading="lazy"></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">// 初始化</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">_jspInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token punctuation">&#125;</span><span class="token comment">// 销毁</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">_jspDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token punctuation">&#125;</span><span class="token comment">// JSPService</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">_jspService</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>HttpServletResponse</span> response<span class="token punctuation">)</span>      <span class="token keyword">throws</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>IOException</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>ServletException</span> <span class="token punctuation">&#123;</span>   </code></pre><ol><li><p>内置一些对象；</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span></span>PageContext</span> pageContext<span class="token punctuation">;</span>  <span class="token comment">// 页面上下文</span><span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>HttpSession</span> session <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token comment">// session</span><span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>ServletContext</span> application<span class="token punctuation">;</span>   <span class="token comment">// applicationContext</span><span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>ServletConfig</span> config<span class="token punctuation">;</span>         <span class="token comment">// config</span><span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span></span>JspWriter</span> out <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>           <span class="token comment">// out</span><span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>               <span class="token comment">// page：当前</span><span class="token class-name">HttpServletRequest</span> request                        <span class="token comment">// 请求</span><span class="token class-name">HttpServletResponse</span> response                      <span class="token comment">// 响应</span></code></pre></li><li><p>输出页面前增加的代码；</p><pre class="language-java" data-language="java"><code class="language-java">response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 设置响应的页面类型</span>pageContext <span class="token operator">=</span> _jspxFactory<span class="token punctuation">.</span><span class="token function">getPageContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">,</span>                                          <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">8192</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>_jspx_page_context <span class="token operator">=</span> pageContext<span class="token punctuation">;</span>application <span class="token operator">=</span> pageContext<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>config <span class="token operator">=</span> pageContext<span class="token punctuation">.</span><span class="token function">getServletConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>session <span class="token operator">=</span> pageContext<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out <span class="token operator">=</span> pageContext<span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>_jspx_out <span class="token operator">=</span> out<span class="token punctuation">;</span></code></pre></li><li><p>以上的这些个对象我们可以在JSP页面中直接使用！</p></li></ol><ul><li>在JSP页面中：<ul><li>只要是 JAVA代码就会原封不动的输出；</li><li>如果是HTML代码，就会被转换为：</li></ul></li></ul><pre class="language-java" data-language="java"><code class="language-java">out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"&lt;html>\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"  &lt;head>\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"    &lt;title>$Title$&lt;/title>\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"  &lt;/head>\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"  &lt;body>\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"  $END$\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"  &lt;/body>\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"&lt;/html>\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>这样的格式，输出到前端！</li></ul><h4 id="JSP语法">JSP语法</h4><ul><li>任何语言都有自己的语法，JAVA中有，JSP 作为java技术的一种应用，它拥有一些自己扩充的语法（了解，知道即可！），Java所有语法都支持！</li><li>配置必需的maven环境：</li></ul><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--        JSP 依赖   --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>javax.servlet.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>javax.servlet.jsp-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.3.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        JSTL表达式的依赖--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>javax.servlet.jsp.jstl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jstl-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        standard标签库--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>taglibs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>standard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><h5 id="JSP表达式">JSP表达式</h5><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;&lt;%--JSP表达式            作用：用来将程序的输出，输出到客户端            &lt;%&#x3D; 变量或者表达式%&gt;--%&gt;&lt;%&#x3D; new java.util.Date()%&gt;&lt;&#x2F;body&gt;</code></pre><h5 id="jsp脚本片段">jsp脚本片段</h5><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;&lt;%--jsp脚本片段--%&gt;&lt;%  int sum &#x3D; 0;  for (int i &#x3D; 1; i &lt;&#x3D;100 ; i++) &#123;    sum+&#x3D;i;  &#125;  out.println(&quot;&lt;h1&gt;Sum&#x3D;&quot;+sum+&quot;&lt;&#x2F;h1&gt;&quot;);%&gt;&lt;&#x2F;body&gt;</code></pre><ul><li>JSP声明</li><li>&lt;%! code %&gt;</li></ul><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;&lt;%!  static &#123;    System.out.println(&quot;Loading Servlet!&quot;);  &#125;  private int globalVar &#x3D; 0;  public void guo()&#123;    System.out.println(&quot;进入了方法guo！&quot;);  &#125;%&gt;&lt;&#x2F;body&gt;</code></pre><ul><li>JSP声明：会被编译到JSP生成Java的类中！其他的，就会被生成到_jspService方法中！</li></ul><p><img src="watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ2MTUzOTQ5,size_16,color_FFFFFF,t_70-20230512204121432.png" alt="在这里插入图片描述" loading="lazy"></p><h5 id="JSP指令-404与500页面实现">JSP指令: 404与500页面实现</h5><p><img src="image-20230512204634669.png" alt="image-20230512204634669" loading="lazy"></p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    自定义错误页面--></span><span class="token comment">&lt;!--    配置之后记得重启Tomcat服务， 修改tomcat配置文件web.xml热部署不生效--></span><span class="token comment">&lt;!--    自由修改jsp文件才能热部署--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-page</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-code</span><span class="token punctuation">></span></span>404<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-code</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>location</span><span class="token punctuation">></span></span>/error/404.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>location</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-page</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-page</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-code</span><span class="token punctuation">></span></span>500<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-code</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>location</span><span class="token punctuation">></span></span>/error/500.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>location</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-page</span><span class="token punctuation">></span></span></code></pre><h6 id="头部和尾部页面拼接">头部和尾部页面拼接</h6><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;    &lt;%-- @include会将两个页面合二为一 --%&gt;    &lt;%@include file&#x3D;&quot;common&#x2F;header.jsp&quot;%&gt;    &lt;h1&gt;网页主体&lt;&#x2F;h1&gt;    &lt;%@include file&#x3D;&quot;common&#x2F;footer.jsp&quot;%&gt;    &lt;hr&gt;    &lt;%--        jsp标签        jsp:include：拼接页面，本质还是三个    --%&gt;    &lt;jsp:include page&#x3D;&quot;&#x2F;common&#x2F;header.jsp&quot;&#x2F;&gt;    &lt;h1&gt;网页主体&lt;&#x2F;h1&gt;    &lt;jsp:include page&#x3D;&quot;&#x2F;common&#x2F;footer.jsp&quot;&#x2F;&gt;&lt;&#x2F;body&gt;</code></pre><h4 id="内置对象">内置对象</h4><ul><li>PageContext 存东西</li><li>Request 存东西</li><li>Response</li><li>Session 存东西</li><li>Application 【SerlvetContext】 存东西</li><li>config 【SerlvetConfig】</li><li>out</li><li>page ，不用了解</li><li>exception</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token generics"><span class="token punctuation">&lt;</span>body<span class="token punctuation">></span></span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">--</span>内置对象<span class="token operator">--</span><span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>    pageContext<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"name1"</span><span class="token punctuation">,</span><span class="token string">"天启1号"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 保存的数据只在一个页面中有效</span>    request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"name2"</span><span class="token punctuation">,</span><span class="token string">"天启2号"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 保存的数据只在一次请求中有效，请求转发会携带这个数据</span>    session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"name3"</span><span class="token punctuation">,</span><span class="token string">"天启3号"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 保存的数据只在一次会话中有效，从打开浏览器到关闭浏览器</span>    application<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"name4"</span><span class="token punctuation">,</span><span class="token string">"天启4号"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 保存的数据只在服务器中有效，从打开服务器到关闭服务器</span><span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">--</span>    脚本片段中的代码，会被原封不动生成到<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span>java    要求：这里面的代码，必须保证<span class="token class-name">Java</span>语法的正确性<span class="token operator">--</span><span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>    <span class="token comment">// 从pageContent取出，我们通过寻找的方式来</span>    <span class="token comment">// 从底层到高层（作用域）:</span>    <span class="token class-name">String</span> name1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> pageContext<span class="token punctuation">.</span><span class="token function">findAttribute</span><span class="token punctuation">(</span><span class="token string">"name1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> name2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> pageContext<span class="token punctuation">.</span><span class="token function">findAttribute</span><span class="token punctuation">(</span><span class="token string">"name2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> name3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> pageContext<span class="token punctuation">.</span><span class="token function">findAttribute</span><span class="token punctuation">(</span><span class="token string">"name3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> name4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> pageContext<span class="token punctuation">.</span><span class="token function">findAttribute</span><span class="token punctuation">(</span><span class="token string">"name4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> name5 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> pageContext<span class="token punctuation">.</span><span class="token function">findAttribute</span><span class="token punctuation">(</span><span class="token string">"name5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 作用域</span><span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">--</span>使用<span class="token constant">EL</span>表达式输出 $<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token operator">--</span><span class="token operator">%</span><span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>h1<span class="token punctuation">></span></span>取出的值<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>h3<span class="token punctuation">></span></span>$<span class="token punctuation">&#123;</span>name1<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>h3<span class="token punctuation">></span></span>$<span class="token punctuation">&#123;</span>name2<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>h3<span class="token punctuation">></span></span>$<span class="token punctuation">&#123;</span>name3<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>h3<span class="token punctuation">></span></span>$<span class="token punctuation">&#123;</span>name4<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>h3<span class="token punctuation">></span></span> <span class="token operator">&lt;</span><span class="token operator">%=</span>name5<span class="token operator">%</span><span class="token operator">></span> <span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre><ul><li>request：客户端向服务器发送请求，产生的数据，用户看完就没用了，比如：新闻，用户看完没用的！</li><li>session：客户端向服务器发送请求，产生的数据，用户用完一会还有用，比如：购物车；</li><li>application：客户端向服务器发送请求，产生的数据，一个用户用完了，其他用户还可能使用，比如：聊天数据；</li></ul><h4 id="JSP标签-JSTL标签-EL表达式">JSP标签.JSTL标签.EL表达式</h4><ul><li>EL表达式： ${ }<ul><li><strong>获取数据</strong></li><li><strong>执行运算</strong></li><li><strong>获取web开发的常用对象</strong></li></ul></li></ul><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;!-- JSTL表达式的依赖 --&gt;&lt;dependency&gt;    &lt;groupId&gt;javax.servlet.jsp.jstl&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;jstl-api&lt;&#x2F;artifactId&gt;    &lt;version&gt;1.2&lt;&#x2F;version&gt;&lt;&#x2F;dependency&gt;&lt;!-- standard标签库 --&gt;&lt;dependency&gt;    &lt;groupId&gt;taglibs&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;standard&lt;&#x2F;artifactId&gt;    &lt;version&gt;1.1.2&lt;&#x2F;version&gt;&lt;&#x2F;dependency&gt;</code></pre><ul><li><p><strong>JSP标签</strong></p></li><li><p>利用JSP标签实现请求转发, 并设置参数</p><p>&lt;jsp:forward page=“url”&gt;</p></li></ul><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;&lt;%--jsp:include--%&gt;&lt;jsp:forward page&#x3D;&quot;&#x2F;jspTag2.jsp&quot;&gt;    &lt;jsp:param name&#x3D;&quot;name&quot; value&#x3D;&quot;subeiLY&quot;&#x2F;&gt;    &lt;jsp:param name&#x3D;&quot;age&quot; value&#x3D;&quot;18&quot;&#x2F;&gt;&lt;&#x2F;jsp:forward&gt;&lt;&#x2F;body&gt;</code></pre><ul><li>再转发的目标Servlet取参数</li></ul><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;&lt;%--取出参数--%&gt;名字:&lt;%&#x3D;request.getParameter(&quot;name&quot;)%&gt;年龄:&lt;%&#x3D;request.getParameter(&quot;age&quot;)%&gt;&lt;&#x2F;body&gt;</code></pre><ul><li><p><strong>JSTL表达式</strong></p><ul><li>JSTL标签库的使用就是为了弥补HTML标签的不足；它自定义许多标签，可以供我们使用，标签的功能和Java代码一样！</li></ul></li><li><p><strong>格式化标签</strong></p></li><li><p><strong>SQL标签</strong></p></li><li><p><strong>XML 标签</strong></p></li><li><p><em><strong>核心标签</strong> （掌握部分）</em></p></li><li><p><strong>JSTL标签库使用步骤</strong>：</p><ul><li>引入对应的 taglib；</li><li>使用其中的方法；</li><li><strong>在Tomcat 的lib目录下也需要引入 jstl-api-1.2.jar、standard-1.1.2.jar的包，否则会报错：JSTL解析错误</strong>；</li></ul></li><li><p>c：if标签 EL表达式获取表单中的数据</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;&lt;form action&#x3D;&quot;core-if.jsp&quot; method&#x3D;&quot;get&quot;&gt;    &lt;%--        EL表达式获取表单中的数据        $&#123;param.参数名&#125;    --%&gt;    &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; value&#x3D;&quot;$&#123;param.username&#125;&quot;&gt;    &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;登录&quot;&gt;&lt;&#x2F;form&gt;&lt;%--判断如果提交的用户名是管理员，则登录成功--%&gt;&lt;c:if test&#x3D;&quot;$&#123;param.username&#x3D;&#x3D;&#39;admin&#39;&#125;&quot; var&#x3D;&quot;isAdmin&quot;&gt;    &lt;c:out value&#x3D;&quot;管理员欢迎您！&quot;&#x2F;&gt;&lt;&#x2F;c:if&gt;  &lt;c:out value&#x3D;&quot;$&#123;isAdmin&#125;&quot;&#x2F;&gt;&lt;&#x2F;body&gt;</code></pre><ul><li>c:choose c:when 实现成绩判断(Switch case)</li></ul><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;&lt;%--定义一个变量score，值为85--%&gt;&lt;c:set var&#x3D;&quot;score&quot; value&#x3D;&quot;65&quot;&#x2F;&gt;&lt;c:choose&gt;    &lt;c:when test&#x3D;&quot;$&#123;score&gt;&#x3D;90&#125;&quot;&gt;        你的成绩为优秀    &lt;&#x2F;c:when&gt;    &lt;c:when test&#x3D;&quot;$&#123;score&gt;&#x3D;80&#125;&quot;&gt;        你的成绩为一般    &lt;&#x2F;c:when&gt;    &lt;c:when test&#x3D;&quot;$&#123;score&gt;&#x3D;70&#125;&quot;&gt;        你的成绩为良好    &lt;&#x2F;c:when&gt;    &lt;c:when test&#x3D;&quot;$&#123;score&lt;&#x3D;60&#125;&quot;&gt;        你的成绩为不及格    &lt;&#x2F;c:when&gt;&lt;&#x2F;c:choose&gt;&lt;&#x2F;body&gt;</code></pre><ul><li>c:forEach</li></ul><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;&lt;%    ArrayList&lt;String&gt; people &#x3D; new ArrayList&lt;&gt;();    people.add(0,&quot;Alice&quot;);    people.add(1,&quot;Bob&quot;);    people.add(2,&quot;楼兰&quot;);    people.add(3,&quot;Goobus&quot;);    people.add(4,&quot;Kris&quot;);    request.setAttribute(&quot;list&quot;,people);%&gt;&lt;%--var , 每一次遍历出来的变量items, 要遍历的对象begin,   哪里开始end,     到哪里step,   步长 (i++)--%&gt;&lt;c:forEach var&#x3D;&quot;people&quot; items&#x3D;&quot;$&#123;list&#125;&quot;&gt;    &lt;c:out value&#x3D;&quot;$&#123;people&#125;&quot;&#x2F;&gt; &lt;br&gt;&lt;&#x2F;c:forEach&gt;&lt;hr&gt;&lt;c:forEach var&#x3D;&quot;people&quot; items&#x3D;&quot;$&#123;list&#125;&quot; begin&#x3D;&quot;1&quot; end&#x3D;&quot;3&quot; step&#x3D;&quot;1&quot; &gt;    &lt;c:out value&#x3D;&quot;$&#123;people&#125;&quot;&#x2F;&gt; &lt;br&gt;&lt;&#x2F;c:forEach&gt;&lt;&#x2F;body&gt;</code></pre></li></ul><h2 id="JavaBean">JavaBean</h2><p>实体类，JavaBean有特定的写法：</p><ul><li>必须要有一个无参构造</li><li>属性必须私有化</li><li>必须有对应的get/set方法；</li></ul><p>一般用来和数据库的字段做映射 ORM；</p><p>ORM ：对象关系映射</p><ul><li>表—&gt;类</li><li>字段–&gt;属性</li><li>行记录----&gt;对象</li></ul><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;jsp:useBean id&#x3D;&quot;people&quot; class&#x3D;&quot;cn.loulan.Bean.People&quot; &#x2F;&gt;&lt;jsp:setProperty name&#x3D;&quot;people&quot; property&#x3D;&quot;address&quot; value&#x3D;&quot;成都&quot;&#x2F;&gt;&lt;jsp:setProperty name&#x3D;&quot;people&quot; property&#x3D;&quot;id&quot; value&#x3D;&quot;1&quot;&#x2F;&gt;&lt;jsp:setProperty name&#x3D;&quot;people&quot; property&#x3D;&quot;age&quot; value&#x3D;&quot;2&quot;&#x2F;&gt;&lt;jsp:setProperty name&#x3D;&quot;people&quot; property&#x3D;&quot;name&quot; value&#x3D;&quot;哇哈哈AD钙&quot;&#x2F;&gt;姓名:&lt;jsp:getProperty name&#x3D;&quot;people&quot; property&#x3D;&quot;name&quot;&#x2F;&gt; ID:&lt;jsp:getProperty name&#x3D;&quot;people&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;年龄:&lt;jsp:getProperty name&#x3D;&quot;people&quot; property&#x3D;&quot;age&quot;&#x2F;&gt;地址:&lt;jsp:getProperty name&#x3D;&quot;people&quot; property&#x3D;&quot;address&quot;&#x2F;&gt;</code></pre><h2 id="MVC三层架构">MVC三层架构</h2><ul><li>什么是MVC： Model view Controller 模型.视图.控制器</li></ul><h3 id="1-早些年">1.早些年</h3><p><img src="watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ2MTUzOTQ5,size_16,color_FFFFFF,t_70-20230512210458691.png" alt="在这里插入图片描述" loading="lazy"></p><ul><li>用户直接访问控制层，控制层就可以直接操作数据库；</li></ul><pre class="language-java" data-language="java"><code class="language-java">servlet<span class="token operator">--</span><span class="token constant">CRUD</span><span class="token operator">--</span><span class="token operator">></span>数据库弊端：程序十分臃肿，不利于维护  servlet的代码中：处理请求<span class="token punctuation">.</span>响应<span class="token punctuation">.</span>视图跳转<span class="token punctuation">.</span>处理<span class="token constant">JDBC</span><span class="token punctuation">.</span>处理业务代码<span class="token punctuation">.</span>处理逻辑代码架构：没有什么是加一层解决不了的！程序猿调用<span class="token operator">|</span><span class="token constant">JDBC</span><span class="token operator">|</span><span class="token class-name">Mysql</span> <span class="token class-name">Oracle</span> <span class="token class-name">SqlServer</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><h3 id="2-MVC三层架构">2.MVC三层架构</h3><p><img src="watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ2MTUzOTQ5,size_16,color_FFFFFF,t_70-20230512210458822.png" alt="在这里插入图片描述" loading="lazy"></p><p>Model</p><ul><li>业务处理 ：业务逻辑（Service）</li><li>数据持久层：CRUD （Dao）</li></ul><p>View</p><ul><li>展示数据</li><li>提供链接发起Servlet请求 （a，form，img…）</li></ul><p>Controller （Servlet）</p><ul><li><p>接收用户的请求 ：（req：请求参数.Session信息….）</p></li><li><p>交给业务层处理对应的代码</p></li><li><p>控制视图的跳转</p><pre class="language-java" data-language="java"><code class="language-java">登录<span class="token operator">--</span><span class="token operator">-></span>接收用户的登录请求<span class="token operator">--</span><span class="token operator">-></span>处理用户的请求（获取用户登录的参数，username，password）<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span>交给业务层处理登录业务（判断用户名密码是否正确：事务）<span class="token operator">--</span><span class="token operator">-></span><span class="token class-name">Dao</span>层查询用户名和密码是否正确<span class="token operator">--</span><span class="token operator">></span>数据库</code></pre></li></ul><h2 id="Filter-重点">Filter(重点)</h2><p>Filter：过滤器 ，用来过滤网站的数据；</p><ul><li>处理中文乱码</li><li>登录验证….</li></ul><p>Filter开发步骤：</p><ol><li>导包</li><li>编写过滤器</li></ol><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--   Servlet 依赖   --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>javax.servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>servlet-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        JSP 依赖   --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>javax.servlet.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>javax.servlet.jsp-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.3.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        JSTL表达式的依赖--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>javax.servlet.jsp.jstl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jstl-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        standard标签库--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>taglibs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>standard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--    连接数据库--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.1.47<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><ol start="3"><li>实现Filter接口，重写对应的方法即可；</li></ol><p>使用Filter设置编码, 防止乱码</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Filter</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>Filter</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//项目启动的时候被调用</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"init filter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        servletRequest<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        servletResponse<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span>servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>这段代码是Java Servlet中用于实现Filter的接口方法<code>doFilter()</code>的签名。</p><p>Filter是一种用于在Servlet容器中对请求和响应进行预处理和后处理的组件。Filter可以截取请求和响应，修改请求参数或响应内容，或者根据某些条件决定是否允许请求继续处理。</p><p><code>doFilter()</code>方法接受三个参数：</p><p><code>ServletRequest servletRequest</code>、<br><code>ServletResponse servletResponse</code><br><code>FilterChain filterChain</code></p><p><code>ServletRequest</code>表示接收到的HTTP请求，<code>ServletResponse</code>表示将要发送的HTTP响应，<code>FilterChain</code>表示Filter链。</p><p>在<code>doFilter()</code>方法中，Filter可以对请求和响应进行任何必要的操作。</p><p>例如，可以检查请求参数、修改请求头、记录请求日志等。</p><p>然后，Filter必须调用<code>filterChain.doFilter()</code>方法，将请求传递给下一个Filter或目标Servlet来进行处理。</p><p>如果不调用<code>filterChain.doFilter()</code>方法，请求将不会传递到下一个组件，也不会生成响应。在最后一个Filter或目标Servlet中，必须生成响应并将其发送回客户端。</p><p>在Filter链中的每个Filter都必须调用<code>filterChain.doFilter()</code>方法，否则请求将停止在当前Filter，不会传递到后续的Filter或目标Servlet。</p><p>如果在Filter链中的某个Filter中调用了<code>filterChain.doFilter()</code>方法之前或之后生成了响应，或者没有调用<code>filterChain.doFilter()</code>方法，都会导致请求失败或无法正常响应。</p><ol start="4"><li>在web.xml中配置 Filter；</li></ol><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--mapping filter--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>encode<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">></span></span>cn.loulan.servlet.Filter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>encode<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>       <span class="token comment">&lt;!--只要是 /filter的任何请求，会经过这个过滤器--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/filter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">></span></span></code></pre><h2 id="监听器-Listener">监听器(Listener)</h2><p>实现一个监听器的接口；（有N种）</p><ol><li><p>编写一个监听器；</p><p>实现监听器的接口…</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OnlineCountListener</span> <span class="token keyword">implements</span> <span class="token class-name">HttpSessionListener</span> <span class="token punctuation">&#123;</span><span class="token comment">//    我们使用一个Integer对象来表示当前在线用户数，</span><span class="token comment">//    并且在每次Session创建时，都将在线用户数加1。</span><span class="token comment">//    然后，我们将在线用户数存储在ServletContext中，</span><span class="token comment">//    以便在整个Web应用程序中共享和使用。</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sessionCreated</span><span class="token punctuation">(</span><span class="token class-name">HttpSessionEvent</span> httpSessionEvent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServletContext</span> servletContext <span class="token operator">=</span> httpSessionEvent<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Integer</span> onlineCounter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> servletContext<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"onlineCounter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>onlineCounter <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            onlineCounter <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            onlineCounter <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>onlineCounter<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        servletContext<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"onlineCounter"</span><span class="token punctuation">,</span> onlineCounter<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sessionDestroyed</span><span class="token punctuation">(</span><span class="token class-name">HttpSessionEvent</span> httpSessionEvent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Integer</span> onlineCounter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> httpSessionEvent<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"onlineCounter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>onlineCounter <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            onlineCounter <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            onlineCounter <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>onlineCounter<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        httpSessionEvent<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"onlineCounter"</span><span class="token punctuation">,</span> onlineCounter<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><ol start="2"><li><p>注册监听器</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    Listener--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener-class</span><span class="token punctuation">></span></span>cn.loulan.servlet.OnlineCountListener<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener-class</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener</span><span class="token punctuation">></span></span></code></pre></li></ol></li></ol><h3 id="过滤器-监听器常见应用">过滤器.监听器常见应用</h3><ul><li><h4 id="监听器：GUI编程中经常使用；"><strong>监听器：GUI编程中经常使用；</strong></h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestPanel</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 新建一个窗体</span>        <span class="token class-name">Frame</span> frame <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Frame</span><span class="token punctuation">(</span><span class="token string">"Happy Day"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 面板</span>        <span class="token class-name">Panel</span> panel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Panel</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 设置窗体的布局</span>        frame<span class="token punctuation">.</span><span class="token function">setLayout</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        frame<span class="token punctuation">.</span><span class="token function">setBounds</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 设置背景颜色1</span>        frame<span class="token punctuation">.</span><span class="token function">setBackground</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>lightGray<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 设置背景颜色2</span>        panel<span class="token punctuation">.</span><span class="token function">setBackground</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>orange<span class="token punctuation">)</span><span class="token punctuation">;</span>        panel<span class="token punctuation">.</span><span class="token function">setBounds</span><span class="token punctuation">(</span>frame<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> frame<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> frame<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> frame<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        frame<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panel<span class="token punctuation">)</span><span class="token punctuation">;</span>        frame<span class="token punctuation">.</span><span class="token function">setVisible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 监听事件，监听关闭事件</span>        frame<span class="token punctuation">.</span><span class="token function">addWindowListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WindowAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">windowClosing</span><span class="token punctuation">(</span><span class="token class-name">WindowEvent</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    frame<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="过滤器：用户登录之后才能进入主页！用户注销后就不能进入主页了">过滤器：用户登录之后才能进入主页！用户注销后就不能进入主页了</h4><ol><li>用户登录之后，向Sesison中放入用户的数据</li><li>进入主页的时候要判断用户是否已经登录；要求：在过滤器中实现！</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Log</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> username <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"root"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/pages/success.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span></code></pre><p>LoginFilter</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginFilter</span> <span class="token keyword">extends</span> <span class="token class-name">Filter</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span><span class="token comment">// ServletRequest 转化为 HttpServletRequest </span><span class="token comment">// 目的是拿到Session, 以便获取Attribute</span>        <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> servletRequest<span class="token punctuation">;</span>        <span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> servletResponse<span class="token punctuation">;</span>        <span class="token class-name">Object</span> o <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>LogoutServlet</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token punctuation">,</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Logout</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>     req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span></code></pre><p>通过设置Session的Attribute(Constants.USER_SESSION)值为空来实现用户的登录, 这种方式不需要服务器重复创建和销毁Session就可以实现用户的注销, 减轻了服务器负担.</p><img src="Kapture 2023-05-13 at 11.38.21-3950252.gif" alt="Kapture 2023-05-13 at 11.38.21" style="zoom:80%;" loading="lazy"></li></ul><h2 id="JDBC">JDBC</h2><ul><li>什么是JDBC ： Java连接数据库！</li><li>需要jar包的支持：<ul><li>java.sql</li><li>javax.sql</li><li>mysql-connecter-java… 连接驱动（必须要导入）</li></ul></li></ul><ol><li><s>加载驱动</s></li><li>连接数据库,代表数据库</li><li>编写SQL （根据业务，不同的SQL）</li><li>预编译</li><li>执行SQL</li><li>关闭连接</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 配置信息</span>    <span class="token comment">// useUnicode=true&amp;characterEncoding=utf-8 解决中文乱码</span>    <span class="token class-name">String</span> url<span class="token operator">=</span><span class="token string">"jdbc:mysql://localhost:3307/JDBC?useUnicode=true&amp;characterEncoding=utf-8"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token comment">// 2.连接数据库,代表数据库</span>    <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 3.编写SQL</span>    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from user"</span><span class="token punctuation">;</span><span class="token comment">//     4. 预编译</span>    <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 5.执行查询SQL，返回一个 ResultSet  ： 结果集</span>    <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"email"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"role"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 6.关闭连接，释放资源（一定要做） 先开后关</span>    rs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    preparedStatement<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="预编译-使用占位符">预编译: 使用占位符</h4><p>在 JDBC 中，预编译 SQL 的主要目的是<strong>提高执行 SQL 语句的效率</strong>。当一个 SQL 语句被预编译后，JDBC 驱动程序会将该语句存储在数据库中，并将其与一个预定义的执行计划关联起来。这样，在执行该 SQL 语句时，JDBC 驱动程序可以直接使用预定义的执行计划，而<strong>不必重新解析 SQL 语句和生成执行计划</strong>，从而提高了执行效率。</p><p>另外，预编译 SQL 还可以提高代码的<strong>可维护性</strong>和<strong>安全性</strong>。通过使用预编译 SQL，我们可以将 SQL 语句与 Java 代码分离开来，使得代码更易于维护。此外，预编译 SQL 可以避免 <strong>SQL 注入</strong>等安全问题。</p><p>具体地，预编译 SQL 的过程包括两个步骤：首先，使用 <code>Connection</code> 接口中的 <code>prepareStatement()</code> 方法创建一个 <code>PreparedStatement</code> 对象；然后，使用 <code>PreparedStatement</code> 对象的 <code>setXXX()</code> 方法设置 SQL 语句中的参数，并使用 <code>execute()</code> 或 <code>executeUpdate()</code> 方法执行 SQL 语句。</p><p>以下是一个使用预编译 SQL 的示例代码：</p><pre class="language-none"><code class="language-none">String sql &#x3D; &quot;SELECT * FROM users WHERE name &#x3D; ?&quot;;PreparedStatement pstmt &#x3D; conn.prepareStatement(sql);pstmt.setString(1, &quot;John&quot;);ResultSet rs &#x3D; pstmt.executeQuery();while (rs.next()) &#123;    &#x2F;&#x2F; process the result set&#125;</code></pre><p>在上述示例代码中，我们首先使用 <code>prepareStatement()</code> 方法创建了一个 <code>PreparedStatement</code> 对象，然后使用 <code>setString()</code> 方法设置了 SQL 语句中的参数，并最终使用 <code>executeQuery()</code> 方法执行 SQL 语句。这样，在执行 SQL 语句时，JDBC 驱动程序会使用预定义的执行计划，从而提高了执行效率。</p><h4 id="SQL注入">SQL注入</h4><p>SQL 注入（SQL Injection）是一种常见的网络安全漏洞，它允许攻击者在执行 SQL 查询时向查询中插入恶意代码，从而获得对数据库的非授权访问。攻击者可以通过构造特定的 SQL 查询语句，从而绕过身份验证、窃取数据或破坏数据库。</p><p>例如，考虑下面的 SQL 查询语句：</p><pre class="language-none"><code class="language-none">SELECT * FROM users WHERE username &#x3D; &#39;&lt;input&gt;&#39;;</code></pre><p>如果用户输入 <code>&lt;input&gt;</code> 的值为 <code>' or '1'='1</code>，那么最终的 SQL 查询语句就会变成：</p><pre class="language-none"><code class="language-none">SELECT * FROM users WHERE username &#x3D; &#39;&#39; or &#39;1&#39;&#x3D;&#39;1&#39;;</code></pre><p>这样就会返回所有用户的记录，而不仅仅是指定的用户名。攻击者可以通过这种方式获取到数据库中的敏感数据或者执行其他恶意操作。</p><h2 id="实战-超市订单管理系统">实战: 超市订单管理系统</h2><p>为了方便表述和理解, 在编写MVC三层对应的代码时, 使用自顶向下, 但在实际的项目中, 编写代码工作往往是自底向上的.</p><h3 id="搭建项目框架">搭建项目框架</h3><h4 id="编写数据库操作的基础公共类DB">编写数据库操作的基础公共类DB</h4><ul><li><p>数据库配置文件，这是一个资源文件，应该创建在maven项目的resources文件中</p><pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">DRIVER</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span><span class="token key attr-name">URL</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3307/smbms?useUnicode=true&amp;characterEncoding=utf-8</span><span class="token key attr-name">USERNAME</span><span class="token punctuation">=</span><span class="token value attr-value">root</span><span class="token key attr-name">PASSWORD</span><span class="token punctuation">=</span></code></pre></li><li><p>使用静态代码块实现初始化参数</p><p>该类为数据库访问工具类，提供了获取数据库连接、执行查询和更新等常用操作的方法。</p><ol><li><p>类名：DB</p></li><li><p>属性：</p></li></ol><ul><li>DRIVER：String类型，表示数据库驱动名。</li><li>URL：String类型，表示数据库连接地址。</li><li>USERNAME：String类型，表示连接数据库的用户名。</li><li>PASSWORD：String类型，表示连接数据库的密码。</li></ul><ol start="3"><li>方法：</li></ol><ul><li>close：用于释放数据库连接、预处理语句和结果集资源。</li><li>getConnection：用于获取数据库连接。</li><li>executeQuery：用于执行查询操作，返回一个结果集。</li><li>executeUpdate：用于执行更新操作，返回受影响的行数。</li></ul><ol start="4"><li>方法的参数：</li></ol><ul><li>conn：Connection类型，表示数据库连接。</li><li>pstmt：PreparedStatement类型，表示预处理语句。</li><li>resSet：ResultSet类型，表示结果集。</li><li>query：String类型，表示要执行的SQL语句。</li><li>params：Object[]类型，表示SQL语句中的参数值。</li></ul><p>在类中还定义了一个静态代码块，该代码块在类加载时会被执行。静态代码块中的主要作用是读取配置文件中的数据库连接参数，并将其赋值给类的静态属性。具体实现如下：</p><ul><li>创建Properties对象。</li><li>通过类加载器加载配置文件为字节输入流。</li><li>使用Properties对象的load()方法加载字节输入流中的内容。</li><li>从Properties对象中获取数据库连接参数，并将其赋值给类的静态属性。</li></ul><p>通过这种方式，可以在不修改Java代码的情况下，更改数据库连接参数，提高了代码的灵活性和可维护性。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DB</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">DRIVER</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">URL</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">USERNAME</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">PASSWORD</span><span class="token punctuation">;</span>    <span class="token comment">//静态代码块， 类加载的时候执行</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//读取配置文件</span>        <span class="token comment">//1、创建properties对象</span>        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2、通过类加载器加载资源文件为字节输入流</span>        <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"db.properties"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token constant">DRIVER</span> <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"DRIVER"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">URL</span> <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"URL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">USERNAME</span> <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"USERNAME"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">PASSWORD</span> <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"PASSWORD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre></li><li><p>编写数据库操作的公共方法</p><p>该类为数据库访问工具类，提供了获取数据库连接、执行查询和更新等常用操作的方法。</p><ol><li><p>类名：DB</p></li><li><p>属性：</p></li></ol><ul><li>DRIVER：String类型，表示数据库驱动名。</li><li>URL：String类型，表示数据库连接地址。</li><li>USERNAME：String类型，表示连接数据库的用户名。</li><li>PASSWORD：String类型，表示连接数据库的密码。</li></ul><ol start="3"><li>方法：</li></ol><ul><li>close：用于释放数据库连接、预处理语句和结果集资源。</li><li>getConnection：用于获取数据库连接。</li><li>executeQuery：用于执行查询操作，返回一个结果集。</li><li>executeUpdate：用于执行更新操作，返回受影响的行数。</li></ul><ol start="4"><li>方法的参数：</li></ol><ul><li>conn：Connection类型，表示数据库连接。</li><li>pstmt：PreparedStatement类型，表示预处理语句。</li><li>resSet：ResultSet类型，表示结果集。</li><li>query：String类型，表示要执行的SQL语句。</li><li>params：Object[]类型，表示SQL语句中的参数值。</li></ul><p>该类还包含一个静态代码块，用于初始化数据库连接参数，但代码块的内容未给出，需要进行补充。</p><p><em>同时需要注意，该类并没有实现单例模式，每次获取数据库连接都会重新创建一个新的连接，这可能会导致性能问题。</em></p></li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DB</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">DRIVER</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">URL</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">USERNAME</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">PASSWORD</span><span class="token punctuation">;</span>     <span class="token comment">//插入静态代码块(need to fininsh)</span>      <span class="token comment">//释放链接资源</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">PreparedStatement</span> pstmt<span class="token punctuation">,</span> <span class="token class-name">ResultSet</span> resSet<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>resSet <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            resSet<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>pstmt <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            pstmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//获取数据库链接</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token constant">DRIVER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token constant">USERNAME</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token constant">PASSWORD</span><span class="token punctuation">;</span>        <span class="token comment">// 2.连接数据库,代表数据库</span>        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span>  connection<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//执行查询, 返回结果集</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ResultSet</span> <span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span><span class="token class-name">String</span> query<span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">&#123;</span>        <span class="token class-name">ResultSet</span> resultSet <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>query<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> params <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//预处理</span>            <span class="token class-name">PreparedStatement</span> statement <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> params<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//设置SQL 语句中的参数</span>                statement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">//执行</span>            resultSet <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> resultSet<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//执行更新， 返回影响行数</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span><span class="token class-name">String</span> query<span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> affectedRows <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>query<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> params <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//预处理</span>            <span class="token class-name">PreparedStatement</span> statement <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> params<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//设置SQL 语句中的参数</span>                statement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">//执行</span>             affectedRows <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> affectedRows<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="登录功能实现">登录功能实现</h3><h4 id="前端页面编写">前端页面编写</h4><p>前端页面由kuang提供</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;%-- header--%&gt;&lt;form class&#x3D;&quot;loginForm&quot; action&#x3D;&quot;$&#123;pageContext.request.contextPath&#125;&#x2F;login.do&quot; name&#x3D;&quot;actionForm&quot; id&#x3D;&quot;actionForm&quot; method&#x3D;&quot;post&quot;&gt;  &lt;div class&#x3D;&quot;info&quot;&gt;$&#123;error&#125;&lt;&#x2F;div&gt;  &lt;div class&#x3D;&quot;inputbox&quot;&gt;      &lt;label&gt;用户名：&lt;&#x2F;label&gt;      &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;input-text&quot; id&#x3D;&quot;userCode&quot; name&#x3D;&quot;userCode&quot; placeholder&#x3D;&quot;请输入用户名&quot; required&#x2F;&gt;  &lt;&#x2F;div&gt;  &lt;div class&#x3D;&quot;inputbox&quot;&gt;      &lt;label&gt;密码：&lt;&#x2F;label&gt;      &lt;input type&#x3D;&quot;password&quot; id&#x3D;&quot;userPassword&quot; name&#x3D;&quot;userPassword&quot; placeholder&#x3D;&quot;请输入密码&quot; required&#x2F;&gt;  &lt;&#x2F;div&gt;  &lt;div class&#x3D;&quot;subBtn&quot;&gt;      &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;登录&quot;&#x2F;&gt;      &lt;input type&#x3D;&quot;reset&quot; value&#x3D;&quot;重置&quot;&#x2F;&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;form&gt;&lt;%-- footer--%&gt;</code></pre><h4 id="登录处理Servlet实现">登录处理Servlet实现</h4><p>在前端form表单的action属性值我们可以看到提交的URL, 所以, 我们需要编写对应的Servlet来处理这个请求</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">action&#x3D;&quot;$&#123;pageContext.request.contextPath&#125;&#x2F;login.do&quot;</code></pre><ul><li><p>创建登录处理Servlet</p><p>以下是一个名为“Login”的Java servlet类，用于处理HTTP GET请求。该类包括对“UserService”实例的引用，该实例用于从数据库中检索用户信息。</p><p>在“doGet”方法中，servlet从HTTP请求中检索userCode和password参数。然后它创建一个“UserServiceImpl”类的新实例（该类实现了“UserService”接口），并调用其“findByUserCode”方法，以根据给定的用户代码从数据库中检索用户对象。</p><p>如果用户对象不为null，则servlet检查用户密码是否与给定密码匹配。如果匹配，则servlet使用用户对象设置名为“USER_SESSION”的会话属性，并将用户重定向到“/jsp/frame.jsp”。如果密码不匹配，则servlet使用错误消息设置名为“error”的会话属性，并将用户重定向回“/login.jsp”。</p><p><em>请注意，此代码片段不完整，因为它缺少有关导入，它所依赖的接口和类，以及servlet配置的信息。</em></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Login</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">UserService</span> service<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> userCode <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"userCode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"userPassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        user <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">findByUserCode</span><span class="token punctuation">(</span>userCode<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">,</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>                resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/jsp/frame.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span><span class="token string">"username or password incorrect"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/login.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span></code></pre></li><li><p>映射 servlet</p><p>这段代码是一个 servlet 配置的 XML 部分，它用于将请求的 URL 映射到特定的 servlet 上。这段配置指定了一个名为 “Login” 的 servlet，使用了完整的类名 <code>servlet.Login</code>，并将它映射到 URL “/login.do” 上。</p><p>这意味着，当用户在浏览器中访问 “/login.do” 时，容器将调用 <code>servlet.Login</code> 的 service() 方法来处理该请求。映射 servlet 的操作是 web 应用的一部分，它在 web.xml 文件中进行配置。</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>servlet.Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/login.do<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre></li><li><p>编写Service层代码</p><p>该代码是一个 Java 类 <code>UserServiceImpl</code>，实现了一个接口 <code>UserService</code>。该类包含了两个方法：</p><ol><li><code>findByUserCode(String userCode)</code>：查找数据库中对应用户的信息，该方法返回一个 <code>User</code> 对象。</li><li><code>updateUser(Integer id, String key, String value)</code>：更新数据库中用户的信息，该方法返回一个 <code>boolean</code> 类型的值，表示更新是否成功。</li></ol><p>在这个类中，私有成员变量 <code>dao</code> 是一个 <code>UserDao</code> 类型的变量，通过该变量调用 <code>UserDaoImpl</code> 类中的方法来访问数据库。在 <code>findByUserCode</code> 和 <code>updateUser</code> 方法中，都需要先通过 <code>dao</code> 实例化一个 <code>UserDaoImpl</code> 对象来调用相应的方法。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> dao<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findByUserCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> userCode<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        dao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">findByUserCode</span><span class="token punctuation">(</span>userCode<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span>  user<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> value<span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>        dao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        i <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">updateUser</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> i <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre></li><li><p>DAO层代码</p><p>这段代码是一个Dao层的实现类，用于和数据库交互，提供了对User表的查询和更新方法。下面是代码的分析：</p><ul><li><code>findByUserCode(String userCode)</code> 方法：根据传入的用户名参数 <code>userCode</code> 查询对应的用户记录，并返回一个User对象。该方法使用了数据库连接池技术，在执行完查询后会关闭连接。方法中首先初始化参数，然后执行SQL语句查询结果集，遍历结果集将数据封装到User对象中，最后关闭连接和结果集，返回User对象。</li><li><code>updateUser(Integer id, String key,String value)</code> 方法：根据传入的参数更新User表中的数据。该方法也使用了数据库连接池技术，在执行完更新后会关闭连接。方法中首先判断传入的参数是否为空，然后执行SQL语句更新数据，最后关闭连接，返回更新结果的影响行数。</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDao</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Connection</span> conn<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> sql<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findByUserCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> userCode<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//2. 初始化参数</span>        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>userCode<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token class-name">ResultSet</span> set<span class="token punctuation">;</span>        sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM smbms_user Where userCode = ?"</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            conn <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            set <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">,</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>set <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    user<span class="token punctuation">.</span><span class="token function">setUserPassword</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userPassword"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//一大串赋值代码...</span>                    user<span class="token punctuation">.</span><span class="token function">setWorkPicPath</span><span class="token punctuation">(</span><span class="token string">"workPicPath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">//关闭链接和结果集</span>            <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> user<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> affectedRow <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token operator">&amp;&amp;</span> value <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            sql <span class="token operator">=</span> <span class="token string">"UPDATE smbms_user SET "</span><span class="token operator">+</span>key<span class="token operator">+</span><span class="token string">" = ? WHERE id = ? "</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>value<span class="token punctuation">,</span>id<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                conn <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                affectedRow <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> affectedRow<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre></li></ul><h3 id="密码修改实现">密码修改实现</h3><h4 id="前端页面">前端页面</h4><p><strong>JSP部分: 页面显示</strong></p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ page contentType&#x3D;&quot;text&#x2F;html;charset&#x3D;UTF-8&quot; language&#x3D;&quot;java&quot; %&gt;&lt;%@include file&#x3D;&quot;&#x2F;jsp&#x2F;common&#x2F;head.jsp&quot; %&gt;&lt;div class&#x3D;&quot;right&quot;&gt;    &lt;div class&#x3D;&quot;location&quot;&gt;        &lt;strong&gt;你现在所在的位置是:&lt;&#x2F;strong&gt;        &lt;span&gt;密码修改页面&lt;&#x2F;span&gt;    &lt;&#x2F;div&gt;    &lt;div class&#x3D;&quot;providerAdd&quot;&gt;        &lt;form id&#x3D;&quot;userForm&quot; name&#x3D;&quot;userForm&quot; method&#x3D;&quot;post&quot; action&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;jsp&#x2F;user.do&quot;&gt;            &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;method&quot; value&#x3D;&quot;savepwd&quot;&#x2F;&gt;            &lt;!--div的class 为error是验证错误，ok是验证成功--&gt;            &lt;div class&#x3D;&quot;info&quot;&gt;$&#123;message&#125;&lt;&#x2F;div&gt;            &lt;div class&#x3D;&quot;&quot;&gt;                &lt;label for&#x3D;&quot;oldPassword&quot;&gt;旧密码：&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;oldpassword&quot; id&#x3D;&quot;oldpassword&quot; value&#x3D;&quot;&quot;&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;                &lt;label for&#x3D;&quot;newPassword&quot;&gt;新密码：&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;newpassword&quot; id&#x3D;&quot;newpassword&quot; value&#x3D;&quot;&quot;&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;                &lt;label for&#x3D;&quot;newPassword&quot;&gt;确认新密码：&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;rnewpassword&quot; id&#x3D;&quot;rnewpassword&quot; value&#x3D;&quot;&quot;&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div class&#x3D;&quot;providerAddBtn&quot;&gt;                &lt;!--&lt;a href&#x3D;&quot;#&quot;&gt;保存&lt;&#x2F;a&gt;--&gt;                &lt;input type&#x3D;&quot;button&quot; name&#x3D;&quot;save&quot; id&#x3D;&quot;save&quot; value&#x3D;&quot;保存&quot; class&#x3D;&quot;input-button&quot;&gt;            &lt;&#x2F;div&gt;        &lt;&#x2F;form&gt;    &lt;&#x2F;div&gt;&lt;&#x2F;div&gt;&lt;&#x2F;section&gt;&lt;%@include file&#x3D;&quot;&#x2F;jsp&#x2F;common&#x2F;foot.jsp&quot; %&gt;&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;statics&#x2F;js&#x2F;pwdmodify.js&quot;&gt;&lt;&#x2F;script&gt;</code></pre><p>这是一个用 JSP（JavaServer Pages）编写的网页代码，用于修改密码。页面包括一个表单，用户可以在其中输入旧密码、新密码和确认新密码。表单使用POST方法提交到服务器，并使用“/jsp/user.do” URL。</p><p>页面包括一个消息区域，用于显示任何错误消息。页面还包括指向名为“pwdmodify.js”的 JavaScript 文件的链接。这个文件应该包含表单的客户端验证逻辑。</p><p>页面使用 JSP 表达式语言（EL）将动态内容插入到 HTML 中。例如，页面使用表达式 “${pageContext.request.contextPath}/statics/js/pwdmodify.js” 插入一个链接到 CSS 文件。“${pageContext.request.contextPath}” 表达式计算为 web 应用程序的上下文路径，用于构造 CSS 文件的完整 URL。</p><p><strong>JavaScript 表单的客户端验证逻辑</strong></p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> oldpassword <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> newpassword <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> rnewpassword <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> saveBtn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   oldpassword <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#oldpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   newpassword <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#newpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   rnewpassword <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#rnewpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   saveBtn <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#save"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   oldpassword<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>         <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span>         <span class="token literal-property property">url</span><span class="token operator">:</span>path<span class="token operator">+</span><span class="token string">"/jsp/user.do"</span><span class="token punctuation">,</span>         <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">"pwdmodify"</span><span class="token punctuation">,</span><span class="token literal-property property">oldpassword</span><span class="token operator">:</span>oldpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>         <span class="token literal-property property">dataType</span><span class="token operator">:</span><span class="token string">"json"</span><span class="token punctuation">,</span>         <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//旧密码正确</span>               <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//旧密码输入不正确</span>               <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" 原密码输入不正确"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">"sessionerror"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//当前用户session过期，请重新登录</span>               <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" 当前用户session过期，请重新登录"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//旧密码输入为空</span>               <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" 请输入旧密码"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>         <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>         <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//请求出错</span>            <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" 请求错误"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* 请输入原密码"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   newpassword<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* 密码长度必须是大于6小于20"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">5</span>         <span class="token operator">&amp;&amp;</span> newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" 密码输入不符合规范，请重新输入"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   rnewpassword<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* 请输入与上面一致的密码"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">5</span>         <span class="token operator">&amp;&amp;</span> rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token operator">&amp;&amp;</span> newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" 两次密码输入不一致，请重新输入"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   saveBtn<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      oldpassword<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      newpassword<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      rnewpassword<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>         oldpassword<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span> <span class="token operator">&amp;&amp;</span>          newpassword<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span>         <span class="token operator">&amp;&amp;</span> rnewpassword<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">"确定要修改密码？"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#userForm"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>这是一个 JavaScript 代码段，它使用 jQuery 库为一个包含密码修改表单的网页添加了客户端验证逻辑。代码使用 AJAX 技术从服务器获取 JSON 格式的响应数据，以验证用户输入的旧密码是否正确，并在页面上显示相关提示信息。</p><p>代码中首先定义了四个变量，分别是旧密码、新密码、确认新密码和提交按钮的 jQuery 对象。然后使用 $() 函数将代码包装在一个回调函数中，确保代码在文档加载完成后才执行。回调函数内部做了以下工作：</p><ol><li><p>通过选择器获取页面上的旧密码输入框、新密码输入框、确认新密码输入框和提交按钮，并将它们的 jQuery 对象赋值给前面定义的四个变量。</p></li><li><p>为旧密码输入框绑定 blur 事件处理函数，当输入框失去焦点时，使用 $.ajax() 函数向服务器发送 GET 请求，验证用户输入的旧密码是否正确，并根据服务器返回的响应数据显示相应的提示信息。在成功回调函数中，根据 data.result 的值判断旧密码是否正确，并通过 validateTip() 函数显示相应的提示信息。在失败回调函数中，显示请求出错的提示信息。</p></li><li><p>为旧密码输入框绑定 focus 事件处理函数，当输入框获得焦点时，显示输入提示信息。</p></li><li><p>为新密码输入框绑定 focus 和 blur 事件处理函数，当输入框获得焦点时，显示输入提示信息；当输入框失去焦点时，判断用户输入的新密码是否符合规范，如果符合则显示正确提示，否则显示错误提示。</p></li><li><p>为确认新密码输入框绑定 focus 和 blur 事件处理函数，当输入框获得焦点时，显示输入提示信息；当输入框失去焦点时，判断用户输入的确认新密码是否与新密码一致，如果一致则显示正确提示，否则显示错误提示。</p></li><li><p>为提交按钮绑定 click 事件处理函数，当按钮被点击时，先让旧密码、新密码和确认新密码输入框失去焦点，然后判断它们的验证状态是否都为 true，如果是，则显示确认修改密码的提示框，如果用户点击确定，则提交表单，将新密码保存到服务器上。</p></li></ol><h4 id="编写处理Servlet">编写处理Servlet</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDo</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">UserService</span> service<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"savepwd"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">savePwd</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"pwdmodify"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">pwdModify</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">savePwd</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//拿到USer Session , 用于得到用户id</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> newPwd <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"newpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"用户输入的：new password: "</span><span class="token operator">+</span>newPwd<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Session password: "</span><span class="token operator">+</span>user<span class="token punctuation">.</span><span class="token function">getUserPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">", id: "</span><span class="token operator">+</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Integer</span> id <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">boolean</span> flag<span class="token punctuation">;</span>        <span class="token comment">//method 值为  savepwd, 表示用户执行修改密码操作</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>newPwd <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            flag <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">updateUser</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">"userPassword"</span><span class="token punctuation">,</span> newPwd<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//修改成功</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"修改成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span><span class="token string">"密码修改成功， 请重新登录"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//  移除Session</span>                session<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"密码修改失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span><span class="token string">"密码修改失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span><span class="token string">"新密码格式错误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//转发到当前页面, 不用重定向而使用转发是为了传统参数（attribute) 通知前端密码修改结果（by attribute message）</span>        req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"/jsp/pwdmodify.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/*    由ajax发起的密码查询请求， 用户进行密码修改时触发    放回前端json， ajax用于比对旧密码正确性,     */</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">pwdModify</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> user <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUserPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> inputPwd <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"oldpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>inputPwd <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> inputPwd<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//旧密码正确</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>inputPwd<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span><span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">//旧密码不正确</span>                    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span><span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token comment">//密码输入为空</span>                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//session timeout</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span><span class="token string">"sessionerror"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//返回前端json数据</span>        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">JSONArray</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>这段代码是一个Java Web应用程序中的Servlet，用于处理用户密码修改操作。</p><p>在doGet()方法中，根据请求参数&quot;method&quot;的值进行不同的操作。如果&quot;method&quot;的值是&quot;savepwd&quot;，则调用savePwd()方法，保存新密码；如果&quot;method&quot;的值是&quot;pwdmodify&quot;，则调用pwdModify()方法，用于检查旧密码是否正确。</p><p>在savePwd()方法中，首先从Session中获取当前用户的信息，然后获取新密码，并使用UserService接口的实现类UserServiceImpl来更新用户密码。如果更新成功，将信息存储在请求属性中，并移除Session中的用户信息，最后将请求转发到密码修改页面。</p><p>在pwdModify()方法中，首先获取当前用户的信息，然后获取旧密码。如果旧密码不为空，则将输入的旧密码与Session中存储的旧密码进行比较。如果输入的旧密码与Session中的旧密码相同，则返回前端JSON数据，表示旧密码正确；否则返回JSON数据，表示旧密码不正确。</p><p><strong>需要注意的是，在返回JSON数据之前，需要设置响应的Content-Type为&quot;application/json&quot;。</strong></p><h5 id="映射Servlet">映射Servlet</h5><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>userDo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>servlet.UserDo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>userDo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/jsp/user.do<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre>]]></content>
    
    
    <summary type="html">狂神说JavaWeb快速入门笔记</summary>
    
    
    
    <category term="Java web" scheme="https://trevoewu.github.io/categories/Java-web/"/>
    
    
    <category term="JavaWeb" scheme="https://trevoewu.github.io/tags/JavaWeb/"/>
    
    <category term="学习笔记" scheme="https://trevoewu.github.io/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Wireshark Lab: Ethernet and ARP</title>
    <link href="https://trevoewu.github.io/2023/05/08/Wireshark-Lab-Ethernet-and-ARP/"/>
    <id>https://trevoewu.github.io/2023/05/08/Wireshark-Lab-Ethernet-and-ARP/</id>
    <published>2023-05-08T11:02:02.000Z</published>
    <updated>2023-05-08T13:26:30.036Z</updated>
    
    <content type="html"><![CDATA[<p><strong>官方英文文档：<a href="Wireshark_Intro_v6.01.pdf">Wireshark_Intro_v6.01.pdf</a></strong></p><p><strong>以下内容为笔者翻译：</strong></p><hr><h2 id="Wireshark-实验-Ethernet-and-ARP-v7-0">Wireshark 实验:  Ethernet and ARP v7.0</h2><p><strong>《计算机网络：自顶向下方法（第6版）》补充材料，J.F. Kurose and K.W. Ross</strong></p><p>“不闻不若闻之，闻之不若见之，见之不若知之，知之不若行之。” ——中国谚语</p><p>© 2005-2012, J.F Kurose and K.W. Ross, All Rights Reserved</p><hr><p>在本实验中，我们将研究以太网协议和 ARP 协议。在开始实验之前， 您可以查看课本的 6.4.1 节（链路层地址和 ARP）和 6.4.2（以太网）, 您也可以去看 RFC 826(<a href="ftp://ftp.rfc-editor.org/in-notes/std/std37.txt">ftp://ftp.rfc-editor.org/in-notes/std/std37.txt</a>)了解关于 ARP 的协议详细信息,该协议可以根据 IP 地址获取远程主机的的物理地址。</p><h2 id="捕获和分析以太网帧">捕获和分析以太网帧</h2><p>让我们从捕获一组以太网帧开始研究。 请执行下列操作 :</p><ul><li><p>首先，清除浏览器缓存。 在Firefox 下执行此操作，请选择 历史记录，然后选中清除历史记录。</p></li><li><p>然后启动 Wireshark 数据包嗅探器</p></li><li><p>打开以下 URL <a href="http://gaia.cs.umass.edu/wireshark-labs/HTTP-ethereal-lab-file3.html">http://gaia.cs.umass.edu/wireshark-labs/HTTP-ethereal-lab-file3.html</a> 您的浏览器应显示相当冗长的美国权利法案。</p></li><li><p>接下来停止 Wireshark 数据包捕获，找到您向 <a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> 的 HTTP GET 消 息的数据包编号以及 <a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> 相应您的 HTTP 回应。您的抓包结果应 看起来向下面一样:</p></li></ul><p><img src="image-20230508193529270.png" alt="image-20230508193529270" loading="lazy"></p><ul><li><p>由于本实验是关于以太网和 ARP 的，我们对 IP 或更高层协议不感兴趣。 因此，让我们更改 Wireshark 的“捕获数据包列表”窗口，以便它仅显示有关 IP 以下协议的信息。 要让 Wireshark 执行此操作，请选择 Analyze-&gt; Enabled Protocols(分析-启用的协议)。 然后取消选中 IP 框(译者注:这里指的 IPV4 协议，下面有搜索)并选择确定。 您现在 Wireshark 窗口应该如下所示:</p><p><img src="image-20230508190619603.png" alt="image-20230508190619603" loading="lazy"></p></li><li><p>为了回答以下问题，您需要查看数据包详细信息和数据包内容窗口(Wireshark 中 的中间和下部显示窗口，译者注: 若您看到的不是如此-建议您重置布局(视图-重 置布局))。</p></li><li><p>选择包含 HTTP GET 消息的以太网帧。 (回想一下，HTTP GET 请求是被加上 TCP 头封装到 TCP 段进行传输,TCP 段加上 IP 头被封装到 IP 数据报进行传输,IP 数 据报又被加上以太网头封装成以太网帧进行传输;如果你发现这个封装有点令人困 惑，请重读文本中的第 1.5.2 节)。 在数据包详细信息窗口中展开以太网 II 信息。 请注意，以太网帧的内容(标题以及有效负载)显示在数据包内容窗口中</p></li><li><p>根据包含 HTTP GET 消息的以太网帧进行分析，如果有可能建议您使用标记的方式展现您的答案。</p></li></ul><ol><li>你的电脑 48 位的地址是多少</li></ol><p><img src="image-20230508195458584.png" alt="image-20230508195458584" loading="lazy"></p><ol><li>以太网帧中的 48 位目标地址是什么?这是 <a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> 的以太网地址 吗?(提示:答案是否定的)。那么它是什么?注意这一题可能会犯错，请 阅读 468-469(中文版 305-308 页)然后理解它</li></ol><p>下一跳路由器的对应接口的MAC地址.</p><p><img src="image-20230508194109036.png" alt="image-20230508194109036" loading="lazy"></p><ol><li>以太网帧上层协议 16 进制值是什么?这对应的上层协议是什么?</li></ol><p><img src="image-20230508194227724.png" alt="image-20230508194227724" loading="lazy"></p><ol><li><p>从以太帧的开始，一直到“GET”中的 ASCII“G”出现在以太网帧中為止，有多</p><p>少字节?</p><p>G 的ascii码为0x47, 对应地址为0x0042, 故在这之前共有0x43字节, 即67Byte</p><p><img src="image-20230508194758609.png" alt="image-20230508194758609" loading="lazy"></p></li></ol><p>接下来，根据包含 HTTP 响应消息的第一个字节的以太网帧的内容，回答以下问题</p><ol start="5"><li><p>这个以太网帧中，以太网源地址的值是多少?这是你的计算机的地址，<a href="http://xn--gaia-zi0i364s.cs.umass.edu">还是gaia.cs.umass.edu</a> 的地址(提示:答案是否定的)。拥有这个以太网地址的设备是什么?</p><p>ANS: 是最后一跳路由器网卡的MAC地址</p><p><img src="image-20230508195637736.png" alt="image-20230508195637736" loading="lazy"></p></li><li><p>以太网帧中的目的地址是什么?这是您的计算机的以太网地址吗?</p><p>ANS: 是的</p></li></ol><p><img src="image-20230508195734432.png" alt="image-20230508195734432" loading="lazy"></p><ol start="5"><li>以太网帧上层协议 16 进制值是什么?这对应的上层协议是什么?</li></ol><p>ANS: 0x0800, IPv4</p><ol start="5"><li>从以太帧的开始，一直到“OK”中的 ASCII“O”出现在以太网帧中为止，有多少字节?</li></ol><p>ANS: 0x4f Byte, 79Byte</p><p><img src="image-20230508200014667.png" alt="image-20230508200014667" loading="lazy"></p><h2 id="The-Address-Resolution-Protocol-地址解析协议">The Address Resolution Protocol 地址解析协议</h2><p>在本节中，我们将观察 ARP 协议的作用。我们强烈建议您在继续实验之前重读课文 6.4.1 节</p><h3 id="ARP-Caching-ARP-缓存">ARP Caching(ARP 缓存)</h3><p>回想一下，ARP 协议通常在您的计算机上维护 IP 到以太网地址转换对的缓存.arp 命令(在 MSDOS 和 Linux / Unix 中)用于查看和操作此缓存的内容。由于 arp 命 令和 ARP 协议具有相同的名称，因此很容易混淆它们。但请记住，它们是不同的: arp 命令用于查看和操作 ARP 缓存内容，而 ARP 协议定义了发送和接收的消息的 格式和含义，并定义了对消息传输和接收所采取的操作。</p><p>我们来看看您计算机上 ARP 缓存的内容:</p><ul><li><p>MS-DOS:arp 命令位于 c:\windows\system32 中，因此在 MS-DOS 命令行中</p><p>输入“arp”或“c:\windows\system32\arp”(没有引号)</p></li><li><p>Linux/Unix/MacOS. 根据安装位置不同路径而不同，一般有/sbin/arp (linux)</p><p>和/usr/etc/arp (Unix)</p></li></ul><p>没有参数的 Windows arp 命令将显示计算机上 ARP 缓存的内容。运行 ARP 命 令。</p><ol start="9"><li>写下计算机 ARP 缓存的内容。每个列值的含义是什么?</li></ol><pre class="language-bash" data-language="bash"><code class="language-bash">// mac/linux arp commend by tldr - Show the current ARP table:    arp <span class="token parameter variable">-a</span>- Delete a specific entry:    arp <span class="token parameter variable">-d</span> address- Create an entry <span class="token keyword">in</span> the ARP table:    arp <span class="token parameter variable">-s</span> address mac_address</code></pre><p>IP地址, MAC地址</p><p><img src="image-20230508200844492.png" alt="image-20230508200844492" loading="lazy"></p><p>为了观察您的计算机发送和接收 ARP 消息，我们需要清除 ARP 缓存，否则您的计算机很可能在其缓存中找到所需的 IP-Ethernet 地址转换关系，因此不会发送 ARP 消息。</p><ul><li>MS-DOS:MS-DOS arp -d <em>命令将清除 ARP 缓存。-d 标志指示删除操作，</em> *  是表示删除所有表项的通配符。</li><li>Linux/Unix/MacOS: 清除 arp 缓存的 arp –d *需要 root 权限，如果您没有也没办法使用 Windows 系统进行实验，请下载作者的抓包结果。</li></ul><p><em>所有在Linux系统下 <strong>arp -d $ip</strong> 命令只能清除一个IP地址的对应MAC地址缓存，当然可以使用组合命令操作，这也算是Linux的一个优点吧。</em></p><h3 id="Observing-ARP-in-action-抓取-ARP-消息">Observing ARP in action 抓取 ARP 消息</h3><p>请进行以下操作:</p><ul><li><p>清除你的 ARP 缓存，如上所述。</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> arp <span class="token parameter variable">-a</span> <span class="token parameter variable">-d</span> //clear arp cahce <span class="token keyword">in</span> mac os</code></pre><p><img src="image-20230508201938321.png" alt="image-20230508201938321" loading="lazy"></p></li><li><p>接下来，确保浏览器的缓存是空的。</p></li><li><p>启动 Wireshark 捕捉封包</p></li><li><p>打开以下 URL，<a href="http://gaia.cs.umass.edu/wireshark-labs/HTTP-wireshark-lab-file3.html%E3%80%82%E4%BD%A0%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8%E5%BA%94%E8%AF%A5%E5%86%8D%E6%AC%A1%E6%98%BE%E7%A4%BA%E7%9B%B8%E5%BD%93%E9%95%BF%E7%9A%84%E7%BE%8E%E5%9B%BD%E6%9D%83%E5%88%A9%E6%B3%95%E6%A1%88">http://gaia.cs.umass.edu/wireshark-labs/HTTP-wireshark-lab-file3.html。你的浏览器应该再次显示相当长的美国权利法案</a></p></li><li><p>同样设置不显示 IP 和更高层协议，请选择 Analyze-&gt; Enabled Protocols(分析 -启用的协议)。 然后取消选中 IP 框(译者注:这里指的 IPV4 协议，下面有 搜索)并选择确定。 您现在 Wireshark 窗口应该如下所示:</p></li></ul><p><img src="image-20230508191216762.png" alt="image-20230508191216762" loading="lazy"></p><p>图示是作者的抓包结果截图，您可以发现第 1，2，6 帧都包含 ARP 消息</p><p><img src="image-20230508203130494.png" alt="image-20230508203130494" loading="lazy"></p><p>Answer the following questions: (回答下列问题)</p><ol start="10"><li>包含 ARP 请求消息的以太网帧中源和目标地址的十六进制值是什么?</li></ol><p><img src="image-20230508202533299.png" alt="image-20230508202533299" loading="lazy"></p><ol start="10"><li><p>以太网帧上层协议 16 进制值是什么?</p><p><img src="image-20230508202601296.png" alt="image-20230508202601296" loading="lazy"></p></li><li><p>下载 ARP 规范(<a href="ftp://ftp.rfc-editor.org/in-notes/std/std37.txt.">ftp://ftp.rfc-editor.org/in-notes/std/std37.txt.</a>),讨论请移步</p><p>(<a href="http://www.erg.abdn.ac.uk/users/gorry/course/inet-pages/arp.html">http://www.erg.abdn.ac.uk/users/gorry/course/inet-pages/arp.html</a>)</p><p><img src="image-20230508204313285.png" alt="image-20230508204313285" loading="lazy"></p><p><img src="image-20230508204134165.png" alt="image-20230508204134165" loading="lazy"></p><p>a) ARP 操作码字段开始从以太网帧的最开始有多少字节?</p><p>0x13Byte = 19Byte,</p><p>操作码：1为ARP请求，2为ARP应答，3为<a href="https://zh.wikipedia.org/wiki/%E9%80%86%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%E5%8D%8F%E8%AE%AE">RARP</a>请求，4为RARP应答。</p><p><img src="image-20230508204930125.png" alt="image-20230508204930125" loading="lazy"></p><p>b) 在进行 ARP 请求的以太网帧的 ARP 负载部分中，操作码字段的值是 多少?</p><p>操作码1为ARP请求</p><p>c) ARP 消息是否包含发送方的 IP 地址?</p><p>不包括.</p><p>d) 在 ARP 请求中从哪里看出我们要查询相应 IP 的以太网地址?</p><p>图中蓝色部分, 可以看到要查询的IP(16进制), 转换为十进制为: 10.51.187.123</p><p><img src="image-20230508205742976.png" alt="image-20230508205742976" loading="lazy"></p></li><li><p>找到相应 ARP 请求的而发送 ARP 回复</p></li></ol><pre><code>1. a) ARP 操作码字段开始从以太网帧的最开始有多少字节?2. b)  在进行 ARP 响应的以太网帧的 ARP 负载部分中，操作码字段的值是   多少?   2, 表示ARP响应3. c)   在响应 ARP 中从哪里看出现早期 ARP 请求的答案?   响应ARP中的源MAC地址</code></pre><ol start="12"><li><p>包含 ARP 回复消息的以太网帧中的源地址和目标地址的十六进制值是多 少?</p></li><li><p>在作者抓包结果中，他有两台电脑，一台运行 wireshark 进行抓包，一台没 有，那么为什么运行 wireshark 那台电脑发送 ARP 请求得到了应答，另外一 台电脑的 ARP 请求没有得到应答?(没有相应第 6 帧的 ARP 的请求)</p></li></ol><p>请求ARP的目标MAC地址48位全1, 是广播地址, 所以局域网设备都能收到, 而响应ARP是单播地址, 目标MAC为请求目标的MAC地址, 故只有发起对该IP请求对电脑能收到.</p><h3 id="Extra-Credit-额外实验">Extra Credit 额外实验</h3><p>EX-1. The arp command: arp 命令:</p><pre class="language-bash" data-language="bash"><code class="language-bash">arp <span class="token parameter variable">-s</span> InetAddr EtherAddr</code></pre><p>这个命令允许你手动添加 arp 记录到缓存表中。它会把您输入的 IP 地址 (InetAddr)解析为物理地址(EtherAddr)，请问您输入正确 IP 地址但是物理地 址错误会发生什么。</p><p>成功写入了, 类型为permanent, 没有发生什么, 而且可以在ARP table中看到两条同一IP地址的不同MAC地址条目.</p><p><img src="image-20230508211728737.png" alt="image-20230508211728737" loading="lazy"></p><p>EX-2. 在删除 ARP 缓存之前，请问它们默认的有效时间是多少，您可以通过不定 时的查看缓存内容得出结论或者查询相应的操作系统文档。</p>]]></content>
    
    
    <summary type="html">在本实验中，我们将研究以太网协议和ARP协议</summary>
    
    
    
    <category term="学习记录" scheme="https://trevoewu.github.io/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="computer network" scheme="https://trevoewu.github.io/tags/computer-network/"/>
    
  </entry>
  
  <entry>
    <title>Wireshark Lab 802.11</title>
    <link href="https://trevoewu.github.io/2023/05/08/Wireshark-Lab-802-11/"/>
    <id>https://trevoewu.github.io/2023/05/08/Wireshark-Lab-802-11/</id>
    <published>2023-05-08T10:36:45.000Z</published>
    <updated>2023-05-08T11:01:19.094Z</updated>
    
    <content type="html"><![CDATA[<hr><h2 id="Wireshark-实验-802-11">Wireshark 实验:  802.11</h2><p><strong>《计算机网络：自顶向下方法（第6版）》补充材料，J.F. Kurose and K.W. Ross</strong></p><p>“不闻不若闻之，闻之不若见之，见之不若知之，知之不若行之。” ——中国谚语</p><p>© 2005-2012, J.F Kurose and K.W. Ross, All Rights Reserved</p><hr><p>在本实验中，我们将研究 802.11 无线协议。在开始本实验之前，建议您重新阅读课本的中第 7.3 节。因为我们将比课本深入研究 802.11 协议内容，因此您可能需要查看 Pablo Brenner (Breezecom Communications)写的《802.11 协议技术指南》<a href="http://www.sss-mag.com/pdf/802_11tut.pdf">ATechnical Tutorial on the 802.11Protocol </a> 以及 Jim Geier 写的《了解 802.11 帧类型》<a href="http://www.wi-fiplanet.com/tutorials/article.php/1447501">Understanding 802.11 Frame Types</a> 。当然，您还需要查阅 802.11 的圣经-它的标准书<a href="http://gaia.cs.umass.edu/wireshark-labs/802.11-1999.pdf">《ANSI / IEEE 标准 802.11,1999 版(R2003)》(ANSI/IEEE Std 802.11, 1999 Edition (R2003)</a>。您可能会发现标准书第 36 页的表 1 在分析无线跟踪特别有用.</p><p>在除本次实验以外其它的 Wireshark 实验中，我们都是在有线以太网连接进行抓包(捕获帧)。在本实验中，因为 802.11 是无线链路层协议，我们将在“空中”捕获帧。不幸的是，带有 802.11 协议的无线网卡(NIC)设备驱动无法提供钩子将捕获/接收的 802.11 帧用于 Wireshark 实验分析。因此，在本实验中，您可能会使用作 者捕获的 802.11 帧(抓包结果)进行分析。如果您有能力自己捕获，欢迎您自己动手。如果您乐意自己跟踪，或许你可以买一个小的 <a href="www.cacetech.com">USB 网卡 AirPcap 用以捕获 802.1 帧</a></p><h2 id="Getting-Started-开始实验">Getting Started 开始实验</h2><p>从 <a href="http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip">http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip</a> 下载压缩包并且得到 Wireshark_802_11.pcap。本结果由团队的一个作者在家庭网络使用 AirPcap 以及运行 Wireshark 的计算机得到，结果其中包括 Linksys 802.11g 的组合接入点(路由器)，该接入点为两台有线 PC 和一台无线 PC 提供服务。作者幸运邻居也使用无线接入点。在此跟踪文件中，我们能看到在通道 6 上捕获的帧。由于我们需要分析主机和接入点不是使用通道 6 的唯一组合，我们也会看到其他例如邻居接入点使用通道6被作者收集到。跟踪文件中采用的无线主机活动包括:</p><ul><li><p>跟踪开始时，主机已经与 30 Munroe St 接入点关联(associated)。</p></li><li><p>在时间 24.82 时刻，主机向 IP 地址 128.119.245.12 的服务器发送 HTTP 请</p><p>求，请求内容是 <a href="http://gaia.cs.umass.edu/wireshark-labs/alice.txt">http://gaia.cs.umass.edu/wireshark-labs/alice.txt</a> 。</p></li><li><p>在时间 32.82 时刻，主机向 IP 地址 128.119.240.19.的服务器发送 HTTP 请求，请求内容是 <a href="http://www.cs.umass.edu">http://www.cs.umass.edu</a>。</p></li><li><p>在时间 49.58 的时刻，主机断开了与 30 Munroe St 接入点的关联，并且尝试</p></li></ul><p>连接到 linksys_ses_24086 接入点。该接入点不是开放的接入点，因此主机始终没有成功与该接入点关联成功。</p><ul><li>在时间 63.0 时刻，主机放弃尝试关联 linksys_ses_24086 接入点，并且再次连接30 Munroe St 接入点关联。</li></ul><ol><li><p>下载作者的抓包结果后，使用 Wireshark 的 File 菜单打开该文件</p><p>Wireshark_802_11.pcap，您应该看到与图 1 显示相同的结果</p><p><img src="image-20230508184630447.png" alt="image-20230508184630447" loading="lazy"></p></li></ol><h2 id="Beacon-Frames-信标帧">Beacon Frames 信标帧</h2><p>回想一下，802.11 接入点使用信标帧表示其存在。要回答下面的问题，您或许应该 展开 IEEE 802.11 帧并在 Wireshark 中间窗口看到它的字段详细信息。请尽量清晰 的展示您的答案，必要时您可以在图中用标记辅以说明。您的答案应该简单可读。</p><ul><li><p>发送最多信标帧的两个接入点的服务集标识符是多少(SSID)?</p></li><li><p>inksys_ses_24086 接入点和 30 Munroe St.接入点的信标帧传输时间是多少?(提示:此时间间隔包含在信标帧本身之中。)</p></li><li><p>请以十六进制表示法找到 30 Munroe St 接入点的源 MAC 地址。回想课本中 图 7-13，并说明源地址，目的地址，基本服务集(BSS)的地址是什么。有 关 802.11 帧结构的详细讨论说明，请参阅 IEEE 802.11 标准文档(上文所 提)中的第 7 节。</p></li><li><p>30 Munroe St 接入点的信标帧目的地址十六进制表示是什么?</p></li><li><p>30 Munroe St 接入点的 BSS ID 地址是什么?</p></li><li><p>来自 30 Munroe St 接入点的信标帧宣告接入点可以支持四种数据速率和八种</p><p>额外的“扩展支持速率”。这些速率是多少?</p></li></ul><h2 id="Data-Transfer-数据传输">Data Transfer 数据传输</h2><p>由于作者抓包开始时，主机已经与 AP 关联，因此在做下面 AP 关联/解除关联之 前，我们首先研究已经主机与关联 802.11 AP 的数据传输。回想一下，在作者抓包 结果中，在时间 24.82 的时刻，主机向 <a href="http://gaia.cs.umass.edu/wireshark-">http://gaia.cs.umass.edu/wireshark-</a> labs/alice.txt 发出 HTTP 请求。 <a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> 的 IP 地址是 128.119.245.12。然 后，在 32.82 时刻，主机向 <a href="http://www.cs.umass.edu">http://www.cs.umass.edu</a> 发出 HTTP 请求。</p><ul><li>找到包含第一个 TCP SYN TCP 报文(下载 alice.txt 会话)的 802.11 帧。 802.11 帧中三个 MAC 地址字段分别是什么?此帧中那个 MAC 地址对应十 六进制的无线主机的 MAC 地址?那个对应接入点 MAC 地址，第一跳路由 器的 MAC 地址?发送此 TCP 报文的无线主机 IP 是什么?目的地 IP 地址是 什么?此目的地是否与主机地址，接入点地址，第一跳路由器地址或者某些 其他网络设备相对应，解释并且说明。</li><li>找到包含此 TCP 会话 SYN ACK 报文的 802.11 帧。该帧中三个 MAC 地址 字段是什么?那个 MAC 地址对应十六进制的无线主机的 MAC 地址?那个 对应接入点 MAC 地址，第一跳路由器的 MAC 地址?帧中的发送方 MAC 地址是否与发送此 TCP 报文的设备的 IP 地址相对应?</li></ul><h2 id="Association-Disassociation-关联-解除关联">Association/Disassociation 关联/解除关联</h2><p>回想一下课本的第 7.3.1 节，主机在发送数据之前必须与接入点关联。802.11 中的关联使用 ASSOCIATE REQUEST 帧(从主机发送到 AP，帧类型 0 和子类型 0，参 见本文中的第 7.3.3 节)和 ASSOCIATE RESPONSE 帧(由 AP 发送给具有主机， 帧类型 0 和子类型 1，响应于接收到的 ASSOCIATE REQUEST)。有关 802.11 帧 中每个字段的详细说明，请参阅 <a href="http://gaia.cs.umass.edu/wireshark-labs/802.11-">http://gaia.cs.umass.edu/wireshark-labs/802.11-</a> 1999.pdf 中 802.11 规范的第 34 页(第 7 节)。</p><ul><li><p>在时间 49 的时刻，主机在跟踪中使用那两个动作(例如:发送帧)解除在 跟踪开始之前就已经连接的 30 Munroe St AP 的关联。(提示:一个是 IP 层 多宗，一个是 802.11 层动作)。在查看 802.11 规范之后，请找出抓包结果 中未显示一个动作帧。</p></li><li><p>在抓包结果中，找到主机发送给无线 AP 的 AUTHENICATION 帧，同时也</p><p>找无线 AP 的回复响应帧。在时间 49 时刻之后，无线主机向 linksys_ses_24086 AP(MAC 地址包括 Cisco_Li_f5:ba:bb)发送了多少 AUTHENTICATION 消息?</p></li><li><p>主机是否希望身份认证和关联 AP?</p></li><li><p>您是否在跟踪中看到来自 linksys_ses_24086 AP 回的 AUTHENTICATION?</p></li><li><p>现在让我们来分析当主机放弃尝试与 linksys_ses_24086 AP 关联并且现在尝</p><p>试与 30 Munroe St AP 关联发生什么。查找从主机发送到 AP 的 AUTHENICATION 帧，同时也找无线 AP 的回复响应帧。在什么时间有一 个主机到 30 Munroe St AP 的帧，在什么时间无线 AP 回主机该帧的回复。 (注意:您可以使用“ wlan.fc.subtype == 11and wlan.fc.type == 0 and wlan.addr == IntelCor_d1:b6:4f ”(不含引号)在此跟踪中仅显示无线主机的 AUTHENTICATION 帧)</p></li><li><p>从主机到 AP 的关联请求，以及相应的 AP 对主机关联请求的响应。在什么 时候有来自主机到 AP 关联请求，什么时候 AP 对主机关联请求响应。(注 意:你可以使用过滤表达式“wlan.fc.subtype &lt; 2 and wlan.fc.type == 0 and wlan.addr == IntelCor_d1:b6:4f”来仅显示 ASSOCIATE REQUEST 和 ASSOCIATE RESPONSE 帧。</p></li><li><p>主机和 AP 愿意使用什么传输速率?要回答此问题，您或许要查看 802.11 无</p><p>线管理帧的字段。</p></li></ul><h2 id="Other-Frame-types-其他帧类型">Other Frame types 其他帧类型</h2><p>作者的抓包结果中含许多 PROBE REQUEST 和 PROBE RESPONSE 帧。</p><ul><li>这些帧中的发送方，接收方和 BSS ID MAC 地址是什么? 这两种帧的目的是什么? (要回答最后一个问题，您需要深入研究本实验前面引用说明的 在线参考资料)。</li></ul>]]></content>
    
    
    <summary type="html">在本实验中，我们将研究 802.11 无线协议。</summary>
    
    
    
    <category term="学习记录" scheme="https://trevoewu.github.io/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="computer network" scheme="https://trevoewu.github.io/tags/computer-network/"/>
    
  </entry>
  
  <entry>
    <title>Wireshark Lab: ICMP</title>
    <link href="https://trevoewu.github.io/2023/05/05/Wireshark-Lab-ICMP/"/>
    <id>https://trevoewu.github.io/2023/05/05/Wireshark-Lab-ICMP/</id>
    <published>2023-05-05T02:48:32.000Z</published>
    <updated>2023-05-05T07:21:30.475Z</updated>
    
    <content type="html"><![CDATA[<p>In this lab, we’ll explore several aspects of the ICMP protocol:<br>在本实验中，我们将探讨 ICMP 协议的几个方面:</p><span id="more"></span><ul><li><p>ICMP messages generating by the Ping program; Ping 程序生成的 ICMP 消息;</p></li><li><p>ICMP messages generated by the Traceroute program; Traceroute 程序生成的 ICMP 消息;</p></li><li><p>the format and contents of an ICMP message. ICMP 消息的格式和内容。</p></li></ul><p>Before attacking this lab, you’re encouraged to review the ICMP material in section 5.6<br>of the text1. We present this lab in the context of the Microsoft Windows operating system. However, it is straightforward to translate the lab to a Unix or Linux environment. 在开始本实验之前，我们建议您查看课本的 5.6 节中的 ICMP 章节。此实验是在Windows 下完成的，如果您使用其他系统也不用担心，因为大体都相同。</p><h2 id="ICMP-and-Ping-ICMP-协议和-Ping-程序">ICMP and Ping ICMP 协议和 Ping 程序</h2><p>Let’s begin our ICMP adventure by capturing the packets generated by the Ping program. You may recall that the Ping program is simple tool that allows anyone (for example, a network administrator) to verify if a host is live or not. The Ping program in the source host sends a packet to the target IP address; if the target is live, the Ping program in the target host responds by sending a packet back to the source host. As you might have guessed (given that this lab is about ICMP), both of these Ping packets are ICMP packets. 让我们通过捕获 Ping 程序生成的数据包开始我们的 ICMP 实验。 您可能还记得Ping 程序是一个简单的工具，允许任何人(例如:网络管理员)验证主机是否存在。 源主机中的 Ping 程序将数据包发送到目标 IP 地址; 如果目标是在线的，则目标主机中的 Ping 程序将会发送响应 Ping 数据包证明他在线，这两个 Ping 数据包都是 ICMP 数据包。 因此您可能猜出我们这个实验都是关于 ICMP 的实验了。</p><p>Do the following: 请按照以下动作做:</p><ul><li><p>Let’s begin this adventure by opening the Windows Command Prompt application (which can be found in your Accessories folder).<br>打开 windows 的命令提示符。</p></li><li><p>Start up the Wireshark packet sniffer, and begin Wireshark packet capture. 启动 Wireshark 数据包嗅探器，并开始 Wireshark 数据包捕获。</p></li><li><p>The ping command is in c:\windows\system32, so type either “ping –n 10 hostname” or “c:\windows\system32\ping –n 10 hostname” in the MS-DOS command line (without quotation marks), where hostname is a host on another continent. If you’re outside of Asia, you may want to enter <a href="http://www.ust.hk">www.ust.hk</a> for the Web server at Hong Kong University of Science and Technology. The argument “-n 10” indicates that 10 ping messages should be sent. Then run the Ping program by typing return.</p></li></ul><p>Ping 程序在 c:\windows\system32 目录中，所以您在命令提示符中输入“ping –n 10 hostname” 或 “c:\windows\system32\ping –n 10 hostname”都是正确的 (注意命令是引号里的内容)。其中 hostname 是另一个大陆的主机名。如 您如果在非亚洲地区，建议您访问香港科技大学 <a href="http://www.ust.hk">www.ust.hk</a> ， 参数-n 10 代表发送 10 个 Ping 消息，然后按下回车执行命令。</p><ul><li>When the Ping program terminates, stop the packet capture in Wireshark. 当 Ping 程序终止时，停止在 Wireshark 中捕获数据包。</li></ul><p>At the end of the experiment, your Command Prompt Window should look something like Figure 1. In this example, the source ping program is in Massachusetts and the destination Ping program is in Hong Kong. From this window we see that the source ping program sent 10 query packets and received 10 responses. Note also that for each response, the source calculates the round-trip time (RTT), which for the 10 packets is on average 375 msec.</p><p>在实验结束时，您的命令提示符窗口应如图 1 所示。在此示例中，源 ping 程序位 于马萨诸塞州，目标 Ping 程序位于香港。 从这个窗口我们看到源 ping 程序发送了10 个查询包并收到了 10 个响应。 另请注意，对于每个响应，源计算往返时间 (RTT)，对于 10 个数据包平均为 375 毫秒。</p><p><img src="image-20230505125410545.png" alt="image-20230505125410545" loading="lazy"></p><p>Figure 2 provides a screenshot of the Wireshark output, after “icmp” has been entered into the filter display window. Note that the packet listing shows 20 packets: the 10 Ping queries sent by the source and the 10 Ping responses received by the source. Also note that the source’s IP address is a private address (behind a NAT) of the form 192.168/12; the destination’s IP address is that of the Web server at HKUST. Now let’s zoom in on the first packet (sent by the client); in the figure below, the packet contents area provides information about this packet. We see that the IP datagram within this packet has protocol number 01, which is the protocol number for ICMP. This means that the payload of the IP datagram is an ICMP packet.<br>如图 2，在将“icmp”输入过滤器显示窗口后 Wireshark 输出的屏幕截图。 请注意，</p><p>数据包列表显示 20 个数据包:源发送的 10 个 Ping 查询和源接收的 10 个 Ping 响 应。 另请注意，源的 IP 地址是 192.168 / 12 格式的私有地址(通过 NAT 协议连接 互联网); 目的地的 IP 地址是香港科技大学网络服务器的 IP 地址。 现在让我们点 击显示第一个由客户端发送的数据包; 在图中的下方，数据包内容区域提供有关此 数据包的信息。 我们看到该数据包中的 IP 数据报具有协议号 01，这是 ICMP 的协 议号。 这意味着 IP 数据报的有效载荷是 ICMP 数据包</p><p><img src="image-20230505110353038.png" alt="image-20230505110353038" loading="lazy"></p><center>图 2 在 Wireshark 中过滤 ICMP 协议并且选中某个 ICMP 消息<center><p>Figure 3 focuses on the same ICMP but has expanded the ICMP protocol information in the packet contents window. Observe that this ICMP packet is of Type 8 and Code 0 - a so-called ICMP “echo request” packet. (See Figure 5.19 of text.) Also note that this ICMP packet contains a checksum, an identifier, and a sequence number.</p><p>图 3 同样使用相同的 ICMP 过滤器，展开可以看到该 ICMP 包的详情信息。 观察到 该 ICMP 数据包是类型 8 和代码 0 ——所谓的 ICMP“回应请求”数据包。 (请参见 书本的图 5.19。)此外，此 ICMP 数据包包含校验和，标识符和序列号</p><p><img src="image-20230505110809611.png" alt="image-20230505110809611" loading="lazy"></p><h2 id="What-to-Hand-In-回答问题">What to Hand In: 回答问题</h2><p>You should hand in a screen shot of the Command Prompt window similar to Figure 1 above. Whenever possible, when answering a question below, you should hand in a printout of the packet(s) within the trace that you used to answer the question asked. Annotate the printout to explain your answer. To print a packet, use File-&gt;Print, choose Selected packet only, choose Packet summary line, and select the minimum amount of packet detail that you need to answer the question.</p><p>请尽量清晰的展示您的答案，必要时您可以在图中用标记辅以说明。您的答案应该<br>简单可读。</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">ping</span> <span class="token parameter variable">-c</span> <span class="token number">10</span> bing.com // <span class="token punctuation">[</span>-c count<span class="token punctuation">]</span> </code></pre><p>You should answer the following questions: 请回答以下问题:</p><ol><li>What is the IP address of your host? What is the IP address of the destination host? 您的主机的 IP 地址是多少? 目标主机的 IP 地址是多少?</li></ol><p><img src="image-20230505125749494.png" alt="image-20230505125749494" loading="lazy"></p><ol><li>Why is it that an ICMP packet does not have source and destination port numbers? 为什么 ICMP 数据包没有源端口号和目的端口号?</li></ol><p><strong>大多数TCP/IP实现直接在操作系统中支持ping服务器, 即该服务器不是一个进程.</strong></p><p>ICMP（Internet Control Message Protocol）数据包没有源端口号和目的端口号，因为ICMP不像TCP（传输控制协议）或UDP（用户数据报协议）那样是传输层协议。相反，ICMP是一种直接在IP（Internet Protocol）层之上运行的网络层协议。</p><p>TCP和UDP使用源和目的地端口号来在同一设备上运行的不同应用程序之间进行多路复用和解复用数据。然而，ICMP不用于传输应用程序数据，而是用于在网络设备之间传递错误消息和网络状态信息。因此，ICMP消息并不是针对设备上的特定端口而言的，而是针对设备本身的。</p><p>ICMP消息包含类型、代码和校验和等字段，这些字段用于指示消息的目的和内容。这些字段允许网络设备适当地解释和响应ICMP消息。例如，当从一个设备发送ping命令到另一个设备时，ping数据包包含一个ICMP回显请求消息，这促使接收设备向发送方发送一个ICMP回显回复消息。ICMP数据包中缺少源和目的端口号是由于这些信息对协议的运行不必要。</p><ol><li>Examine one of the ping request packets sent by your host. What are the ICMP type and code numbers? What other fields does this ICMP packet have? How many bytes are the checksum, sequence number and identifier fields? 查看任意的请求 ICMP 数据包， ICMP 类型和代码是什么? 该 ICMP 数据包还有哪些其他字段? 校验和，序列号和标识符字段有多少字节?</li></ol><p><strong>Type: 8 code: 0 回显请求</strong>。还包括<strong>检验和(2 Byte)</strong>, <strong>id(2 Byte)</strong>, <strong>sequence number(2 Byte)</strong></p><p><img src="image-20230505131005238.png" alt="image-20230505131005238" loading="lazy"></p><p><img src="image-20230505140604234.png" alt="image-20230505140604234" loading="lazy"></p><ol><li>Examine the corresponding ping reply packet. What are the ICMP type and code numbers? What other fields does this ICMP packet have? How many bytes are the checksum, sequence number and identifier fields?<br>查看任意的响应 ICMP 数据包， ICMP 类型和代码是什么? 该 ICMP 数据包<br>还有哪些其他字段? 校验和，序列号和标识符字段有多少字节?</li></ol><p>Type: 0(Echo reply)</p><p>Code : 0</p><p>还包括<strong>检验和(2 Byte)</strong>, <strong>id(2 Byte)</strong>, <strong>sequence number</strong>**(2 Byte**)</p><p><img src="image-20230505140719354.png" alt="image-20230505140719354" loading="lazy"></p><h2 id="ICMP-and-Traceroute-ICMP-协议和-Traceroute-命令">ICMP and Traceroute ICMP 协议和 Traceroute 命令</h2><p>Let’s now continue our ICMP adventure by capturing the packets generated by the Traceroute program. You may recall that the Traceroute program can be used to figure out the path a packet takes from source to destination. Traceroute is discussed in Section 1.4 and in Section 5.6 of the text.<br>现在让我们通过捕获 Traceroute 程序生成的数据包继续我们的 ICMP 实验。 您可能<br>还记得 Traceroute 程序可用于确定数据包从源到目的地的路径。 Traceroute 命令可 以在课本中的 1.4 节和 5.6 节中找到</p><p>Traceroute is implemented in different ways in Unix/Linux/MacOS and in Windows. In Unix/Linux, the source sends a series of UDP packets to the target destination using an unlikely destination port number; in Windows, the source sends a series of ICMP packets to the target destination. For both operating systems, the program sends the first packet with TTL=1, the second packet with TTL=2, and so on. Recall that a router will decrement a packet’s TTL value as the packet passes through the router. When a packet arrives at a router with TTL=1, the router sends an ICMP error packet back to the source. In the following, we’ll use the native Windows tracert program. A shareware version of a much nice Windows Traceroute program is pingplotter (<a href="http://www.pingplotter.com">www.pingplotter.com</a>). We’ll use pingplotter in our Wireshark IP lab since it provides additional functionality that we’ll need there.<br>每个系统有不同路由跟踪实现办法，在 Unix / Linux 中，路由跟踪 traceroute 使用 发送不可到达(无使用的)端口的 <strong>UDP</strong> 包来实现，在 Windows 中，路由跟踪 tracert 仅使用 <strong>ICMP</strong> 数据包来实现，但是对于他们来说，都是发送 TTL 增加的数据 包，例如 TTL=1,TTL=2，回想下，每经过一个路由器，TTL 就会减一，<strong>当 TTL=1 的包达到路由器，该路由器会将该包丢弃，并且发送 ICMP 错误给请求的机器</strong>，在 本次实验，我们使用 window 自带的 tracert。有一个跨平台 Windows Traceroute 程序的是 pingplotter(<a href="http://www.pingplotter.com">www.pingplotter.com</a>)(收费但可以试用)。 我们将在 Wireshark IP 实验室中使用 pingplotter，因为它提供了我们在那里需要的其他功能。</p><p>Do the following4: 请执行以下步骤</p><ul><li><p>Let’s begin by opening the Windows Command Prompt application (which can be found in your Accessories folder).<br>打开 windows 的命令提示符。</p></li><li><p>Start up the Wireshark packet sniffer, and begin Wireshark packet capture. 启动 Wireshark 数据包嗅探器，并开始 Wireshark 数据包捕获。</p></li><li><p>The tracert command is in c:\windows\system32, so type either “tracert hostname” or “c:\windows\system32\tracert hostname” in the MS-DOS command line (without quotation marks), where hostname is a host on another continent. (Note that on a Windows machine, the command is “tracert” and not “traceroute”.) If you’re outside of Europe, you may want to enter <a href="http://www.inria.fr">www.inria.fr</a> for the Web server at INRIA, a computer science research institute in France. Then run the Traceroute program by typing return.<br>tracert 程序在 c:\windows\system32 目录中，所以您在命令提示符中输入</p><p>“tracert hostname” 或 “c:\windows\system32\ tracert hostname”都是正确的(注 意命令是引号里的内容)。其中 hostname 是另一个大陆的主机名。如您如 果在非欧洲地区，建议您访问法国 INRIA(计算机科学研究所) <a href="http://www.inria.fr">www.inria.fr</a> 然后按下回车执行命令。</p></li><li><p>When the Traceroute program terminates, stop packet capture in Wireshark. 当 Traceroute 程序终止时，停止在 Wireshark 中捕获数据包。</p><p>At the end of the experiment, your Command Prompt Window should look something like Figure 4. In this figure, the client Traceroute program is in Massachusetts and the target destination is in France. From this figure we see that for each TTL value, the</p></li></ul><p>source program sends three probe packets. Traceroute displays the RTTs for each of the probe packets, as well as the IP address (and possibly the name) of the router that returned the ICMP TTL-exceeded message. 在实验结束时，您的命令提示符窗口应如图 4 所示。在此图中，客户端 Traceroute程序主机位于马萨诸塞州，目标主机位于法国。 从该图中我们看到，对于每个 TTL 值，源程序发送三个探测包。 Traceroute 显示每个探测包的 RTT，以及返回 ICMP TTL 超出消息的路由器的 IP 地址(可能还有名称)。</p><p><img src="image-20230505111220401.png" alt="image-20230505111220401" loading="lazy"></p><p>Figure 5 displays the Wireshark window for an ICMP packet returned by a router. Note that this ICMP error packet contains many more fields than the Ping ICMP messages.<br>图 5 显示了路由器返回的 ICMP 数据包的 Wireshark 窗口。 请注意，此 ICMP 错误数据包包含的字段比 Ping ICMP 消息多得多。</p><h2 id="image-20230505111244920"><img src="image-20230505111244920.png" alt="image-20230505111244920" loading="lazy"></h2><p>If you are unable to run Wireshark live on a computer, you can download the zip file <a href="http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip">http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip</a> and extract the file ICMP-ethereal-trace-2. The traces in this zip file were collected by Wireshark running on one of the author’s computers, while performing the steps indicated in the Wireshark lab. Once you have downloaded the trace, you can load it into Wireshark and view the trace using the File pull down menu, choosing Open, and then selecting the ICMP-ethereal-trace-2 trace file. You can then use this trace file to answer the questions below. 同样如果您无法抓包，建议您下载作者的抓包结果 <a href="http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip">http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip</a> 解压并且使用 Wireshark 打开 ICMP-ethereal-trace-2 进行分析。</p><hr><h2 id="What-to-Hand-In-回答问题-2">What to Hand In: 回答问题</h2><p>For this part of the lab, you should hand in a screen shot of the Command Prompt window. Whenever possible, when answering a question below, you should hand in a printout of the packet(s) within the trace that you used to answer the question asked. Annotate the printout to explain your answer. To print a packet, use File-&gt;Print, choose Selected packet only, choose Packet summary line, and select the minimum amount of packet detail that you need to answer the question. 请尽量清晰的展示您的答案，必要时您可以在图中用标记辅以说明。您的答案应该简单可读</p><p>Answer the following questions: 请回答以下问题:</p><ol><li><p>What is the IP address of your host? What is the IP address of the target destination host?<br>您的主机的 IP 地址是多少? 目标目标主机的 IP 地址是多少?</p></li><li><p>If ICMP sent UDP packets instead (as in Unix/Linux), would the IP protocol number still be 01 for the probe packets? If not, what would it be?<br>如果 ICMP 发送了 UDP 数据包(如在 Unix / Linux 中)，那么探测数据包的 IP 协议号仍然是 01 吗? 如果没有，它会是什么?</p></li></ol><p><img src="image-20230505141720372.png" alt="image-20230505141720372" loading="lazy"></p><ol><li>Examine the ICMP echo packet in your screenshot. Is this different from the ICMP ping query packets in the first half of this lab? If yes, how so? 检查屏幕截图中的 ICMP 响应数据包。 这与本实验的前半部分中的 ICMP ping 查询数据包不同吗? 如果不同，请解释为什么?</li></ol><p><img src="image-20230505141845947.png" alt="image-20230505141845947" loading="lazy"></p><p>该ICMP Message Type:11 Code: 0 , 路由器告诉源主机你的分组由于TTL减为0被我丢掉了(Time-to-live exceeded), 这是Ping和treaceroute程序的工作原理不同导致的, Ping程序发送请求回显报文, 目标主机收到后回复(回显回答), 而traceroute程序通过发送TTL从1递增的UPD数据报来获得路由信息.</p><ol><li>Examine the ICMP error packet in your screenshot. It has more fields than the ICMP echo packet. What is included in those fields?<br>检查屏幕截图中的 ICMP 错误数据包。 它具有比 ICMP 响应数据包更多的字段。 这个数据包含哪些内容?</li></ol><p><img src="image-20230505142419713.png" alt="image-20230505142419713" loading="lazy"></p><p>多了IP头部, IP头部包含了被丢弃的IP数据报的头部字段</p><ol><li>Examine the last three ICMP packets received by the source host. How are these packets different from the ICMP error packets? Why are they different? 检查源主机收到的最后三个 ICMP 数据包。 这些数据包与 ICMP 错误数据包有何不同? 他们为什么不同?</li></ol><p>找不到…最后都没有收到, 但我还是说几句. 这些同为ICMP数据包, 但TYPE和Code字段的字不同, Type:3 Code:3 目标主机告诉源主机目标端口不可达, 这是因为treaceroute程序发送了不可达的端口</p><p><img src="image-20230505143521010.png" alt="image-20230505143521010" loading="lazy"></p><ol><li><p>Within the tracert measurements, is there a link whose delay is significantly longer than others? Refer to the screenshot in Figure 4, is there a link whose delay is significantly longer than others? On the basis of the router names, can you guess the location of the two routers on the end of this link?</p><p>在 tracert 跟踪测量中，是否有一个连接的延迟比其他连接长得多? 请参阅 图 4 中的屏幕截图，是否有连接的延迟明显长于其他连接? 根据路由器名 称，您能猜出这个连接末端的两个路由器的位置吗?</p></li></ol><p>可以发现TTL为6和为10时, 延迟变化很大, 通过best trace程序发现, 这两个路由器的位置分别是中国北京和德国，黑森州，法兰克福，</p><img src="image-20230505144758780.png" alt="image-20230505144758780" style="zoom:50%;" loading="lazy"><p><img src="image-20230505145146382.png" alt="image-20230505145146382" loading="lazy"></p><h2 id="Extra-Credit-额外问题">Extra Credit 额外问题</h2><p>For one of the programming assignments you created a UDP client ping program. This ping program, unlike the standard ping program, sends UDP probe packets rather than ICMP probe packets. Use the client program to send a UDP packet with an unusual destination port number to some live host. At the same time, use Wireshark to capture any response from the target host. Provide a Wireshark screenshot for the response as well as an analysis of the response.</p><p>对于一个编程任务，您可能创建了一个 UDP 客户端 ping 程序。 与标准 ping 程序 不同，此 ping 程序发送 UDP 探测包而不是 ICMP 探测包。 使用客户端程序将具有 异常目标端口号的 UDP 数据包发送到某个活动主机。 同时，使用 Wireshark 捕获 目标主机的任何响应。 提供响应的 Wireshark 屏幕截图以及响应分析。</p></center></center>]]></content>
    
    
    <summary type="html">&lt;p&gt;In this lab, we’ll explore several aspects of the ICMP protocol:&lt;br&gt;
在本实验中，我们将探讨 ICMP 协议的几个方面:&lt;/p&gt;</summary>
    
    
    
    <category term="学习" scheme="https://trevoewu.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="computer network" scheme="https://trevoewu.github.io/tags/computer-network/"/>
    
    <category term="lab" scheme="https://trevoewu.github.io/tags/lab/"/>
    
  </entry>
  
  <entry>
    <title>Wireshark Lab: DNS</title>
    <link href="https://trevoewu.github.io/2023/04/21/Wireshark-Lab-DNS/"/>
    <id>https://trevoewu.github.io/2023/04/21/Wireshark-Lab-DNS/</id>
    <published>2023-04-21T13:05:21.000Z</published>
    <updated>2023-04-21T13:18:17.607Z</updated>
    
    <content type="html"><![CDATA[<p><strong>官方英文文档：<a href="Wireshark_Intro_v6.01.pdf">Wireshark_Intro_v6.01.pdf</a></strong></p><p><strong>以下内容为笔者翻译：</strong></p><hr><h2 id="Wireshark-实验-DNS-v6-01">Wireshark 实验:  DNS v6.01</h2><p><strong>《计算机网络：自顶向下方法（第6版）》补充材料，J.F. Kurose and K.W. Ross</strong></p><p>“不闻不若闻之，闻之不若见之，见之不若知之，知之不若行之。” ——中国谚语</p><p>© 2005-2012, J.F Kurose and K.W. Ross, All Rights Reserved</p><hr><p>如书中第2.5节所述，域名系统(DNS)将主机名转换为IP地址，在互联网基础架构中发挥关键作用。在本实验中，我们将仔细查看DNS在客户端的细节。回想一下，客户端在DNS中的角色相对简单——客户端向其本地DNS服务器发送<em>请求</em>，并接收一个<em>响应</em>。如书中的图2.21和2.22所示，由于DNS分层服务器之间相互通信，可以递归地或迭代地解析客户端的DNS查询请求，而大多数操作是不可见的。然而，从DNS客户端的角度来看，协议非常简 ——将查询指向为本地DNS服务器，并从该服务器接收到响应。</p><p>在开始本实验之前，您可能需要阅读书中的第2.5节来了解DNS。另外，您可能需要查看关于<strong>本地DNS服务器，DNS缓存，DNS记录和消息，以及DNS记录中的TYPE字段</strong>的资料。</p><h3 id="1-nslookup">1. nslookup</h3><p>在本实验中，我们将大量使用<em>nslookup</em>工具，这个工具在现在的大多数Linux/Unix和Microsoft平台中都有。要在Linux/Unix中运行<em>nslookup</em>，您只需在命令行中键入<em>nslookup</em>命令即可。要在Windows中运行，请打开命令提示符并在命令行上运行<em>nslookup</em>。</p><p>在这是最基本的操作，<em>nslookup</em>工具允许主机查询任何指定的DNS服务器的DNS记录。DNS服务器可以是根DNS服务器，顶级域DNS服务器，权威DNS服务器或中间DNS服务器（有关这些术语的定义，请参阅书本）。要完成此任务，<em>nslookup</em>将DNS查询发送到指定的DNS服务器，然后接收DNS回复，并显示结果。</p><p>上面的屏幕截图显示了三个不同<em>nslookup</em>命令的结果（显示在Windows命令提示符中）。在此示例中，客户端主机位于布鲁克林理工大学校园，<a href="http://xn--DNSdns-prime-1f5s760cplnk5cu61h2pa6538cej6c.poly.edu">默认本地DNS服务器为dns-prime.poly.edu</a>。运行nslookup时，如果没有指定DNS服务器，则<em>nslookup</em>会将查询发送到默认的DNS服务器（<a href="http://xn--dnsprime-t39lfp892aj4qdp3agi7e3d7c.poly.edu">在这种情况下为dnsprime.poly.edu</a>）。来看第一个命令：</p><p><code>nslookup www.mit.edu</code></p><p>说这个命令是说，请告诉我主机 <a href="http://www.mit.edu">www.mit.edu</a> 的IP地址。如屏幕截图所示，此命令的响应提供两条信息：（1）提供响应的DNS服务器的名称和IP地址；（2）响应本身，即 <a href="http://www.mit.edu">www.mit.edu</a> 的主机名和IP地址。虽然响应来自理工大学的本地DNS服务器，但本地DNS服务器很可能会迭代地联系其他几个DNS服务器来获得结果，如书中第2.4节所述。</p><p>现在来看第二个命令：</p><p><code>nslookup -type=NS mit.edu</code></p><p>在这个例子中，我们添加了选项&quot;-type=NS&quot;和域名&quot;<a href="http://mit.edu">mit.edu</a>&quot;。这将使得<em>nslookup</em>将NS记录发送到默认的本地DNS服务器。换句话说，“请给我发送mit.edu的权威DNS的主机名” （当不使用-type选项时，<em>nslookup</em>使用默认值，即查询A类记录。）上述屏幕截图中，首先显示了提供响应的DNS服务器（这是默认本地DNS服务器）以及三个MIT域名服务器。这些服务器中的每一个确实都是麻省理工学院校园主机的权威DNS服务器。然而，<em>nslookup</em>也表明该响应是非权威的，这意味着这个响应来自某个服务器的缓存，而不是来自权威MIT DNS服务器。最后，响应结果还显示了麻省理工学院权威DNS服务器的IP地址。 （即使<em>nslookup</em>生成的NS类型查询没有明确要求IP地址，本地DNS服务器依然”免费“返回了这些信息，然后被<em>nslookup</em>显示出来。）</p><p>最后来看第三个命令：</p><p><code>nslookup www.aiit.or.kr bitsy.mit.edu</code></p><p>在这个例子中，我们希望将查询请求发送到DNS服务器 <a href="http://bitsy.mit.edu">bitsy.mit.edu</a> ，而不是默认的DNS服务器（<a href="http://dns-prime.poly.edu">dns-prime.poly.edu</a>）。因此，查询和响应事务直接发生在我们的主机和 <a href="http://bitsy.mit.edu">bitsy.mit.edu</a> 之间。在这个例子中，DNS服务器 <a href="http://bitsy.mit.edu">bitsy.mit.edu</a> 提供主机 <a href="http://www.aiit.or.kr">www.aiit.or.kr</a> 的IP地址，它是高级信息技术研究所（韩国）的Web服务器。</p><p>现在我们了解了一些示例，您现在可能想知道<em>nslookup</em>命令的一般语法。语法是：</p><p><code>nslookup -option1 -option2 host-to-find dns-server</code></p><p>一般来说，<em>nslookup</em>可以不添加选项，或者添加一两个甚至更多选项。正如我们在上面的示例中看到的，dns-server也是可选的；如果这项没有提供，查询将发送到默认的本地DNS服务器。</p><p>现在我们提供了总览了<em>nslookup</em>，现在是你自己驾驭它的时候了。执行以下操作（并记下结果）：</p><ol><li><p>运行<em>nslookup</em>以获取一个亚洲的Web服务器的IP地址。该服务器的IP地址是什么？</p><p><img src="image-20230421210837297.png" alt="image-20230421210837297" loading="lazy"></p><p>查询了哈尔滨理工大学的ip地址, 通过得到的信息可以知道, 该服务器的IP地址为202.118.201.1</p><p>可以发现这是一个来自DNS服务器182.254.116.116的应答, 搜索发现, 这是腾讯的备用域名服务器.</p><p><img src="image-20230421210846142.png" alt="image-20230421210846142" loading="lazy"></p><p>继续查询权威名字服务器, 得到的是非权威的, 这是因为腾讯的DNS服务器不知道哈尔滨理工大学的权威名字服务器, 只能向根DNS→TLD(顶级域DNS)(.cn)→edu.cnDNS→hrbust.edu.cnDNS, 迭代查询获得</p><p>如果我们之间对这个DNS服务器发起DNS查询:</p><p><img src="image-20230421210900650.png" alt="image-20230421210900650" loading="lazy"></p><p>可以发现, 这样一条来自权威名字服务器的应答.</p></li><li><p>运行<em>nslookup</em>来确定一个欧洲的大学的权威DNS服务器。</p><p>查询了苏黎世联邦理工大学的权威DNS</p></li></ol><p><img src="image-20230421210910755.png" alt="image-20230421210910755" loading="lazy"></p><p>可以发现权威名字服务器为: <a href="http://ns1.ethz.ch">ns1.ethz.ch</a></p><ol><li>运行<em>nslookup</em>，使用问题2中一个已获得的DNS服务器，来查询Yahoo!邮箱的邮件服务器。它的IP地址是什么？</li></ol><p><img src="image-20230421210921960.png" alt="image-20230421210921960" loading="lazy"></p><p>查不到好吧…人家是大学的权威DNS, 没有雅虎的邮件服务器地址, 只维护了大学的IP地址查询, 不当然公共DNS的指责, 即不去迭代的查询(个人猜测)</p><p>又到了问聪明的chatGPT的时间了:</p><p><img src="image-20230421211212041.png" alt="image-20230421211212041" loading="lazy"></p><p><img src="image-20230421210930573.png" alt="image-20230421210930573" loading="lazy"></p><p>使用腾讯的公共DNS服务器我们可以得到Yahoo的邮件服务器地址.</p><p>同时为发现查询<code>www.mail.yahoo.com</code>和mail.yahoo.com的结果不同</p><p><img src="image-20230421211245869.png" alt="image-20230421211245869" loading="lazy"></p><p>查询chatGPT得到以下回复:</p><p><img src="image-20230421211255078.png" alt="image-20230421211255078" loading="lazy"></p><h3 id="2-ipconfig">2. ipconfig</h3><p><em>ipconfig</em>（对于Windows）和<em>ifconfig</em>（对于Linux / Unix）是主机中最实用的程序，尤其是用于调试网络问题时。这里我们只讨论<em>ipconfig</em>，尽管Linux / Unix的<em>ifconfig</em>与其非常相似。 <em>ipconfig</em>可用于显示您当前的TCP/IP信息，包括您的地址，DNS服务器地址，适配器类型等。例如，您只需进入命令提示符，输入</p><p><code>ipconfig /all</code></p><p><em>ipconfig</em>对于管理主机中存储的DNS信息也非常有用。在第2.5节中，我们了解到主机可以缓存最近获得的DNS记录。要查看这些缓存记录，在 C:\&gt; 提示符后输入以下命令：</p><p><code>ipconfig /displaydns</code></p><p>每个条目显示剩余的生存时间（TTL）（秒）。要清除缓存，请输入</p><p><code>ipconfig /flushdns</code></p><p>清除了所有条目并从hosts文件重新加载条目。</p><h3 id="3-使用Wireshark追踪DNS">3. 使用Wireshark追踪DNS</h3><p>现在，我们熟悉<code>nslookup</code>和<code>ipconfig</code>，我们准备好了一些正经的事情。首先让我们捕获一些由常规上网活动生成的DNS数据包。</p><ul><li>使用<em>ipconfig</em>清空主机中的DNS缓存。</li><li>打开浏览器并清空浏览器缓存。 （若使用Internet Explorer，转到<strong>工具</strong>菜单并选择<strong>Internet选项</strong>；然后在<strong>常规</strong>选项卡中选择删除文件。）</li><li>打开Wireshark，然后在过滤器中输入“ip.addr==your_IP_address”，您可以先使用<em>ipconfig</em>获取你的IP地址。此过滤器将删除既从你主机不发出也不发往你主机的所有数据包。</li><li>在Wireshark中启动数据包捕获。</li><li>使用浏览器访问网页： <a href="http://www.ietf.org">http://www.ietf.org</a></li><li>停止数据包捕获。</li></ul><p>如果您无法在你的网络连接上运行Wireshark，则可以下载一个捕获了数据包的文件，这个文件是本书作者在自己计算机上 按照上述步骤捕获的（原文注：Download the zip file <a href="http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip">http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip</a> and extract the file dnsethereal-trace-1. The traces in this zip file were collected by Wireshark running on one of the author’s computers, while performing the steps indicated in the Wireshark lab. Once you have downloaded the trace, you can load it into Wireshark and view the trace using the File pull down menu, choosing Open, and then selecting the dns-ethereal-trace-1 trace file. ）。回答下列问题。您应该在解答中尽可能展示你使用了哪些你捕获到的数据包，并注释出来（原文注：What do we mean by “annotate”? If you hand in a paper copy, please highlight where in the printout you’ve found the answer and add some text (preferably with a colored pen) noting what you found in what you ‘ve highlight. If you hand in an electronic copy, it would be great if you could also highlight and annotate. ）。若要打印数据包，请使用<em>文件</em>-&gt;<em>打印</em>，只勾选<em>仅选中分组</em>，和<em>概要行</em>，并选中你所需要用于解答问题的数据包。</p><ol start="4"><li><p>找到DNS查询和响应消息。它们是否通过UDP或TCP发送？</p><p><img src="image-20230421211313407.png" alt="image-20230421211313407" loading="lazy"></p><p>通过UDP发送</p></li><li><p>DNS查询消息的目标端口是什么？ DNS响应消息的源端口是什么？</p><p><img src="image-20230421211321920.png" alt="image-20230421211321920" loading="lazy"></p><p>目标端口通过上一问的图片可以得到为: 53, 响应DNS到源端口也是53</p></li><li><p>DNS查询消息发送到哪个IP地址？使用ipconfig来确定本地DNS服务器的IP地址。这两个IP地址是否相同？</p><p>本地IP 地址: 10.51.172.226</p><p>DNS服务器IP地址: 182.254.116.116</p><p>相同</p><p><img src="image-20230421211341608.png" alt="image-20230421211341608" loading="lazy"></p></li><li><p>检查DNS查询消息。DNS查询是什么&quot;Type&quot;的？查询消息是否包含任何&quot;answers&quot;？</p><p><img src="image-20230421211351099.png" alt="image-20230421211351099" loading="lazy"></p><p>TYPE: A</p><p>不包含</p></li><li><p>检查DNS响应消息。提供了多少个&quot;answers&quot;？这些答案具体包含什么？</p><p><img src="image-20230421211359997.png" alt="image-20230421211359997" loading="lazy"></p><p>三个answer</p><p>第一个answer: TYPE CNAME, 主机别名到规范主机名的对应关系</p><p><img src="image-20230421211409785.png" alt="image-20230421211409785" loading="lazy"></p><p>包含NAME(域名),TYPE, Class, TTL, Data. CNAME(规范主机名)</p><p>第二个answer: TYPE A, 域名和IP地址</p><p><img src="image-20230421211422241.png" alt="image-20230421211422241" loading="lazy"></p><p>得到了规范主机名的IP地址</p><p>第三个answer:</p><p><img src="image-20230421211431684.png" alt="image-20230421211431684" loading="lazy"></p><p>另一个规范主机名的IP地址</p></li><li><p>考虑从您主机发送的后续TCP SYN数据包。 SYN数据包的目的IP地址是否与DNS响应消息中提供的任何IP地址相对应？</p><p>直接过滤ip.addr==104.16.44.99</p><p>结果如下:</p><p><img src="image-20230421211445058.png" alt="image-20230421211445058" loading="lazy"></p><p>可以发现我的主机向这个IP地址发起了TCP的链接请求</p></li><li><p>这个网页包含一些图片。在获取每个图片前，您的主机是否都发出了新的DNS查询？</p><p><img src="image-20230421211456062.png" alt="image-20230421211456062" loading="lazy"></p><p>有一个对r3.o.lencr.org的DNS查询, 搜索发现这是一个恶意的软件发起的, 目的是给浏览器带来广告(服了…)</p><p><img src="image-20230421211504325.png" alt="image-20230421211504325" loading="lazy"></p></li></ol><p>现在让我们玩玩<em>nslookup</em>（原文注：If you are unable to run Wireshark and capture a trace file, use the trace file dns-ethereal-trace-2 in the zip file <a href="http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip">http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip</a>  ）。</p><ul><li>启动数据包捕获。</li><li>使用nslookup查询 <a href="http://www.mit.edu">www.mit.edu</a></li><li>停止数据包捕获。</li></ul><p>我们从上面的屏幕截图看到，<em>nslookup</em>实际上发送了三个DNS查询，并收到了三个DNS响应。只考虑本次实验相关结果，在回答以下问题时，请忽略前两组查询/响应，因为<em>nslookup</em>的一些特殊性，这些查询通常不是由标准网络应用程序生成的。您应该专注于最后一个查询和响应消息。</p><ol start="11"><li><p>DNS查询消息的目标端口是什么？ DNS响应消息的源端口是什么？</p><p>查询:</p><p><img src="image-20230421211516046.png" alt="image-20230421211516046" loading="lazy"></p><p>响应:</p><p><img src="image-20230421211522148.png" alt="image-20230421211522148" loading="lazy"></p></li><li><p>DNS查询消息的目标IP地址是什么？这是你的默认本地DNS服务器的IP地址吗？</p><p>是的</p><p><img src="image-20230421211532903.png" alt="image-20230421211532903" loading="lazy"></p></li><li><p>检查DNS查询消息。DNS查询是什么&quot;Type&quot;的？查询消息是否包含任何&quot;answers&quot;？</p></li><li><p>TYPE A, 不包含</p><p><img src="image-20230421211545749.png" alt="image-20230421211545749" loading="lazy"></p></li><li><p>检查DNS响应消息。提供了多少个&quot;answers&quot;？这些答案包含什么？</p><p>三个</p><p><img src="image-20230421211557865.png" alt="image-20230421211557865" loading="lazy"></p><p>包含主机别名到规范主机名的转化关系(TYPE:CNAME)</p><p>规范主机名到IP地址到转换关系</p></li></ol><p>现在重复上一个实验，但换成以下命令：</p><p><code>nslookup -type=NS mit.edu</code></p><p>回答下列问题：</p><ol start="16"><li><p>DNS查询消息发送到的IP地址是什么？这是您的默认本地DNS服务器的IP地址吗？</p><p>是的</p><p><img src="image-20230421211610171.png" alt="image-20230421211610171" loading="lazy"></p></li><li><p>检查DNS查询消息。DNS查询是什么&quot;Type&quot;的？查询消息是否包含任何&quot;answers&quot;？</p><p><img src="image-20230421211621477.png" alt="image-20230421211621477" loading="lazy"></p><p>Type: NS</p><p>不包含</p></li><li><p>检查DNS响应消息。响应消息提供的MIT域名服务器是什么？此响应消息还提供了MIT域名服务器的IP地址吗？</p><p>![image-20230416184356921](/Users/trevorwu/Library/Application Support/typora-user-images/image-20230416184356921.png)</p></li></ol><p>现在重复上一个实验，但换成以下命令：</p><p><code>nslookup www.aiit.or.kr bitsy.mit.edu</code></p><p><strong>该DNS服务器已停用</strong>, 使用作者提供的抓包结果dns-ethereal-trace-4</p><p>回答下列问题：</p><ol start="20"><li><p>DNS查询消息发送到的IP地址是什么？这是您的默认本地DNS服务器的IP地址吗？如果不是，这个IP地址是什么？</p><p><img src="image-20230421211639835.png" alt="image-20230421211639835" loading="lazy"></p><p>理论上不是, 因为已经指定了对应的DNS服务器,目标IP地址应该是DNS服务器名字<code>bitsy.mit.edu</code> 的IP地址</p></li><li><p>检查DNS查询消息。DNS查询是什么&quot;Type&quot;的？查询消息是否包含任何&quot;answers&quot;？</p><p>第一个查询:</p><p><img src="image-20230421211649155.png" alt="image-20230421211649155" loading="lazy"></p><p>TYPE: PTR 通过IP反向查询域名</p><p>第二个查询: TYPE A, 查询<code>www.aiit.or.kr.poly.edu</code>的IP地址, 目标IP地址是18.72.0.3</p><p><img src="image-20230421211656347.png" alt="image-20230421211656347" loading="lazy"></p><p>第三个查询: TYPE A, 查询<code>www.aiit.or.kr</code>的IP地址, 目标IP和上一个查询相同.</p><p><img src="image-20230421211702635.png" alt="image-20230421211702635" loading="lazy"></p></li><li><p>检查DNS响应消息。提供了多少个&quot;answers&quot;？这些答案包含什么？</p><p>第一个响应: 提供了一个answer</p><p><img src="image-20230421211713117.png" alt="image-20230421211713117" loading="lazy"></p><p>TYPE:PTR</p><p>回答里包含IP地址3.0.72.18对应的域名</p><p>第二个响应:</p><p><img src="image-20230421211730365.png" alt="image-20230421211730365" loading="lazy"></p><p>TYPE: SOA(Start Of a zone of Authority)</p><p><img src="image-20230421211748643.png" alt="image-20230421211748643" loading="lazy"></p><p>响应结果为找不到:</p><p>第三个响应:</p><p><img src="image-20230421211757311.png" alt="image-20230421211757311" loading="lazy"></p><p>ansewer为目标域名的IP地址.</p></li></ol>]]></content>
    
    
    <summary type="html">域名系统(DNS)将主机名转换为IP地址，在互联网基础架构中发挥关键作用。在本实验中，我们将仔细查看DNS在客户端的细节。回想一下，客户端在DNS中的角色相对简单——客户端向其本地DNS服务器发送*请求*，并接收一个*响应*。如书中的图2.21和2.22所示，由于DNS分层服务器之间相互通信，可以递归地或迭代地解析客户端的DNS查询请求，而大多数操作是不可见的。然而，从DNS客户端的角度来看，协议非常简 ——将查询指向为本地DNS服务器，并从该服务器接收到响应</summary>
    
    
    
    <category term="学习" scheme="https://trevoewu.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="computer cetwork" scheme="https://trevoewu.github.io/tags/computer-cetwork/"/>
    
  </entry>
  
  <entry>
    <title>Wireshark Lab: TCP</title>
    <link href="https://trevoewu.github.io/2023/04/21/Wireshark-Lab-TCP/"/>
    <id>https://trevoewu.github.io/2023/04/21/Wireshark-Lab-TCP/</id>
    <published>2023-04-21T12:48:28.000Z</published>
    <updated>2023-04-21T13:04:35.920Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>在本实验中，我们将详细研究著名的 TCP 协议的行为。 我们将通过从您的电脑向 远程服务器传输一份 150KB 的文件(一份 Lewis Carrol 的“爱丽丝梦游仙境”文本)，并分析 TCP 传输内容的发送和接收过程来实现。 我们将研究 TCP 对序列和 确认号的使用，以提供可靠的数据传输;我们将看到 TCP 的拥塞控制算法 – 慢启 动和拥塞避免 – 在过程中，我们将看看 TCP 的接收器发送流量控制的机制。 我们还将简要地观察 TCP 连线的设置，我们还会研究计算机和服务器之间 TCP 连线的性能(吞吐量和往返时间)。</p></blockquote><h2 id="A-first-look-at-the-captured-trace">A first look at the captured trace</h2><ul><li><p>将文件传输到 <a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> 的客户端计算机使用的 IP 地址和 TCP 端口号是什么?</p></li><li><p><a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> 的 IP 地址是什么? 在哪个端口号上发送和接收此连接的 TCP 段?</p></li></ul><p><img src="image-20230421205628132.png" alt="image-20230421205628132" loading="lazy"></p><p>Client IP Addressee: 10.51.172.226 Client Port: 61084<br><a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> IP Address: 128.119.245.12</p><ul><li>客户端计算机将文件传输到 <a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> 所使用的 IP 地址和 TCP 端口号是多少?</li></ul><p><img src="image-20230421205643562.png" alt="image-20230421205643562" loading="lazy"></p><p>Client IP Addressee: 10.51.172.226 Client Port: 61084</p><ul><li>用于在客户端计算机和 <a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> 之间启动 TCP 连接的 TCP SYN 段的序列号是什么? 标识为 SYN 段的段有什么功能?</li></ul><p><img src="image-20230421205702461.png" alt="image-20230421205702461" loading="lazy"></p><p>如图, SYN序列号为<code>4095602682</code>, 标识为SYN的segment用于建立TCP链接</p><ul><li><a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> 发送给客户端计算机以回复 SYN 的 SYNACK 段的序列号是多少?</li></ul><p><code>2017202044</code></p><p><img src="image-20230421205716096.png" alt="image-20230421205716096" loading="lazy"></p><p>SYNACK 段中的 Acknowledgment 栏位的值是多少?</p><p>为<code>4095602683</code></p><p><img src="image-20230421205729437.png" alt="image-20230421205729437" loading="lazy"></p><p><strong>观察到除了 SYN 标志位，ACK(Acknoledment)标志位也设 1，意思服务器接收到我约连按请求并且发 SYN-ACIK 确认，这是三次握手的第二步。</strong></p><p><a href="http://Gaia.cs.umass.edu">Gaia.cs.umass.edu</a> 是如何确定此 Acknowledgment 的数值的?</p><p>收到的$$seqence number + Len.$$</p><p>在将段标识 为 SYNACK 段的段在连线中有什么功能?</p><p><img src="image-20230421205757558.png" alt="image-20230421205757558" loading="lazy"></p><p><strong>用于建立链接, 是三次握手的第二次, 表示同样连接请求</strong></p><ul><li>包含 HTTP POST 命令的 TCP 区段的序列号是多少?</li></ul><p><img src="image-20230421205811084.png" alt="image-20230421205811084" loading="lazy"></p><p>如图为<code>4095602683</code>,TCP PSH 字段设为1表示要传送数据.  HTTP的POST方法借助于TCP提供的服务实现, 在TCP中表现为TCP的PUSH字段设为1.</p><ul><li>将包含 HTTP POST 的 TCP 区段视为 TCP 连接中的第一个区段。在这个 TCP 连线中前六个 TCP 区段的序列号是什么(包括包含 HTTP POST的段 每区段发送的时间是什么时候? 收到的每个区段的 ACK 是什么时候?</li></ul><p>鉴于发送每个 TCP 区段的时间与收到确认的时间之间的差异，六个区段中每个区段的 RTT 值是多少?</p><p>如图是前6段的信息:</p><p><img src="image-20230421205823688.png" alt="image-20230421205823688" loading="lazy"></p><h3 id="第一段Frame1">第一段Frame1:</h3><p>(发送第一个frame,在 Wireshark中序号为frame69,这是Wireshark捕获到的序号, 由于这是发送数据的第一帧记frame1)</p><p><img src="image-20230421205838620.png" alt="image-20230421205838620" loading="lazy"></p><p>RTT:</p><p><em>note: 这里的Timestamps是Wireshark提供的额外的功能, 和TCP段Optionfields 里的Timestamps不同.</em></p><p>通过Wireshark的分析, 可以知道IRTT(initial RTT 表示握手阶段的RTT)为0.39900200s</p><p><img src="image-20230421205848826.png" alt="image-20230421205848826" loading="lazy"></p><p>ACK(对第一个frame)的ACK</p><p><img src="image-20230421205858659.png" alt="image-20230421205858659" loading="lazy"></p><p>发现这里的ACK number = 4095603435, 而seq1 的Next sequence = 4095603298, 而恰好, frame2的Next sequence = 4095603435</p><p><img src="image-20230421205911880.png" alt="image-20230415112704099" loading="lazy"></p><p><strong>所以这是对frame1和frame2的累计确认, 这是因为TCP 采用了延迟到ACK(delay ACK), 具有所期望的序号报文到达时, 等待一段时间(通常为40ms), 如果下一个按序报文到达, 立即发送单个累计ACK, 以确认两个按序到达的报文段. 如果下一个按序报文段没有在这个时间内到达, 则发送一个ACK.</strong></p><p>我们继续观察第一个报文段段Timestamps字段的值:</p><p><img src="image-20230421205924206.png" alt="image-20230421205924206" loading="lazy"></p><p>对比ACK1的Timestamps:</p><p><img src="image-20230421205931912.png" alt="image-20230421205931912" loading="lazy"></p><p>可以发现, 第一个报文段的TSval和ACK1的TimestampsTSerc相等, 进一步验证了之前的说法, 当接受到连续两个按序到达的报文时, 用于回复的ACK报文段段TSerc值的最早接受到的报文段的TSval, 这是为了对方更够更好的估算RTT.</p><p><strong>时间戳选项主要的功能有两个</strong>：</p><ul><li><p><strong>用来计算往返时间RTT</strong>。</p><p>发送方在发送报文段时把当前时钟的时间值放入时间戳字段，接收方在确认该报文段时把时间戳字段值复制到时间戳回送回答字段。因此，发送方在收到确认报文后，可以准确计算出RTT。时间戳是一个单调增长的值，接收方只需要回显收到的内容，因此是不需要关注时间戳的单元是什么，也不需要连接双发的时钟同步。</p></li><li><p><strong>PAWS:防止回绕的序号</strong>。</p></li></ul><p>我们知道序列号只有32位，而每增加2^32个序列号后就会重复使用原来用过的序列号。假设我们有一条高速网络，通信的主机双方有足够大的带宽用来快速的传输数据。例如1Gb/s（<strong>TCP 的窗口经过窗口缩放可以最高到 1GB（2^30)</strong>）的速率发送报文段，则不到35秒钟数据字节的序列号就会重复。这样对TCP传输带来混乱的情况。这种情况之出现在高速链路上。<strong>而采用时间戳选项，可以很容易的分辨出相同序列号的数据报，哪个是最近发送，哪个是以前发送的。</strong></p><p>参考文章<a href="https://switch-router.gitee.io/blog/tcp-timestamp/">TCP timestamp 选项那点事</a></p><p>接着我们观察ACK1报文的ACK分析(由wireshark提供), RTT为: 0.40989700s</p><p><img src="image-20230421205941895.png" alt="image-20230421205941895" loading="lazy"></p><h3 id="第二段"><strong>第二段:</strong></h3><p>我们直接去找, 收到的第二个ACK报文</p><p><img src="image-20230421210002459.png" alt="image-20230421210002459" loading="lazy"></p><p>对比sequence的值, 可以发现, 这是对frame75的ACK, 也就是, 收到了对第七个报文段的ACK. 说明服务器已经收到了第七个报文段以及之前的报文.</p><p>我们还发现, 收到了一条[Windows Update]的报文, 这是TCP的流量控制, 用来告诉发送端根据这个值适当的调节发送速率.</p><p><img src="image-20230421210012633.png" alt="image-20230421210012633" loading="lazy"></p><p>根据wireshark的分析, 可以知道, RTT为0.409390000s</p><p><img src="image-20230421210034300.png" alt="image-20230421210034300" loading="lazy"></p><h3 id="第三段">第三段:</h3><p><img src="image-20230421210044526.png" alt="image-20230415135344532" loading="lazy"></p><h3 id="第四段">第四段:</h3><p><img src="image-20230421210050923.png" alt="image-20230421210050923" loading="lazy"></p><h3 id="第五段">第五段:</h3><p><img src="image-20230421210058078.png" alt="image-20230421210058078" loading="lazy"></p><h3 id="第六段">第六段</h3><p><img src="image-20230421210120044.png" alt="image-20230421210120044" loading="lazy"></p><p>收到每个 ACK 后，EstimatedRTT 值(参 见本节中的第 3.5.3 节，第 242 页)是什么?</p><p>假设第一个 EstimatedRTT 的 值等于第一个区段的测量 RTT，然后使用课本第 242 页的 EstimatedRTT 公式计算所有后续区段。</p><p><img src="image-20230421210135957.png" alt="image-20230421210135957" loading="lazy"></p><ul><li><p>What is the length of each of the first six TCP segments?4 前六个 TCP 区段的长度是多少?</p><p><img src="image-20230421210144892.png" alt="image-20230421210144892" loading="lazy"></p><p><img src="image-20230421210152513.png" alt="image-20230421210152513" loading="lazy"></p></li><li><p>What is the minimum amount of available buffer space advertised at the received for the entire trace? Does the lack of receiver buffer space ever throttle the sender? 对于整个跟踪包，收到的最小可用缓冲区空间量是多少? 缺少接收缓冲区空间是否会限制发送方传送 TCP 区段?</p><p><img src="image-20230421210204402.png" alt="image-20230421210204402" loading="lazy"></p><p>大部分Win都是很大的值, 太多包了, 懒得分析了.通过检查此跟踪，发送器永远不会因为接收器缓冲区空间不足而受到抑制。</p></li><li><p>Are there any retransmitted segments in the trace file? What did you check for (in the trace) in order to answer this question?<br>在跟踪文件中是否有重传的段? 为了回答这个问题，您检查了什么(在跟踪包中)?</p><p>观察序列号的变化:</p><p>可以发现, 序列号一直在增加, 所以没有重传的段.</p><p><img src="image-20230421210221963.png" alt="image-20230421210221963" loading="lazy"></p><p>通常到收到了不同的两个冗余ACK, 但这不一定意味着丢包, 这是因为分组乱序到达接受方导致的.</p><p><img src="image-20230421210234982.png" alt="image-20230421210234982" loading="lazy"></p></li><li><p>How much data does the receiver typically acknowledge in an ACK? Can you identify cases where the receiver is ACKing every other received segment (see Table 3.2 on page 250 in the text).<br>接收方通常在 ACK 中确认多少数据? 您是否可以识别接收方每隔一个接收到的区段才发送确认的情况(参见本文第 250 页的表 3.2)</p><p>按照表3-2的说明, 接受方最多确认两个段, 但是观察了捕获结果, 发现很多事确认了超过两个段段情况, 比如在下图中, 收到的第一个ACK确认了69,70两段. 这是一次典型的delay ACK</p><p><img src="image-20230421210252350.png" alt="image-20230421210252350" loading="lazy"></p><p>但是观察收到的第二个ACK, 是对75段及之前段的累积确认, 这同时累积确认了71,72,73,74,75这五个段. 且观察后续的ACK, 除了在上一问题上出现的冗余ACK外, 无其他冗余ACK.</p><p>如果严格按照表3-2的叙述来看, 这只可能是部分ACK丢失导致的, 这就意味着网络拥塞, 但很明显这是不可能的, 因为没有发现任何一个重传的段, 网络很通畅.</p><p>让我们问问万能的chatGPT吧:</p><p><img src="image-20230421210304585.png" alt="image-20230421210304585" loading="lazy"></p><p><strong>最多可以合并2~5个报文段哦!!! chatGPT yyds!</strong></p><p><img src="image-20230421210315184.png" alt="image-20230421210315184" loading="lazy"></p></li><li><p>What is the throughput (bytes transferred per unit time) for the TCP connection? Explain how you calculated this value.TCP 连接的吞吐量(每单位时间传输的节数)是多少? 解释你如何计算 这个值。</p><p>TCP吞吐量的计算在很大程度上取决于平均时间段的选择。作为一种常见的吞吐量计算，在本问题中，我们选择平均时间周期作为整个连接时间。然后，该TCP连接的平均吞吐量被计算为总数据量与总传输时间之间的比率。可以通过第一个TCP数据段的序列号和最后一个确认确认的序列号之间的差来计算发送的总数据量。</p><p>最后一个由我发给服务器的最后一个ACK的seqence numerber为4095755619, 我发送的报文段第一个序列号为: 4095602682</p><p>所以接受方的接受到的总数据为: 4095755619- 4095602682   =  152936Byte</p><p><img src="image-20230421210352640.png" alt="image-20230421210352640" loading="lazy"></p><p><img src="image-20230421210406967.png" alt="image-20230421210406967" loading="lazy"></p><p>总传输时间为5.455830-0.026477=2.50933秒。</p><p>因此，tcp连接的吞吐量计算为152936/2.50933=60946.945997537191202B/s = 60KB/s。</p><p><img src="image-20230421210418067.png" alt="image-20230421210418067" loading="lazy"></p></li></ul><p><em>图由wireshark产生</em></p><blockquote><p>4tcp-ethereal-trace-1 跟踪文件中的 TCP 区段都小于 1460 􏰁节。 这是因为收集跟踪 的计算机具有以太网卡，该最大 IP 数据包的长度限制为 1500 􏰁节(40 􏰁节的 TCP / IP 报头数据和 1460 􏰁节的 TCP 有效负载)。此 1500 􏰁节值是以太网允许 的标准最大长度。 如果您的跟踪包内容指示 TCP 区段长度大于 1500 􏰁节，并且 您的计算机使用以太网连接网路，则是 Wireshark 报告了错误的 TCP 区段长度;它 也可能是只显示一个大的 TCP 段而不是多个较小的区段，而您的计算机确实可能 正在发送多个较小的区段，这可以由收到的 ACK 区段来证明。 报告的区段长度的 这种不一致是由于以太网驱动程序和 Wireshark 软件之间的交互作用所导致。 如果 您有这种不一致情形，我们建议您使用本文所提供的跟踪文件来执行本实验的分析 内容。</p></blockquote><h2 id="TCP-congestion-control-in-action-TCP-拥塞控制">TCP congestion control in action (TCP 拥塞控制)</h2><blockquote><p>现在让我们检查从客户端服务器的每单位时间发送的数据量。 而不是(繁琐 地!)从 Wireshark 窗口中的原始数据计算这些数值，我们将使用 Wireshark 的 TCP 图形工具 – 时序图(Stevens) - 来绘制数据。</p></blockquote><ul><li><p>使用时序图(Stevens)绘图工具查看从客户端发送到 <a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> 服务 器的区段的序列号与时间关系图。您能否确定 TCP 的慢启动阶段的开始和 结束位置，以及拥塞避免接管的位置? 评论测量数据与我们在文本中研究 的 TCP 的理想化行为的不同之处。</p><p><img src="image-20230421210435578.png" alt="image-20230421210435578" loading="lazy"></p></li></ul><p>计算每轮发送的段数量分别为: 12,17,36,87 呈指数增长, 一只在慢启动阶段.</p>]]></content>
    
    
    <summary type="html">在本实验中，我们将详细研究著名的 TCP 协议的行为。 我们将通过从您的电脑向 远程服务器传输一份 150KB 的文件，并分析 TCP 传输内容的发送和接收过程来实现。 我们将研究 TCP 对序列和 确认号的使用，以提供可靠的数据传输;我们将看到 TCP 的拥塞控制算法 – 慢启 动和拥塞避免 – 在过程中，我们将看看 TCP 的接收器发送流量控制的机制。 我们还将简要地观察 TCP 连线的设置，我们还会研究计算机和服务器之间 TCP 连线的性能。</summary>
    
    
    
    <category term="学习" scheme="https://trevoewu.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="computer network" scheme="https://trevoewu.github.io/tags/computer-network/"/>
    
  </entry>
  
  <entry>
    <title>MAC M1 安装Oracle数据库教程</title>
    <link href="https://trevoewu.github.io/2023/04/21/MAC-M1-%E5%AE%89%E8%A3%85Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%99%E7%A8%8B/"/>
    <id>https://trevoewu.github.io/2023/04/21/MAC-M1-%E5%AE%89%E8%A3%85Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%99%E7%A8%8B/</id>
    <published>2023-04-21T12:35:34.000Z</published>
    <updated>2023-04-21T12:37:22.477Z</updated>
    
    <content type="html"><![CDATA[<h1>MAC M1 安装Oracle数据库教程</h1><p><strong>oracle目前还没有支持M1的版本, 本教程使用SSH来远程登录oracle服务器</strong></p><ol><li>在开始之前, 请确保你的mac安装了parallels Desktop, 并安装windows系统</li><li>如果你身边有windows环境, 比如你的室友的电脑, 你可以跳过1.</li><li>在windows电脑中安装Oracle Database Software.</li></ol><h2 id="安装OpenSSH服务">安装OpenSSH服务</h2><p>在window设置中</p><p><em>适用于 Windows Server 2019、Windows 10,11、Windows Server 2022</em></p><p>OpenSSH 是一款用于远程登录的连接工具，它使用 SSH 协议。 它会加密客户端与服务器之间的所有流量，从而遏止窃听、连接劫持和其他攻击。</p><p>OpenSSH 可用于将安装了 OpenSSH 客户端的 Window 10（版本 1809 及更高版本）或 Windows Server 2019 设备连接到那些安装了 OpenSSH 服务器的设备。</p><h3 id="使用windous设置安装OpenSSSH">使用windous设置安装OpenSSSH</h3><p>可以使用 Windows Server 2019 和 Windows 10 设备上的 Windows 设置安装这两个 OpenSSH 组件。</p><p>若要安装 OpenSSH 组件：</p><ol><li>打开“设置”，选择“应用”&gt;“应用和功能”，然后选择“可选功能” 。</li><li>扫描列表，查看是否已安装 OpenSSH。 如果未安装，请在页面顶部选择“添加功能”，然后：<ul><li>查找“OpenSSH 客户端”，再单击“安装”</li><li>查找“OpenSSH 服务器”，再单击“安装”</li></ul></li></ol><p>设置完成后，回到“应用”&gt;“应用和功能”和“可选功能”，你应会看到已列出 OpenSSH 。</p><p><em>安装 OpenSSH 服务器将创建并启用一个名为 <code>OpenSSH-Server-In-TCP</code> 的防火墙规则。 这允许端口 22 上的入站 SSH 流量。 如果未启用此规则且未打开此端口，那么连接将被拒绝或重置。</em></p><h3 id="使用PowerShell安装OpenSSH">使用PowerShell安装OpenSSH</h3><p>若要使用 PowerShell 安装 OpenSSH，请先以管理员身份运行 PowerShell。 为了确保 OpenSSH 可用，请运行以下 cmdlet：</p><pre class="language-bash" data-language="bash"><code class="language-bash">Get-WindowsCapability <span class="token parameter variable">-Online</span> <span class="token operator">|</span> Where-Object Name <span class="token parameter variable">-like</span> <span class="token string">'OpenSSH*'</span></code></pre><p>如果两者均尚未安装，则此操作应返回以下输出：</p><pre class="language-bash" data-language="bash"><code class="language-bash">Name  <span class="token builtin class-name">:</span> OpenSSH.Client~~~~0.0.1.0State <span class="token builtin class-name">:</span> NotPresentName  <span class="token builtin class-name">:</span> OpenSSH.Server~~~~0.0.1.0State <span class="token builtin class-name">:</span> NotPresent</code></pre><p>然后，根据需要安装服务器或客户端组件：</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Install the OpenSSH Client</span>Add-WindowsCapability <span class="token parameter variable">-Online</span> <span class="token parameter variable">-Name</span> OpenSSH.Client~~~~0.0.1.0<span class="token comment"># Install the OpenSSH Server</span>Add-WindowsCapability <span class="token parameter variable">-Online</span> <span class="token parameter variable">-Name</span> OpenSSH.Server~~~~0.0.1.0</code></pre><p>这两者应该都会返回以下输出：</p><pre class="language-bash" data-language="bash"><code class="language-bash">Path          <span class="token builtin class-name">:</span>Online        <span class="token builtin class-name">:</span> TrueRestartNeeded <span class="token builtin class-name">:</span> False</code></pre><h2 id="启动并配置-OpenSSH-服务器">启动并配置 OpenSSH 服务器</h2><p>若要启动并配置 OpenSSH 服务器来开启使用，请以管理员身份打开 PowerShell，然后运行以下命令来启动 <code>sshd service</code>：</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Start the sshd service</span>Start-Service sshd<span class="token comment"># OPTIONAL but recommended:</span>Set-Service <span class="token parameter variable">-Name</span> sshd <span class="token parameter variable">-StartupType</span> <span class="token string">'Automatic'</span><span class="token comment"># Confirm the Firewall rule is configured. It should be created automatically by setup. Run the following to verify</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>Get-NetFirewallRule <span class="token parameter variable">-Name</span> <span class="token string">"OpenSSH-Server-In-TCP"</span> <span class="token parameter variable">-ErrorAction</span> SilentlyContinue <span class="token operator">|</span> Select-Object Name, Enabled<span class="token punctuation">))</span> <span class="token punctuation">&#123;</span>    Write-Output <span class="token string">"Firewall Rule 'OpenSSH-Server-In-TCP' does not exist, creating it..."</span>    New-NetFirewallRule <span class="token parameter variable">-Name</span> <span class="token string">'OpenSSH-Server-In-TCP'</span> <span class="token parameter variable">-DisplayName</span> <span class="token string">'OpenSSH Server (sshd)'</span> <span class="token parameter variable">-Enabled</span> True <span class="token parameter variable">-Direction</span> Inbound <span class="token parameter variable">-Protocol</span> TCP <span class="token parameter variable">-Action</span> Allow <span class="token parameter variable">-LocalPort</span> <span class="token number">22</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    Write-Output <span class="token string">"Firewall rule 'OpenSSH-Server-In-TCP' has been created and exists."</span><span class="token punctuation">&#125;</span></code></pre><h2 id="连接到-OpenSSH-服务器">连接到 OpenSSH 服务器</h2><p>mac自带SSH服务, 所以安装后，可以使用MAC连接到 OpenSSH 服务器, 在终端中运行一下命令:</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> username@ipadress <span class="token comment">#username是安装了Oracle的windows电脑的用户名</span><span class="token comment">#ipaddress是该电脑的ip地址</span></code></pre><p>可以通过在windows的PowerShell中运行以下命令来查看ip地址:</p><pre class="language-bash" data-language="bash"><code class="language-bash">ipconfig</code></pre><p>安装要求输入密码, 注意是微软用户的密码, 不是电脑的开机密码</p><p>连接后，你将看到 Windows 命令行界面提示符：</p><pre class="language-bash" data-language="bash"><code class="language-bash">domain<span class="token punctuation">\</span>username@SERVERNAME C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>username<span class="token operator">></span></code></pre><h2 id="用户登录Oracle数据库">用户登录Oracle数据库</h2><p>c成功链接后, 在终端输入:</p><pre class="language-bash" data-language="bash"><code class="language-bash">sqlplus / as sysdba</code></pre><p>按照提示输入用户名:</p><pre class="language-bash" data-language="bash"><code class="language-bash">sys as sysdba </code></pre><p>并按照提示输入口令, 这个口令是在你安装Orecle软件的过程中设置的.</p><p>产生一下输出则链接成功</p><pre class="language-bash" data-language="bash"><code class="language-bash">连接到: Oracle Database 11g Enterprise Edition Release <span class="token number">11.2</span>.0.1.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing options</code></pre><p>使用<code>ctrl</code>+<code>c</code>退出sql服务, 输入<code>exit</code>退出ssh链接</p><h2 id="用Navicat远程登陆Oracle数据库">用Navicat远程登陆Oracle数据库</h2><p>打开Navicat, 左上角选择, 之后选择Oracle.</p><p>链接名请随意填写, 主机位置填入localhost, 端口默认为1521</p><p>服务名默认为ORCL, 如果你在安装Oracle中没有更改, 则保持不变, 我的改为了ORACLE</p><p>角色选择SYSDBA,用户名为sys, 密码就是之前提到的口令.</p><img src="/Users/trevorwu/Library/Application Support/typora-user-images/image-20220929221736551.png" alt="image-20220929221736551" style="zoom:50%;" loading="lazy"><p>点击SSH选项</p><img src="/Users/trevorwu/Library/Application Support/typora-user-images/image-20220929221807569.png" alt="image-20220929221807569" style="zoom:50%;" loading="lazy"><p>主机填入windows主机的IP地址, 端口默认22, 用户名是windows账户的用户名, 密码是该账户的密码</p><p>点击链接测试, 成功链接后点击保存即可.</p>]]></content>
    
    
    <summary type="html">oracle目前还没有支持M1的版本, 本教程使用SSH来远程登录oracle服务器</summary>
    
    
    
    <category term="mac使用指南" scheme="https://trevoewu.github.io/categories/mac%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
    
    
    <category term="mac使用指南" scheme="https://trevoewu.github.io/tags/mac%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
    
    <category term="oracle" scheme="https://trevoewu.github.io/tags/oracle/"/>
    
    <category term="教程" scheme="https://trevoewu.github.io/tags/%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
</feed>
