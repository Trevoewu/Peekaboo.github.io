<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ¥¼å…°</title>
  
  
  <link href="https://trevoewu.github.io/atom.xml" rel="self"/>
  
  <link href="https://trevoewu.github.io/"/>
  <updated>2023-10-11T03:03:20.884Z</updated>
  <id>https://trevoewu.github.io/</id>
  
  <author>
    <name>æ¥¼å…°</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ğŸ“”iDictionary</title>
    <link href="https://trevoewu.github.io/2023/10/10/iDictionary/"/>
    <id>https://trevoewu.github.io/2023/10/10/iDictionary/</id>
    <published>2023-10-10T13:14:49.000Z</published>
    <updated>2023-10-11T03:03:20.884Z</updated>
    
    <content type="html"><![CDATA[<p>ğŸ“”</p><h2 id="Upset">Upset</h2><h3 id="Upset-n">Upset n.</h3><ol><li><strong>an unhappy and worried mental stateupğŸ˜­</strong><br>she didnâ€™t realize the upset she caused me</li></ol><p><em>synonymous</em>ï¼š <strong>disturbance</strong>, <strong>perturbation</strong></p><ol start="2"><li>==the act of <strong>disturbing</strong> the mind or body==<br>his carelessness could have caused an ecological upset</li></ol><p><em>synonymous</em>ï¼š <strong>derangement</strong>, <strong>overthrow</strong></p><ol start="3"><li><strong>condition in which there is a disturbance of normal functioning</strong><br>everyone gets stomach upsets from time to time</li></ol><p><em>synonymous</em>ï¼š disorder</p><ol start="4"><li><p>a tool used to thicken or spread metal (the end of a bar or a rivet etc.) by <strong>forging</strong> or <strong>hammering</strong> or <strong>swaging</strong></p><img src="5c5e80be6839dfa92a7391ed0f182e1d_z.jpg" alt="Upset Stretching Device - Standard/Profi 70 mm - Complete Device incl. Upset+Stretching  Tool" style="zoom:25%;" loading="lazy"></li></ol><p><em>synonymous</em>ï¼š swage</p><ol start="5"><li><strong>the act of upsetting something</strong><br>he was badly bruised by the upset of his sled at a high speed</li></ol><p><em>synonymous</em>ï¼š overturn, turnover</p><ol start="6"><li><strong>an improbable and unexpected victory</strong><br>the biggest upset since David beat Goliath</li></ol><p><em>synonymous</em>ï¼š overturn</p><h3 id="upset-v">upset v.</h3><ol><li><p><strong>disturb the balance or stability of</strong><br>The <strong>hostile</strong> talks upset the peaceful relations between the two countries</p></li><li><p><strong>cause to lose oneâ€™s composure</strong></p></li></ol><p><em>synonymous</em>ï¼š discompose, untune, disconcert, discomfit</p><ol start="3"><li>move deeply[æ·±æ·±çš„æ‰“åŠ¨]<br>This book upset me</li></ol><p><em>synonymous</em>ï¼š disturb, trouble</p><ol start="4"><li><p><strong>cause to overturn from an upright or normal position</strong></p><img src="image-20231010214409000.png" alt="image-20231010214409000" style="zoom:25%;" loading="lazy"></li></ol><p><em>synonymous</em>ï¼š overturn, tip over, turn over, knock over, bowl over, tump over</p><ol start="5"><li><strong>defeat suddenly and unexpectedly</strong><br>The foreign team upset the local team</li></ol><h3 id="upset-adj">upset adj.</h3><ol><li><strong>afflicted with or marked by anxious uneasiness or trouble or grief</strong><br>too upset to say anything</li></ol><p><em>synonymous</em>ï¼š disquieted, distressed, disturbed, worried</p><ol start="2"><li><strong>thrown into a state of disarray or confusion</strong><br>with everything so upset</li></ol><p><em>synonymous</em>ï¼š broken, confused, disordered</p><ol start="3"><li><strong>used of an unexpected defeat of a team favored to win</strong><br>the Billsâ€™ upset victory over the Houston Oilers</li></ol><ul><li><p>mildly physically distressed<br>an upset stomach</p></li><li><p>having been turned so that the bottom is no longer the bottom<br>the upset pitcher of milk</p></li></ul><p><em>synonymous</em>ï¼š overturned, upturned</p><h2 id="Justice">Justice</h2><img src="11-justice.png" alt="Justice Tarot Card Meanings | Biddy Tarot" style="zoom:25%;" loading="lazy"><h3 id="justice-n">justice n.</h3><ol><li><strong>the quality of being just or fair</strong></li></ol><p>synonymousï¼š justness</p><ol start="2"><li><strong>the administration of law; the act of determining rights and assigning rewards or punishments</strong><br>justice <strong>deferred</strong> is justice denied</li></ol><p>synonymousï¼š judicature</p><ol start="3"><li><strong>a public official authorized to decide questions brought before a court of justice</strong></li></ol><p>synonymousï¼š judge, jurist, magistrate</p><h2 id="Ethical">Ethical</h2><h3 id="ethical-adj">ethical adj.</h3><ol><li><strong>of or relating to the philosophical study of ethics</strong><br>==ethical codes==<br>==ethical theories==</li><li><strong>conforming to accepted standards of social or professional behavior</strong><br>an ethical lawyer<br>ethical medical practice<br>an ethical problem<br>had no ethical objection to drinking<br>Ours is a world of nuclear giants and ethical infants</li><li><strong>adhering to ethical and moral principles</strong><br>it seems ethical and right</li></ol><p>synonymousï¼š honorable, honourable, moral</p><h2 id="Legitim-acy">Legitim-acy</h2><blockquote><p>è¯æ ¹&quot;legitim&quot;æ¥è‡ªæ‹‰ä¸è¯­&quot;legitimus&quot;ï¼Œæ„ä¸º&quot;åˆæ³•çš„&quot;æˆ–&quot;æ­£å½“çš„&quot;ã€‚è¿™ä¸ªè¯æ ¹æŒ‡ç¤ºäº†legitimacyçš„åŸºæœ¬å«ä¹‰ï¼Œå³åˆæ³•æ€§æˆ–åˆç†æ€§ã€‚</p><p>è¯ç¼€&quot;-acy&quot;æ˜¯ä¸€ä¸ªåè¯åç¼€ï¼Œç”¨äºå°†ä¸€ä¸ªå½¢å®¹è¯è½¬åŒ–ä¸ºä¸€ä¸ªåè¯ã€‚</p></blockquote><ol><li><strong>åˆæ³•æ€§ï¼Œåˆæ³•åœ°ä½</strong><br>è¿‘ä¹‰è¯ï¼švalidity, legality<br>åä¹‰è¯ï¼šillegitimacy<br>ä¾‹å¥ï¼š</li></ol><ul><li>The governmentâ€™s legitimacy was questioned after <strong>allegations</strong> of electoral <strong>fraud</strong>.</li><li>The courtâ€™s decision confirmed the legitimacy of the contract.</li></ul><h2 id="Con-duct">Con-duct</h2><blockquote><p>è¯æ ¹ï¼šconductçš„è¯æ ¹æ˜¯â€œcon-â€ï¼Œå®ƒæºè‡ªæ‹‰ä¸è¯­ä¸­çš„â€œconducereâ€ï¼Œæ„ä¸ºâ€œå¼•å¯¼ã€å¸¦é¢†â€ã€‚è¿™ä¸ªè¯æ ¹è¡¨è¾¾äº†è¡Œä¸ºæˆ–è¿‡ç¨‹ä¸­å¼•å¯¼ã€å¸¦é¢†çš„æ„ä¹‰ã€‚</p><p>è¯æºï¼šconductçš„è¯æºå¯ä»¥è¿½æº¯åˆ°æ‹‰ä¸è¯­ä¸­çš„â€œconductusâ€ï¼Œæ„ä¸ºâ€œå¼•å¯¼ã€å¸¦é¢†â€ã€‚è¿™ä¸ªè¯æºè¿›ä¸€æ­¥æ¥è‡ªæ‹‰ä¸è¯­ä¸­çš„â€œconducereâ€ï¼Œæ„ä¸ºâ€œå¸¦é¢†ã€å¼•å¯¼â€ï¼Œç”±â€œcon-â€ï¼ˆå…±åŒï¼‰å’Œâ€œducereâ€ï¼ˆå¼•å¯¼ï¼‰ç»„æˆã€‚</p></blockquote><h3 id="conduct-n">conduct n.</h3><ol><li><p><strong>manner of acting or controlling yourself</strong></p><p>==The code of conduct== è¡Œä¸ºå‡†åˆ™</p></li></ol><p>synonymousï¼š behavior, behaviour, doings</p><ol start="2"><li><strong>(behavioral attributes) the way a person behaves toward other people</strong></li></ol><p>synonymousï¼š <strong>demeanor</strong>, behavior, <strong>deportment</strong></p><h3 id="conduct-v">conduct v.</h3><ol><li><strong>direct the course of; manage or control</strong><br>You cannot conduct business like this</li></ol><p>synonymousï¼š carry on, deal</p><ol start="2"><li><strong>lead, as in the performance of a composition</strong><br>conduct an orchestra<br>Barenboim conducted the Chicago symphony for years</li></ol><p>synonymousï¼š lead, direct</p><ol start="3"><li><strong>behave in a certain manner</strong><br>They conducted themselves well during these difficult times</li></ol><p>synonymousï¼š behave, <strong>acquit</strong>, bear, <strong>deport</strong>, <strong>comport</strong>, carry</p><ol start="4"><li><strong>transmit or serve as the medium for transmission</strong><br>Many metals conduct heat<img src="Types-of-Heat-Transfer-1024x683-20231011104745952.png" alt="Types of Heat Transfer" style="zoom:45%;" loading="lazy"></li></ol><p>synonymousï¼š transmit, convey, carry, channel</p><ol start="5"><li><strong>take somebody somewhere</strong><br>He conducted us to the palace</li></ol><p>synonymousï¼š lead, take, direct, guide</p><ol start="6"><li><strong>lead musicians in the performance of</strong><br>Bernstein conducted Mahler like no other conductor<br>she cannot conduct modern pieces</li></ol><h2 id="Judic-iary">Judic-iary</h2><img src="organiazation-of-the-judiciary.jpg" alt="Organization Of The Judiciary - Political Science" style="zoom:45%;" loading="lazy"><blockquote><p>è¯æ ¹&quot;judic-â€œï¼Œæ¥è‡ªæ‹‰ä¸è¯­è¯æ ¹&quot;iudiciumâ€ï¼Œæ„ä¸º&quot;è£å®šã€åˆ¤å†³ã€åˆ¤æ–­&quot;ã€‚&quot;Judic-â€œä½œä¸ºä¸€ä¸ªè¯æ ¹ï¼Œå¸¸åœ¨ä¸æ³•å¾‹ã€å¸æ³•ç­‰é¢†åŸŸçš„è¯æ±‡ä¸­å‡ºç°ï¼Œä¾‹å¦‚&quot;judgeâ€ï¼ˆæ³•å®˜ï¼‰ã€â€œjudgmentâ€ï¼ˆåˆ¤å†³ã€åˆ¤æ–­ï¼‰ç­‰ã€‚</p><p>è¯ç¼€&quot;-ary&quot;ï¼Œè¡¨ç¤º&quot;ä¸â€¦æœ‰å…³çš„&quot;æˆ–&quot;æŸä¸ªé¢†åŸŸçš„&quot;ã€‚åœ¨è¿™ä¸ªå•è¯ä¸­ï¼Œ&quot;-ary&quot;è¡¨æ˜&quot;judiciary&quot;æ˜¯ä¸å¸æ³•ç³»ç»Ÿç›¸å…³çš„äº‹ç‰©ï¼Œæ˜¯æŒ‡æ³•é™¢ã€æ³•å®˜ã€æ³•åº­å’Œå…¶ä»–å¸æ³•æœºæ„çš„é›†åˆã€‚</p></blockquote><ol><li>ä¸­æ–‡æ„æ€ï¼šå¸æ³•ï¼ˆæœºæ„/éƒ¨é—¨ï¼‰</li></ol><ul><li><p>è¿‘ä¹‰è¯ï¼šæ³•å®˜å›¢é˜Ÿ</p></li><li><p>åä¹‰è¯ï¼šè¡Œæ”¿éƒ¨é—¨</p></li><li><p>ä¾‹å¥ï¼š</p></li><li><p>The judiciary plays a vital role in <strong>upholding</strong> <strong>the rule of law.</strong></p></li><li><p>The appointment of judges is a <strong>crucial</strong> decision for the judiciary.ï¼ˆâ€œæ³•å®˜å›¢é˜Ÿâ€æ„ä¹‰ä¸‹çš„ä½¿ç”¨ï¼‰</p></li></ul><h2 id="sub-ject">sub-ject</h2><blockquote><p>subjectæºè‡ªæ‹‰ä¸è¯­çš„â€œsubjectusâ€ï¼Œæ„ä¸ºâ€œè¢«ç½®äºä¸‹æ–¹çš„â€ã€‚åœ¨æ‹‰ä¸è¯­ä¸­ï¼Œè¿™ä¸ªè¯å½¢å®¹ä¸€ç§è¢«å¾æœæˆ–è¢«æ§åˆ¶çš„çŠ¶æ€ã€‚</p><ol><li><p>è¯æ ¹â€œsub-â€è¡¨ç¤ºâ€œåœ¨ä¸‹æ–¹â€ï¼Œæ¬¡çº§çš„æ„æ€ã€‚åœ¨subjectä¸­ï¼Œè¯æ ¹â€œsub-â€è¡¨è¾¾äº†è¢«ç½®äºæˆ–å—æ§åˆ¶çš„çŠ¶æ€ã€‚</p></li><li><p>è¯ç¼€â€œ-jectâ€è¡¨ç¤ºâ€œæŠ•æ·â€æˆ–â€œæ”¾ç½®â€ã€‚åœ¨subjectä¸­ï¼Œè¯ç¼€â€œ-jectâ€è¡¨ç¤ºæŸäººæˆ–æŸäº‹è¢«æ”¾ç½®æˆ–å®‰ç½®åœ¨æŸç§æƒ…å†µæˆ–æ¡ä»¶ä¹‹ä¸‹ã€‚</p></li></ol></blockquote><h3 id="subject-n">subject n.</h3><ol><li><strong>the subject matter of a conversation or discussion</strong><br>he didnâ€™t want to discuss that subject</li></ol><p>synonymousï¼š topic, theme</p><ol start="2"><li><strong>a branch of knowledge</strong><br>teachers should be well trained in their subject</li></ol><p>synonymousï¼š <strong>discipline</strong>, subject area, subject field, field, field of study, study, <strong>bailiwick</strong>, branch of knowledge</p><ol start="4"><li><strong>something (a person or object or scene) selected by an artist or photographer for graphic representation</strong><br>a moving picture of a train is more dramatic than a still picture of the same subject</li></ol><p>synonymousï¼š content, depicted object</p><ol start="5"><li><strong>a person who is subjected to experimental or other observational procedures; someone who is an object of investigation</strong><br>the subjects for this investigation were selected randomly</li></ol><p>synonymousï¼š case, <strong>guinea pig</strong></p><blockquote><p>guinea pig: è±šé¼ ï¼šä¸€ç§å°å‹ã€çŸ®èƒ–ã€æ— å°¾å·´çš„å®¶å…»å•®é½¿åŠ¨ç‰©ï¼ˆCavia porcellusï¼‰ï¼ŒåŸäº§äºå—ç¾æ´²ï¼Œé€šå¸¸ä½œä¸ºå® ç‰©é¥²å…»ï¼Œå¹¶å¹¿æ³›ç”¨äºç”Ÿç‰©ç ”ç©¶ã€‚</p><img src="image-20231011101659564.png" alt="image-20231011101659564" style="zoom:10%;" loading="lazy"></blockquote><ol start="6"><li><p><strong>a person who owes allegiance to that nation[è‡£æ°‘]</strong><br>a monarch has a duty to his subjects</p><img src="image-20231011101819551.png" alt="image-20231011101819551" style="zoom:35%;" loading="lazy"></li></ol><p>synonymousï¼š national</p><ol start="7"><li>(<em>grammar</em>) one of the two main <strong>constituents</strong> of a sentence; the grammatical constituent about which something is <strong>predicated</strong></li><li>(logic) the first term of a proposition</li></ol><h3 id="subject-v">subject v.</h3><ol><li><strong>cause to experience or suffer or make liable or vulnerable to</strong><br>He subjected me to his awful poetry<br>The <strong>sergeant</strong> subjected the new recruits to many <strong>drills</strong><br>People in Chernobyl were subjected to radiation</li><li><strong>make accountable for</strong><br>He did not want to subject himself to the judgments of his superiors</li><li><strong>make subservient; force to submit or subdue</strong></li></ol><p>synonymousï¼š <strong>subjugate</strong></p><ol start="4"><li><strong>refer for judgment or consideration</strong></li></ol><p>synonymousï¼š submit</p><h3 id="subject-adj">subject adj.</h3><ol><li><strong>not exempt from tax</strong><br>the gift will ==be subject to== taxation</li><li><strong>possibly accepting or permitting</strong><br>the time is fixed by the director and players and therefore <strong>subject to much variation</strong></li></ol><p>synonymousï¼š capable, open</p><ol start="3"><li><strong>being under the power or sovereignty of another or others</strong><br>subject peoples</li></ol><p>synonymousï¼š dependent</p><ol start="4"><li><strong>likely to be affected by something (especially something unpleasant)</strong><br>the bond is subject to taxation<br>he is subject to <strong>fits</strong> of depression</li></ol><h2 id="Envision">Envision</h2><h3 id="envision-v">envision v.</h3><ol><li><strong>imagine; conceive of; see in oneâ€™s mind</strong></li></ol><p>synonymousï¼š visualize, visualise, project, fancy, see, figure, picture, image</p><ol start="2"><li><strong>picture to oneself; imagine possible</strong><br>I cannot envision him as President</li></ol><p>synonymousï¼š foresee</p><h2 id="Cultivate">Cultivate</h2><img src="Cultivate.jpg" alt="Cultivate.jpg" style="zoom:50%;" loading="lazy"><p>cultivate | ËˆkÊŒltÉªveÉªt | verb <em>[with object]</em></p><ol><li><p><strong>prepare and use (land) for crops or gardening:</strong></p><p><em>the peasants who cultivated the land became its owners</em>.</p><p>â€¢ <strong>break up (soil) in preparation for sowing or planting</strong>:</p><p>(as adjective, with submodifier cultivated) : <em>damp, well-cultivated soil</em>.</p><p><strong>â€¢ raise or grow (plants), especially on a large scale for commercial purposes:</strong></p><p><em>they were encouraged to cultivate basic food crops</em> |</p><p><em>walnuts were cultivated for salad oil</em>.</p><p><strong>â€¢ <em>Biology</em> grow or maintain (living cells or tissue) in culture</strong></p><p>: <em>blood cells that can be most easily cultivated are macrophages</em>.</p></li><li><p><strong>try to acquire or develop (a quality or skill)</strong></p></li></ol><p>: <em>he cultivated <strong>an air of indifference</strong></em>.</p><p><strong>â€¢ try to win the friendship or favour of (someone):</strong></p><pre><code>*it helps if you go out of your way to cultivate the local people*.**â€¢ try to improve or develop (one's mind).**</code></pre><h2 id="Ideology">Ideology</h2><p><img src="Destutt_de_Tracy.jpg" alt="undefined" loading="lazy"></p><p>An <strong>ideology</strong> is a set of <a href="https://en.wikipedia.org/wiki/Belief">beliefs</a> or philosophies attributed to a person or group of persons, especially those held for reasons that are not purely <a href="https://en.wikipedia.org/wiki/Epistemic">epistemic</a>, in which &quot;practical elements are as prominent as theoretical ones.&quot;Formerly applied primarily to <a href="https://en.wikipedia.org/wiki/Economy">economic</a>, <a href="https://en.wikipedia.org/wiki/Political_philosophy">political</a>, or <a href="https://en.wikipedia.org/wiki/Religion">religious</a> theories and policies, in a tradition going back to <a href="https://en.wikipedia.org/wiki/Karl_Marx">Karl Marx</a> and <a href="https://en.wikipedia.org/wiki/Friedrich_Engels">Friedrich Engels</a>, more recent use treats the term as mainly condemnatory</p><p>æ„è¯†å½¢æ€æ˜¯å½’å› äºä¸€ä¸ªäººæˆ–ä¸€ç¾¤äººçš„ä¸€å¥—ä¿¡ä»°æˆ–å“²å­¦ï¼Œç‰¹åˆ«æ˜¯é‚£äº›å‡ºäºéçº¯ç²¹è®¤è¯†è®ºçš„åŸå› è€ŒæŒæœ‰çš„ä¿¡ä»°æˆ–å“²å­¦ï¼Œ å…¶ä¸­â€œå®è·µå› ç´ ä¸ç†è®ºå› ç´ ä¸€æ ·çªå‡ºâ€ã€‚ ä»¥å‰ä¸»è¦åº”ç”¨äºç»æµï¼Œæ”¿æ²»æˆ–å®—æ•™ç†è®ºå’Œæ”¿ç­–ï¼Œå…¶ä¼ ç»Ÿå¯ä»¥è¿½æº¯åˆ°å¡å°”é©¬å…‹æ€å’Œå¼—é‡Œå¾·é‡Œå¸Œæ©æ ¼æ–¯ï¼Œ<strong>æœ€è¿‘çš„ä½¿ç”¨å°†è¿™ä¸ªè¯è§†ä¸ºä¸»è¦æ˜¯è°´è´£æ€§çš„ã€‚</strong></p><p>The term was coined by <a href="https://en.wikipedia.org/wiki/Antoine_Destutt_de_Tracy">Antoine Destutt de Tracy</a>, a <a href="https://en.wikipedia.org/wiki/French_people">French</a> <a href="https://en.wikipedia.org/wiki/Age_of_Enlightenment">Enlightenment</a> <a href="https://en.wikipedia.org/wiki/Aristocracy_(class)">aristocrat</a> and <a href="https://en.wikipedia.org/wiki/Philosopher">philosopher</a>, who conceived it in 1796 as the â€œscience of ideasâ€ to develop a rational system of ideas to oppose the irrational impulses of the mob. In <a href="https://en.wikipedia.org/wiki/Political_science">political science</a>, the term is used in a <a href="https://en.wikipedia.org/wiki/Linguistic_description">descriptive</a> sense to refer to <a href="https://en.wikipedia.org/wiki/List_of_political_ideologies">political belief systems</a></p><p>è¿™ä¸ªè¯æ˜¯ç”±æ³•å›½å¯è’™è¿åŠ¨è´µæ—å’Œå“²å­¦å®¶å®‰æ‰˜ä¸‡Â·å¾·æ–¯å›¾ç‰¹Â·å¾·Â·ç‰¹é›·è¥¿ï¼ˆAntoine Destutt de Tracyï¼‰åˆ›é€ çš„ï¼Œä»–åœ¨1796å¹´å°†å…¶è®¾æƒ³ä¸ºâ€œæ€æƒ³ç§‘å­¦â€ï¼Œä»¥å‘å±•ä¸€ç§ç†æ€§çš„æ€æƒ³ä½“ç³»ï¼Œä»¥åå¯¹æš´æ°‘çš„éç†æ€§å†²åŠ¨ã€‚åœ¨æ”¿æ²»å­¦ä¸­ï¼Œè¯¥æœ¯è¯­ç”¨äºæè¿°æ€§æ„ä¹‰ï¼ŒæŒ‡ä»£æ”¿æ²»ä¿¡ä»°ä½“ç³»ã€‚</p>]]></content>
    
    
    <summary type="html">ä¸€æœ¬è‡ªå·±çš„è¯ä¹¦ï¼Œç›¸é‡æ¥è‡ªè€ƒç ”è¯æ±‡</summary>
    
    
    
    <category term="è€ƒç ”" scheme="https://trevoewu.github.io/categories/%E8%80%83%E7%A0%94/"/>
    
    
    <category term="è€ƒç ”" scheme="https://trevoewu.github.io/tags/%E8%80%83%E7%A0%94/"/>
    
    <category term="è‹±è¯­å­¦ä¹ " scheme="https://trevoewu.github.io/tags/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>å¿…è¦çš„è®°å½•-åˆ«åœä¸‹æ¥</title>
    <link href="https://trevoewu.github.io/2023/09/10/%E5%BF%85%E8%A6%81%E7%9A%84%E8%AE%B0%E5%BD%95/"/>
    <id>https://trevoewu.github.io/2023/09/10/%E5%BF%85%E8%A6%81%E7%9A%84%E8%AE%B0%E5%BD%95/</id>
    <published>2023-09-10T14:35:27.000Z</published>
    <updated>2023-09-17T14:39:53.780Z</updated>
    
    <content type="html"><![CDATA[<p>æ—©ä¸Šèµ·åºŠï¼Œæˆ‘æƒ³ä¹Ÿä¸èƒ½ç§°ä¹‹ä¸ºæ—©ä¸Šï¼Œå‘ç°æ˜¨å¤©å¼€å§‹çš„ç—‡çŠ¶å¹¶æ²¡æœ‰å‡è½»ã€‚æ˜¨å¤©æ—©ä¸Šå¼€å§‹ï¼Œå±è‚¡çœ¼é‡Œçš„è‚Œè‚‰ä¾¿å¼€å§‹ä¸å—æ§åˆ¶çš„çš„ç­‹æŒ›ï¼Œå¥½åƒåœ¨æ˜­ç¤ºè‡ªå·±çš„å­˜åœ¨èˆ¬ã€‚è™½ä¸ä¸¥é‡ï¼Œä½†æ€»è®©æˆ‘å¿ƒçƒ¦ï¼Œå®Œå…¨æ²¡æ³•æ²‰æµ¸åœ¨çœ¼å‰çš„å­¦ä¹ ä¸­ã€‚</p><p>ä¸Šæ¬¡è¿™ç§æƒ…å†µå‡ºç°æ˜¯åœ¨æˆ‘ä¸€æ®µç”Ÿæ´»æå…¶ä¸è§„å¾‹çš„æ—¶å…‰ï¼Œä½†ï¼Œè¿™æ®µæ—¶é—´æˆ‘æˆ‘çš„ç”Ÿæ´»ç›¸å½“è§„å¾‹å§ã€‚æ¯å¤©ä¸€ç‚¹ç¡ï¼Œæ—©ä¸Šåç‚¹èµ·ï¼Œåº”è¯¥å¯¹äºä¸€ä¸ªå¤§å­¦ç”Ÿæ¥è¯´ç›¸å½“å¥½äº†ã€‚</p><p>ä½†æƒ…å†µä¾æ—§å‘ç”Ÿäº†ï¼Œæ—©ä¸Šå»äº†å›¾ä¹¦é¦†ï¼Œåšä¸äº†å‡ åˆ†é’Ÿä¾¿è¢«å¹²æ‰°å¾—å¿ƒçƒ¦æ„ä¹±ã€‚å½»åº•æ”¾ä¸‹ç¬”ï¼ŒèƒŒç€ä¹¦åŒ…ç¦»å¼€äº†å›¾ä¹¦é¦†ã€‚æƒ³ç€åšç‚¹ä»€ä¹ˆè¿åŠ¨ï¼Œæˆ‘ç¡®å®ä¹Ÿå¥½ä¹…æ²¡è¿åŠ¨äº†ã€‚åšç‚¹ä»€ä¹ˆå‘¢ï¼Œçªç„¶æ„Ÿè§‰å¾ˆé—æ†¾ï¼Œæ²¡ä»€ä¹ˆè¿åŠ¨å¯åšå•Šã€‚æˆ‘ä¼šçš„ä¹Ÿå°±åªæœ‰ç¾½æ¯›çƒå’Œä¹’ä¹“çƒã€‚ç°åœ¨ï¼Œç¾½æ¯›çƒæ²¡æœ‰æ‹ï¼Œä¹’ä¹“çƒåœºé¦†å°±æ²¡è§å­¦æ ¡å¼€è¿‡å‡ æ¬¡ï¼ŒçœŸä¸çŸ¥é“å­¦æ ¡ä¿®è¿™ä¹ˆè±ªåçš„ä½“è‚²é¦†æœ‰ä»€ä¹ˆç”¨äº†ã€‚åˆ©ç”¨ç‡æœ€é«˜çš„æ—¶å€™ææ€•æ˜¯ç–«æƒ…æ—¶å€™è¢«ç”¨æ¥åšæ ¸é…¸å§ã€‚</p><hr><p>Dear Wilbur,</p><p><strong>I am thrilled to learn of</strong> your interest in <strong>seeking employment opportunities</strong> in my country, China, which <strong>is undergoing rapid development and brimming with possibilities</strong>. <strong>I have a few suggestions that I would like to share with you.</strong></p><p><strong>Primarily</strong>, <strong>ensure that you pursue a profession that suits your preferences.</strong> <strong>China being a vast and diversified economy</strong>, you can certainly find a job that <strong>aligns with your interests</strong>. Additionally, try to <strong>exhibit a positive attitude</strong> while <strong>presenting your resume</strong>. If you receive no response after submitting a document to a <strong>prospective</strong> employer, it may <strong>leave you feeling perplexed and rejected</strong>. However, do not lose heart and continue to <strong>hone the skills you lack</strong>, and <strong>persist in your pursuit of employment</strong>. Congratulations when you receive an offer! The employer and you <strong>are bound to</strong> <strong>find their match in each other</strong>. Finally, maintain a <strong>healthy lifestyle</strong> while <strong>tackling</strong> the challenges that <strong>lie in store for</strong> you.</p><p>Besides work, China offers a <strong>plethora</strong> of fantastic <strong>cuisine</strong> and social activities. Do not forget to <strong>savour lifeâ€™s little pleasures!</strong></p><p>Sincerely,</p><p>Li Ming.</p><hr><p>This picture depicts that the son feels discouraged by peers comments that opera is not enjoyable at all, but the father thinks it is enough if you and yourself like opera in your heart.</p><p>Children always pay attention to peersâ€™ thoughs unduly when they trying to something them want to do but compare peers  that behaviors are relative strange. Thus children are  easily be influented cause them finally give the thing them loved up. It is important for a yong children to offer them confience and courage when they were confused and though themselves were perculiar.</p><hr><p>The depicted picture portrays a disheartened son who has been discouraged by his peersâ€™ negative opinions on opera. His father, on the other hand, believes that it is enough for one to enjoy opera in their own heart, regardless of what others think.</p><p>It is common for children to be overly concerned with the opinions of their peers, especially when it comes to pursuing interests that may not be widely accepted. However, comparing oneself to others is a peculiar behavior that can ultimately lead to feeling influenced and giving up on what is truly loved. Thus, it is crucial for young children to be instilled with confidence and bravery during moments of confusion or doubt, even in seemingly odd situations.</p><hr><p>The image presented shows a despondent son who has been disheartened by the negative opinions of his peers regarding opera. In contrast, his father believes that it is paramount for an individual to derive pleasure from opera within themselves, irrespective of the views of others.</p><p>Peer pressure is a common phenomenon that affects children, and it can be particularly challenging when a child is interested in something that is not generally applauded. Comparing oneself to peers is a strange habit that often leads to conformity and abandoning what one truly loves. Hence, it is essential to instill self-confidence and bravery in children, particularly when they are unsure of themselves in unusual situations.</p><p>It is imperative to teach children to believe in themselves and follow their hearts, even when others do not understand or approve of their interests. Encouraging children to embrace their passions, hobbies, and talents can help them grow into more fulfilled adults who are capable of pursuing their dreams despite any form of negativity around them.</p><p>In conclusion, children must be taught to follow their aspirations and be brave enough to <strong>march to the beat of their drum</strong>. By doing so, they are more likely to develop a sense of self-awareness, self-love, and self-confidence that will stay with them for life. The depicted image serves as a gentle reminder that it is vital to believe in oneself and live life by oneâ€™s own terms.</p>]]></content>
    
    
    <summary type="html">åˆ«åœä¸‹æ¥ï¼Œè®©å¥‡è¿¹å‘ç”Ÿã€‚</summary>
    
    
    
    <category term="å¿…è¦çš„è®°å½•" scheme="https://trevoewu.github.io/categories/%E5%BF%85%E8%A6%81%E7%9A%84%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="æ—¥è®°" scheme="https://trevoewu.github.io/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Writing Your Own Unix Shell</title>
    <link href="https://trevoewu.github.io/2023/07/09/Writing-Your-Own-Unix-Shell/"/>
    <id>https://trevoewu.github.io/2023/07/09/Writing-Your-Own-Unix-Shell/</id>
    <published>2023-07-09T08:26:25.000Z</published>
    <updated>2023-07-11T11:14:23.397Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Introduce">Introduce</h2><p>è¿™ä¸ªä»»åŠ¡çš„ç›®çš„æ˜¯è®©ä½ æ›´åŠ ç†Ÿæ‚‰è¿›ç¨‹æ§åˆ¶å’Œä¿¡å·ä¼ é€’çš„æ¦‚å¿µã€‚ä½ å°†é€šè¿‡ç¼–å†™ä¸€ä¸ªç®€å•çš„Unix shellç¨‹åºæ¥å®ç°ä½œä¸šæ§åˆ¶ã€‚</p><span id="more"></span><h2 id="ä½¿ç”¨è¯´æ˜">ä½¿ç”¨è¯´æ˜</h2><ol><li><p>è¾“å…¥å‘½ä»¤ <code>tar xvf shlab-handout.tar</code> è§£å‹ tarfileæ–‡ä»¶ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">tar</span> xvf shlab-handout.tar</code></pre></li><li><p>é”®å…¥ make å‘½ä»¤ä»¥ç¼–è¯‘å’Œé“¾æ¥ä¸€äº›æµ‹è¯•ä¾‹ç¨‹ã€‚</p></li><li><p>æŸ¥çœ‹ tsh.c æ–‡ä»¶ï¼Œå®ƒåŒ…å«ä¸€ä¸ªç®€å• Unix shell çš„å‡½æ•°æ¡†æ¶ã€‚ä¸ºäº†å¸®åŠ©ä½ å…¥é—¨ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†ä¸€äº›ä¸é‚£ä¹ˆæœ‰è¶£çš„å‡½æ•°ã€‚ä½ çš„ä»»åŠ¡å°±æ˜¯å®Œæˆä¸‹åˆ—å‡½æ•°ã€‚ä¸ºäº†è®©ä½ è¿›è¡Œä¸€æ¬¡åˆç†æ€§æ£€æŸ¥ï¼Œæˆ‘ä»¬åˆ—å‡ºäº†æˆ‘ä»¬å‚è€ƒè§£å†³æ–¹æ¡ˆä¸­æ¯ä¸ªå‡½æ•°çš„å¤§è‡´ä»£ç è¡Œæ•°ï¼ˆåŒ…æ‹¬å¤§é‡æ³¨é‡Šï¼‰ã€‚</p><ol><li>eval: è§£æå’Œè§£é‡Šå‘½ä»¤è¡Œçš„ Main ä¾‹ç¨‹. [70 è¡Œ]</li><li>builtin cmd: è¯†åˆ«å’Œè§£é‡Šå†…ç½®å‘½ä»¤: quitï¼Œfgï¼Œbgï¼Œand jobs [25 è¡Œ]</li><li>do_bgfg: Implements the bg and fg built-in commands. [50 lines]</li><li>waitfg: ç­‰å¾…å‰å°ä½œä¸šå®Œæˆã€‚[20 è¡Œ]</li><li>sigchld handler: æ•æ‰ SIGCHILD ä¿¡å·ã€‚[80 è¡Œ]</li><li>sigint handler: æ•è·SIGINTï¼ˆctrl-cï¼‰ä¿¡å·ã€‚[15è¡Œ]</li><li>sigtstp handler: æ•æ‰ SIGTSTP (ctrl-z)ä¿¡å·ã€‚[15 è¡Œ]</li></ol></li><li><p>æ¯æ¬¡ä¿®æ”¹ tsh.c æ–‡ä»¶æ—¶ï¼Œè¾“å…¥ make é‡æ–°ç¼–è¯‘å®ƒã€‚è¦è¿è¡Œ shellï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ <code>./tsh</code>:</p><pre class="language-bash" data-language="bash"><code class="language-bash">unix<span class="token operator">></span> ./tsh</code></pre></li></ol><h2 id="tsh-è§„èŒƒ">tsh è§„èŒƒ</h2><p>æ‚¨çš„ tsh shell åº”è¯¥å…·æœ‰ä»¥ä¸‹ç‰¹æ€§:</p><ul><li>æç¤ºç¬¦åº”è¯¥æ˜¯å­—ç¬¦ä¸²â€œ tsh &gt;â€ã€‚</li><li>ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤è¡Œåº”è¯¥åŒ…å«ä¸€ä¸ªåç§°ï¼Œé›¶ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼Œæ‰€æœ‰å‚æ•°éƒ½ç”±ä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼åˆ†éš”ã€‚ å¦‚æœ name æ˜¯ä¸€ä¸ªå†…ç½®å‘½ä»¤ï¼Œé‚£ä¹ˆ tsh åº”è¯¥ç«‹å³å¤„ç†å®ƒå¹¶ç­‰å¾…ä¸‹ä¸€ä¸ªå‘½ä»¤è¡Œã€‚å¦åˆ™ï¼Œtsh åº”è¯¥ å‡å®š name æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ï¼Œå®ƒåœ¨ä¸€ä¸ªåˆå§‹å­è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­åŠ è½½å¹¶è¿è¡Œè¯¥æ–‡ä»¶(åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œæœ¯è¯­ job æŒ‡çš„æ˜¯è¿™ä¸ªåˆå§‹å­è¿›ç¨‹)ã€‚</li><li>tsh ä¸éœ€è¦æ”¯æŒç®¡é“(|)æˆ– i/o é‡å®šå‘(&lt; å’Œ &gt;)ã€‚</li><li>é”®å…¥ ctrl-c (ctrl-z)åº”è¯¥å¯¼è‡´å°† SIGINT (SIGTSTP)ä¿¡å·å‘é€åˆ°å‰å°ä½œä¸šï¼Œä»¥åŠè¯¥ä½œä¸šçš„ä»»ä½•åä»£(ä¾‹å¦‚ï¼Œå®ƒåˆ†å‰çš„ä»»ä½•å­è¿›ç¨‹)ã€‚å¦‚æœæ²¡æœ‰å‰å°ä½œä¸šï¼Œé‚£ä¹ˆè¯¥ä¿¡å·åº”è¯¥æ²¡æœ‰ä½œç”¨ã€‚</li><li>å¦‚æœå‘½ä»¤è¡Œä»¥ &amp; ç»“å°¾ï¼Œé‚£ä¹ˆ tsh åº”è¯¥åœ¨åå°è¿è¡Œä½œä¸šã€‚å¦åˆ™ï¼Œå®ƒåº”è¯¥åœ¨å‰å°è¿è¡Œä½œä¸šã€‚</li><li>æ¯ä¸ªä½œä¸šå¯ä»¥ç”±è¿›ç¨‹ ID (PID)æˆ–ä½œä¸š ID (JID)æ ‡è¯†ï¼Œåè€…æ˜¯ç”± tsh åˆ†é…çš„ä¸€ä¸ªæ­£æ•´æ•°ã€‚Jid åº”è¯¥ åœ¨å‘½ä»¤è¡Œä¸­ç”¨å‰ç¼€â€œ%â€è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œâ€œ% 5â€è¡¨ç¤º JID 5ï¼Œâ€œ5â€è¡¨ç¤º PID 5ã€‚(æˆ‘ä»¬å·²ç»ä¸ºæ‚¨æä¾›äº† æ“çºµå·¥ä½œåˆ—è¡¨æ‰€éœ€çš„æ‰€æœ‰ä¾‹ç¨‹ï¼‰</li><li>tsh åº”è¯¥æ”¯æŒä»¥ä¸‹å†…ç½®å‘½ä»¤:<ul><li>Quit å‘½ä»¤ç»ˆæ­¢ shellã€‚</li><li>Jobs å‘½ä»¤åˆ—å‡ºäº†æ‰€æœ‰çš„åå°å·¥ä½œã€‚</li><li>Bg &lt; job &gt; å‘½ä»¤é€šè¿‡å‘é€ SIGCONT ä¿¡å·é‡å¯ &lt; job &gt; ï¼Œç„¶ååœ¨åå°è¿è¡Œã€‚å‚æ•° &lt; job &gt; å¯ä»¥æ˜¯ PID æˆ– JIDã€‚</li><li>fg &lt; job &gt; å‘½ä»¤é€šè¿‡å‘é€ SIGCONT ä¿¡å·é‡æ–°å¯åŠ¨ &lt; job &gt; ï¼Œç„¶ååœ¨å‰å°è¿è¡Œå®ƒã€‚å‚æ•° &lt; job &gt; å¯ä»¥æ˜¯ PID æˆ– JIDã€‚</li><li>tsh åº”è¯¥å›æ”¶æ‰€æœ‰çš„åƒµå°¸å­è¿›ç¨‹ã€‚å¦‚æœæœ‰ä»»ä½•ä½œä¸šå› æ¥æ”¶åˆ°æœªæ•è·çš„ä¿¡å·è€Œç»ˆæ­¢ï¼Œé‚£ä¹ˆ tsh åº”è¯¥è¯†åˆ«æ­¤äº‹ä»¶ï¼Œå¹¶æ‰“å°ä¸€æ¡åŒ…å«ä½œä¸šçš„ PID å’Œè§¦å‘ä¿¡å·æè¿°çš„æ¶ˆæ¯ã€‚</li></ul></li></ul><h2 id="æ£€æŸ¥ä½ çš„ç¨‹åº">æ£€æŸ¥ä½ çš„ç¨‹åº</h2><p>æˆ‘ä»¬æä¾›äº†ä¸€äº›å·¥å…·æ¥å¸®åŠ©ä½ æ£€æŸ¥ä½ çš„ç¨‹åºã€‚</p><p><strong>å‚è€ƒè§£å†³æ–¹æ¡ˆã€‚</strong></p><p>Linux å¯æ‰§è¡Œæ–‡ä»¶ tshref æ˜¯è¯¥ Shell çš„å‚è€ƒè§£å†³æ–¹æ¡ˆã€‚è¿è¡Œæ­¤ç¨‹åºä»¥è§£ç­”æ‚¨å¯¹æ‚¨çš„ Shell åº”å¦‚ä½•è¡Œä¸ºçš„ä»»ä½•ç–‘é—®ã€‚æ‚¨çš„ Shell åº”ç”Ÿæˆä¸å‚è€ƒè§£å†³æ–¹æ¡ˆå®Œå…¨ç›¸åŒçš„è¾“å‡ºï¼ˆå½“ç„¶ï¼Œé™¤äº†è¿›ç¨‹IDï¼Œå› ä¸ºå®ƒä»¬åœ¨æ¯æ¬¡è¿è¡Œæ—¶ä¼šå˜åŒ–ï¼‰ã€‚</p><p><strong>Shell é©±åŠ¨ç¨‹åº</strong></p><p>sdriver.plç¨‹åºå°†shellä½œä¸ºå­è¿›ç¨‹æ‰§è¡Œï¼Œæ ¹æ®è·Ÿè¸ªæ–‡ä»¶çš„æŒ‡ç¤ºå‘é€å‘½ä»¤å’Œä¿¡å·ï¼Œå¹¶æ•è·å¹¶æ˜¾ç¤ºshellçš„è¾“å‡ºã€‚</p><p><strong>ä½¿ç”¨ -h å‚æ•°æŸ¥æ‰¾ <a href="http://sdriver.pl">sdriver.pl</a> çš„ç”¨æ³•:</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">-<span class="token operator">></span> ./sdriver.pl <span class="token parameter variable">-h</span>Usage: ./sdriver.pl <span class="token punctuation">[</span>-hv<span class="token punctuation">]</span> <span class="token parameter variable">-t</span> <span class="token operator">&lt;</span>trace<span class="token operator">></span> <span class="token parameter variable">-s</span> <span class="token operator">&lt;</span>shellprog<span class="token operator">></span> <span class="token parameter variable">-a</span> <span class="token operator">&lt;</span>args<span class="token operator">></span>Options:  <span class="token parameter variable">-h</span>            Print this message  <span class="token parameter variable">-v</span>            Be <span class="token function">more</span> verbose  <span class="token parameter variable">-t</span> <span class="token operator">&lt;</span>trace<span class="token operator">></span>    Trace <span class="token function">file</span>  <span class="token parameter variable">-s</span> <span class="token operator">&lt;</span>shell<span class="token operator">></span>    Shell program to <span class="token builtin class-name">test</span>  <span class="token parameter variable">-a</span> <span class="token operator">&lt;</span>args<span class="token operator">></span>     Shell arguments  <span class="token parameter variable">-g</span>            Generate output <span class="token keyword">for</span> autograder</code></pre><p>æˆ‘ä»¬è¿˜æä¾›äº†16ä¸ªè·Ÿè¸ªæ–‡ä»¶ï¼ˆtrace{01-16}.txtï¼‰ï¼Œæ‚¨å°†ä¸Shellé©±åŠ¨ç¨‹åºä¸€èµ·ä½¿ç”¨è¿™äº›æ–‡ä»¶æ¥æµ‹è¯•æ‚¨çš„Shellçš„æ­£ç¡®æ€§ã€‚è¾ƒä½ç¼–å·çš„è·Ÿè¸ªæ–‡ä»¶æ‰§è¡Œéå¸¸ç®€å•çš„æµ‹è¯•ï¼Œè€Œè¾ƒé«˜ç¼–å·çš„æµ‹è¯•æ‰§è¡Œæ›´å¤æ‚çš„æµ‹è¯•ã€‚</p><p>æ‚¨å¯ä»¥é€šè¿‡è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œåœ¨æ‚¨çš„Shellä¸Šä½¿ç”¨traceæ–‡ä»¶trace01.txtæ¥è¿è¡ŒShellé©±åŠ¨ç¨‹åºï¼š</p><p>- aâ€œ-pâ€å‚æ•°å‘Šè¯‰ä½ çš„ shell å¿½ç•¥æç¤ºä¿¡æ¯</p><pre class="language-bash" data-language="bash"><code class="language-bash">unix<span class="token operator">></span> ./sdriver.pl <span class="token parameter variable">-t</span> trace01.txt <span class="token parameter variable">-s</span> ./tsh <span class="token parameter variable">-a</span> <span class="token string">"-p"</span> </code></pre><p>æˆ–è€…</p><pre class="language-bash" data-language="bash"><code class="language-bash">unix<span class="token operator">></span> <span class="token function">make</span> test01</code></pre><p>ç±»ä¼¼åœ°ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥è¿è¡Œè·Ÿè¸ªé©±åŠ¨ç¨‹åºï¼Œå¹¶å°†å…¶åº”ç”¨äºå‚è€ƒShellï¼Œä»¥å°†ç»“æœä¸å‚è€ƒShellè¿›è¡Œæ¯”è¾ƒï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">./sdriver.pl <span class="token parameter variable">-t</span> trace01.txt <span class="token parameter variable">-s</span> ./tshref <span class="token parameter variable">-a</span> <span class="token string">"-p"</span></code></pre><p>æˆ–è€…</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">make</span> rtest01</code></pre><p>tshref.outæä¾›äº†å‚è€ƒè§£å†³æ–¹æ¡ˆåœ¨æ‰€æœ‰è·Ÿè¸ªæ–‡ä»¶ä¸Šçš„è¾“å‡ºã€‚è¿™å¯èƒ½æ¯”æ‚¨æ‰‹åŠ¨åœ¨æ‰€æœ‰è·Ÿè¸ªæ–‡ä»¶ä¸Šè¿è¡ŒShellé©±åŠ¨ç¨‹åºæ›´æ–¹ä¾¿ã€‚</p><p>è·Ÿè¸ªæ–‡ä»¶çš„å¥½å¤„åœ¨äºï¼Œå®ƒä»¬ç”Ÿæˆçš„è¾“å‡ºä¸æ‚¨ä»¥äº¤äº’æ–¹å¼è¿è¡ŒShellæ—¶è·å¾—çš„è¾“å‡ºç›¸åŒï¼ˆé™¤äº†ä¸€ä¸ªæ ‡è¯†è·Ÿè¸ªçš„åˆå§‹æ³¨é‡Šï¼‰ã€‚</p><p>ä¾‹å¦‚ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">bass<span class="token operator">></span> <span class="token function">make</span> test15./sdriver.pl <span class="token parameter variable">-t</span> trace15.txt <span class="token parameter variable">-s</span> ./tsh <span class="token parameter variable">-a</span> <span class="token string">"-p"</span> <span class="token comment">#</span><span class="token comment"># trace15.txt - Putting it all together</span><span class="token comment">#</span>tsh<span class="token operator">></span> ./bogus./bogus: Command not found.tsh<span class="token operator">></span> ./myspin <span class="token number">10</span>Job <span class="token punctuation">(</span><span class="token number">9721</span><span class="token punctuation">)</span> terminated by signal <span class="token number">2</span>tsh<span class="token operator">></span> ./myspin <span class="token number">3</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9723</span><span class="token punctuation">)</span> ./myspin <span class="token number">3</span> <span class="token operator">&amp;</span>tsh<span class="token operator">></span> ./myspin <span class="token number">4</span> <span class="token operator">&amp;</span><span class="token number">5</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9725</span><span class="token punctuation">)</span> ./myspin <span class="token number">4</span> <span class="token operator">&amp;</span>tsh<span class="token operator">></span> <span class="token function">jobs</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9723</span><span class="token punctuation">)</span> Running ./myspin <span class="token number">3</span> <span class="token operator">&amp;</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9725</span><span class="token punctuation">)</span> Running ./myspin <span class="token number">4</span> <span class="token operator">&amp;</span> tsh<span class="token operator">></span> <span class="token function">fg</span> %1Job <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9723</span><span class="token punctuation">)</span> stopped by signal <span class="token number">20</span> tsh<span class="token operator">></span> <span class="token function">jobs</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9723</span><span class="token punctuation">)</span> Stopped<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9725</span><span class="token punctuation">)</span> Runningtsh<span class="token operator">></span> <span class="token function">bg</span> %3%3: No such jobtsh<span class="token operator">></span> <span class="token function">bg</span> %1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9723</span><span class="token punctuation">)</span> ./myspin <span class="token number">3</span> <span class="token operator">&amp;</span>tsh<span class="token operator">></span> <span class="token function">jobs</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9723</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">9725</span><span class="token punctuation">)</span>tsh<span class="token operator">></span> <span class="token function">fg</span> %1tsh<span class="token operator">></span> quitbass<span class="token operator">></span></code></pre><h2 id="æç¤ºï¼š">æç¤ºï¼š</h2><ul><li><p>ä»”ç»†é˜…è¯»æ•™æç¬¬8ç« ï¼ˆå¼‚å¸¸æ§åˆ¶æµï¼‰çš„æ¯ä¸€ä¸ªè¯ã€‚</p></li><li><p>ä½¿ç”¨è·Ÿè¸ªæ–‡ä»¶æŒ‡å¯¼æ‚¨çš„Shellçš„å¼€å‘ã€‚ä»trace01.txtå¼€å§‹ï¼Œç¡®ä¿æ‚¨çš„Shelläº§ç”Ÿä¸å‚è€ƒShellå®Œå…¨ç›¸åŒçš„è¾“å‡ºã€‚ç„¶åç»§ç»­å¤„ç†trace02.txtï¼Œä»¥æ­¤ç±»æ¨ã€‚</p></li><li><p><code>waitpid</code>ã€<code>kill</code>ã€<code>fork</code>ã€<code>execve</code>ã€<code>setpgid</code>å’Œ<code>sigprocmask</code>å‡½æ•°å°†éå¸¸æœ‰ç”¨ã€‚<code>waitpid</code>çš„<code>WUNTRACED</code>å’Œ<code>WNOHANG</code>é€‰é¡¹ä¹Ÿå¾ˆæœ‰ç”¨ã€‚</p></li><li><p>åœ¨å®ç°ä¿¡å·å¤„ç†ç¨‹åºæ—¶ï¼Œè¯·ç¡®ä¿ä½¿ç”¨<code>kill</code>å‡½æ•°çš„å‚æ•°ä¸­çš„<code>&quot;-pid&quot;</code>è€Œä¸æ˜¯<code>&quot;pid&quot;</code>ï¼Œå‘æ•´ä¸ªå‰å°è¿›ç¨‹ç»„å‘é€<code>SIGINT</code>å’Œ<code>SIGTSTP</code>ä¿¡å·ã€‚<code>sdriver.pl</code>ç¨‹åºä¼šæ£€æŸ¥æ­¤é”™è¯¯ã€‚</p></li><li><p>ä»»åŠ¡çš„ä¸€ä¸ªæ£˜æ‰‹éƒ¨åˆ†æ˜¯å†³å®š<code>waitfg</code>å’Œ<code>sigchld</code>å¤„ç†å‡½æ•°ä¹‹é—´çš„å·¥ä½œåˆ†é…ã€‚æˆ‘ä»¬æ¨èä»¥ä¸‹æ–¹æ³•ï¼š</p><ul><li><p>åœ¨<code>waitfg</code>ä¸­ï¼Œä½¿ç”¨<code>sleep</code>å‡½æ•°å‘¨å›´çš„å¿™ç­‰å¾…å¾ªç¯ã€‚</p></li><li><p>åœ¨<code>sigchld</code>å¤„ç†ç¨‹åºä¸­ï¼Œåªè°ƒç”¨ä¸€æ¬¡<code>waitpid</code>ã€‚</p></li></ul></li></ul><p>è™½ç„¶è¿˜æœ‰å…¶ä»–å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚åœ¨waitfgå’Œsigchldå¤„ç†ç¨‹åºä¸­éƒ½è°ƒç”¨waitpidï¼Œä½†è¿™å¯èƒ½éå¸¸ä»¤äººå›°æƒ‘ã€‚åœ¨å¤„ç†ç¨‹åºä¸­å®Œæˆæ‰€æœ‰çš„æ”¶é›†å·¥ä½œæ›´ç®€å•ã€‚</p><ul><li><p>åœ¨<code>eval</code>ä¸­ï¼Œçˆ¶è¿›ç¨‹åœ¨<code>fork</code>å­è¿›ç¨‹ä¹‹å‰å¿…é¡»ä½¿ç”¨<code>sigprocmask</code>é˜»å¡<code>SIGCHLD</code>ä¿¡å·ï¼Œç„¶ååœ¨å°†å­è¿›ç¨‹æ·»åŠ åˆ°ä½œä¸šåˆ—è¡¨ä¸­æ—¶ï¼Œé€šè¿‡è°ƒç”¨<code>addjob</code>åå†è§£é™¤é˜»å¡ã€‚ç”±äºå­è¿›ç¨‹ç»§æ‰¿äº†å…¶çˆ¶è¿›ç¨‹çš„é˜»å¡å‘é‡ï¼Œå› æ­¤å­è¿›ç¨‹åœ¨æ‰§è¡Œæ–°ç¨‹åºä¹‹å‰å¿…é¡»ç¡®ä¿è§£é™¤é˜»å¡<code>SIGCHLD</code>ä¿¡å·ã€‚</p><p>çˆ¶è¿›ç¨‹ä»¥è¿™ç§æ–¹å¼é˜»å¡<code>SIGCHLD</code>ä¿¡å·ï¼Œä»¥é¿å…åœ¨çˆ¶è¿›ç¨‹è°ƒç”¨<code>addjob</code>ä¹‹å‰ï¼Œå­è¿›ç¨‹è¢«<code>sigchld</code>å¤„ç†ç¨‹åºæ”¶å›ï¼ˆä»è€Œä»ä½œä¸šåˆ—è¡¨ä¸­ç§»é™¤ï¼‰çš„ç«äº‰æ¡ä»¶ã€‚</p></li><li><p>è¯¸å¦‚<code>more</code>ã€<code>less</code>ã€<code>vi</code>å’Œ<code>emacs</code>ä¹‹ç±»çš„ç¨‹åºä¼šå¯¹ç»ˆç«¯è®¾ç½®è¿›è¡Œå¥‡æ€ªçš„æ“ä½œã€‚ä¸è¦ä»æ‚¨çš„Shellä¸­è¿è¡Œè¿™äº›ç¨‹åºã€‚åšæŒä½¿ç”¨ç®€å•çš„åŸºäºæ–‡æœ¬çš„ç¨‹åºï¼Œä¾‹å¦‚<code>/bin/ls</code>ã€<code>/bin/ps</code>å’Œ<code>/bin/echo</code>ã€‚</p></li><li><p>å½“æ‚¨ä»æ ‡å‡†Unix Shellè¿è¡Œæ‚¨çš„Shellæ—¶ï¼Œæ‚¨çš„Shellæ­£åœ¨è¿è¡Œåœ¨å‰å°è¿›ç¨‹ç»„ä¸­ã€‚å¦‚æœæ‚¨çš„Shellåˆ›å»ºäº†ä¸€ä¸ªå­è¿›ç¨‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å­è¿›ç¨‹ä¹Ÿå°†æˆä¸ºå‰å°è¿›ç¨‹ç»„çš„æˆå‘˜ã€‚ç”±äºé”®å…¥ctrl-cä¼šå‘å‰å°ç»„ä¸­çš„æ¯ä¸ªè¿›ç¨‹å‘é€SIGINTä¿¡å·ï¼Œå› æ­¤é”®å…¥ctrl-cå°†å‘æ‚¨çš„Shellå‘é€SIGINTä¿¡å·ï¼Œä»¥åŠæ‚¨çš„Shellåˆ›å»ºçš„æ¯ä¸ªè¿›ç¨‹ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸æ­£ç¡®çš„ã€‚</p><p>ä»¥ä¸‹æ˜¯è§£å†³æ–¹æ³•ï¼š</p><p>åœ¨forkä¹‹åä½†åœ¨execveä¹‹å‰ï¼Œå­è¿›ç¨‹åº”è°ƒç”¨setpgid(0, 0)ï¼Œè¿™å°†å­è¿›ç¨‹æ”¾å…¥ä¸€ä¸ªæ–°çš„è¿›ç¨‹ç»„ï¼Œå…¶ç»„IDä¸å­è¿›ç¨‹çš„PIDç›¸åŒã€‚è¿™ç¡®ä¿å‰å°è¿›ç¨‹ç»„ä¸­åªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œå³æ‚¨çš„Shellã€‚å½“æ‚¨é”®å…¥ctrl-cæ—¶ï¼ŒShellåº”æ•è·ç”Ÿæˆçš„SIGINTä¿¡å·ï¼Œç„¶åå°†å…¶è½¬å‘ç»™ç›¸åº”çš„å‰å°ä½œä¸šï¼ˆæ›´ç¡®åˆ‡åœ°è¯´ï¼ŒåŒ…å«å‰å°ä½œä¸šçš„è¿›ç¨‹ç»„ï¼‰ã€‚</p><h2 id="è¯„ä¼°">è¯„ä¼°</h2><p>æ ¹æ®ä»¥ä¸‹åˆ†é…ï¼Œæ‚¨çš„å¾—åˆ†å°†è®¡ä¸ºæœ€é«˜90åˆ†ä¸­çš„ä¸€éƒ¨åˆ†ï¼š</p><ol><li><p>80åˆ† æ­£ç¡®æ€§ï¼š</p></li><li><p>16ä¸ªè·Ÿè¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶5åˆ†ã€‚</p></li><li><p>10åˆ† é£æ ¼åˆ†ã€‚</p></li></ol><p>æˆ‘ä»¬æœŸæœ›æ‚¨æœ‰è‰¯å¥½çš„æ³¨é‡Šï¼ˆ5åˆ†ï¼‰ï¼Œå¹¶æ£€æŸ¥æ¯ä¸ªç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼ï¼ˆ5åˆ†ï¼‰ã€‚</p><p>æ‚¨çš„è§£å†³æ–¹æ¡ˆå°†åœ¨Linuxæœºå™¨ä¸Šè¿›è¡Œæ­£ç¡®æ€§æµ‹è¯•ï¼Œä½¿ç”¨ä¸å®éªŒç›®å½•ä¸­åŒ…å«çš„Shellé©±åŠ¨ç¨‹åºå’Œè·Ÿè¸ªæ–‡ä»¶ç›¸åŒçš„å·¥å…·ã€‚æ‚¨çš„Shellåº”åœ¨è¿™äº›è·Ÿè¸ªæ–‡ä»¶ä¸Šäº§ç”Ÿä¸å‚è€ƒShellå®Œå…¨ç›¸åŒçš„è¾“å‡ºï¼Œåªæœ‰ä¸¤ä¸ªä¾‹å¤–ï¼š<br>â€¢ PIDå¯èƒ½ä¼šä¸åŒï¼ˆä¼šå˜åŒ–ï¼‰ã€‚<br>â€¢ trace11.txtã€trace12.txtå’Œtrace13.txtä¸­/bin/pså‘½ä»¤çš„è¾“å‡ºä¼šå› æ¯æ¬¡è¿è¡Œè€Œæœ‰æ‰€ä¸åŒã€‚ç„¶è€Œï¼Œåœ¨/bin/pså‘½ä»¤çš„è¾“å‡ºä¸­ï¼Œmysplitè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€åº”ä¿æŒä¸€è‡´ã€‚</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Introduce&quot;&gt;Introduce&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªä»»åŠ¡çš„ç›®çš„æ˜¯è®©ä½ æ›´åŠ ç†Ÿæ‚‰è¿›ç¨‹æ§åˆ¶å’Œä¿¡å·ä¼ é€’çš„æ¦‚å¿µã€‚ä½ å°†é€šè¿‡ç¼–å†™ä¸€ä¸ªç®€å•çš„Unix shellç¨‹åºæ¥å®ç°ä½œä¸šæ§åˆ¶ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="csapp" scheme="https://trevoewu.github.io/categories/csapp/"/>
    
    
    <category term="lab" scheme="https://trevoewu.github.io/tags/lab/"/>
    
    <category term="csapp" scheme="https://trevoewu.github.io/tags/csapp/"/>
    
  </entry>
  
  <entry>
    <title>å­¦ä¹ æ‚è°ˆï¼šæŒä¹…å±‚æ¡†æ¶é‚£äº›é“¾æ¥æ•°æ®åº“çš„æ“ä½œ</title>
    <link href="https://trevoewu.github.io/2023/06/10/%E5%AD%A6%E4%B9%A0%E6%9D%82%E8%B0%88%EF%BC%9A%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6%E9%82%A3%E4%BA%9B%E9%93%BE%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%93%8D%E4%BD%9C/"/>
    <id>https://trevoewu.github.io/2023/06/10/%E5%AD%A6%E4%B9%A0%E6%9D%82%E8%B0%88%EF%BC%9A%E6%8C%81%E4%B9%85%E5%B1%82%E6%A1%86%E6%9E%B6%E9%82%A3%E4%BA%9B%E9%93%BE%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%93%8D%E4%BD%9C/</id>
    <published>2023-06-10T11:26:53.000Z</published>
    <updated>2023-06-11T11:53:02.194Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸ºäº†è¿›è¡Œæ•°æ®çš„æŒä¹…åŒ–ï¼Œå’Œæ•°æ®åº“æ“ä½œæ˜¯å¿…é¡»çš„æ“ä½œã€‚ æœ¬æ–‡æ¢è®¨ä¸åŒçš„æŒä¹…å±‚æ¡†æ¶é“¾æ¥æ•°æ®åº“çš„æ“ä½œã€‚</p><span id="more"></span><h2 id="JDBC">JDBC</h2><p>JDBC ä¸ºå¤šä¸ªä¸åŒçš„æ•°æ®åº“å®ç°æä¾›äº†åŒä¸€çš„æ¥å£ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥é€šè¿‡JDBCæ¥æ“ä½œä¸åŒçš„æ•°æ®åº“ï¼Œè€Œä¸éœ€è¦æ‹…å¿ƒæ•°æ®åº“çš„å…·ä½“å®ç°ã€‚</p><p>è¦åœ¨Javaé¡¹ç›®ä¸­ä½¿ç”¨JDBCï¼Œé¦–å…ˆéœ€è¦å¼•è¿›jaråŒ…ã€‚å‡è®¾æˆ‘ä»¬éœ€è¦é“¾æ¥çš„æ•°æ®åº“æ˜¯mysqlï¼Œåˆ™éœ€è¦å¼•è¿›mysqlç›¸å…³çš„jaråŒ…ã€‚</p><p>ä½¿ç”¨Mavenæ˜¯è¿›è¡ŒåŒ…ç®¡ç†æ˜¯ç›¸å½“ä¾¿æ·çš„åšæ³•ï¼Œè¦ä½¿ç”¨mavenï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ä¸ªMavençš„é¡¹ç›®æˆ–è€…æ¨¡å—ã€‚è¿™é‡Œå°±ç”¨Javaå”¯ä¸€æŒ‡å®šIDE IntlliJ IDEA æ¥æ¼”ç¤ºã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--        mysql --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>8.0.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>è¦é“¾æ¥æ•°æ®åº“ï¼Œè‡ªç„¶å°‘ä¸äº†è¦é“¾æ¥æ•°æ®åº“çš„å‚æ•°ï¼Œæ¯”å¦‚Driverï¼ŒURLï¼Œä»¥åŠUsernameï¼ŒPasswordç­‰ç­‰ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ä¸ªproperties æ¥å­˜æ”¾è¿™äº›æ•°æ®ï¼Œè€Œä¸æ˜¯å†™æ­»åœ¨Javaä»£ç ä¸­ã€‚</p><pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">DRIVER</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.cj.jdbc.Driver</span><span class="token key attr-name">URL</span><span class="token punctuation">=</span><span class="token value attr-value">mysql://localhost:3306/demo?useUnicode=true&amp;characterEncoding=utf-8</span><span class="token key attr-name">USERNAME</span><span class="token punctuation">=</span><span class="token value attr-value">root</span><span class="token key attr-name">PASSWORD</span><span class="token punctuation">=</span><span class="token value attr-value">root</span></code></pre><ol><li>åŠ è½½é©±åŠ¨</li></ol><p>æ•°æ®åº“æœ‰ç€ä¸åŒçš„å®ç°ï¼Œmysqlï¼Œoracleï¼ŒmonogDBï¼ŒSQL Serverç­‰ç­‰ï¼Œè€Œæ¯ä¸ªæ•°æ®åº“éƒ½æä¾›ä¸€ä¸ªé©±åŠ¨ç¨‹åºï¼Œé©±åŠ¨ç¨‹åºæ˜¯ä¸æ•°æ®åº“ç³»ç»Ÿè¿›è¡Œé€šä¿¡çš„è½¯ä»¶ç»„ä»¶ã€‚æ¯ç§æ•°æ®åº“ç³»ç»Ÿéƒ½æœ‰è‡ªå·±çš„é©±åŠ¨ç¨‹åºï¼Œè¿™æ˜¯å› ä¸ºä¸åŒæ•°æ®åº“ç³»ç»Ÿé‡‡ç”¨ä¸åŒçš„åè®®å’Œé€šä¿¡æ–¹å¼ã€‚</p><p><strong>é©±åŠ¨ç¨‹åºå……å½“Javaç¨‹åºä¸æ•°æ®åº“ä¹‹é—´çš„æ¡¥æ¢</strong>ï¼Œè´Ÿè´£å¤„ç†ä¸æ•°æ®åº“çš„è¿æ¥ã€æ‰§è¡ŒSQLè¯­å¥ä»¥åŠè·å–å’Œå¤„ç†æŸ¥è¯¢ç»“æœç­‰ä»»åŠ¡ã€‚å®ƒä»¬æä¾›äº†ä¸€ç»„æ ‡å‡†çš„æ¥å£å’Œæ–¹æ³•ï¼Œä½¿å¾—Javaç¨‹åºèƒ½å¤Ÿé€šè¿‡ç»Ÿä¸€çš„æ–¹å¼ä¸ä¸åŒæ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œè€Œä¸éœ€è¦äº†è§£åº•å±‚æ•°æ®åº“çš„å…·ä½“å®ç°ç»†èŠ‚ã€‚</p><p>åŠ è½½æ•°æ®åº“é©±åŠ¨ç¨‹åºçš„å¸¸ç”¨æ–¹å¼æ˜¯ä½¿ç”¨<code>Class.forName()</code>æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦åŠ è½½mysqlçš„é©±åŠ¨ç¨‹åºï¼ŒMySQLæ•°æ®åº“çš„é©±åŠ¨ç¨‹åºç±»åä¸º<code>com.mysql.jdbc.Driver</code>ï¼ˆæ—§ç‰ˆï¼‰æˆ–<code>com.mysql.cj.jdbc.Driver</code>ï¼ˆæ–°ç‰ˆï¼‰ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åŠ è½½MySQLé©±åŠ¨ç¨‹åº</span></code></pre><p>ä¸€æ—¦æ•°æ®åº“é©±åŠ¨ç¨‹åºåŠ è½½æˆåŠŸï¼Œå°±å¯ä»¥é€šè¿‡JDBCå»ºç«‹ä¸æ•°æ®åº“çš„è¿æ¥å¹¶æ‰§è¡Œç›¸å…³æ“ä½œã€‚</p><ol start="2"><li>å»ºç«‹æ•°æ®åº“è¿æ¥</li></ol><p>è¦å’Œæ•°æ®åº“è¿›ç¨‹æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦å’Œæ•°æ®åº“å»ºç«‹ä¸€ä¸ªä¼šè¯å…³ç³»ï¼Œå°±åƒåœ¨webä¸­ä¸€æ ·ï¼Œåœ¨webä¸­ï¼Œè¿™ä¸ªä¼šè¯è¢«ç§°ä¸ºhttpSession, è€Œåœ¨æ•°æ®åº“ä¸­ï¼Œä¹ŸåŒæ ·å­˜åœ¨ç€è¿™ä¸ªä¼šè¯ã€‚</p><p>ä¸€ä¸ªä¼šè¯ä»£è¡¨äº†å®¢æˆ·ç«¯ä¸æ•°æ®åº“ä¹‹é—´çš„é€šä¿¡é€šé“ï¼Œå®ƒå…è®¸å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸æ•°æ®åº“æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">// 2.è¿æ¥æ•°æ®åº“</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åœ¨JDBCä¸­ï¼Œé€šè¿‡<code>DriverManager.getConnection()</code>æ–¹æ³•å»ºç«‹æ•°æ®åº“è¿æ¥æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨å»ºç«‹ä¸€ä¸ªä¼šè¯ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª<code>Connection</code>å¯¹è±¡ï¼Œè¡¨ç¤ºä¸æ•°æ®åº“çš„è¿æ¥ã€‚è¿™ä¸ª<code>Connection</code>å¯¹è±¡å°è£…äº†ä¸æ•°æ®åº“æœåŠ¡å™¨çš„åº•å±‚é€šä¿¡ç»†èŠ‚ï¼ŒåŒ…æ‹¬è¿æ¥ä¿¡æ¯ã€ä¼šè¯çŠ¶æ€å’Œæ•°æ®ä¼ è¾“ç­‰ã€‚</p><p>é€šè¿‡ä¼šè¯ï¼Œå¯ä»¥åœ¨è¿æ¥æœŸé—´æ‰§è¡Œå¤šä¸ªSQLè¯­å¥ï¼Œä¿æŒæ•°æ®åº“è¿æ¥çš„çŠ¶æ€ã€‚è¿™æ ·å¯ä»¥é¿å…æ¯æ¬¡æ‰§è¡ŒSQLè¯­å¥éƒ½é‡æ–°å»ºç«‹è¿æ¥ï¼Œæé«˜æ€§èƒ½å’Œæ•ˆç‡ã€‚å½“ä¸å†éœ€è¦è¿æ¥æ—¶ï¼Œå¯ä»¥è°ƒç”¨<code>Connection</code>å¯¹è±¡çš„<code>close()</code>æ–¹æ³•å…³é—­è¿æ¥ï¼Œé‡Šæ”¾ç›¸å…³èµ„æºã€‚</p><ol start="3"><li>åˆ›å»ºæ‰§è¡ŒSQLè¯­å¥çš„å¯¹è±¡</li></ol><p>æœ‰äº†é“¾æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>Connection</code>å¯¹è±¡çš„<code>createStatement()</code>æ–¹æ³•åˆ›å»º<code>Statement</code>å¯¹è±¡æˆ–<code>prepareStatement()</code>æ–¹æ³•åˆ›å»º<code>PreparedStatement</code>å¯¹è±¡ã€‚</p><p><code>Statement</code>ç”¨äºæ‰§è¡Œé™æ€çš„SQLè¯­å¥ï¼Œè€Œ<code>PreparedStatement</code>ç”¨äºæ‰§è¡Œé¢„ç¼–è¯‘çš„SQLè¯­å¥ï¼Œå¯ä»¥æé«˜æ€§èƒ½å’Œå®‰å…¨æ€§ï¼Œé˜²æ­¢SQLæ³¨å…¥ã€‚</p><ol start="4"><li>æ‰§è¡ŒSQLè¯­å¥ï¼š</li></ol><p>é€šè¿‡<code>Statement</code>æˆ–<code>PreparedStatement</code>å¯¹è±¡çš„<code>executeQuery()</code>æ–¹æ³•æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè¿”å›ä¸€ä¸ª<code>ResultSet</code>å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æŸ¥è¯¢ç»“æœï¼›é€šè¿‡<code>executeUpdate()</code>æ–¹æ³•æ‰§è¡Œæ›´æ–°è¯­å¥ï¼ˆå¦‚æ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼‰ï¼Œè¿”å›å—å½±å“çš„è¡Œæ•°ã€‚</p><ol start="5"><li>å¤„ç†ç»“æœé›†ï¼š</li></ol><p>ä½†æ˜¯ä»…ä»…æ˜¯å¾€æ•°æ®åº“ä¸­ä¼ SQLè¯­å¥ï¼Œæ˜¾ç„¶æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ¥å—æ•°æ®åº“è¿”å›çš„æ•°æ®ã€‚</p><p>æ•°æ®åº“çš„æ“ä½œæœ‰å››ç§ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¸ºCRUDï¼Œå³CREATE, READ, UPDATE and DELETEï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„å¢åˆ æ”¹æŸ¥ã€‚å…¶ä¸­æŸ¥è¯¢æ“ä½œè¿”å›ä¸€ä¸ªç»“æœé›†Resultï¼Œå…¶ä»–çš„æ“ä½œéƒ½è¿”å›ä¸€ä¸ªintç±»å‹çš„æ•´æ•°ï¼Œä»£è¡¨å—å½±å“çš„è¡Œæ•°ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦ç¼–å†™ä¸¤ä¸ªå‡½æ•°ï¼Œå¤„ç†è¿™ä¸¤ç§ä¸åŒçš„æ“ä½œã€‚</p><p>å¯¹äºæŸ¥è¯¢æ“ä½œ</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//æ‰§è¡ŒæŸ¥è¯¢, è¿”å›ç»“æœé›†</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ResultSet</span> <span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span><span class="token class-name">String</span> query<span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">&#123;</span>    <span class="token class-name">ResultSet</span> resultSet <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>query<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> params <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//é¢„å¤„ç†</span>        <span class="token class-name">PreparedStatement</span> statement <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> params<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//è®¾ç½®SQL è¯­å¥ä¸­çš„å‚æ•°</span>            statement<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//æ‰§è¡Œ</span>        resultSet <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> resultSet<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¯¹äºæ›´æ–°åˆ é™¤ï¼Œå¢åŠ æ“ä½œï¼š</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//æ‰§è¡Œæ›´æ–°ï¼Œ è¿”å›å½±å“è¡Œæ•°</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span><span class="token class-name">String</span> query<span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> affectedRows <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>query<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> params <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//é¢„å¤„ç†</span>        <span class="token class-name">PreparedStatement</span> statement <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> params<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//è®¾ç½®SQL è¯­å¥ä¸­çš„å‚æ•°</span>            statement<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//æ‰§è¡Œ</span>         affectedRows <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> affectedRows<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><ol start="6"><li>å…³é—­è¿æ¥å’Œèµ„æº</li></ol><p>ä½¿ç”¨å®Œ<code>ResultSet</code>ã€<code>Statement</code>å’Œ<code>Connection</code>ç­‰å¯¹è±¡åï¼Œéœ€è¦è°ƒç”¨å®ƒä»¬çš„<code>close()</code>æ–¹æ³•æ¥å…³é—­è¿æ¥å’Œé‡Šæ”¾èµ„æºï¼Œä»¥å…é€ æˆå†…å­˜æ³„æ¼å’Œèµ„æºæµªè´¹ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥ä¸“é—¨å…³é—­è¿™äº›èµ„æºï¼Œä½†è¿™ä¸æ˜¯å¿…é¡»çš„ï¼Œä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨å…³é—­ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//é‡Šæ”¾é“¾æ¥èµ„æº</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">PreparedStatement</span> pstmt<span class="token punctuation">,</span> <span class="token class-name">ResultSet</span> resSet<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>resSet <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>resSet<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>pstmt <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>pstmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>æœç„¶å¥½éº»çƒ¦ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ç»“æŸï¼ŒæŸ¥è¯¢æ“ä½œè¿”å›äº†ä¸€ä¸ªç»“æœé›†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹è¿™ä¸ªç»“æœé›†è¿›è¡ŒORMå¤„ç†ï¼Œå³Object Relationship Mappingã€‚æŠŠæ•°æ®åº“ä¸­çš„entityæ˜ å°„åˆ°ä¸€ä¸ªbeanä¸Šï¼Œè¿™æ˜¯æœ€éº»çƒ¦çš„ã€‚å› ä¸ºæˆ‘ä»¬éœ€è¦ä¸€ä¸€ä¸ªå¤„ç†è¿™äº›å­—æ®µå’Œå±æ€§çš„å¯¹åº”å…³ç³»ã€‚</p><p>ä¸‹é¢è¿™æ®µä»£ç å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªä¾‹å­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºæ¯ä¸€ä¸ªå¯¹è±¡çš„å±æ€§å€¼ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸€çš„æ‰¾åˆ°å¯¹åº”çš„å­—æ®µå€¼ã€‚è¿™è¿˜åªæ˜¯æŸ¥è¯¢ä¸€å¼ è¡¨ï¼Œåœ¨å¤šè¡¨è”åˆæŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°è£…çš„å¯¹è±¡æ•°é‡æ›´å¤šã€‚æˆ‘ä»¬ä¸åº”è¯¥èŠ±å¤ªå¤šæ—¶é—´å¤„ç†è¿™äº›é‡å¤è€Œåˆæ— æ„ä¹‰çš„äº‹ã€‚</p><p>ä¸‹é¢ä»‹ç»çš„æŒä¹…å±‚æ¡†æ¶ï¼Œå°±æ˜¯å¯¹JDBCçš„äºŒæ¬¡å°è£…ï¼Œå…å»äº†æˆ‘ä»¬ç¼–å†™ORMçš„ä»£ç ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>id<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token class-name">ResultSet</span> set<span class="token punctuation">;</span>    sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM smbms_user,smbms_role Where smbms_user.userRole = smbms_role.id and smbms_user.id = ?"</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        conn <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        set <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">,</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>set <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                user<span class="token punctuation">.</span><span class="token function">setUserRoleName</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"roleName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setUserPassword</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userPassword"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setUserCode</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userCode"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setBirthday</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Date</span><span class="token punctuation">)</span> set<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"birthday"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setPhone</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setIdPicPath</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"idPicPath"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setUserRole</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"userRole"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setCreatedBy</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"createdBy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setCreationDate</span><span class="token punctuation">(</span> set<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"creationDate"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setModifyBy</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"modifyBy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setModifyDate</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"modifyDate"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setWorkPicPath</span><span class="token punctuation">(</span><span class="token string">"workPicPath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//å…³é—­é“¾æ¥å’Œç»“æœé›†</span>        <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> user<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h2 id="MyBatis">MyBatis</h2><p>MyBatisæ˜¯ä¸€ä¸ªä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ï¼Œæ˜¯å¯¹JDBCçš„äºŒæ¬¡å°è£…ã€‚è¯¥æ¡†æ¶å¤§å¤§ç®€åŒ–äº†ORMè¿‡ç¨‹ï¼ŒMyBatiså¯ä»¥é€šè¿‡å­—æ®µå’Œå±æ€§åè‡ªåŠ¨è¿›è¡ŒORMæ“ä½œã€‚</p><ol><li>è¦ä½¿ç”¨MyBatisï¼Œå½“ç„¶éœ€è¦å¼•å…¥ç›¸å…³çš„jaråŒ…ï¼š</li></ol><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.5.13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><ol start="2"><li>ç¼–å†™MyBatisé…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶æˆ‘ä»¬å¯ä»¥ä»å®˜ç½‘ä¸­æ‹¿åˆ°å¯¹åº”çš„æ¨¡ç‰ˆï¼Œè¿™æ˜¯mybatisçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œé€šè¿‡ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°mybatisçš„ä¸åŒè¡¨ç°ã€‚</li></ol><p>æœ€å¥½å°†è¿™ä¸ªé…ç½®æ–‡ä»¶ç¼–å†™åœ¨æ ¹è·¯å¾„ä¸‹ï¼Œæ”¾åœ¨èµ„æºæ–‡ä»¶æœ‰æ˜¯å†å¥½ä¸è¿‡çš„é€‰æ‹©</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">configuration</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Config 3.0//EN"</span>        <span class="token string">"https://mybatis.org/dtd/mybatis-3-config.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--    ä»db.propertiesè¯»å–æ•°æ®åº“å±æ€§--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>db.properties<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;DRIVER&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;URL&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;USERNAME&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span></code></pre><p>åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬åªé…ç½®çš„æ•°æ®æºï¼Œåç»­çš„é…ç½®éšç€è®²è§£çš„æ·±å…¥å†ä¸€ä¸€æ·»åŠ </p><ol start="2"><li><p>ç¼–å†™bean</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> major<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre></li><li><p>ç¼–å†™æ¥å£</p></li></ol><p>å’ŒJDBCä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™æ¥å£ï¼Œåœ¨æ¥å£ä¸­å®šä¹‰æ–¹æ³•ã€‚é¢å‘æ¥å£ç¼–ç¨‹å¯ä»¥å¤§å¤§é™ä½å±‚ä¸å±‚ä¹‹é—´çš„è€¦åˆåº¦ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Student</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Param</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StudentMapper</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Student</span> <span class="token function">getStudent</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>ä¸åŒçš„æ˜¯ï¼Œç”±äºä¸éœ€è¦ç¼–å†™æ¥å£å®ç°ç±»äº†ï¼ŒMybatisä¼šé€šè¿‡åå°„çš„æ–¹å¼åœ¨ç¨‹åºè¿è¡Œæ—¶ç”Ÿæˆå®ç°ç±»ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>@Param</code>æ³¨è§£æ¥æŒ‡å®šå‚æ•°ï¼Œå¦‚æœå‚æ•°åªæœ‰ä¸€ä¸ªåˆ™ä¸éœ€è¦æ˜¾å¼çš„ç»™å‡ºï¼Œå‚æ•°ç±»å‹æ˜¯å¤æ‚ç±»å‹å¦‚java beanæ—¶ä¹Ÿä¸éœ€è¦æ˜¾å¼çš„ç»™å‡ºã€‚</p><ol start="4"><li>ç¼–å†™mapper</li></ol><p>æ²¡æœ‰äº†å®ç°äº†ç±»ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦ç¼–å†™mapperæ–‡ä»¶ï¼Œå…¶å®ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨æ³¨è§£çš„æ–¹å¼å®šä¹‰SQLè¯­å¥ï¼Œä½†æ˜¯è¿™æ ·å¯¹äºè¾ƒä¸ºå¤æ‚çš„SQLè¯­å¥ä»£ç çš„å¯è¯»æ€§å°†å¤§å¤§é™ä½ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯åŸºäºxmlçš„çš„æ–¹å¼ã€‚</p><p>mapperä½¿ç”¨xmlæ ¼å¼ï¼Œä¸”éœ€è¦ä¿è¯ä¸æ¥å£åç§°ç›¸åŒã€‚ åœ¨mapperä¸­ï¼Œè¦æŒ‡å®šå‘½åç©ºé—´ï¼Œè¿™ä¸ªå‘½åç©ºé—´æŒ‡å‘æ¥å£ç±»ï¼Œä½¿ç”¨æ¥å£ç±»çš„å…¨é™å®šåã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>        <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cn.loulan.dao.StudentMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getStudent<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cn.loulan.bean.Student<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select * from student where id=#&#123;id&#125;;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></code></pre><p>å’ŒJDBCä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦å’Œæ•°æ®åº“å»ºç«‹è¿æ¥ï¼Œæ‹¿åˆ°ä¼šè¯ï¼Œåœ¨Mybatisä¸­ï¼Œè¿™ä¸ªä¼šè¯è¢«ç§°ä¸ºSql Sessionè¦æ‹¿åˆ°è¿™ä¸ªSqlSession, è¿˜æœ‰ç‚¹éº»çƒ¦ï¼Œè¿™é‡ŒMybatisä½¿ç”¨äº†ä¸€ä¸ªè®¾è®¡æ¨¡å¼ï¼Œå«åšå»ºé€ è€…æ¨¡å¼ã€‚è¿™æ˜¯GOF23ç§è®¾è®¡æ¨¡å¼çš„åˆ›é€ å‹è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚è¦ç†è§£å»ºé€ è€…æ¨¡å¼ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆäº†è§£å·¥å‚æ¨¡å¼ã€‚</p><p>å·¥å‚æ¨¡å¼åœ¨springä¸­æœ‰ç€å¤§é‡çš„è¿ç”¨ï¼Œæ¯”å¦‚åŠ¨æ€ä»£ç†ä¸­Beançš„å®ä¾‹åŒ–å°±æ˜¯å·¥å‚æ¨¡å¼çš„ä¸€ä¸ªè¿ç”¨ã€‚æ¯ä¸€ä¸ªbeanéƒ½å¯¹åº”ä¸€ä¸ªå·¥å‚ï¼Œç”¨æ¥ç”Ÿæˆè¿™ä¸ªbeanã€‚è¿™é‡Œçš„å·¥å‚æ¨¡å¼ç¡®å®çš„è¯´æ˜¯é™æ€å·¥å‚æ¨¡å¼ï¼Œä¹Ÿå«åšç®€å•å·¥å‚æ¨¡å¼ï¼Œè¿™ä¸ªè®¾è®¡æ¨¡å¼å¹¶ä¸åœ¨GOF23ç§è®¾è®¡æ¨¡å¼ä¹‹å†…ï¼Œä½†æ˜¯è¿ç”¨çš„ä¹Ÿæ¯”è¾ƒå¤šï¼Œè€Œä¸”ç®€å•å·¥å‚æ¨¡å¼å…¶å®ç®—å¾—ä¸Šæ˜¯å·¥å‚æ¨¡å¼çš„ä¸€ä¸ªç‰¹ä¾‹ã€‚</p><p>è¦ç†è§£å·¥å‚æ¨¡å¼ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸ºä»€ä¹ˆéœ€è¦å·¥å‚æ¨¡å¼ï¼Ÿ</p><p>é¢å‘å¯¹è±¡æœ‰ä¸ƒå¤§è®¾è®¡åŸåˆ™ï¼Œç¬¬ä¸€ä¸ªä¾¿æ˜¯å•ä¸€èŒè´£åŸåˆ™ã€‚é¡¾åæ€ä¹‰å°±æ˜¯ä¸€ä¸ªç±»åªè´Ÿè´£ä¸€ä¸ªèŒè´£ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç±»ï¼Œä¸éœ€è¦æ‹…å¿ƒè¿™ä¸ªæ˜¯å¦‚ä½•è¢«åˆ›å»ºå‡ºæ¥çš„ï¼Œå°±åƒåœ¨ç”Ÿæ´»ä¸­æˆ‘ä»¬ä¹°ä¸€å°ç”µè„‘ä¸éœ€è¦å…³å¿ƒè¿™ä¸ªç”µè„‘æ˜¯å¦‚ä½•ç”Ÿäº§å‡ºæ¥çš„ã€‚ç”µè„‘çš„ç”Ÿäº§ç”±ç”Ÿäº§è¿™ä¸ªç”µè„‘çš„å·¥å‚è´Ÿè´£ã€‚ç›¸è¾ƒäºè‡ªå·±é€ ä¸€å°ç”µè„‘ï¼Œæ˜¾ç„¶å»ä¹°ä¸€å°å·¥å‚ç”Ÿäº§çš„ç”µè„‘æ›´ä¸ºç°å®ã€‚</p><p>ç®€å•å·¥å‚æ¨¡å¼å°±æ˜¯è¿™æ ·æ€æƒ³çš„ä¸€ç§ä½“éªŒï¼Œåœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦å®ä¾‹åŒ–ä¸€äº›æ¥ç€åŒä¸€ä¸ªçˆ¶ç±»çš„å¯¹è±¡, è¿™ä¸ªçˆ¶ç±»å®šä¹‰äº†è¿™ä¸ªå·¥å‚ä¸‹æ‰€ä»¥å¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‚ä¸ºæ­¤ä¸“é—¨æä¾›ä¸€ä¸ªå·¥å‚æ¥å¸®æˆ‘ä»¬å®ä¾‹åŒ–è¿™ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬åªéœ€è¦æä¾›ä¸åŒçš„å‚æ•°ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸åŒçš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œåœ¨Javaå¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸æŠŠå·¥å‚ç±»çš„å®ä¾‹åŒ–è¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•å®šä¹‰ä¸ºä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å®ä¾‹åŒ–è¿™ä¸ªç±»å°±å¯ä»¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•äº†ï¼Œè¿™ä¹Ÿå°±æ˜¯é™æ€å·¥å‚æ¨¡å¼åå­—çš„æ¥æºã€‚</p><p>ç®€å•å·¥å‚æ¨¡å¼åŒ…å«ä¸‰ä¸ªé‡è¦çš„è§’è‰²ï¼š</p><ol><li>å·¥å‚ Factory:  å·¥å‚æ¨¡å¼çš„æ ¸å¿ƒè§’è‰²ï¼Œè¿™ä¸ªè§’è‰²æä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è´Ÿè´£å®ä¾‹åŒ–å¯¹è±¡å¹¶è¿”å›ï¼Œè¿”å›ç±»å‹ä¸ºæŠ½è±¡äº§å“ã€‚</li><li>æŠ½è±¡äº§å“ Productï¼š æŠ½è±¡äº§å“æ˜¯å·¥å‚å»ºé€ çš„æ‰€ä»¥å…·ä½“å¯¹è±¡çš„çˆ¶ç±»ï¼Œè´Ÿè´£æè¿°æ‰€ä»¥å®ä¾‹åŒ–å¯¹è±¡çš„å…¬å…±æ¥å£ã€‚å®ƒçš„å¼•å…¥ä½¿å¾—ç³»ç»Ÿæ›´åŠ çµæ´»ï¼Œåœ¨å·¥å‚ç±»ä¸­åªéœ€è¦å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œå› ä¸ºæ‰€ä»¥çš„å…·ä½“äº§å“å¯¹è±¡éƒ½æ˜¯å…¶å­ç±»å¯¹è±¡ã€‚</li><li>å…·ä½“äº§å“ ConcreteProductï¼š ç®€å•å·¥å‚æ¨¡å¼çš„åˆ›å»ºç›®æ ‡ï¼Œæ˜¯æŠ½è±¡äº§å“çš„å…·ä½“è¡¨ç°ï¼Œéœ€è¦å®ç°æŠ½è±¡äº§å“ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚</li></ol><!--to do... è¡¥å……å·¥å‚æ¨¡å¼ï¼Œå»ºé€ è€…æ¨¡å¼--><p>åœ¨Mybatisä¸­ï¼Œä¾¿ä½¿ç”¨å·¥å‚æ¨¡å¼è¿™ä¸€æ€æƒ³ã€‚è¦æ‹¿åˆ°sqlsessionï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ‹¿åˆ°å·¥å‚å¯¹è±¡ï¼Œé€šè¿‡è¯»å–é…ç½®æ–‡ä»¶ï¼ŒMyBatisä¼šåˆ›å»ºä¸€ä¸ªSqlSessionFactoryå¯¹è±¡ã€‚é€šè¿‡å·¥å‚å¯¹è±¡çš„openSessionæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°è¿™ä¸ªSql Sessionäº†ã€‚SqlSessionæ˜¯ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’çš„ä¸»è¦æ¥å£ï¼Œå®ƒå°è£…äº†æ•°æ®åº“ä¼šè¯å’Œæ‰§è¡ŒSQLæ“ä½œçš„æ–¹æ³•ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Student</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSession</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactory</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactoryBuilder</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestStudent</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetStudent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1. åŠ è½½mybatisé…ç½®æ–‡ä»¶</span>        <span class="token class-name">InputStream</span> resourceAsStream <span class="token operator">=</span> <span class="token class-name">TestStudent</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"mybatis.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//2. æ‹¿åˆ°å·¥å‚å¯¹è±¡</span>        <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>resourceAsStream<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//3. sqlSessionå¯¹è±¡</span>        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//4. æ‹¿åˆ°æ¥å£å®ç°ç±»</span>        <span class="token class-name">StudentMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//5. å…³é—­sql sessioné‡Šæ”¾èµ„æº</span>        sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//6. è¾“å‡ºæŸ¥è¯¢ç»“æœ</span>        <span class="token class-name">Student</span> student <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">getStudent</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><!--é¥¿äº†ï¼Œåƒé¥­å»äº†--><!--æˆ‘æ¥äº†ï¼Œç»§ç»­ç»§ç»­ã€‚å“ï¼Œè¶Šæ¥è¶Šæä¸æ‡‚è‡ªå·±äº†ï¼Œä¸€èººåœ¨åºŠä¸Šå°±ä¼šæƒ³ç‘Ÿç‘Ÿã€‚æ„Ÿè§‰åˆè§‰ç¡äº†æ ¹æ²¡ç¡ä¸€æ ·ï¼Œå¾ˆå¥‡æ€ªå•Šï¼Œä¸€èººä¸‹å°±å¿ä¸ä½æƒ³Moonã€‚æˆ‘ä¹Ÿä¸çŸ¥é“æˆ‘å–œæ¬¢å¥¹ä»€ä¹ˆï¼Œé«˜ä¸­æ—¶æœŸçš„æš—æ‹å¯¹è±¡èƒ½æŒç»­è¿™ä¹ˆä¹…çš„å½±å“æˆ‘ã€‚å¥¹éƒ½é‚€è¯·æˆ‘å»å¥¹å®¶ç©äº†ï¼Œè™½ç„¶ç¡®å®å¾ˆæƒ³å»ï¼Œä½†æ˜¯è‡ªå·±æƒ³å»çš„åŠ¨æœºæ€»æ„Ÿè§‰ä¸çº¯ã€‚è€Œä¸”ä¹Ÿæ€ªä¸å¥½æ„æ€çš„ï¼Œå¥¹å§å§æˆ‘ä¹Ÿä¸ç†Ÿï¼Œå»å¥¹å®¶ç©çš„è¯è‡ªå·±ä¹Ÿä¼šå¾ˆéš¾åŠã€‚ä¸”ä¸è¯´å¾€è¿”çš„æœºç¥¨é’±å°±ä¸æ˜¯ä¸€ä¸ªå°æ•°ç›®ï¼Œä¸ºä»€ä¹ˆè¦è·‘åˆ°è¿™ä¹ˆè¿œä¸Šå¤§å­¦å‘¢ï¼Œæˆ‘åˆå¼€å§‹æ€€ç–‘è‡ªå·±äº†ã€‚è¦æ˜¯åœ¨ä¸Šæµ·è¯»ä¹¦çš„è¯å°±æ–¹ä¾¿å¾ˆå¤šäº†ã€‚å“ï½åŠ ä¸Šè¿˜æœ‰å‡†å¤‡è€ƒç ”ï¼Œå‡†å¤‡è€ƒç ”ï¼Œä¸€ç›´éƒ½åœ¨å‡†å¤‡ï¼Œå‡†å¤‡ç€å‡†å¤‡ç€ï¼Œåˆ°ç›®å‰ä¹Ÿæ²¡ä»€ä¹ˆè¿›åº¦ï¼Œæ„Ÿè§‰å°±åƒé»˜è®¤è‡ªå·±å·²ç»è¦äºŒæˆ˜äº†ä¸€æ ·ã€‚å¥½å¯æ‚²å•Šï¼Œå“ªæœ‰è¿˜æ²¡è€ƒå°±æƒ³ç€ä¸‹ä¸€æ¬¡çš„å•Šï¼Œæ€ä¹ˆè¯´å‘¢ï¼Œä¹Ÿä¸èƒ½è®¨åŒè¿™æ ·çš„è‡ªå·±ã€‚è¦å’Œè‡ªå·±å’Œå¹³ç›¸å¤„ï¼Œä¸è¦å’Œè‡ªå·±ä¸ºæ•Œã€‚å‡æœŸæŠŠCSAPPæå®šï¼Œä¸€å®šè¦åŠ æ²¹ï¼--><p>åˆ°è¿™é‡ŒMybatisé“¾æ¥æ•°æ®åº“çš„æ“ä½œå°±ç»“æŸäº†ï¼Œè™½ç„¶è¿˜æœ‰å¾ˆå¤šæ²¡æœ‰è®¾è®¡ï¼Œæ¯”å¦‚äº‹åŠ¡ç®¡ç†ï¼Œå¯¹è±¡å…³ç³»æ˜ å°„å•Šï¼Œä½†æ˜¯è¿™åˆä¸æ˜¯Mybatisæ•™ç¨‹ï¼Œè¦çœ‹mybatisæ•™ç¨‹çš„è¯ç§»æ­¥åšå®¢æ–‡ç« mybatisã€‚</p><p>æ€»å¾—æ¥è¯´ï¼Œmybatisç¡®å®ç›¸è¾ƒäºç›´æ¥ç”¨JDBCæ–¹ä¾¿å¾ˆå¤šï¼Œè‡ªå·±å†ä¹Ÿä¸ç”¨å¤„ç†ä»¤äººå¤´ç–¼çš„ç»“æœé›†äº†ï¼Œåªéœ€è¦å†™äº›é…ç½®æ–‡ä»¶å°±å¥½äº†ï¼Œæ•ˆç‡æé«˜äº†å¾ˆå¤šã€‚ä½†æ˜¯å¬è¯´åˆ°äº†spring bootå°±æ›´æ–¹ä¾¿äº†ï¼Œæ€»æ„Ÿè§‰å­¦ä¸å®Œå•Šã€‚</p><h2 id="Springé›†æˆMybatisæ¡†æ¶">Springé›†æˆMybatisæ¡†æ¶</h2><p>æ¥ä¸‹æ¥å°±æ˜¯springé›†æˆmybatisæ¡†æ¶äº†ï¼Œé›†æˆspringå¯ä»¥é€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰æ¥é™ä½å±‚ä¸å±‚ä¹‹é—´çš„è€¦åˆåº¦ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯å¯¹è±¡ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±newäº†ï¼Œå¯¹è±¡é—´å…³ç³»çš„ç»´æŠ¤ä¹Ÿä¸éœ€è¦æˆ‘ä»¬è‡ªå·±ç»´æŠ¤äº†ï¼Œå…¨éƒ¨äº¤ç»™Springæ¥ç®¡ç†ã€‚</p><p>springé›†æˆmybatisæ¡†æ¶æ„Ÿè§‰å°±æ˜¯æŠŠmybatisé…ç½®ç§»åˆ°äº†Springçš„é…ç½®ä¸­å»ï¼Œä»¥å‰æ˜¯mybatisé€šè¿‡åå°„å®ä¾‹åŒ–å¯¹è±¡ï¼Œå˜æˆäº†springå’Œmybatiså…±åŒå®Œæˆäº†ã€‚</p><ol><li>MyBatiséƒ¨åˆ†ï¼šMyBatisé€šè¿‡Mapperæ¥å£çš„ä»£ç†æ–¹å¼æ¥æ‰§è¡ŒSQLæ“ä½œã€‚åœ¨MyBatisä¸­ï¼Œé€šè¿‡é…ç½®æ˜ å°„æ–‡ä»¶ï¼ˆMapper XMLï¼‰æ¥å®šä¹‰SQLè¯­å¥å’Œæ˜ å°„å…³ç³»ã€‚MyBatisä¼šæ ¹æ®æ˜ å°„æ–‡ä»¶ä¸­çš„é…ç½®ï¼ŒåŠ¨æ€ç”ŸæˆMapperæ¥å£çš„ä»£ç†å¯¹è±¡ï¼Œå®ç°äº†Mapperæ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚</li><li>Springéƒ¨åˆ†ï¼šSpringè´Ÿè´£ç®¡ç†å’Œé…ç½®åº”ç”¨ç¨‹åºä¸­çš„å„ä¸ªç»„ä»¶ï¼ŒåŒ…æ‹¬Mapperæ¥å£çš„å®ä¾‹åŒ–å’Œä¾èµ–æ³¨å…¥ã€‚åœ¨é›†æˆMyBatisæ—¶ï¼ŒSpringä¼šæ‰«ææŒ‡å®šçš„åŒ…è·¯å¾„ï¼Œæ£€æµ‹å¹¶å®ä¾‹åŒ–Mapperæ¥å£çš„ä»£ç†å¯¹è±¡ã€‚Springæä¾›äº†<code>@MapperScan</code>æ³¨è§£æ¥è‡ªåŠ¨æ‰«æå’Œå®ä¾‹åŒ–Mapperæ¥å£ã€‚</li></ol><p>å½“Springå®ä¾‹åŒ–Mapperæ¥å£æ—¶ï¼Œå®ƒä¼šä½¿ç”¨MyBatisæä¾›çš„<code>MapperProxyFactory</code>ç±»æ¥åˆ›å»ºMapperæ¥å£çš„ä»£ç†å¯¹è±¡ã€‚è¯¥ä»£ç†å¯¹è±¡åœ¨æ‰§è¡Œæ–¹æ³•æ—¶ï¼Œä¼šå§”æ‰˜ç»™MyBatisçš„åº•å±‚å®ç°æ¥æ‰§è¡Œç›¸åº”çš„SQLæ“ä½œã€‚</p><p>é€šè¿‡Springå’ŒMyBatisçš„åä½œï¼Œå®ç°äº†Mapperæ¥å£çš„å®ä¾‹åŒ–å’Œä½¿ç”¨ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥åœ¨Springä¸­è½»æ¾åœ°ä½¿ç”¨MyBatisè¿›è¡Œæ•°æ®åº“æ“ä½œã€‚åŒæ—¶ï¼ŒSpringè¿˜è´Ÿè´£ç®¡ç†äº‹åŠ¡ã€æ•°æ®æºé…ç½®ç­‰ä¸æ•°æ®åº“ç›¸å…³çš„äº‹åŠ¡å¤„ç†å’Œè¿æ¥ç®¡ç†å·¥ä½œï¼Œä¸MyBatisç›¸ç»“åˆæä¾›äº†æ›´å®Œæ•´çš„æ•°æ®åº“è®¿é—®è§£å†³æ–¹æ¡ˆã€‚</p><p>ä»¥ä¸Šå†…å®¹å…¨ç”±chatGPTç”Ÿæˆï¼Œæˆ‘æ˜¯ä¸ä¼šçš„ã€‚</p><p>ç»§ç»­ã€‚</p><p>ç…§ä¾‹ï¼Œå…ˆå¼•å…¥jaråŒ…</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>druid<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2.16<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-tx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>6.0.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>6.0.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        MyBatis--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.5.13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-context<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>6.0.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>å·®ä¸å¤šå°±è¿™äº›äº†ï¼Œä¸»è¦åŒ…æ‹¬springæ¡†æ¶çš„ä¾èµ–ï¼Œmybatisä¾èµ–ï¼Œspringé›†æˆmybatisçš„ä¾èµ–ï¼Œå¾·é²ä¼Šçš„ä¾èµ–ã€‚</p><p>ç´¯äº†ï¼Œä¸æƒ³å†™äº†ã€‚ä¸‹æ¬¡è¡¥å……ã€‚ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¸ºäº†è¿›è¡Œæ•°æ®çš„æŒä¹…åŒ–ï¼Œå’Œæ•°æ®åº“æ“ä½œæ˜¯å¿…é¡»çš„æ“ä½œã€‚ æœ¬æ–‡æ¢è®¨ä¸åŒçš„æŒä¹…å±‚æ¡†æ¶é“¾æ¥æ•°æ®åº“çš„æ“ä½œã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="æ‚è°ˆ" scheme="https://trevoewu.github.io/categories/%E6%9D%82%E8%B0%88/"/>
    
    
    <category term="æ‚è°ˆ" scheme="https://trevoewu.github.io/tags/%E6%9D%82%E8%B0%88/"/>
    
    <category term="mybatis" scheme="https://trevoewu.github.io/tags/mybatis/"/>
    
    <category term="JDBC" scheme="https://trevoewu.github.io/tags/JDBC/"/>
    
    <category term="JDBCtemplate" scheme="https://trevoewu.github.io/tags/JDBCtemplate/"/>
    
  </entry>
  
  <entry>
    <title>æ‰‹å†™ç®€æ˜“Springæ¡†æ¶</title>
    <link href="https://trevoewu.github.io/2023/06/09/%E6%89%8B%E5%86%99%E7%AE%80%E6%98%93Spring%E6%A1%86%E6%9E%B6/"/>
    <id>https://trevoewu.github.io/2023/06/09/%E6%89%8B%E5%86%99%E7%AE%80%E6%98%93Spring%E6%A1%86%E6%9E%B6/</id>
    <published>2023-06-09T06:10:22.000Z</published>
    <updated>2023-06-09T06:11:33.799Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‰‹å†™Springæ¡†æ¶">æ‰‹å†™Springæ¡†æ¶</h2><p>Springåº•å±‚æ˜¯é€šè¿‡åå°„æœºåˆ¶æ¥å®ä¾‹åŒ–å¯¹è±¡ï¼Œä»¥åŠå±æ€§æ³¨å…¥çš„ï¼Œåœ¨æ‰‹å†™Springæ¡†æ¶ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£åå°„æœºåˆ¶ã€‚</p><blockquote><p>JAVAåå°„æœºåˆ¶æ˜¯åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ï¼›è¿™ç§åŠ¨æ€è·å–çš„ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºjavaè¯­è¨€çš„åå°„æœºåˆ¶ã€‚Javaåå°„æœºåˆ¶åœ¨æ¡†æ¶è®¾è®¡ä¸­æä¸ºå¹¿æ³›ï¼Œéœ€è¦æ·±å…¥ç†è§£ã€‚</p></blockquote><p>é€šè¿‡åå°„ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¿åˆ°ç±»çš„å±æ€§ï¼Œæ–¹æ³•ã€‚ å›é¡¾Springæ¡†æ¶ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªspringçš„é…ç½®æ–‡ä»¶ä¾‹å¦‚ï¼šspring.xmlï¼Œåœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æ³¨å†Œä¸€ä¸ªç±»ï¼Œå¹¶æ³¨å…¥å±æ€§å€¼ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sonetto<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>123456<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>points<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>12.3<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>isActive<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.UserDao<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.UserService<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span></code></pre><p>åœ¨å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡<code>ClassPathXmlApplicationContext()</code>ï¼Œä¼ å…¥æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ï¼Œæ‹¿åˆ°ä¸€ä¸ª<code>ApplicationContext</code>å¯¹è±¡ï¼Œé€šè¿‡<code>ApplicationContext</code>å¯¹è±¡è°ƒç”¨<code>getBeanï¼ˆï¼‰</code>æ–¹æ³•æ¥è·å–å¯¹è±¡, æœ€ç»ˆè°ƒç”¨å¯¹è±¡å‘æ–¹æ³•ï¼Œæ¥ä½¿ç”¨Beanã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"mySpring.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"userService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        userService<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æˆ‘ä»¬çš„æœ€ç»ˆç›®çš„å°±æ˜¯è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œä¸€ä¸ªæŒ‡å®šä¸€ä¸ªæ–¹æ³•éœ€è¦å››è¦ç´ ï¼š ä»€ä¹ˆå¯¹è±¡ï¼ˆå¯¹è±¡çš„å…¨é™å®šç±»åæ˜¯ä»€ä¹ˆï¼Ÿï¼‰ä»€ä¹ˆæ–¹æ³•ï¼ˆæ–¹æ³•åï¼‰ï¼Œä»€ä¹ˆå‚æ•°ï¼ˆå‚æ•°çš„ç±»å‹å’Œæ•°é‡ï¼‰ï¼Œè¿”å›ä»€ä¹ˆå€¼ã€‚</p><p>æŒ‡å®šæ¥è¿™æ–¹æ³•çš„å››ä¸ªè¦ç´ ï¼Œæˆ‘ä»¬å°±å¯ä»¥å”¯ä¸€çš„ç¡®å®šä¸€ä¸ªæ–¹æ³•ï¼Œç„¶åè°ƒç”¨è¯¥æ–¹æ³•ã€‚</p><p>åœ¨springçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæ³¨å†Œä¸€ä¸ªBeanæ—¶ï¼Œæˆ‘ä»¬éœ€è¦æä¾›è¿™ä¸ªBeançš„å…¨é™å®šç±»åï¼Œä¹Ÿå°±æ˜¯Beanæ ‡ç­¾å†…çš„classå±æ€§çš„å†…å®¹ã€‚æœ‰äº†å…¨é™å®šç±»åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡åå°„æœºåˆ¶è°ƒç”¨<code>class.forName()</code>æ‹¿åˆ°è¿™ä¸ªå¯¹è±¡çš„ç±»ã€‚æ›´è¿›ä¸€æ­¥ï¼Œé€šè¿‡è¿™ä¸ªç±»æ‹¿åˆ°æ„é€ æ–¹æ³•ï¼Œå®ä¾‹åŒ–å¯¹è±¡ã€‚æ‹¿åˆ°æˆ‘ä»¬éœ€è¦çš„ç›®æ ‡æ–¹æ³•ï¼Œæœ€ç»ˆè°ƒç”¨è¿™ä¸ªç›®æ ‡æ–¹æ³•ã€‚</p><p>æœ‰äº†æ•´ä¸ªå¤§æ¦‚çš„å…¨æ™¯å›¾ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ç¼–å†™æˆ‘ä»¬è‡ªå·±çš„Springæ¡†æ¶äº†ã€‚</p><ol><li>é¦–å…ˆï¼Œè®©æˆ‘ä»¬å…ˆç¼–å†™ä¸€ä¸ª<code>ApplicationContext</code> æ¥å£ç±»ï¼Œè¿™ä¸ªç±»å®šä¹‰äº†<code>getBean()</code>æ–¹æ³•</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>spring</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApplicationContext</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><ol start="2"><li>ç„¶åç¼–å†™è¯¥æ¥å£çš„å®ç°ç±»<code>ClassPathXmlApplicationContext</code> æˆ‘ä»¬æ­£æ˜¯é€šè¿‡è¿™ä¸ªç±»æ¥å®ä¾‹åŒ–ä¸€ä¸ª<code>ApplicationContext</code> å¯¹è±¡ã€‚å›é¡¾<code>ApplicationContext context = new ClassPathXmlApplicationContext(&quot;mySpring.xml&quot;);</code> è¿™æ®µä»£ç ï¼Œå®ä¾‹åŒ–è¿™ä¸ªç±»æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‚æ•°â€”â€”Springé…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªå‚æ•°å¯¹åº”ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„<code>ClassPathXmlApplicationContext</code>ä¹Ÿéœ€è¦æä¾›è¿™ä¸ªæ„é€ æ–¹æ³•ã€‚</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">String</span> resource<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></code></pre><ol start="3"><li><p>æˆ‘ä»¬éœ€è¦è¯»å–ä½¿ç”¨è¿™ä¸ªæ¡†æ¶çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶æ‹¿åˆ°æ‰€æœ‰çš„Beanæ ‡ç­¾ã€‚è¦æ‹¿åˆ°è¿™ä¸ªxmlæ–‡ä»¶å¹¶è¯»å–é‡Œé¢çš„æ ‡ç­¾å·²ç»å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©<code>SAXReader</code> è¿™ä¸ªç±»æ¥å®Œæˆã€‚é€šè¿‡Mavenæˆ‘ä»¬å¯ä»¥è½»æ¾çš„å¼•å…¥è¿™ä¸ªjaråŒ…ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è§£æè¿™ä¸ªxmlæ–‡ä»¶ï¼Œé€šè¿‡<code>Document</code> æ¥å®Œæˆã€‚æ‰€ä»¥æˆ‘è¿˜éœ€è¦dom4jçš„ä¾èµ–ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--        dom4jä¾èµ–--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.dom4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>dom4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.1.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        jaxençš„ä¾èµ–ï¼Œå› ä¸ºè¦ä½¿ç”¨å®ƒè§£æXMLæ–‡ä»¶--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>jaxen<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jaxen<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>æ¥ä¸‹æ¥å°±æ˜¯æ„‰å¿«çš„ç¼–å†™ä»£ç å•¦ï¼</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>spring</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">Document</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">DocumentException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">Element</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">Node</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">SAXReader</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Constructor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassPathXmlApplicationContext</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContext</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span>beans <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">String</span> resource<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1. æ‹¿åˆ°è¿™ä¸ªxmlé…ç½®æ–‡ä»¶</span>        <span class="token class-name">SAXReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SAXReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Document</span> document <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            document <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è·å–æ‰€æœ‰çš„beanæ ‡ç­¾</span>            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">></span></span> beanNodes <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">"//bean"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// éå†é›†åˆ</span>            beanNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>beanNode <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Element</span> beanElt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> beanNode<span class="token punctuation">;</span>                <span class="token comment">// è·å–id</span>                <span class="token class-name">String</span> id <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// è·å–className</span>                <span class="token class-name">String</span> className <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"id->"</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">" className->"</span><span class="token operator">+</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">//é€šè¿‡åå°„æ‹¿åˆ°class</span>                    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// è·å¾—classçš„æ„é€ å™¨</span>                    <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> constructor <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// å®ä¾‹åŒ–å¯¹è±¡</span>                    <span class="token class-name">Object</span> o <span class="token operator">=</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å®ä¾‹åŒ–å¯¹è±¡->"</span><span class="token operator">+</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// æš´éœ²beanï¼Œæ”¾åœ¨mapï¼ˆç¼“å­˜ï¼‰</span>                    beans<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//å†æ¬¡éå†beanï¼Œç»™å±æ€§èµ‹å€¼ï¼ˆDIï¼‰</span>            beanNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>beanNode <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Element</span> beanElt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> beanNode<span class="token punctuation">;</span>                <span class="token comment">// è·å–id</span>                <span class="token class-name">String</span> id <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// è·å–className</span>                <span class="token class-name">String</span> className <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// è·å–å®ä¾‹åŒ–å¯¹è±¡</span>                <span class="token class-name">Object</span> bean <span class="token operator">=</span> beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>                logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è·å–å®ä¾‹åŒ–å¯¹è±¡"</span><span class="token operator">+</span>bean<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//æ‹¿åˆ°properties</span>                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">></span></span> properties <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">"property"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                properties<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>property <span class="token operator">-></span><span class="token punctuation">&#123;</span>                    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è·å–property-> "</span> <span class="token operator">+</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">Element</span> element <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> property<span class="token punctuation">;</span>                    <span class="token class-name">String</span> name <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> arg <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> ref <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"ref"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> methodName <span class="token operator">=</span> <span class="token string">"set"</span><span class="token operator">+</span>name<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"methodName="</span><span class="token operator">+</span>methodName<span class="token operator">+</span><span class="token string">" arg="</span><span class="token operator">+</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">Object</span> actualValue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                        <span class="token comment">//è·å¾—å±æ€§</span>                        <span class="token class-name">Field</span> field <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token class-name">Method</span> method <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>methodName<span class="token punctuation">,</span> field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å‚æ•°ç±»å‹->"</span><span class="token operator">+</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>ref <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                            <span class="token comment">//å¦‚æœå‚æ•°æ˜¯å¼•ç”¨æ•°æ®ç±»å‹</span>                            method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span>beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> arg <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                            <span class="token comment">//å‚æ•°æ˜¯ç®€å•æ•°æ®ç±»å‹</span>                            <span class="token keyword">switch</span> <span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                                <span class="token keyword">case</span> <span class="token string">"boolean"</span><span class="token punctuation">,</span><span class="token string">"Boolean"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token function">parseBoolean</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"byte"</span><span class="token punctuation">,</span><span class="token string">"Byte"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Byte</span><span class="token punctuation">.</span><span class="token function">parseByte</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"short"</span><span class="token punctuation">,</span><span class="token string">"Short"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Short</span><span class="token punctuation">.</span><span class="token function">parseShort</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"int"</span><span class="token punctuation">,</span><span class="token string">"Integer"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"long"</span><span class="token punctuation">,</span> <span class="token string">"Long"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"float"</span><span class="token punctuation">,</span><span class="token string">"Float"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"double"</span><span class="token punctuation">,</span><span class="token string">"Double"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"char"</span><span class="token punctuation">,</span><span class="token string">"Character"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> arg<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"String"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> arg<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                            method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span>actualValue<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre></li></ol><p>ä»£ç å¾ˆé•¿ï¼Œåˆ«æ€¥æˆ‘ä»¬ä¸€æ­¥æ­¥åˆ†æï¼š</p><p>è¿™æ®µä»£ç åšä¸‰ä»¶äº‹ï¼š</p><ol><li><p>é€šè¿‡ <code>document = reader.read(ClassLoader.getSystemClassLoader().getResourceAsStream(resource));</code>æ‹¿åˆ°é…ç½®æ–‡ä»¶ã€‚</p></li><li><p>æ‹¿åˆ°æ‰€ä»¥çš„beanæ ‡ç­¾,è·å–æ ‡ç­¾çš„nameå±æ€§å’Œå’Œclasså±æ€§å€¼ï¼Œnameå±æ€§å€¼æ˜¯è¿™ä¸ªbeançš„idï¼Œclassæ˜¯è¿™ä¸ªç±»çš„å…¨é™å®šç±»åã€‚</p></li><li><p>é€šè¿‡åå°„æœºåˆ¶å®ä¾‹åŒ–å¯¹è±¡ï¼Œå¹¶æ”¾åˆ°mapé›†åˆä¸­ã€‚</p><p>è¿™ä¸€æ­¥ç›¸å½“äºæŠŠbeanæ”¾å…¥äºŒçº§ç¼“å­˜ä¸­ï¼Œæå‰æš´éœ²beanã€‚mapé›†åˆå°±æ˜¯äºŒçº§ç¼“å­˜ï¼Œå…¶ä¸­keyå­˜æ”¾å¯¹è±¡çš„nameæˆ–idï¼Œvalueå­˜æ”¾è¿™ä¸ªå®ä¾‹åŒ–çš„å¯¹è±¡ã€‚</p></li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//1. æ‹¿åˆ°è¿™ä¸ªxmlé…ç½®æ–‡ä»¶</span><span class="token class-name">SAXReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SAXReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Document</span> document <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    document <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è·å–æ‰€æœ‰çš„beanæ ‡ç­¾</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">></span></span> beanNodes <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">"//bean"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// éå†é›†åˆ</span>    beanNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>beanNode <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Element</span> beanElt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> beanNode<span class="token punctuation">;</span>        <span class="token comment">// è·å–id</span>        <span class="token class-name">String</span> id <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·å–className</span>        <span class="token class-name">String</span> className <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"id->"</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">" className->"</span><span class="token operator">+</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//é€šè¿‡åå°„æ‹¿åˆ°class</span>            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è·å¾—classçš„æ„é€ å™¨</span>            <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> constructor <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å®ä¾‹åŒ–å¯¹è±¡</span>            <span class="token class-name">Object</span> o <span class="token operator">=</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å®ä¾‹åŒ–å¯¹è±¡->"</span><span class="token operator">+</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// æš´éœ²beanï¼Œæ”¾åœ¨mapï¼ˆç¼“å­˜ï¼‰</span>            beans<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å®ä¾‹åŒ–beanä¹‹åï¼Œæ¥ä¸‹é‡Œå°±æ˜¯ä¾èµ–æ³¨å…¥äº†ï¼ˆDependency Injectionï¼‰ã€‚æˆ‘ä»¬éœ€è¦å†æ¬¡éå†æ¯ä¸€ä¸ªbeanèŠ‚ç‚¹ï¼Œä¸€ä¸ªbeanèŠ‚ç‚¹ç›¸å½“äºä¸€ä¸ªbeanå¯¹è±¡ã€‚å¯¹äºæ¯ä¸€ä¸ªbeanå¯¹è±¡ï¼Œå†æ¬¡éå†beanå¯¹è±¡çš„<property>æ ‡ç­¾ï¼Œè¿™å¯¹äºè¿™äº›benaå¯¹è±¡çš„å±æ€§å€¼ï¼Œå¯¹äºè¿™äº›å±æ€§å€¼ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡setæ³¨å…¥çš„æ–¹æ³•ç»™å±æ€§èµ‹å€¼ã€‚</property></p><p>è¿™æ—¶å€™å°±æ˜¯è°ƒç”¨å¯¹è±¡çš„setæ–¹æ³•äº†ï¼Œè¿˜è®°å¾—è°ƒç”¨æ–¹æ³•çš„å››è¦ç´ å—ï¼Ÿæ²¡é”™ï¼Œæˆ‘ä»¬éœ€è¦æ–¹æ³•æ‰€å±çš„å¯¹è±¡ï¼Œæ–¹æ³•åï¼Œæ–¹æ³•å‚æ•°ï¼Œä»¥åŠè¿”å›å€¼ç±»å‹ã€‚</p><p>å…¶ä¸­ï¼Œå¯¹è±¡æˆ‘ä»¬å¯ä»¥é€šè¿‡äºŒçº§ç¼“å­˜æ‹¿åˆ°ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€éƒ¨åˆ†çš„mapé›†åˆã€‚æ–¹æ³•å‚æ•°ä¹Ÿæ˜¯å±æ€§å€¼ï¼Œåœ¨propertyæ ‡ç­¾çš„valueå±æ€§å€¼æŒ‡æ˜ã€‚è¿”å›å€¼å°±æ›´è½»æ¾äº†ï¼Œsetæ–¹æ³•çš„è¿”å›å€¼éƒ½æ˜¯voidã€‚</p><p>é‚£ä¹ˆå‰©ä¸‹çš„ï¼Œå°±æ˜¯æ–¹æ³•åäº†ï¼ŒæŒ‰ç…§Javaå‘½åè§„èŒƒè§„èŒƒï¼Œsetæ–¹æ³•åæœ‰setåŠ ä¸Šå±æ€§åçš„é¦–å­—æ¯å¤§å°ç»„æˆï¼Œç¬¦åˆé©¼å³°å‘½åè§„èŒƒã€‚æˆ‘ä»¬æ‹¿åˆ°äº†å±æ€§å€¼ï¼Œå°±å¯ä»¥é€šè¿‡æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹æ³•æ¥å¾—åˆ°æ–¹æ³•åã€‚</p><p>ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå±æ€§å€¼æœ‰æ™®é€šç±»å‹å’Œå¼•ç”¨ç±»å‹ä¸¤ç§ï¼Œå¯¹åº”å¼•ç”¨ç±»å‹ï¼Œæˆ‘ä»¬çš„åšæ³•å¾ˆç®€å•ï¼Œé€šè¿‡äºŒçº§ç¼“å­˜æ‹¿åˆ°å¼•ç”¨å¯¹è±¡ï¼Œå†é€šè¿‡setæ–¹æ³•æ³¨å…¥å°±å¥½å•¦ã€‚ä½†æ˜¯æ™®é€šç±»å‹å°±æ¯”è¾ƒéº»çƒ¦äº†ã€‚</p><p>é¦–å…ˆï¼Œæ™®é€šç±»å‹å¤ªå¤šï¼Œè€Œæˆ‘ä»¬ä»é…ç½®æ–‡ä»¶ä¸­æ‹¿åˆ°çš„æ•°æ®éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚æœç›®æ ‡å±æ€§æ˜¯Stringç±»å‹çš„è¯å¾ˆç›´æ¥ï¼Œç›´æ¥è°ƒç”¨setæ–¹æ³•å³å¯ã€‚ä½†æ˜¯å¦‚æœå±æ€§ç±»å‹æ˜¯intç±»å‹ï¼Œæˆ–è€…boolç±»å‹ï¼Œæˆ‘ä»¬å°±éœ€è¦æŠŠStringç±»å‹è½¬æ¢æˆå¯¹åº”çš„ç±»å‹ã€‚</p><p>å¥½åœ¨è¿™äº›æ™®é€šç±»éƒ½æœ‰å¯¹åº”çš„åŒ…è£…ç±»å‹ï¼Œé€šåŒ…è£…ç±»å‹æˆ‘ä»¬å¯ä»¥è½»æ¾çš„å®ç°å­—ç¬¦ä¸²ç±»å‹çš„è½¬æ¢ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦çš„å°±æ˜¯åŒ¹é…æ¯ä¸€ä¸ªæ™®é€šç±»å‹ï¼Œå¯¹è¿™æ ·çš„ç±»å‹åšç±»å‹è½¬æ¢å³å¯ã€‚</p><p>æ™®é€šç±»å‹å¤ªå¤šï¼Œå‡ºäºå­¦ä¹ çš„ç›®çš„ï¼Œå‡è®¾æˆ‘ä»¬çš„Springæ¡†æ¶åªæ”¯æŒå…¶ä¸­éƒ¨åˆ†ç±»å‹ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//å†æ¬¡éå†beanï¼Œç»™å±æ€§èµ‹å€¼ï¼ˆDIï¼‰</span>beanNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>beanNode <span class="token operator">-></span> <span class="token punctuation">&#123;</span>  <span class="token class-name">Element</span> beanElt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> beanNode<span class="token punctuation">;</span>  <span class="token comment">// è·å–id</span>  <span class="token class-name">String</span> id <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è·å–className</span>  <span class="token class-name">String</span> className <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è·å–å®ä¾‹åŒ–å¯¹è±¡</span>  <span class="token class-name">Object</span> bean <span class="token operator">=</span> beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>  logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è·å–å®ä¾‹åŒ–å¯¹è±¡"</span><span class="token operator">+</span>bean<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//æ‹¿åˆ°properties</span>  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">></span></span> properties <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">"property"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  properties<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>property <span class="token operator">-></span><span class="token punctuation">&#123;</span>      logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è·å–property-> "</span> <span class="token operator">+</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">Element</span> element <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> property<span class="token punctuation">;</span>      <span class="token class-name">String</span> name <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">String</span> arg <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">String</span> ref <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"ref"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">String</span> methodName <span class="token operator">=</span> <span class="token string">"set"</span><span class="token operator">+</span>name<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"methodName="</span><span class="token operator">+</span>methodName<span class="token operator">+</span><span class="token string">" arg="</span><span class="token operator">+</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">Object</span> actualValue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>          <span class="token comment">//è·å¾—å±æ€§</span>          <span class="token class-name">Field</span> field <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">Method</span> method <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>methodName<span class="token punctuation">,</span> field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å‚æ•°ç±»å‹->"</span><span class="token operator">+</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">if</span><span class="token punctuation">(</span>ref <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>              <span class="token comment">//å¦‚æœå‚æ•°æ˜¯å¼•ç”¨æ•°æ®ç±»å‹</span>              method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span>beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> arg <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>              <span class="token comment">//å‚æ•°æ˜¯ç®€å•æ•°æ®ç±»å‹</span>              <span class="token keyword">switch</span> <span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                  <span class="token keyword">case</span> <span class="token string">"boolean"</span><span class="token punctuation">,</span><span class="token string">"Boolean"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token function">parseBoolean</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"byte"</span><span class="token punctuation">,</span><span class="token string">"Byte"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Byte</span><span class="token punctuation">.</span><span class="token function">parseByte</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"short"</span><span class="token punctuation">,</span><span class="token string">"Short"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Short</span><span class="token punctuation">.</span><span class="token function">parseShort</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"int"</span><span class="token punctuation">,</span><span class="token string">"Integer"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"long"</span><span class="token punctuation">,</span> <span class="token string">"Long"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"float"</span><span class="token punctuation">,</span><span class="token string">"Float"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"double"</span><span class="token punctuation">,</span><span class="token string">"Double"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"char"</span><span class="token punctuation">,</span><span class="token string">"Character"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> arg<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"String"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> arg<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>              <span class="token punctuation">&#125;</span>              method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span>actualValue<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span></code></pre><p>æœ€åï¼Œæä¾›ä¸€ä¸ªgetBeanæ–¹æ³•çš„æ¥å£ï¼Œç”¨äºæ´»åŠ¨å®ä¾‹åŒ–çš„bean</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„Springæ¡†æ¶å°±ç®—ç¼–å†™å®Œäº†ï¼Œæ‰“åŒ…å‘å¸ƒå§ï¼</p><img src="image-20230609140316257.png" alt="image-20230609140316257" style="zoom:30%;" loading="lazy"><h3 id="æµ‹è¯•è‡ªå·±çš„Springæ¡†æ¶">æµ‹è¯•è‡ªå·±çš„Springæ¡†æ¶</h3><p>åˆ›å»ºä¸€ä¸ªMavenæ¨¡å—ï¼Œå¹¶å¼•å…¥åˆšåˆšæ‰“åŒ…å¥½çš„jaråŒ…å§</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>cn.loulan<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>MySpring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªBeanç±»</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">float</span> points<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isActive<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setIsActive</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> active<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        isActive <span class="token operator">=</span> active<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>ç„¶åæ˜¯Springé…ç½®æ–‡ä»¶</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>beans<span class="token punctuation">></span></span>    <span class="token generics"><span class="token punctuation">&lt;</span>beans<span class="token punctuation">></span></span>        <span class="token operator">&lt;</span>bean name<span class="token operator">=</span><span class="token string">"user"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bean.User"</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"id"</span> value<span class="token operator">=</span><span class="token string">"1"</span><span class="token operator">/</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"username"</span> value<span class="token operator">=</span><span class="token string">"sonetto"</span><span class="token operator">/</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"password"</span> value<span class="token operator">=</span><span class="token string">"123456"</span><span class="token operator">/</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"points"</span> value<span class="token operator">=</span><span class="token string">"12.3"</span><span class="token operator">/</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"isActive"</span> value<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>        <span class="token operator">&lt;</span>bean name<span class="token operator">=</span><span class="token string">"userDao"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bean.UserDao"</span><span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span>bean name<span class="token operator">=</span><span class="token string">"userService"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bean.UserService"</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"userDao"</span> ref<span class="token operator">=</span><span class="token string">"userDao"</span><span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">></span></code></pre><p>ç¼–å†™æµ‹è¯•ç±»ï¼š</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">ClassPathXmlApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">DefaultSingletonBeanRegistry</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestBean</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"mySpring.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><img src="image-20230609140900802.png" alt="image-20230609140900802" loading="lazy"></p><p>è·‘èµ·æ¥äº†ï¼</p>]]></content>
    
    
    <summary type="html">åœ¨å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡`ClassPathXmlApplicationContext()`ï¼Œä¼ å…¥æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ï¼Œæ‹¿åˆ°ä¸€ä¸ª`ApplicationContext`å¯¹è±¡ï¼Œé€šè¿‡`ApplicationContext`å¯¹è±¡è°ƒç”¨`getBeanï¼ˆï¼‰`æ–¹æ³•æ¥è·å–å¯¹è±¡, æœ€ç»ˆè°ƒç”¨å¯¹è±¡å‘æ–¹æ³•ï¼Œæ¥ä½¿ç”¨Beanã€‚</summary>
    
    
    
    <category term="spring" scheme="https://trevoewu.github.io/categories/spring/"/>
    
    <category term="java" scheme="https://trevoewu.github.io/categories/spring/java/"/>
    
    <category term="javaweb" scheme="https://trevoewu.github.io/categories/spring/java/javaweb/"/>
    
    
    <category term="spring" scheme="https://trevoewu.github.io/tags/spring/"/>
    
  </entry>
  
  <entry>
    <title>Spring å­¦ä¹ ç¬”è®°</title>
    <link href="https://trevoewu.github.io/2023/06/03/Spring-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>https://trevoewu.github.io/2023/06/03/Spring-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2023-06-03T07:49:54.000Z</published>
    <updated>2023-06-10T08:43:20.933Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Springæ¦‚è¿°">Springæ¦‚è¿°</h2><ul><li><p><strong>Springæ¡†æ¶</strong>æ˜¯<a href="https://zh.wikipedia.org/wiki/Java">Java</a>å¹³å°çš„ä¸€ä¸ª<a href="https://zh.wikipedia.org/wiki/%E5%BC%80%E6%94%BE%E6%BA%90%E4%BB%A3%E7%A0%81">å¼€æº</a>çš„å…¨æ ˆï¼ˆ<a href="https://zh.wikipedia.org/wiki/%E5%85%A8%E6%A0%88">full-stack</a>ï¼‰<a href="https://zh.wikipedia.org/wiki/%E8%BD%AF%E4%BB%B6%E6%A1%86%E6%9E%B6">åº”ç”¨ç¨‹å¼æ¡†æ¶</a>å’Œ<a href="https://zh.wikipedia.org/wiki/%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC">æ§åˆ¶åè½¬</a>å®¹å™¨å®ç°ï¼Œä¸€èˆ¬è¢«ç›´æ¥ç§°ä¸ºSpringã€‚</p></li><li><p><strong>Spring</strong>æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ§åˆ¶<strong>åè½¬(IoC)<strong>å’Œé¢å‘</strong>åˆ‡é¢(AOP)<strong>çš„</strong>å®¹å™¨æ¡†æ¶</strong>ã€‚</p></li><li><p>Springæœ€åˆçš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³EJBè‡ƒè‚¿çš„è®¾è®¡ï¼Œä»¥åŠéš¾ä»¥æµ‹è¯•ç­‰é—®é¢˜ã€‚</p></li><li><p>Springä¸ºç®€åŒ–å¼€å‘è€Œç”Ÿï¼Œè®©ç¨‹åºå‘˜åªéœ€å…³æ³¨æ ¸å¿ƒä¸šåŠ¡çš„å®ç°ï¼Œå°½å¯èƒ½çš„ä¸å†å…³æ³¨éä¸šåŠ¡é€»è¾‘ä»£ç ï¼ˆäº‹åŠ¡æ§åˆ¶ï¼Œå®‰å…¨æ—¥å¿—ç­‰ï¼‰ã€‚</p></li></ul><h2 id="Springç‰¹ç‚¹">Springç‰¹ç‚¹</h2><ol><li><p>è½»é‡</p></li><li><ol><li>ä»å¤§å°ä¸å¼€é”€ä¸¤æ–¹é¢è€Œè¨€Springéƒ½æ˜¯è½»é‡çš„ã€‚å®Œæ•´çš„Springæ¡†æ¶å¯ä»¥åœ¨ä¸€ä¸ªå¤§å°åªæœ‰1MBå¤šçš„JARæ–‡ä»¶é‡Œå‘å¸ƒã€‚å¹¶ä¸”Springæ‰€éœ€çš„å¤„ç†å¼€é”€ä¹Ÿæ˜¯å¾®ä¸è¶³é“çš„ã€‚</li><li>Spring<strong>æ˜¯éä¾µå…¥å¼</strong>çš„ï¼šSpringåº”ç”¨ä¸­çš„å¯¹è±¡ä¸ä¾èµ–äºSpringçš„ç‰¹å®šç±»ã€‚</li></ol></li><li><p><strong>æ§åˆ¶åè½¬</strong></p></li><li><ol><li>Springé€šè¿‡ä¸€ç§ç§°ä½œæ§åˆ¶åè½¬ï¼ˆIoCï¼‰çš„æŠ€æœ¯ä¿ƒè¿›äº†æ¾è€¦åˆã€‚å½“åº”ç”¨äº†IoCï¼Œä¸€ä¸ªå¯¹è±¡ä¾èµ–çš„å…¶å®ƒå¯¹è±¡ä¼šé€šè¿‡è¢«åŠ¨çš„æ–¹å¼ä¼ é€’è¿›æ¥ï¼Œè€Œä¸æ˜¯è¿™ä¸ªå¯¹è±¡è‡ªå·±åˆ›å»ºæˆ–è€…æŸ¥æ‰¾ä¾èµ–å¯¹è±¡ã€‚ä½ å¯ä»¥è®¤ä¸ºIoCä¸JNDIç›¸åâ€”â€”ä¸æ˜¯å¯¹è±¡ä»å®¹å™¨ä¸­æŸ¥æ‰¾ä¾èµ–ï¼Œè€Œæ˜¯å®¹å™¨åœ¨å¯¹è±¡åˆå§‹åŒ–æ—¶ä¸ç­‰å¯¹è±¡è¯·æ±‚å°±ä¸»åŠ¨å°†ä¾èµ–ä¼ é€’ç»™å®ƒã€‚</li></ol></li><li><p><strong>é¢å‘åˆ‡é¢</strong></p></li><li><ol><li>Springæä¾›äº†é¢å‘åˆ‡é¢ç¼–ç¨‹çš„ä¸°å¯Œæ”¯æŒï¼Œå…è®¸é€šè¿‡åˆ†ç¦»åº”ç”¨çš„ä¸šåŠ¡é€»è¾‘ä¸ç³»ç»Ÿçº§æœåŠ¡ï¼ˆä¾‹å¦‚å®¡è®¡ï¼ˆauditingï¼‰å’Œäº‹åŠ¡ï¼ˆtransactionï¼‰ç®¡ç†ï¼‰è¿›è¡Œå†…èšæ€§çš„å¼€å‘ã€‚åº”ç”¨å¯¹è±¡åªå®ç°å®ƒä»¬åº”è¯¥åšçš„â€”â€”å®Œæˆä¸šåŠ¡é€»è¾‘â€”â€”ä»…æ­¤è€Œå·²ã€‚å®ƒä»¬å¹¶ä¸è´Ÿè´£ï¼ˆç”šè‡³æ˜¯æ„è¯†ï¼‰å…¶å®ƒçš„ç³»ç»Ÿçº§å…³æ³¨ç‚¹ï¼Œä¾‹å¦‚æ—¥å¿—æˆ–äº‹åŠ¡æ”¯æŒã€‚</li></ol></li><li><p>å®¹å™¨</p></li><li><ol><li>SpringåŒ…å«å¹¶ç®¡ç†åº”ç”¨å¯¹è±¡çš„é…ç½®å’Œç”Ÿå‘½å‘¨æœŸï¼Œåœ¨è¿™ä¸ªæ„ä¹‰ä¸Šå®ƒæ˜¯ä¸€ç§å®¹å™¨ï¼Œä½ å¯ä»¥é…ç½®ä½ çš„æ¯ä¸ªbeanå¦‚ä½•è¢«åˆ›å»ºâ€”â€”åŸºäºä¸€ä¸ªå¯é…ç½®åŸå‹ï¼ˆprototypeï¼‰ï¼Œä½ çš„beanå¯ä»¥åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„å®ä¾‹æˆ–è€…æ¯æ¬¡éœ€è¦æ—¶éƒ½ç”Ÿæˆä¸€ä¸ªæ–°çš„å®ä¾‹â€”â€”ä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•ç›¸äº’å…³è”çš„ã€‚ç„¶è€Œï¼ŒSpringä¸åº”è¯¥è¢«æ··åŒäºä¼ ç»Ÿçš„é‡é‡çº§çš„EJBå®¹å™¨ï¼Œå®ƒä»¬ç»å¸¸æ˜¯åºå¤§ä¸ç¬¨é‡çš„ï¼Œéš¾ä»¥ä½¿ç”¨ã€‚</li></ol></li><li><p>æ¡†æ¶</p></li><li><ol><li>Springå¯ä»¥å°†ç®€å•çš„ç»„ä»¶é…ç½®ã€ç»„åˆæˆä¸ºå¤æ‚çš„åº”ç”¨ã€‚åœ¨Springä¸­ï¼Œåº”ç”¨å¯¹è±¡è¢«å£°æ˜å¼åœ°ç»„åˆï¼Œå…¸å‹åœ°æ˜¯åœ¨ä¸€ä¸ªXMLæ–‡ä»¶é‡Œã€‚Springä¹Ÿæä¾›äº†å¾ˆå¤šåŸºç¡€åŠŸèƒ½ï¼ˆäº‹åŠ¡ç®¡ç†ã€æŒä¹…åŒ–æ¡†æ¶é›†æˆç­‰ç­‰ï¼‰ï¼Œå°†åº”ç”¨é€»è¾‘çš„å¼€å‘ç•™ç»™äº†ä½ ã€‚</li></ol></li></ol><p>æ‰€æœ‰Springçš„è¿™äº›ç‰¹å¾ä½¿ä½ èƒ½å¤Ÿç¼–å†™æ›´å¹²å‡€ã€æ›´å¯ç®¡ç†ã€å¹¶ä¸”æ›´æ˜“äºæµ‹è¯•çš„ä»£ç ã€‚å®ƒä»¬ä¹Ÿä¸ºSpringä¸­çš„å„ç§æ¨¡å—æä¾›äº†åŸºç¡€æ”¯æŒã€‚</p><h2 id="Springå¯¹IOCçš„å®ç°">Springå¯¹IOCçš„å®ç°</h2><ul><li><blockquote><p>æ§åˆ¶åè½¬ï¼ˆInversion of Controlï¼ŒIoCï¼‰æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œå¯ä»¥ç”¨æ¥é™ä½ä»£ç ä¹‹é—´çš„è€¦åˆåº¦ï¼Œç¬¦åˆ<strong>ä¾èµ–å€’ç½®åŸåˆ™</strong>ã€‚</p><p>æ§åˆ¶åè½¬çš„æ ¸å¿ƒæ˜¯ï¼š<strong>å°†å¯¹è±¡çš„åˆ›å»ºæƒäº¤å‡ºå»ï¼Œå°†å¯¹è±¡å’Œå¯¹è±¡ä¹‹é—´å…³ç³»çš„ç®¡ç†æƒäº¤å‡ºå»ï¼Œç”±ç¬¬ä¸‰æ–¹å®¹å™¨æ¥è´Ÿè´£åˆ›å»ºä¸ç»´æŠ¤</strong>ã€‚</p><p>æ§åˆ¶åè½¬å¸¸è§çš„å®ç°æ–¹å¼ï¼šä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼Œç®€ç§°DIï¼‰</p></blockquote></li><li></li></ul><p><strong>Springé€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼æ¥å®ŒæˆBeanç®¡ç†çš„ã€‚</strong></p><p><strong>Beanç®¡ç†è¯´çš„æ˜¯ï¼šBeanå¯¹è±¡çš„åˆ›å»ºï¼Œä»¥åŠBeanå¯¹è±¡ä¸­å±æ€§çš„èµ‹å€¼ï¼ˆæˆ–è€…å«åšBeanå¯¹è±¡ä¹‹é—´å…³ç³»çš„ç»´æŠ¤ï¼‰ã€‚</strong></p><p>ä¾èµ–æ³¨å…¥ï¼š</p><ul><li><p>ä¾èµ–æŒ‡çš„æ˜¯å¯¹è±¡å’Œå¯¹è±¡ä¹‹é—´çš„å…³è”å…³ç³»ã€‚</p></li><li><p>æ³¨å…¥æŒ‡çš„æ˜¯ä¸€ç§æ•°æ®ä¼ é€’è¡Œä¸ºï¼Œé€šè¿‡æ³¨å…¥è¡Œä¸ºæ¥è®©å¯¹è±¡å’Œå¯¹è±¡äº§ç”Ÿå…³ç³»ã€‚</p><ul><li>ä¾èµ–æ³¨å…¥å¸¸è§çš„å®ç°æ–¹å¼åŒ…æ‹¬ä¸¤ç§ï¼šsetæ³¨å…¥ æ„é€ æ³¨å…¥</li></ul><h3 id="setæ³¨å…¥">setæ³¨å…¥</h3><p><strong>åŸç†ï¼š</strong></p><ol><li><p>é€šè¿‡<code>property</code>æ ‡ç­¾è·å–åˆ°å±æ€§åï¼šuserDao</p></li><li><p>é€šè¿‡å±æ€§åæ¨æ–­å‡ºsetæ–¹æ³•åï¼šsetUserDao</p></li><li><p>é€šè¿‡åå°„æœºåˆ¶è°ƒç”¨setUserDao()æ–¹æ³•ç»™å±æ€§èµ‹å€¼</p></li></ol><p><code>property</code>æ ‡ç­¾çš„nameæ˜¯å±æ€§åã€‚</p><p><code>property</code>æ ‡ç­¾çš„refæ˜¯è¦æ³¨å…¥çš„beanå¯¹è±¡çš„idã€‚</p><p><strong>(é€šè¿‡refå±æ€§æ¥å®Œæˆbeançš„è£…é…ï¼Œè¿™æ˜¯beanæœ€ç®€å•çš„ä¸€ç§è£…é…æ–¹å¼ã€‚è£…é…æŒ‡çš„æ˜¯ï¼šåˆ›å»ºç³»ç»Ÿç»„ä»¶ä¹‹é—´å…³è”çš„åŠ¨ä½œ)</strong></p><p>==setæ³¨å…¥çš„æ ¸å¿ƒå®ç°åŸç†ï¼šé€šè¿‡åå°„æœºåˆ¶è°ƒç”¨setæ–¹æ³•æ¥ç»™å±æ€§èµ‹å€¼ï¼Œè®©ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´äº§ç”Ÿå…³ç³»ã€‚==</p><p>TeacherServiceå¾€å¾€éœ€è¦ä¾èµ–TeacherMapper/Dao å¯¹è±¡ï¼Œ ä¸ºäº†é™ä½ç±»ä¸ç±»ï¼Œå±‚ä¸å±‚ä¹‹é—´çš„è€¦åˆåº¦ï¼Œæˆ‘ä»¬é€šå¸¸é‡‡ç”¨é¢å‘æ¥å£ç¼–ç¨‹ã€‚æŠŠå¯¹è±¡çš„åˆ›å»ºæƒäº¤å‡ºå»ï¼Œäº¤ç»™Springå®¹å™¨æ¥ç®¡ç†ã€‚ç”±Springå®¹å™¨æ¥åˆ›å»ºå¯¹è±¡å’Œç»´æŠ¤å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„å…³ç³»ã€‚</p><p>é€šè¿‡åœ¨springé…ç½®æ–‡ä»¶ï¼ˆå¦‚spring-config.xmlï¼‰ä¸­ï¼Œæ³¨å†ŒBeanï¼Œä»¥åŠBeanä¸Beançš„å…³ç³»ï¼ŒBeançš„å±æ€§å€¼ï¼Œæ¥è®©Springå»åˆ›å»ºå’Œæ³¨å…¥Beanã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherMapper<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mapper.teacher.TeacherMapperImpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--    åŸºäºsetterçš„å¤–éƒ¨Beanæ³¨å…¥--></span><span class="token comment">&lt;!--    &lt;property> æ ‡ç­¾å†…çš„nameå±æ€§æ˜¯å¯¹åº”setteræ–¹æ³•çš„æ–¹æ³•åå»æ‰setterï¼Œé¦–å­—æ¯å°å†™--></span><span class="token comment">&lt;!--    åœ¨è§„èŒƒçš„Bean setter æ–¹æ³•ä¸­ï¼Œè¿™ä¸ªå€¼å°±ç­‰äºBeançš„å±æ€§åç§°--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>service.teacher.TeacherService<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherMapper<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherMapper<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre><p>åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æ³¨å†Œäº†ä¸¤ä¸ªBeanï¼Œ<code>teacherMapper</code>å’Œ<code>teacherService</code> ï¼Œå¹¶é€šè¿‡setæ³¨å…¥æ¥ç»™å±æ€§è´Ÿè´£ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestTeacherService</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTeacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>          <span class="token class-name">ApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"spring.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">TeacherService</span> teacherService <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"teacherService"</span><span class="token punctuation">,</span> <span class="token class-name">TeacherService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          teacherService<span class="token punctuation">.</span><span class="token function">getTeachers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>applicatContext</code>å¯¹è±¡å¾—åˆ°ï¼Œ<code>applicationContext</code>å¯¹è±¡é€šè¿‡è¯»å–é…ç½®æ–‡ä»¶å¾—åˆ°ã€‚</p><p>è°ƒç”¨<code>applicatonContext.getBean(&quot;Bean id&quot;)</code>æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°å®ä¾‹åŒ–çš„Beanäº†ã€‚</p><h3 id="æ„é€ æ³¨å…¥">æ„é€ æ³¨å…¥</h3><p>==é€šè¿‡è°ƒç”¨æ„é€ æ–¹æ³•æ¥ç»™å±æ€§èµ‹å€¼ã€‚==</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    åŸºäºæ„é€ æ–¹æ³•æ³¨å…¥--></span><span class="token comment">&lt;!--    è¦æ±‚å¯¹åº”Beanä¸­è¦æœ‰å¯¹åº”çš„æ„é€ æ–¹æ³•--></span><span class="token comment">&lt;!--    å¯ä»¥é€šè¿‡&lt;constructor-arg>æ ‡ç­¾ æ³¨å…¥å±æ€§å€¼--></span><span class="token comment">&lt;!--    å…¶ä¸­ï¼Œnameå±æ€§é€šè¿‡å±æ€§åå®Œæˆæ³¨å…¥ï¼Œå€¼ä¸ºvalue--></span><span class="token comment">&lt;!--    index ä½¿ç”¨å±æ€§å€¼ä¸‹æ ‡å®Œæˆæ³¨å…¥ï¼Œä»0å¼€å§‹--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>unveil a new cd<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>regulus<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>description<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>new cd<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre></li></ul><h2 id="setæ³¨å…¥ä¸“é¢˜">setæ³¨å…¥ä¸“é¢˜</h2><h3 id="æ³¨å…¥å¤–éƒ¨Beanå’Œå†…éƒ¨Bean">æ³¨å…¥å¤–éƒ¨Beanå’Œå†…éƒ¨Bean</h3><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    åŸºäºsetterçš„å¤–éƒ¨Beanæ³¨å…¥--></span><span class="token comment">&lt;!--    &lt;property> æ ‡ç­¾å†…çš„nameå±æ€§æ˜¯å¯¹åº”setteræ–¹æ³•çš„æ–¹æ³•åå»æ‰setterï¼Œé¦–å­—æ¯å°å†™--></span><span class="token comment">&lt;!--    åœ¨è§„èŒƒçš„Bean setter æ–¹æ³•ä¸­ï¼Œè¿™ä¸ªå€¼å°±ç­‰äºBeançš„å±æ€§åç§°--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>service.teacher.TeacherService<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherMapper<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherMapper<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--    åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºå†…éƒ¨Beanæ³¨å…¥--></span><span class="token comment">&lt;!--    å†…éƒ¨Beanå°±æ˜¯åœ¨&lt;bean> æ ‡ç­¾é‡ŒåµŒå¥—å®šä¹‰çš„Bean--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherService2<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>service.teacher.TeacherService<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>teacherMapper<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mapper.teacher.TeacherMapperImpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre><h3 id="æ³¨å…¥ç®€å•ç±»å‹">æ³¨å…¥ç®€å•ç±»å‹</h3><p>==å¦‚æœç»™ç®€å•ç±»å‹èµ‹å€¼ï¼Œä½¿ç”¨valueå±æ€§æˆ–valueæ ‡ç­¾ã€‚è€Œä¸æ˜¯refã€‚==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> gender<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>person<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Person<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>20<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gender<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>female<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sonetto<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>&lt;/bean</code></pre><p><strong>ç®€å•ç±»å‹åŒ…æ‹¬å“ªäº›å‘¢ï¼Ÿ</strong></p><p>å¯ä»¥é€šè¿‡Springçš„æºç æ¥åˆ†æä¸€ä¸‹ï¼šBeanUtilsç±»</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanUtils</span><span class="token punctuation">&#123;</span>  <span class="token comment">//.......</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isSimpleValueType</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Void</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">!=</span> type <span class="token operator">&amp;&amp;</span> <span class="token keyword">void</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">!=</span> type <span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span><span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">isPrimitiveOrWrapper</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span><span class="token class-name">Enum</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span><span class="token class-name">CharSequence</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span><span class="token class-name">Number</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span><span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span><span class="token class-name">Temporal</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span><span class="token constant">URI</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">==</span> type <span class="token operator">||</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">==</span> type <span class="token operator">||</span><span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">==</span> type <span class="token operator">||</span><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">==</span> type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>        <span class="token comment">//........</span><span class="token punctuation">&#125;</span></code></pre><p>é€šè¿‡æºç åˆ†æå¾—çŸ¥ï¼Œç®€å•ç±»å‹åŒ…æ‹¬ï¼š</p><ul><li>åŸºæœ¬æ•°æ®ç±»å‹(int,char)</li><li>åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„åŒ…è£…ç±»(String, Interger)</li><li>Stringæˆ–å…¶ä»–çš„CharSequenceå­ç±»</li><li>Numberå­ç±»</li><li>Dateå­ç±»</li><li>Enumå­ç±»</li><li>URI</li><li>URL</li><li>Temporalå­ç±»</li><li>Locale</li><li>Class</li><li>å¦å¤–è¿˜åŒ…æ‹¬ä»¥ä¸Šç®€å•å€¼ç±»å‹å¯¹åº”çš„æ•°ç»„ç±»å‹ã€‚</li></ul><h3 id="æ³¨å…¥é›†åˆæ•°ç»„">æ³¨å…¥é›†åˆæ•°ç»„</h3><h4 id="æ•°ç»„">æ•°ç»„</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> tags<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Person</span> person<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    æ³¨å…¥æ•°ç»„--></span><span class="token comment">&lt;!--    1. æ•°ç»„å…ƒç´ æ˜¯ç®€å•ç±»å‹--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Article<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tags<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>array</span> <span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>mac<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>c++<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>app recommend<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>array</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        æ•°ç»„å…ƒç´ æ˜¯å¼•ç”¨ç±»å‹--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>person<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>array</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>person<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>array</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre><p><strong>è¦ç‚¹ï¼š</strong></p><ul><li><strong>å¦‚æœæ•°ç»„ä¸­æ˜¯ç®€å•ç±»å‹ï¼Œä½¿ç”¨valueæ ‡ç­¾ã€‚</strong></li><li><strong>å¦‚æœæ•°ç»„ä¸­æ˜¯éç®€å•ç±»å‹ï¼Œä½¿ç”¨refæ ‡ç­¾ã€‚</strong></li></ul><h4 id="é›†åˆ">é›†åˆ</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Library</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">></span></span> bookList<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> classifications<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">></span></span> bookSet<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    æ³¨å…¥é›†åˆ--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>library<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Library<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        æ³¨å…¥Listé›†åˆ--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookList<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Book<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>çˆ±ä¸½ä¸æ¢¦æ¸¸ä»™å¢ƒ<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ISBN<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1192-2313-31-13<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Book<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>è¿½é£ç­çš„äºº<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ISBN<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1192-2343-34-33<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        æ³¨å…¥seté›†åˆ--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookSet<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">></span></span>               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Book<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>çˆ±ä¸½ä¸æ¢¦æ¸¸ä»™å¢ƒ<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ISBN<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1192-2313-31-13<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Book<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>è¿½é£ç­çš„äºº<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ISBN<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1192-2343-34-33<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        æ³¨å…¥ç®€å•ç±»å‹ String--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>classifications<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>array</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>å°è¯´<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>æ•™è‚²<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>array</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre><p><strong>æ³¨å…¥Listé›†åˆçš„æ—¶å€™ä½¿ç”¨listæ ‡ç­¾ï¼Œå¦‚æœListé›†åˆä¸­æ˜¯ç®€å•ç±»å‹ä½¿ç”¨valueæ ‡ç­¾ï¼Œåä¹‹ä½¿ç”¨refæ ‡ç­¾ã€‚</strong></p><p><strong>seté›†åˆä¸­å…ƒç´ æ˜¯ç®€å•ç±»å‹çš„ä½¿ç”¨valueæ ‡ç­¾ï¼Œåä¹‹ä½¿ç”¨refæ ‡ç­¾ã€‚</strong></p><h4 id="map">map</h4><p>==ä½¿ç”¨<map>æ ‡ç­¾å’Œ<entry key value>åµŒå¥—==</entry></map></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Color</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">></span></span> colorMap<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    æ³¨å…¥map--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Color<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>colorMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>RED<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>255,0,255<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>GREEN<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0,255,0<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BLUE<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0,0,255<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre><h3 id="æ³¨å…¥Propertis">æ³¨å…¥Propertis</h3><p>==ä½¿ç”¨<props>æ ‡ç­¾åµŒå¥—<prop>æ ‡ç­¾å®Œæˆã€‚==</prop></props></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBC</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Properties</span> properties<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--æ³¨å…¥properties--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.JDBC<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>properties<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>props</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DRIVER<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>com.mysql.jdbc.Driver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>URL<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>jdbc:mysql://localhost:3306/demo?useUnicode=true<span class="token entity named-entity" title="&amp;">&amp;amp;</span>characterEncoding=utf-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>USERNAME<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>root<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PASSWORD<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>password<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>props</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre><h3 id="æ³¨å…¥ç©ºå­—ç¬¦ä¸²å’ŒNULL">æ³¨å…¥ç©ºå­—ç¬¦ä¸²å’ŒNULL</h3><p>ä¸æ³¨å…¥å°±æ˜¯<code>null</code>ï¼Œç©ºå­—ç¬¦ä¸²å¯ä»¥è®¾ç½®<code>value=&quot;&quot;</code>æ³¨å…¥</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<code>&lt;value/&gt;</code>è¿™ä¸ªè‡ªé—­å’Œæ ‡ç­¾æ³¨å…¥ç©ºå­—ç¬¦ä¸²ï¼Œä»¥åŠä½¿ç”¨<code>&lt;null/&gt;</code>æ ‡ç­¾æ³¨å…¥nullã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--ç©ºä¸²çš„ç¬¬ä¸€ç§æ–¹å¼--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token comment">&lt;!--ç©ºä¸²çš„ç¬¬äºŒç§æ–¹å¼--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--æ³¨å…¥null--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vipBean<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.powernode.spring6.beans.Vip<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>null</span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre><h3 id="æ³¨å…¥ç‰¹æ®Šç¬¦å·">æ³¨å…¥ç‰¹æ®Šç¬¦å·</h3><p>XMLä¸­æœ‰5ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œåˆ†åˆ«æ˜¯ï¼š&lt;ã€&gt;ã€'ã€&quot;ã€&amp;</p><p>ä»¥ä¸Š5ä¸ªç‰¹æ®Šç¬¦å·åœ¨XMLä¸­ä¼šè¢«ç‰¹æ®Šå¯¹å¾…ï¼Œä¼šè¢«å½“åšXMLè¯­æ³•çš„ä¸€éƒ¨åˆ†è¿›è¡Œè§£æï¼Œå¦‚æœè¿™äº›ç‰¹æ®Šç¬¦å·ç›´æ¥å‡ºç°åœ¨æ³¨å…¥çš„å­—ç¬¦ä¸²å½“ä¸­ï¼Œä¼šæŠ¥é”™ã€‚</p><p>è§£å†³æ–¹æ¡ˆåŒ…æ‹¬ä¸¤ç§ï¼š</p><ul><li>ç¬¬ä¸€ç§ï¼šç‰¹æ®Šç¬¦å·ä½¿ç”¨è½¬ä¹‰å­—ç¬¦ä»£æ›¿ã€‚</li><li>ç¬¬äºŒç§ï¼šå°†å«æœ‰ç‰¹æ®Šç¬¦å·çš„å­—ç¬¦ä¸²æ”¾åˆ°ï¼š<!--[CDATA[]]--> å½“ä¸­ã€‚å› ä¸ºæ”¾åœ¨CDATAåŒºä¸­çš„æ•°æ®ä¸ä¼šè¢«XMLæ–‡ä»¶è§£æå™¨è§£æã€‚</li></ul><p>5ä¸ªç‰¹æ®Šå­—ç¬¦å¯¹åº”çš„è½¬ä¹‰å­—ç¬¦åˆ†åˆ«æ˜¯ï¼š</p><table><thead><tr><th><strong>ç‰¹æ®Šå­—ç¬¦</strong></th><th><strong>è½¬ä¹‰å­—ç¬¦</strong></th></tr></thead><tbody><tr><td>&gt;</td><td>&amp;gt;</td></tr><tr><td>&lt;</td><td>&amp;lt;</td></tr><tr><td>â€™</td><td>&amp;apos;</td></tr><tr><td>&quot;</td><td>&amp;quot;</td></tr><tr><td>&amp;</td><td>&amp;amp;</td></tr></tbody></table><h2 id="Beançš„å®ä¾‹åŒ–æ–¹å¼">Beançš„å®ä¾‹åŒ–æ–¹å¼</h2><ol><li><p>é€šè¿‡æ„é€ æ–¹æ³•å®ä¾‹åŒ–</p></li><li><p>é€šè¿‡ç®€å•å·¥å‚æ¨¡å¼å®ä¾‹åŒ–</p></li><li><p><strong>é€šè¿‡factory-beanå®ä¾‹åŒ–</strong></p></li><li><p>é€šè¿‡factoryBeanæ¥å£å®ä¾‹åŒ–</p></li></ol><h3 id="é€šè¿‡æ„é€ æ–¹æ³•å®ä¾‹åŒ–Bean">é€šè¿‡æ„é€ æ–¹æ³•å®ä¾‹åŒ–Bean</h3><p>é€šè¿‡æ„é€ æ–¹æ³•å®ä¾‹åŒ–Beanæ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹Springä¼šåœ¨åŠ è½½é…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è°ƒç”¨</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">ApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"spring.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è¿™æ®µä»£ç æ—¶ï¼ŒSpringè°ƒç”¨ç›®æ ‡Beançš„æ— å‚æ„é€ æ–¹æ³•å®ä¾‹åŒ–Beanã€‚</p><h3 id="é€šè¿‡ç®€å•å·¥å‚æ¨¡å¼å®ä¾‹åŒ–Bean">é€šè¿‡ç®€å•å·¥å‚æ¨¡å¼å®ä¾‹åŒ–Bean</h3><p>åœ¨Springæ¡†æ¶ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼æ¥å®ä¾‹åŒ–Beanã€‚</p><ol><li>åˆ›å»ºä¸€ä¸ªå·¥å‚ç±»ï¼Œè¯¥ç±»è´Ÿè´£å®ä¾‹åŒ–Beanå¹¶è¿”å›å®ä¾‹åŒ–åçš„å¯¹è±¡ã€‚è¿™ä¸ªå·¥å‚ç±»å¯ä»¥æ˜¯ä¸€ä¸ª<strong>æ™®é€šçš„Javaç±»ï¼Œä¸éœ€è¦å®ç°ç‰¹å®šçš„æ¥å£</strong>ã€‚</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">MyBean</span> <span class="token function">createBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// åœ¨è¿™é‡Œè¿›è¡Œå®ä¾‹åŒ–Beançš„é€»è¾‘</span>        <span class="token class-name">MyBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¯ä»¥è¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œ</span>        bean<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Example Bean"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è¿”å›å®ä¾‹åŒ–åçš„Beanå¯¹è±¡</span>        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>MyBean</code>æ˜¯è¦å®ä¾‹åŒ–çš„Beanç±»ï¼Œä½ å¯ä»¥æ ¹æ®å®é™…æƒ…å†µæ›¿æ¢ä¸ºä½ è‡ªå·±çš„Beanç±»ã€‚åœ¨<code>createBean()</code>æ–¹æ³•ä¸­ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡ŒBeançš„å®ä¾‹åŒ–ï¼Œå¹¶å¯¹å…¶è¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œã€‚</p><ol start="2"><li>åœ¨ä½ çš„Springé…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å·¥å‚æ–¹æ³•æ¥åˆ›å»ºBeançš„å®ä¾‹ã€‚é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­å£°æ˜ä¸€ä¸ªå·¥å‚æ–¹æ³•ï¼ŒSpringå°†è°ƒç”¨è¯¥æ–¹æ³•æ¥è·å–Beançš„å®ä¾‹ã€‚</li></ol><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myBean<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.BeanFactory<span class="token punctuation">"</span></span> <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>createBean<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>id</code>å±æ€§æŒ‡å®šäº†Beançš„IDï¼Œ<code>class</code>å±æ€§æŒ‡å®šäº†å·¥å‚ç±»çš„å…¨é™å®šåï¼Œ<code>factory-method</code>å±æ€§æŒ‡å®šäº†å·¥å‚ç±»ä¸­ç”¨äºåˆ›å»ºBeanå®ä¾‹çš„æ–¹æ³•åã€‚</p><p>ç°åœ¨ï¼Œå½“Springå®¹å™¨å¯åŠ¨æ—¶ï¼Œå®ƒå°†ä½¿ç”¨å·¥å‚æ–¹æ³•æ¥å®ä¾‹åŒ–<code>myBean</code>ã€‚ä½ å¯ä»¥é€šè¿‡ä»å®¹å™¨ä¸­è·å–è¯¥Beanæ¥ä½¿ç”¨å®ƒã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">MyBean</span> bean <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MyBean</span><span class="token punctuation">)</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"myBean"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼æ¥å®ä¾‹åŒ–Beanï¼Œå¹¶å°†å…¶é›†æˆåˆ°Springæ¡†æ¶ä¸­ã€‚</p><blockquote><p>ç®€å•å·¥å‚æ¨¡å¼ï¼ˆSimple Factory Patternï¼‰æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§é›†ä¸­åŒ–çš„æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ï¼Œè€Œä¸éœ€è¦åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ç›´æ¥å®ä¾‹åŒ–å…·ä½“çš„å¯¹è±¡ã€‚</p><p>ç®€å•å·¥å‚æ¨¡å¼ç”±ä¸‰ä¸ªä¸»è¦ç»„ä»¶ç»„æˆï¼š</p><ol><li>å·¥å‚ç±»ï¼ˆFactory Classï¼‰ï¼šè´Ÿè´£åˆ›å»ºå¯¹è±¡çš„ç±»ã€‚å®ƒåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªåˆ›å»ºå¯¹è±¡çš„é™æ€æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•æ ¹æ®ä¼ å…¥çš„å‚æ•°æˆ–æ¡ä»¶ç¡®å®šè¦åˆ›å»ºçš„å…·ä½“å¯¹è±¡ç±»å‹ï¼Œå¹¶è¿”å›ç›¸åº”çš„å¯¹è±¡å®ä¾‹ã€‚</li><li>äº§å“ç±»ï¼ˆProduct Classï¼‰ï¼šè¢«å·¥å‚ç±»åˆ›å»ºçš„å¯¹è±¡ã€‚å®ƒä»¬å…±äº«ä¸€ä¸ªå…±åŒçš„çˆ¶ç±»æˆ–æ¥å£ï¼Œå¹¶å®šä¹‰äº†ä¸€ç»„å…±åŒçš„è¡Œä¸ºå’Œå±æ€§ã€‚</li><li>å®¢æˆ·ç«¯ï¼ˆClientï¼‰ï¼šä½¿ç”¨å·¥å‚ç±»åˆ›å»ºå¯¹è±¡çš„ä»£ç ã€‚å®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨å·¥å‚ç±»çš„æ–¹æ³•æ¥è·å–æ‰€éœ€çš„å¯¹è±¡ï¼Œè€Œæ— éœ€ç›´æ¥å®ä¾‹åŒ–å…·ä½“çš„äº§å“ç±»ã€‚</li></ol><p>ç®€å•å·¥å‚æ¨¡å¼çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</p><ol><li>å®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨å·¥å‚ç±»çš„æ–¹æ³•è¯·æ±‚åˆ›å»ºå¯¹è±¡ã€‚</li><li>å·¥å‚ç±»æ ¹æ®ä¼ å…¥çš„å‚æ•°æˆ–æ¡ä»¶ç¡®å®šè¦åˆ›å»ºçš„å¯¹è±¡ç±»å‹ã€‚</li><li>å·¥å‚ç±»å®ä¾‹åŒ–ç›¸åº”çš„å¯¹è±¡ï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li>å®¢æˆ·ç«¯ä½¿ç”¨è¿”å›çš„å¯¹è±¡è¿›è¡Œåç»­æ“ä½œã€‚</li></ol><p>ç®€å•å·¥å‚æ¨¡å¼çš„ä¼˜ç‚¹åŒ…æ‹¬ï¼š</p><ul><li>å°†å¯¹è±¡çš„åˆ›å»ºé€»è¾‘é›†ä¸­åœ¨å·¥å‚ç±»ä¸­ï¼Œå®¢æˆ·ç«¯æ— éœ€çŸ¥é“å…·ä½“çš„å¯¹è±¡å®ç°ã€‚</li><li>ç®€åŒ–äº†å®¢æˆ·ç«¯ä»£ç ï¼Œå®¢æˆ·ç«¯åªéœ€è¦å…³æ³¨å¦‚ä½•ä½¿ç”¨å¯¹è±¡ï¼Œè€Œä¸éœ€è¦å…³æ³¨å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ã€‚</li><li>é€šè¿‡å·¥å‚ç±»å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„äº§å“ç±»ï¼Œæ— éœ€ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç ã€‚</li></ul><p>ç„¶è€Œï¼Œç®€å•å·¥å‚æ¨¡å¼ä¹Ÿæœ‰ä¸€äº›å±€é™æ€§ï¼š</p><ul><li>å¦‚æœéœ€è¦æ·»åŠ æ–°çš„äº§å“ç±»ï¼Œéœ€è¦ä¿®æ”¹å·¥å‚ç±»çš„ä»£ç ï¼Œè¿èƒŒäº†å¼€é—­åŸåˆ™ã€‚</li><li>å·¥å‚ç±»çš„èŒè´£è¾ƒé‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç±»çš„èŒè´£ä¸å¤Ÿå•ä¸€ã€‚</li><li>å®¢æˆ·ç«¯åªèƒ½é€šè¿‡å·¥å‚ç±»æä¾›çš„æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ï¼Œç¼ºä¹çµæ´»æ€§ã€‚</li></ul><p>ç®€å•å·¥å‚æ¨¡å¼é€‚ç”¨äºå¯¹è±¡çš„åˆ›å»ºé€»è¾‘ç›¸å¯¹ç®€å•ã€å¯¹è±¡ç±»å‹è¾ƒå°‘ä¸”ä¸ç»å¸¸å˜åŒ–çš„æƒ…å†µã€‚å¯¹äºå¤æ‚çš„å¯¹è±¡åˆ›å»ºé€»è¾‘æˆ–å¯¹è±¡ç±»å‹é¢‘ç¹å˜åŒ–çš„æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å…¶ä»–åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå¦‚å·¥å‚æ–¹æ³•æ¨¡å¼æˆ–æŠ½è±¡å·¥å‚æ¨¡å¼ã€‚</p></blockquote><h3 id="Beançš„ç”Ÿå‘½å‘¨æœŸ">Bean<strong>çš„ç”Ÿå‘½å‘¨æœŸ</strong></h3><ol><li>äº”æ­¥<ol><li>å®ä¾‹åŒ–Beanã€‚é»˜è®¤ä½¿ç”¨æ— å‚æ•°æ„é€ æ–¹æ³•newä¸€ä¸ªBean</li><li>æ³¨å…¥Beanã€‚é€šè¿‡Settetæ–¹æ³•ç»™å±æ€§èµ‹å€¼</li><li>åˆå§‹åŒ–Beanã€‚è°ƒç”¨Beançš„initæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦ç¨‹åºå‘˜è‡ªå·±ç¼–å†™ï¼Œä¸‹destoyæ–¹æ³•åŒã€‚</li><li>ä½¿ç”¨Beanã€‚</li><li>é”€æ¯Beanã€‚è°ƒç”¨beançš„destroyæ–¹æ³•ã€‚</li></ol></li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"1. new cat is instantiated"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">miao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"4. cat: miao miao miao...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"2. bean resign properties"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"3. cat is initialized"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"5. cat is destroyed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cat<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.Cat<span class="token punctuation">"</span></span> <span class="token attr-name">init-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>init<span class="token punctuation">"</span></span> <span class="token attr-name">destroy-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>destroy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Mio<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre><p><img src="image-20230605164041553.png" alt="image-20230605164041553" loading="lazy"></p><ol><li><p><strong>ä¸ƒæ­¥ï¼ˆéœ€è¦æŒæ¡ï¼‰</strong></p><ol><li>å®ä¾‹åŒ–Beanã€‚é»˜è®¤ä½¿ç”¨æ— å‚æ•°æ„é€ æ–¹æ³•newä¸€ä¸ªBean</li><li>æ³¨å…¥Beanã€‚é€šè¿‡Settetæ–¹æ³•ç»™å±æ€§èµ‹å€¼</li><li>==Beanåå¤„ç†å™¨Beforeæ–¹æ³•æ‰§è¡Œ==</li><li>åˆå§‹åŒ–Beanã€‚è°ƒç”¨Beançš„initæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦ç¨‹åºå‘˜è‡ªå·±ç¼–å†™ï¼Œä¸‹destoyæ–¹æ³•åŒã€‚==â†åœ¨è¿™é‡Œæ’å…¥==</li><li>==Beanåå¤„ç†å™¨çš„Afteræ–¹æ³•æ‰§è¡Œ==</li><li>ä½¿ç”¨Beanã€‚</li><li>é”€æ¯Beanã€‚è°ƒç”¨beançš„destroyæ–¹æ³•ã€‚</li></ol><p>åœ¨ä»¥ä¸Šçš„5æ­¥ä¸­ï¼Œç¬¬3æ­¥æ˜¯åˆå§‹åŒ–Beanï¼Œå¦‚æœä½ è¿˜æƒ³åœ¨åˆå§‹åŒ–å‰å’Œåˆå§‹åŒ–åæ·»åŠ ä»£ç ï¼Œå¯ä»¥åŠ å…¥â€œBeanåå¤„ç†å™¨â€ã€‚</p><p>ç¼–å†™ä¸€ä¸ªç±»å®ç°BeanPostProcessorç±»ï¼Œå¹¶ä¸”é‡å†™beforeå’Œafteræ–¹æ³•ï¼š</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">BeansException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">BeanPostProcessor</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"------------------------>beforeInitialization"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">BeanPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"------------------------>afterInitialization"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">BeanPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>åœ¨spring.xmlæ–‡ä»¶ä¸­é…ç½®â€œBeanåå¤„ç†å™¨â€ï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    åœ¨spring.xmlæ–‡ä»¶ä¸­é…ç½®â€œBeanåå¤„ç†å™¨â€ï¼š--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.PostProcessor<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><p>==ä¸€å®šè¦æ³¨æ„ï¼šåœ¨spring.xmlæ–‡ä»¶ä¸­é…ç½®çš„Beanåå¤„ç†å™¨å°†ä½œç”¨äºå½“å‰é…ç½®æ–‡ä»¶ä¸­æ‰€æœ‰çš„Beanã€‚==</p></li><li><p>åæ­¥</p><ol><li><p>å®ä¾‹åŒ–Beanã€‚é»˜è®¤ä½¿ç”¨æ— å‚æ•°æ„é€ æ–¹æ³•newä¸€ä¸ªBean</p></li><li><p>æ³¨å…¥Beanã€‚é€šè¿‡Settetæ–¹æ³•ç»™å±æ€§èµ‹å€¼</p></li><li><p>==æ£€æŸ¥Beanæ˜¯å¦å®ç°äº†Awareç›¸å…³æ¥å£ï¼Œå¹¶è®¾ç½®ç›¸å…³ä¾èµ–ã€‚==</p></li><li><p>Beanåå¤„ç†å™¨Beforeæ–¹æ³•æ‰§è¡Œ</p></li><li><p>==æ£€æŸ¥Beanæ˜¯å¦å®ç°äº†InitializingBeanæ¥å£ &amp; è°ƒç”¨æ¥å£æ–¹æ³•ã€‚==</p></li><li><p>åˆå§‹åŒ–Beanã€‚è°ƒç”¨Beançš„initæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦ç¨‹åºå‘˜è‡ªå·±ç¼–å†™ï¼Œä¸‹destoyæ–¹æ³•åŒã€‚</p></li><li><p>Beanåå¤„ç†å™¨çš„Afteræ–¹æ³•æ‰§è¡Œ</p></li><li><p>ä½¿ç”¨Beanã€‚</p></li><li><p>==æ£€æŸ¥Beanæ˜¯å¦å®ç°äº†DisposableBeanæ¥å£ï¼Œå¹¶è°ƒç”¨æ¥å£æ–¹æ³•==</p></li><li><p>é”€æ¯Beanã€‚è°ƒç”¨beançš„destroyæ–¹æ³•ã€‚</p></li></ol></li></ol><p>Awareç›¸å…³çš„æ¥å£åŒ…æ‹¬ï¼šBeanNameAwareã€BeanClassLoaderAwareã€BeanFactoryAware</p><ul><li>å½“Beanå®ç°äº†BeanNameAwareï¼ŒSpringä¼šå°†Beançš„åå­—ä¼ é€’ç»™Beanã€‚</li><li>å½“Beanå®ç°äº†BeanClassLoaderAwareï¼ŒSpringä¼šå°†åŠ è½½è¯¥Beançš„ç±»åŠ è½½å™¨ä¼ é€’ç»™Beanã€‚</li><li>å½“Beanå®ç°äº†BeanFactoryAwareï¼ŒSpringä¼šå°†Beanå·¥å‚å¯¹è±¡ä¼ é€’ç»™Beanã€‚</li></ul><p>æµ‹è¯•ä»¥ä¸Š10æ­¥ï¼Œå¯ä»¥è®©Userç±»å®ç°5ä¸ªæ¥å£ï¼Œå¹¶å®ç°æ‰€æœ‰æ–¹æ³•ï¼š</p><ul><li>BeanNameAware</li><li>BeanClassLoaderAware</li><li>BeanFactoryAware</li><li>InitializingBean</li><li>DisposableBean</li></ul><h2 id="Beançš„å¾ªç¯ä¾èµ–é—®é¢˜">Beançš„å¾ªç¯ä¾èµ–é—®é¢˜</h2><h3 id="Overview">Overview</h3><p>Beançš„å¾ªç¯ä¾èµ–æŒ‡çš„æ˜¯åœ¨Springå®¹å™¨ä¸­å­˜åœ¨ç›¸äº’ä¾èµ–çš„Beanå®ä¾‹ã€‚è¿™ç§å¾ªç¯ä¾èµ–ä¼šå¯¼è‡´Beançš„åˆ›å»ºè¿‡ç¨‹é™·å…¥æ­»å¾ªç¯æˆ–æ— æ³•å®Œæˆï¼Œä»è€Œå¯¼è‡´åº”ç”¨ç¨‹åºæ— æ³•æ­£å¸¸å¯åŠ¨æˆ–å‡ºç°å…¶ä»–å¼‚å¸¸ã€‚</p><p>å¾ªç¯ä¾èµ–é€šå¸¸å‘ç”Ÿåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼š</p><ol><li><strong>æ„é€ å‡½æ•°å¾ªç¯ä¾èµ–</strong>ï¼šä¸€ä¸ªBeançš„æ„é€ å‡½æ•°å‚æ•°ä¾èµ–äºå¦ä¸€ä¸ªBeanï¼Œè€Œå¦ä¸€ä¸ªBeançš„æ„é€ å‡½æ•°å‚æ•°åˆä¾èµ–äºç¬¬ä¸€ä¸ªBeanã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå½“å®¹å™¨å°è¯•å®ä¾‹åŒ–å…¶ä¸­ä¸€ä¸ªBeanæ—¶ï¼Œå®ƒéœ€è¦å…ˆå®ä¾‹åŒ–å¦ä¸€ä¸ªBeanï¼Œè€Œåè€…åˆä¾èµ–äºå‰è€…ï¼Œä»è€Œå¯¼è‡´å¾ªç¯ä¾èµ–ã€‚</li><li><strong>å±æ€§å¾ªç¯ä¾èµ–</strong>ï¼šä¸€ä¸ªBeançš„å±æ€§ä¾èµ–äºå¦ä¸€ä¸ªBeanï¼Œè€Œå¦ä¸€ä¸ªBeançš„å±æ€§åˆä¾èµ–äºç¬¬ä¸€ä¸ªBeanã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå½“å®¹å™¨å°è¯•ä¸ºä¸€ä¸ªBeanæ³¨å…¥å±æ€§æ—¶ï¼Œå®ƒéœ€è¦å…ˆå®ä¾‹åŒ–å¦ä¸€ä¸ªBeanï¼Œè€Œåè€…åˆä¾èµ–äºå‰è€…ï¼Œä»è€Œå¯¼è‡´å¾ªç¯ä¾èµ–ã€‚</li></ol><p>Springæ¡†æ¶é€šè¿‡ä½¿ç”¨<strong>ä¸‰çº§ç¼“å­˜</strong>æ¥è§£å†³Beançš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚åœ¨å®ä¾‹åŒ–Beançš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç°å¾ªç¯ä¾èµ–ï¼ŒSpringä¼šå…ˆåˆ›å»ºä¸€ä¸ªå°šæœªå®Œæˆåˆå§‹åŒ–çš„æ—©æœŸå¯¹è±¡å¹¶ç¼“å­˜èµ·æ¥ï¼Œç„¶åç»§ç»­å®Œæˆå½“å‰Beançš„å®ä¾‹åŒ–å’Œåˆå§‹åŒ–ã€‚å½“å…¶ä»–Beanéœ€è¦è®¿é—®å½“å‰Beanæ—¶ï¼Œå°†è¿”å›è¯¥æ—©æœŸå¯¹è±¡ã€‚å¾…å½“å‰Beanåˆå§‹åŒ–å®Œæˆåï¼ŒSpringä¼šå°†å…¶è®¾ç½®åˆ°æ—©æœŸå¯¹è±¡ä¸­ï¼Œä»è€Œè§£å†³å¾ªç¯ä¾èµ–ã€‚</p><p>ç„¶è€Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¾ªç¯ä¾èµ–å¯èƒ½ä¼šå¯¼è‡´æ½œåœ¨çš„é—®é¢˜ï¼Œå¦‚æ­»é”æˆ–ä¸ç¡®å®šæ€§çŠ¶æ€ã€‚å› æ­¤ï¼Œåº”è¯¥å°½é‡é¿å…å¾ªç¯ä¾èµ–çš„äº§ç”Ÿï¼Œåˆç†è®¾è®¡Beanä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæˆ–è€…è€ƒè™‘é€šè¿‡é‡æ„ä»£ç æ¥æ¶ˆé™¤å¾ªç¯ä¾èµ–ã€‚</p><h3 id="Springçš„ä¸‰çº§ç¼“å­˜">Springçš„ä¸‰çº§ç¼“å­˜</h3><p>Springä¸ºä»€ä¹ˆå¯ä»¥è§£å†³set + singletonæ¨¡å¼ä¸‹å¾ªç¯ä¾èµ–ï¼Ÿ</p><p>==æ ¹æœ¬çš„åŸå› åœ¨äºï¼šè¿™ç§æ–¹å¼å¯ä»¥åšåˆ°å°†â€œå®ä¾‹åŒ–Beanâ€å’Œâ€œç»™Beanå±æ€§èµ‹å€¼â€è¿™ä¸¤ä¸ªåŠ¨ä½œåˆ†å¼€å»å®Œæˆã€‚==</p><p>å®ä¾‹åŒ–Beançš„æ—¶å€™ï¼šè°ƒç”¨æ— å‚æ•°æ„é€ æ–¹æ³•æ¥å®Œæˆã€‚<strong>æ­¤æ—¶å¯ä»¥å…ˆä¸ç»™å±æ€§èµ‹å€¼ï¼Œå¯ä»¥æå‰å°†è¯¥Beanå¯¹è±¡â€œæ›å…‰â€ç»™å¤–ç•Œã€‚</strong></p><p>ç»™Beanå±æ€§èµ‹å€¼çš„æ—¶å€™ï¼šè°ƒç”¨setteræ–¹æ³•æ¥å®Œæˆã€‚</p><p>ä¸¤ä¸ªæ­¥éª¤æ˜¯å®Œå…¨å¯ä»¥åˆ†ç¦»å¼€å»å®Œæˆçš„ï¼Œå¹¶ä¸”è¿™ä¸¤æ­¥ä¸è¦æ±‚åœ¨åŒä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šå®Œæˆã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒBeanéƒ½æ˜¯å•ä¾‹çš„ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæŠŠæ‰€æœ‰çš„å•ä¾‹Beanå®ä¾‹åŒ–å‡ºæ¥ï¼Œæ”¾åˆ°ä¸€ä¸ªé›†åˆå½“ä¸­ï¼ˆæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºç¼“å­˜ï¼‰ï¼Œæ‰€æœ‰çš„å•ä¾‹Beanå…¨éƒ¨å®ä¾‹åŒ–å®Œæˆä¹‹åï¼Œä»¥åæˆ‘ä»¬å†æ…¢æ…¢çš„è°ƒç”¨setteræ–¹æ³•ç»™å±æ€§èµ‹å€¼ã€‚è¿™æ ·å°±è§£å†³äº†å¾ªç¯ä¾èµ–çš„é—®é¢˜ã€‚</p><p>é‚£ä¹ˆåœ¨Springæ¡†æ¶åº•å±‚æºç çº§åˆ«ä¸Šæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿè¯·çœ‹ï¼š</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultSingletonBeanRegistry</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleAliasRegistry</span> <span class="token keyword">implements</span> <span class="token class-name">SingletonBeanRegistry</span> <span class="token punctuation">&#123;</span>   <span class="token comment">/** Maximum number of suppressed exceptions to preserve. */</span>   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">SUPPRESSED_EXCEPTIONS_LIMIT</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span><span class="token comment">// 1. ä¸€çº§ç¼“å­˜ å•ä¾‹å¯¹è±¡ç¼“å­˜æ± </span>   <span class="token comment">/** Cache of singleton objects: bean name to bean instance. */</span>   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> singletonObjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 3. ä¸‰çº§ç¼“å­˜ åŸå§‹å¯¹è±¡ç¼“å­˜æ± </span>   <span class="token comment">/** Cache of singleton factories: bean name to ObjectFactory. */</span>   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ObjectFactory</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span><span class="token punctuation">></span></span> singletonFactories <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2. äºŒçº§ç¼“å­˜ æ—©æœŸå¯¹è±¡ç¼“å­˜æ± </span>   <span class="token comment">/** Cache of early singleton objects: bean name to bean instance. */</span>   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> earlySingletonObjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>Springçš„ä¸‰çº§ç¼“å­˜ï¼ˆThree-Level Cacheï¼‰æ˜¯Springæ¡†æ¶åœ¨å¤„ç†Beanå®ä¾‹åŒ–å’Œå¾ªç¯ä¾èµ–æ—¶ä½¿ç”¨çš„ä¸€ç§æœºåˆ¶ã€‚å®ƒæ˜¯ä¸ºäº†è§£å†³Beançš„å¾ªç¯ä¾èµ–é—®é¢˜è€Œå¼•å…¥çš„ã€‚</p><p>ä¸‰çº§ç¼“å­˜åœ¨Springå®¹å™¨çš„Beanç”Ÿå‘½å‘¨æœŸä¸­æ‰®æ¼”é‡è¦è§’è‰²ï¼Œå®ƒåŒ…å«äº†ä»¥ä¸‹ä¸‰ä¸ªå±‚æ¬¡çš„ç¼“å­˜ï¼š</p><ol><li><p>ç¬¬ä¸€çº§ç¼“å­˜ï¼šå•ä¾‹å¯¹è±¡ç¼“å­˜æ± ï¼ˆSingleton Cacheï¼‰ã€‚</p><ul><li>ç¬¬ä¸€çº§ç¼“å­˜æ˜¯Springå®¹å™¨ä¸­çš„å•ä¾‹Beanç¼“å­˜ã€‚</li><li><strong>å½“Springå®¹å™¨åˆ›å»ºä¸€ä¸ªå•ä¾‹Beanæ—¶ï¼Œä¼šé¦–å…ˆå°è¯•ä»ç¬¬ä¸€çº§ç¼“å­˜ä¸­è·å–å·²ç»åˆ›å»ºçš„å®ä¾‹ã€‚</strong></li><li>å¦‚æœèƒ½å¤Ÿæ‰¾åˆ°å®ä¾‹ï¼Œåˆ™ç›´æ¥è¿”å›ç»™è°ƒç”¨è€…ï¼Œé¿å…é‡å¤å®ä¾‹åŒ–ç›¸åŒçš„å•ä¾‹Beanã€‚</li><li>ç¬¬ä¸€çº§ç¼“å­˜çš„é”®å€¼å¯¹ç»“æ„ä¸º <code>&lt;Beanåç§°, Beanå®ä¾‹&gt;</code>ã€‚</li></ul></li><li><p>ç¬¬äºŒçº§ç¼“å­˜ï¼šæ—©æœŸå¯¹è±¡ç¼“å­˜æ± ï¼ˆEarly-Stage Object Cacheï¼‰ã€‚</p><ul><li><strong>ç¬¬äºŒçº§ç¼“å­˜ç”¨äºè§£å†³Beançš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</strong></li><li>å½“Beanå®ä¾‹åŒ–è¿‡ç¨‹ä¸­å­˜åœ¨å¾ªç¯ä¾èµ–æ—¶ï¼ŒSpringä¼šå°†å·²ç»åˆ›å»ºä½†å°šæœªå®Œæˆåˆå§‹åŒ–çš„Beanå¯¹è±¡æ”¾å…¥ç¬¬äºŒçº§ç¼“å­˜ä¸­ã€‚</li><li>æ—©æœŸå¯¹è±¡æŒ‡çš„æ˜¯åœ¨Beanå®ä¾‹åŒ–è¿‡ç¨‹ä¸­å·²ç»åˆ›å»ºå‡ºæ¥ä½†å°šæœªå®Œå…¨åˆå§‹åŒ–çš„å¯¹è±¡ã€‚</li><li>é€šè¿‡ç¬¬äºŒçº§ç¼“å­˜ï¼ŒSpringèƒ½å¤Ÿåœ¨åç»­çš„Beanåˆå§‹åŒ–é˜¶æ®µä¸­è§£å†³å¾ªç¯ä¾èµ–ï¼Œå°†ä¾èµ–çš„Beanè®¾ç½®åˆ°æ—©æœŸå¯¹è±¡ä¸­ã€‚</li><li>ç¬¬äºŒçº§ç¼“å­˜çš„é”®å€¼å¯¹ç»“æ„ä¸º <code>&lt;Beanåç§°, æ—©æœŸå¯¹è±¡&gt;</code>ã€‚</li></ul></li><li><p>ç¬¬ä¸‰çº§ç¼“å­˜ï¼šåŸå§‹å¯¹è±¡ç¼“å­˜æ± ï¼ˆRaw Object Cacheï¼‰ã€‚</p><ul><li><p>ç¬¬ä¸‰çº§ç¼“å­˜æ˜¯æœ€åº•å±‚çš„ç¼“å­˜ï¼Œç”¨äºå­˜å‚¨å°šæœªç»è¿‡ä»»ä½•å¤„ç†çš„åŸå§‹Beanå¯¹è±¡ã€‚</p></li><li><p>å½“å®¹å™¨åˆ›å»ºBeanæ—¶ï¼Œå¦‚æœæ— æ³•ä»ç¬¬ä¸€çº§å’Œç¬¬äºŒçº§ç¼“å­˜ä¸­è·å–Beanå®ä¾‹ï¼ŒSpringä¼šå°†æ­£åœ¨åˆ›å»ºçš„Beanæ”¾å…¥ç¬¬ä¸‰çº§ç¼“å­˜ä¸­ï¼Œä½œä¸ºç¼“å­˜çš„æœ€åä¸€é“é˜²çº¿ã€‚</p></li><li><p>åŸå§‹å¯¹è±¡æŒ‡çš„æ˜¯å°šæœªç»è¿‡ä»»ä½•å¤„ç†çš„åˆå§‹å¯¹è±¡ï¼Œå°šæœªè¿›è¡Œä¾èµ–æ³¨å…¥ç­‰æ“ä½œã€‚</p></li><li><p>é€šè¿‡ç¬¬ä¸‰çº§ç¼“å­˜ï¼ŒSpringå¯ä»¥ç¡®ä¿åœ¨è§£å†³å¾ªç¯ä¾èµ–åï¼Œå°†åŸå§‹å¯¹è±¡è¿›è¡Œè¿›ä¸€æ­¥çš„åˆå§‹åŒ–æ“ä½œã€‚</p></li><li><p>ç¬¬ä¸‰çº§ç¼“å­˜çš„é”®å€¼å¯¹ç»“æ„ä¸º <code>&lt;Beanåç§°, åŸå§‹å¯¹è±¡&gt;</code>ã€‚</p></li></ul></li></ol><p>åœ¨Beançš„å®ä¾‹åŒ–è¿‡ç¨‹ä¸­ï¼ŒSpringæ¡†æ¶ä¼šä¾æ¬¡å°è¯•ä»ä¸‰çº§ç¼“å­˜ä¸­è·å–Beançš„å®ä¾‹ï¼Œä»¥æ»¡è¶³ä¾èµ–æ³¨å…¥å’Œå¾ªç¯ä¾èµ–çš„éœ€æ±‚ã€‚è¿™ç§ç¼“å­˜æœºåˆ¶ä½¿å¾—Springèƒ½å¤Ÿé«˜æ•ˆåœ°å¤„ç†å¤æ‚çš„Beanä¾èµ–å…³ç³»ï¼Œä¿è¯äº†Beançš„æ­£ç¡®åˆ›å»ºå’Œåˆå§‹åŒ–ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>ä¸‰çº§ç¼“å­˜ä»…åœ¨å¤„ç†å•ä¾‹ï¼ˆSingletonï¼‰ä½œç”¨åŸŸçš„Beanæ—¶ä½¿ç”¨ï¼Œå¯¹äºå…¶ä»–ä½œç”¨åŸŸï¼ˆå¦‚åŸå‹Prototypeï¼‰çš„Beanï¼Œä¸ä¼šä½¿ç”¨ä¸‰çº§ç¼“å­˜ã€‚æ¯æ¬¡è¯·æ±‚åŸå‹Beanæ—¶ï¼ŒSpringéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œé¿å…äº†å¾ªç¯ä¾èµ–çš„é—®é¢˜ã€‚</strong></p><h2 id="æ‰‹å†™Springæ¡†æ¶">æ‰‹å†™Springæ¡†æ¶</h2><p>Springåº•å±‚æ˜¯é€šè¿‡åå°„æœºåˆ¶æ¥å®ä¾‹åŒ–å¯¹è±¡ï¼Œä»¥åŠå±æ€§æ³¨å…¥çš„ï¼Œåœ¨æ‰‹å†™Springæ¡†æ¶ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£åå°„æœºåˆ¶ã€‚</p><blockquote><p>JAVAåå°„æœºåˆ¶æ˜¯åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ï¼›è¿™ç§åŠ¨æ€è·å–çš„ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºjavaè¯­è¨€çš„åå°„æœºåˆ¶ã€‚Javaåå°„æœºåˆ¶åœ¨æ¡†æ¶è®¾è®¡ä¸­æä¸ºå¹¿æ³›ï¼Œéœ€è¦æ·±å…¥ç†è§£ã€‚</p></blockquote><p>é€šè¿‡åå°„ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¿åˆ°ç±»çš„å±æ€§ï¼Œæ–¹æ³•ã€‚ å›é¡¾Springæ¡†æ¶ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªspringçš„é…ç½®æ–‡ä»¶ä¾‹å¦‚ï¼šspring.xmlï¼Œåœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æ³¨å†Œä¸€ä¸ªç±»ï¼Œå¹¶æ³¨å…¥å±æ€§å€¼ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sonetto<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>123456<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>points<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>12.3<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>isActive<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.UserDao<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean.UserService<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span></code></pre><p>åœ¨å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡<code>ClassPathXmlApplicationContext()</code>ï¼Œä¼ å…¥æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ï¼Œæ‹¿åˆ°ä¸€ä¸ª<code>ApplicationContext</code>å¯¹è±¡ï¼Œé€šè¿‡<code>ApplicationContext</code>å¯¹è±¡è°ƒç”¨<code>getBeanï¼ˆï¼‰</code>æ–¹æ³•æ¥è·å–å¯¹è±¡, æœ€ç»ˆè°ƒç”¨å¯¹è±¡å‘æ–¹æ³•ï¼Œæ¥ä½¿ç”¨Beanã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"mySpring.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"userService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        userService<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æˆ‘ä»¬çš„æœ€ç»ˆç›®çš„å°±æ˜¯è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œä¸€ä¸ªæŒ‡å®šä¸€ä¸ªæ–¹æ³•éœ€è¦å››è¦ç´ ï¼š ä»€ä¹ˆå¯¹è±¡ï¼ˆå¯¹è±¡çš„å…¨é™å®šç±»åæ˜¯ä»€ä¹ˆï¼Ÿï¼‰ä»€ä¹ˆæ–¹æ³•ï¼ˆæ–¹æ³•åï¼‰ï¼Œä»€ä¹ˆå‚æ•°ï¼ˆå‚æ•°çš„ç±»å‹å’Œæ•°é‡ï¼‰ï¼Œè¿”å›ä»€ä¹ˆå€¼ã€‚</p><p>æŒ‡å®šæ¥è¿™æ–¹æ³•çš„å››ä¸ªè¦ç´ ï¼Œæˆ‘ä»¬å°±å¯ä»¥å”¯ä¸€çš„ç¡®å®šä¸€ä¸ªæ–¹æ³•ï¼Œç„¶åè°ƒç”¨è¯¥æ–¹æ³•ã€‚</p><p>åœ¨springçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæ³¨å†Œä¸€ä¸ªBeanæ—¶ï¼Œæˆ‘ä»¬éœ€è¦æä¾›è¿™ä¸ªBeançš„å…¨é™å®šç±»åï¼Œä¹Ÿå°±æ˜¯Beanæ ‡ç­¾å†…çš„classå±æ€§çš„å†…å®¹ã€‚æœ‰äº†å…¨é™å®šç±»åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡åå°„æœºåˆ¶è°ƒç”¨<code>class.forName()</code>æ‹¿åˆ°è¿™ä¸ªå¯¹è±¡çš„ç±»ã€‚æ›´è¿›ä¸€æ­¥ï¼Œé€šè¿‡è¿™ä¸ªç±»æ‹¿åˆ°æ„é€ æ–¹æ³•ï¼Œå®ä¾‹åŒ–å¯¹è±¡ã€‚æ‹¿åˆ°æˆ‘ä»¬éœ€è¦çš„ç›®æ ‡æ–¹æ³•ï¼Œæœ€ç»ˆè°ƒç”¨è¿™ä¸ªç›®æ ‡æ–¹æ³•ã€‚</p><p>æœ‰äº†æ•´ä¸ªå¤§æ¦‚çš„å…¨æ™¯å›¾ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ç¼–å†™æˆ‘ä»¬è‡ªå·±çš„Springæ¡†æ¶äº†ã€‚</p><ol><li>é¦–å…ˆï¼Œè®©æˆ‘ä»¬å…ˆç¼–å†™ä¸€ä¸ª<code>ApplicationContext</code> æ¥å£ç±»ï¼Œè¿™ä¸ªç±»å®šä¹‰äº†<code>getBean()</code>æ–¹æ³•</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>spring</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApplicationContext</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><ol start="2"><li>ç„¶åç¼–å†™è¯¥æ¥å£çš„å®ç°ç±»<code>ClassPathXmlApplicationContext</code> æˆ‘ä»¬æ­£æ˜¯é€šè¿‡è¿™ä¸ªç±»æ¥å®ä¾‹åŒ–ä¸€ä¸ª<code>ApplicationContext</code> å¯¹è±¡ã€‚å›é¡¾<code>ApplicationContext context = new ClassPathXmlApplicationContext(&quot;mySpring.xml&quot;);</code> è¿™æ®µä»£ç ï¼Œå®ä¾‹åŒ–è¿™ä¸ªç±»æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‚æ•°â€”â€”Springé…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªå‚æ•°å¯¹åº”ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„<code>ClassPathXmlApplicationContext</code>ä¹Ÿéœ€è¦æä¾›è¿™ä¸ªæ„é€ æ–¹æ³•ã€‚</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">String</span> resource<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></code></pre><ol start="3"><li><p>æˆ‘ä»¬éœ€è¦è¯»å–ä½¿ç”¨è¿™ä¸ªæ¡†æ¶çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶æ‹¿åˆ°æ‰€æœ‰çš„Beanæ ‡ç­¾ã€‚è¦æ‹¿åˆ°è¿™ä¸ªxmlæ–‡ä»¶å¹¶è¯»å–é‡Œé¢çš„æ ‡ç­¾å·²ç»å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©<code>SAXReader</code> è¿™ä¸ªç±»æ¥å®Œæˆã€‚é€šè¿‡Mavenæˆ‘ä»¬å¯ä»¥è½»æ¾çš„å¼•å…¥è¿™ä¸ªjaråŒ…ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è§£æè¿™ä¸ªxmlæ–‡ä»¶ï¼Œé€šè¿‡<code>Document</code> æ¥å®Œæˆã€‚æ‰€ä»¥æˆ‘è¿˜éœ€è¦dom4jçš„ä¾èµ–ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--        dom4jä¾èµ–--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.dom4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>dom4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.1.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        jaxençš„ä¾èµ–ï¼Œå› ä¸ºè¦ä½¿ç”¨å®ƒè§£æXMLæ–‡ä»¶--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>jaxen<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jaxen<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>æ¥ä¸‹æ¥å°±æ˜¯æ„‰å¿«çš„ç¼–å†™ä»£ç å•¦ï¼</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>spring</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">Document</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">DocumentException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">Element</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span></span><span class="token class-name">Node</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dom4j<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">SAXReader</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Constructor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassPathXmlApplicationContext</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContext</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span>beans <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">String</span> resource<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1. æ‹¿åˆ°è¿™ä¸ªxmlé…ç½®æ–‡ä»¶</span>        <span class="token class-name">SAXReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SAXReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Document</span> document <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            document <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è·å–æ‰€æœ‰çš„beanæ ‡ç­¾</span>            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">></span></span> beanNodes <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">"//bean"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// éå†é›†åˆ</span>            beanNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>beanNode <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Element</span> beanElt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> beanNode<span class="token punctuation">;</span>                <span class="token comment">// è·å–id</span>                <span class="token class-name">String</span> id <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// è·å–className</span>                <span class="token class-name">String</span> className <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"id->"</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">" className->"</span><span class="token operator">+</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">//é€šè¿‡åå°„æ‹¿åˆ°class</span>                    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// è·å¾—classçš„æ„é€ å™¨</span>                    <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> constructor <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// å®ä¾‹åŒ–å¯¹è±¡</span>                    <span class="token class-name">Object</span> o <span class="token operator">=</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å®ä¾‹åŒ–å¯¹è±¡->"</span><span class="token operator">+</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// æš´éœ²beanï¼Œæ”¾åœ¨mapï¼ˆç¼“å­˜ï¼‰</span>                    beans<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//å†æ¬¡éå†beanï¼Œç»™å±æ€§èµ‹å€¼ï¼ˆDIï¼‰</span>            beanNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>beanNode <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Element</span> beanElt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> beanNode<span class="token punctuation">;</span>                <span class="token comment">// è·å–id</span>                <span class="token class-name">String</span> id <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// è·å–className</span>                <span class="token class-name">String</span> className <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// è·å–å®ä¾‹åŒ–å¯¹è±¡</span>                <span class="token class-name">Object</span> bean <span class="token operator">=</span> beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>                logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è·å–å®ä¾‹åŒ–å¯¹è±¡"</span><span class="token operator">+</span>bean<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//æ‹¿åˆ°properties</span>                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">></span></span> properties <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">"property"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                properties<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>property <span class="token operator">-></span><span class="token punctuation">&#123;</span>                    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è·å–property-> "</span> <span class="token operator">+</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">Element</span> element <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> property<span class="token punctuation">;</span>                    <span class="token class-name">String</span> name <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> arg <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> ref <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"ref"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> methodName <span class="token operator">=</span> <span class="token string">"set"</span><span class="token operator">+</span>name<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"methodName="</span><span class="token operator">+</span>methodName<span class="token operator">+</span><span class="token string">" arg="</span><span class="token operator">+</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">Object</span> actualValue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                        <span class="token comment">//è·å¾—å±æ€§</span>                        <span class="token class-name">Field</span> field <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token class-name">Method</span> method <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>methodName<span class="token punctuation">,</span> field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å‚æ•°ç±»å‹->"</span><span class="token operator">+</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>ref <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                            <span class="token comment">//å¦‚æœå‚æ•°æ˜¯å¼•ç”¨æ•°æ®ç±»å‹</span>                            method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span>beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> arg <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                            <span class="token comment">//å‚æ•°æ˜¯ç®€å•æ•°æ®ç±»å‹</span>                            <span class="token keyword">switch</span> <span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                                <span class="token keyword">case</span> <span class="token string">"boolean"</span><span class="token punctuation">,</span><span class="token string">"Boolean"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token function">parseBoolean</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"byte"</span><span class="token punctuation">,</span><span class="token string">"Byte"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Byte</span><span class="token punctuation">.</span><span class="token function">parseByte</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"short"</span><span class="token punctuation">,</span><span class="token string">"Short"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Short</span><span class="token punctuation">.</span><span class="token function">parseShort</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"int"</span><span class="token punctuation">,</span><span class="token string">"Integer"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"long"</span><span class="token punctuation">,</span> <span class="token string">"Long"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"float"</span><span class="token punctuation">,</span><span class="token string">"Float"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"double"</span><span class="token punctuation">,</span><span class="token string">"Double"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"char"</span><span class="token punctuation">,</span><span class="token string">"Character"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> arg<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                                <span class="token keyword">case</span> <span class="token string">"String"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> arg<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                            method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span>actualValue<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre></li></ol><p>ä»£ç å¾ˆé•¿ï¼Œåˆ«æ€¥æˆ‘ä»¬ä¸€æ­¥æ­¥åˆ†æï¼š</p><p>è¿™æ®µä»£ç åšä¸‰ä»¶äº‹ï¼š</p><ol><li><p>é€šè¿‡ <code>document = reader.read(ClassLoader.getSystemClassLoader().getResourceAsStream(resource));</code>æ‹¿åˆ°é…ç½®æ–‡ä»¶ã€‚</p></li><li><p>æ‹¿åˆ°æ‰€ä»¥çš„beanæ ‡ç­¾,è·å–æ ‡ç­¾çš„nameå±æ€§å’Œå’Œclasså±æ€§å€¼ï¼Œnameå±æ€§å€¼æ˜¯è¿™ä¸ªbeançš„idï¼Œclassæ˜¯è¿™ä¸ªç±»çš„å…¨é™å®šç±»åã€‚</p></li><li><p>é€šè¿‡åå°„æœºåˆ¶å®ä¾‹åŒ–å¯¹è±¡ï¼Œå¹¶æ”¾åˆ°mapé›†åˆä¸­ã€‚</p><p>è¿™ä¸€æ­¥ç›¸å½“äºæŠŠbeanæ”¾å…¥äºŒçº§ç¼“å­˜ä¸­ï¼Œæå‰æš´éœ²beanã€‚mapé›†åˆå°±æ˜¯äºŒçº§ç¼“å­˜ï¼Œå…¶ä¸­keyå­˜æ”¾å¯¹è±¡çš„nameæˆ–idï¼Œvalueå­˜æ”¾è¿™ä¸ªå®ä¾‹åŒ–çš„å¯¹è±¡ã€‚</p></li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//1. æ‹¿åˆ°è¿™ä¸ªxmlé…ç½®æ–‡ä»¶</span><span class="token class-name">SAXReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SAXReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Document</span> document <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    document <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è·å–æ‰€æœ‰çš„beanæ ‡ç­¾</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">></span></span> beanNodes <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">"//bean"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// éå†é›†åˆ</span>    beanNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>beanNode <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Element</span> beanElt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> beanNode<span class="token punctuation">;</span>        <span class="token comment">// è·å–id</span>        <span class="token class-name">String</span> id <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·å–className</span>        <span class="token class-name">String</span> className <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"id->"</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">" className->"</span><span class="token operator">+</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//é€šè¿‡åå°„æ‹¿åˆ°class</span>            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è·å¾—classçš„æ„é€ å™¨</span>            <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> constructor <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å®ä¾‹åŒ–å¯¹è±¡</span>            <span class="token class-name">Object</span> o <span class="token operator">=</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å®ä¾‹åŒ–å¯¹è±¡->"</span><span class="token operator">+</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// æš´éœ²beanï¼Œæ”¾åœ¨mapï¼ˆç¼“å­˜ï¼‰</span>            beans<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å®ä¾‹åŒ–beanä¹‹åï¼Œæ¥ä¸‹é‡Œå°±æ˜¯ä¾èµ–æ³¨å…¥äº†ï¼ˆDependency Injectionï¼‰ã€‚æˆ‘ä»¬éœ€è¦å†æ¬¡éå†æ¯ä¸€ä¸ªbeanèŠ‚ç‚¹ï¼Œä¸€ä¸ªbeanèŠ‚ç‚¹ç›¸å½“äºä¸€ä¸ªbeanå¯¹è±¡ã€‚å¯¹äºæ¯ä¸€ä¸ªbeanå¯¹è±¡ï¼Œå†æ¬¡éå†beanå¯¹è±¡çš„<property>æ ‡ç­¾ï¼Œè¿™å¯¹äºè¿™äº›benaå¯¹è±¡çš„å±æ€§å€¼ï¼Œå¯¹äºè¿™äº›å±æ€§å€¼ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡setæ³¨å…¥çš„æ–¹æ³•ç»™å±æ€§èµ‹å€¼ã€‚</property></p><p>è¿™æ—¶å€™å°±æ˜¯è°ƒç”¨å¯¹è±¡çš„setæ–¹æ³•äº†ï¼Œè¿˜è®°å¾—è°ƒç”¨æ–¹æ³•çš„å››è¦ç´ å—ï¼Ÿæ²¡é”™ï¼Œæˆ‘ä»¬éœ€è¦æ–¹æ³•æ‰€å±çš„å¯¹è±¡ï¼Œæ–¹æ³•åï¼Œæ–¹æ³•å‚æ•°ï¼Œä»¥åŠè¿”å›å€¼ç±»å‹ã€‚</p><p>å…¶ä¸­ï¼Œå¯¹è±¡æˆ‘ä»¬å¯ä»¥é€šè¿‡äºŒçº§ç¼“å­˜æ‹¿åˆ°ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€éƒ¨åˆ†çš„mapé›†åˆã€‚æ–¹æ³•å‚æ•°ä¹Ÿæ˜¯å±æ€§å€¼ï¼Œåœ¨propertyæ ‡ç­¾çš„valueå±æ€§å€¼æŒ‡æ˜ã€‚è¿”å›å€¼å°±æ›´è½»æ¾äº†ï¼Œsetæ–¹æ³•çš„è¿”å›å€¼éƒ½æ˜¯voidã€‚</p><p>é‚£ä¹ˆå‰©ä¸‹çš„ï¼Œå°±æ˜¯æ–¹æ³•åäº†ï¼ŒæŒ‰ç…§Javaå‘½åè§„èŒƒè§„èŒƒï¼Œsetæ–¹æ³•åæœ‰setåŠ ä¸Šå±æ€§åçš„é¦–å­—æ¯å¤§å°ç»„æˆï¼Œç¬¦åˆé©¼å³°å‘½åè§„èŒƒã€‚æˆ‘ä»¬æ‹¿åˆ°äº†å±æ€§å€¼ï¼Œå°±å¯ä»¥é€šè¿‡æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹æ³•æ¥å¾—åˆ°æ–¹æ³•åã€‚</p><p>ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå±æ€§å€¼æœ‰æ™®é€šç±»å‹å’Œå¼•ç”¨ç±»å‹ä¸¤ç§ï¼Œå¯¹åº”å¼•ç”¨ç±»å‹ï¼Œæˆ‘ä»¬çš„åšæ³•å¾ˆç®€å•ï¼Œé€šè¿‡äºŒçº§ç¼“å­˜æ‹¿åˆ°å¼•ç”¨å¯¹è±¡ï¼Œå†é€šè¿‡setæ–¹æ³•æ³¨å…¥å°±å¥½å•¦ã€‚ä½†æ˜¯æ™®é€šç±»å‹å°±æ¯”è¾ƒéº»çƒ¦äº†ã€‚</p><p>é¦–å…ˆï¼Œæ™®é€šç±»å‹å¤ªå¤šï¼Œè€Œæˆ‘ä»¬ä»é…ç½®æ–‡ä»¶ä¸­æ‹¿åˆ°çš„æ•°æ®éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚æœç›®æ ‡å±æ€§æ˜¯Stringç±»å‹çš„è¯å¾ˆç›´æ¥ï¼Œç›´æ¥è°ƒç”¨setæ–¹æ³•å³å¯ã€‚ä½†æ˜¯å¦‚æœå±æ€§ç±»å‹æ˜¯intç±»å‹ï¼Œæˆ–è€…boolç±»å‹ï¼Œæˆ‘ä»¬å°±éœ€è¦æŠŠStringç±»å‹è½¬æ¢æˆå¯¹åº”çš„ç±»å‹ã€‚</p><p>å¥½åœ¨è¿™äº›æ™®é€šç±»éƒ½æœ‰å¯¹åº”çš„åŒ…è£…ç±»å‹ï¼Œé€šåŒ…è£…ç±»å‹æˆ‘ä»¬å¯ä»¥è½»æ¾çš„å®ç°å­—ç¬¦ä¸²ç±»å‹çš„è½¬æ¢ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦çš„å°±æ˜¯åŒ¹é…æ¯ä¸€ä¸ªæ™®é€šç±»å‹ï¼Œå¯¹è¿™æ ·çš„ç±»å‹åšç±»å‹è½¬æ¢å³å¯ã€‚</p><p>æ™®é€šç±»å‹å¤ªå¤šï¼Œå‡ºäºå­¦ä¹ çš„ç›®çš„ï¼Œå‡è®¾æˆ‘ä»¬çš„Springæ¡†æ¶åªæ”¯æŒå…¶ä¸­éƒ¨åˆ†ç±»å‹ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//å†æ¬¡éå†beanï¼Œç»™å±æ€§èµ‹å€¼ï¼ˆDIï¼‰</span>beanNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>beanNode <span class="token operator">-></span> <span class="token punctuation">&#123;</span>  <span class="token class-name">Element</span> beanElt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> beanNode<span class="token punctuation">;</span>  <span class="token comment">// è·å–id</span>  <span class="token class-name">String</span> id <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è·å–className</span>  <span class="token class-name">String</span> className <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è·å–å®ä¾‹åŒ–å¯¹è±¡</span>  <span class="token class-name">Object</span> bean <span class="token operator">=</span> beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>  logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è·å–å®ä¾‹åŒ–å¯¹è±¡"</span><span class="token operator">+</span>bean<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//æ‹¿åˆ°properties</span>  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">></span></span> properties <span class="token operator">=</span> beanElt<span class="token punctuation">.</span><span class="token function">selectNodes</span><span class="token punctuation">(</span><span class="token string">"property"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  properties<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>property <span class="token operator">-></span><span class="token punctuation">&#123;</span>      logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è·å–property-> "</span> <span class="token operator">+</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">Element</span> element <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> property<span class="token punctuation">;</span>      <span class="token class-name">String</span> name <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">String</span> arg <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">String</span> ref <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">attributeValue</span><span class="token punctuation">(</span><span class="token string">"ref"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">String</span> methodName <span class="token operator">=</span> <span class="token string">"set"</span><span class="token operator">+</span>name<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"methodName="</span><span class="token operator">+</span>methodName<span class="token operator">+</span><span class="token string">" arg="</span><span class="token operator">+</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">Object</span> actualValue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>          <span class="token comment">//è·å¾—å±æ€§</span>          <span class="token class-name">Field</span> field <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">Method</span> method <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>methodName<span class="token punctuation">,</span> field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å‚æ•°ç±»å‹->"</span><span class="token operator">+</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">if</span><span class="token punctuation">(</span>ref <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>              <span class="token comment">//å¦‚æœå‚æ•°æ˜¯å¼•ç”¨æ•°æ®ç±»å‹</span>              method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span>beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> arg <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>              <span class="token comment">//å‚æ•°æ˜¯ç®€å•æ•°æ®ç±»å‹</span>              <span class="token keyword">switch</span> <span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                  <span class="token keyword">case</span> <span class="token string">"boolean"</span><span class="token punctuation">,</span><span class="token string">"Boolean"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token function">parseBoolean</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"byte"</span><span class="token punctuation">,</span><span class="token string">"Byte"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Byte</span><span class="token punctuation">.</span><span class="token function">parseByte</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"short"</span><span class="token punctuation">,</span><span class="token string">"Short"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Short</span><span class="token punctuation">.</span><span class="token function">parseShort</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"int"</span><span class="token punctuation">,</span><span class="token string">"Integer"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"long"</span><span class="token punctuation">,</span> <span class="token string">"Long"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"float"</span><span class="token punctuation">,</span><span class="token string">"Float"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"double"</span><span class="token punctuation">,</span><span class="token string">"Double"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"char"</span><span class="token punctuation">,</span><span class="token string">"Character"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> arg<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                  <span class="token keyword">case</span> <span class="token string">"String"</span><span class="token operator">:</span> actualValue <span class="token operator">=</span> arg<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>              <span class="token punctuation">&#125;</span>              method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span>actualValue<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span></code></pre><p>æœ€åï¼Œæä¾›ä¸€ä¸ªgetBeanæ–¹æ³•çš„æ¥å£ï¼Œç”¨äºæ´»åŠ¨å®ä¾‹åŒ–çš„bean</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„Springæ¡†æ¶å°±ç®—ç¼–å†™å®Œäº†ï¼Œæ‰“åŒ…å‘å¸ƒå§ï¼</p><img src="image-20230609140316257.png" alt="image-20230609140316257" style="zoom:30%;" loading="lazy"><h3 id="æµ‹è¯•è‡ªå·±çš„Springæ¡†æ¶">æµ‹è¯•è‡ªå·±çš„Springæ¡†æ¶</h3><p>åˆ›å»ºä¸€ä¸ªMavenæ¨¡å—ï¼Œå¹¶å¼•å…¥åˆšåˆšæ‰“åŒ…å¥½çš„jaråŒ…å§</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>cn.loulan<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>MySpring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªBeanç±»</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">float</span> points<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isActive<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setIsActive</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> active<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        isActive <span class="token operator">=</span> active<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>ç„¶åæ˜¯Springé…ç½®æ–‡ä»¶</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>beans<span class="token punctuation">></span></span>    <span class="token generics"><span class="token punctuation">&lt;</span>beans<span class="token punctuation">></span></span>        <span class="token operator">&lt;</span>bean name<span class="token operator">=</span><span class="token string">"user"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bean.User"</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"id"</span> value<span class="token operator">=</span><span class="token string">"1"</span><span class="token operator">/</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"username"</span> value<span class="token operator">=</span><span class="token string">"sonetto"</span><span class="token operator">/</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"password"</span> value<span class="token operator">=</span><span class="token string">"123456"</span><span class="token operator">/</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"points"</span> value<span class="token operator">=</span><span class="token string">"12.3"</span><span class="token operator">/</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"isActive"</span> value<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>        <span class="token operator">&lt;</span>bean name<span class="token operator">=</span><span class="token string">"userDao"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bean.UserDao"</span><span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span>bean name<span class="token operator">=</span><span class="token string">"userService"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bean.UserService"</span><span class="token operator">></span>            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"userDao"</span> ref<span class="token operator">=</span><span class="token string">"userDao"</span><span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">></span></code></pre><p>ç¼–å†™æµ‹è¯•ç±»ï¼š</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">ClassPathXmlApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">DefaultSingletonBeanRegistry</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestBean</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"mySpring.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><img src="image-20230609140900802.png" alt="image-20230609140900802" loading="lazy"></p><p>è·‘èµ·æ¥äº†ï¼</p><h2 id="Spring-é›†æˆMyBatisæ¡†æ¶">Spring é›†æˆMyBatisæ¡†æ¶</h2><h3 id="Overview-2">Overview</h3><ol><li><p>éœ€è¦çš„ä¾èµ–</p><ol><li>Spring-context(å…³è”å¼•å…¥Spring-aop)</li><li>Spring-MyBatisï¼ˆSpring é›†æˆMyBatisï¼‰</li><li>Mysql-connetor(Mysqlé©±åŠ¨)</li><li>Spring-jdbcï¼ˆé“¾æ¥æ•°æ®åº“ï¼‰</li><li>MyBatis</li><li>Junitï¼ˆå•å…ƒæµ‹è¯•ï¼‰</li><li>druid(æ•°æ®æº)</li><li>Lombok</li></ol></li><li><p>é…ç½®æ•°æ®åº“</p><ol><li>accountè¡¨ï¼Œå­—æ®µact_no,banlance</li></ol></li><li><p>é¡¹ç›®ç»“æ„æ­å»º</p><ol><li><p>Bean(pojo)</p><ol><li>Account</li></ol></li><li><p>mapper</p><ol><li>AccountMapper</li><li>AccountMapper.xml</li></ol></li><li><p>Service</p><ol><li>AccountService</li><li>AccountServiceImpl</li></ol></li><li><p>resources</p><ol><li><p>Springæ ¸å¿ƒé…ç½®æ–‡ä»¶Spring.xml</p><ol><li>ç»„å»ºæ‰«æ</li><li>äº‹åŠ¡ç®¡ç†å™¨</li></ol></li><li><p>MyBatisæ ¸å¿ƒé…ç½®æ–‡ä»¶MyBatis.xml</p><ol><li>æ³¨å†ŒMapper</li><li>ç±»åˆ«å</li><li>è®¾ç½®æ—¥å¿—å®ç°</li></ol></li><li><ul><li>è¯¥æ–‡ä»¶å¯ä»¥æ²¡æœ‰ï¼Œå¤§éƒ¨åˆ†çš„é…ç½®å¯ä»¥è½¬ç§»åˆ°springé…ç½®æ–‡ä»¶ä¸­ã€‚</li><li>å¦‚æœé‡åˆ°mybatisç›¸å…³çš„ç³»ç»Ÿçº§é…ç½®ï¼Œè¿˜æ˜¯éœ€è¦è¿™ä¸ªæ–‡ä»¶ã€‚</li></ul></li><li><p>DB.propertis</p><ol><li>Driverâ†’com.mysql.jdbc.Driver</li><li>urlâ†’jdbc:mysql://localhost:3307/class?useUnicode=true&amp;characterEncoding=utf-8</li><li>usernameâ†’root</li><li>Passwordâ†’root</li></ol></li><li><p>ç¼–å†™æµ‹è¯•ç±»</p></li></ol></li></ol></li></ol><h3 id="ç¼–å†™mapper">ç¼–å†™mapper</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Account</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountMapper</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Account</span> account<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">String</span> actNo<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Account</span> account<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Account</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">String</span> actNo<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">></span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>        <span class="token string">"https://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cn.loulan.mapper.AccountMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>insert<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        Insert into account values(#&#123;actNo&#125;,#&#123;balance&#125;)    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>update<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Account<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        update account set balance = #&#123;balance&#125; where act_no = #&#123;actNo&#125;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>delete<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>        delete account where act_no = #&#123;actNo&#125;;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delete</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getById<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Account<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select * from account where act_no =#&#123;actNo&#125;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getAll<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Account<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select * from account;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></code></pre><h3 id="Service">Service</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Account</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">boolean</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Account</span> account<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">boolean</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">String</span> actNo<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">boolean</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token class-name">Account</span> account<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Account</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">String</span> actNo<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">></span></span> <span class="token function">getAllAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">boolean</span> <span class="token function">transaction</span><span class="token punctuation">(</span><span class="token class-name">String</span> from<span class="token punctuation">,</span> <span class="token class-name">String</span> <span class="token keyword">to</span><span class="token punctuation">,</span><span class="token keyword">double</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Account</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">AccountMapper</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Transactional</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">"accountService"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Transactional</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AccountService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">AccountMapper</span> accountMapper<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMapper</span><span class="token punctuation">(</span><span class="token class-name">AccountMapper</span> mapper<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>accountMapper <span class="token operator">=</span> mapper<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Account</span> account<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       accountMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">String</span> actNo<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        accountMapper<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>actNo<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token class-name">Account</span> account<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        accountMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Account</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">String</span> actNo<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> accountMapper<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>actNo<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">></span></span> <span class="token function">getAllAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> accountMapper<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">transaction</span><span class="token punctuation">(</span><span class="token class-name">String</span> from<span class="token punctuation">,</span> <span class="token class-name">String</span> <span class="token keyword">to</span><span class="token punctuation">,</span> <span class="token keyword">double</span> amount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Account</span> fromAccount <span class="token operator">=</span> accountMapper<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Account</span> toAccount <span class="token operator">=</span> accountMapper<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>fromAccount<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> amount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"ä½™é¢ä¸è¶³"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        fromAccount<span class="token punctuation">.</span><span class="token function">setBalance</span><span class="token punctuation">(</span>fromAccount<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span>  amount<span class="token punctuation">)</span><span class="token punctuation">;</span>        toAccount<span class="token punctuation">.</span><span class="token function">setBalance</span><span class="token punctuation">(</span>toAccount<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> count <span class="token operator">=</span> accountMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>fromAccount<span class="token punctuation">)</span><span class="token punctuation">;</span>         count <span class="token operator">+=</span> accountMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>toAccount<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"å¼‚å¸¸"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> count <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="resources">resources</h3><p>æ•°æ®é…ç½®æ–‡ä»¶</p><pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token comment">#DRIVER=com.mysql.jdbc.Driver</span><span class="token key attr-name">DRIVER</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.cj.jdbc.Driver</span><span class="token key attr-name">URL</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3306/demo?useUnicode=true&amp;characterEncoding=utf-8</span><span class="token key attr-name">USERNAME</span><span class="token punctuation">=</span><span class="token value attr-value">root</span><span class="token key attr-name">PASSWORD</span><span class="token punctuation">=</span><span class="token value attr-value">root</span></code></pre><p>MyBatisæ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">configuration</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Config 3.0//EN"</span>        <span class="token string">"https://mybatis.org/dtd/mybatis-3-config.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--æ—¥å¿—å®ç°--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logImpl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>STDOUT_LOGGING<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Account<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cn.loulan.bean.Account<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span></code></pre><p>Springæ ¸å¿ƒé…ç½®æ–‡ä»¶</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>tx</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/tx<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment">&lt;!--å¼€å¯ç»„ä»¶è‡ªåŠ¨æ‰«æ--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cn.loulan.service<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token comment">&lt;!--    åŠ è½½æ•°æ®åº“é…ç½®æ–‡ä»¶--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DB.properties<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token comment">&lt;!--    é…ç½®æ•°æ®æº--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.alibaba.druid.pool.DruidDataSource<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driverClassName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;DRIVER&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;URL&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;USERNAME&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;PASSWORD&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--Mapperæ‰«æå™¨--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.mybatis.spring.mapper.MapperScannerConfigurer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>basePackage<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cn.loulan.mapper<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--SqlSessionFactoryBean--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.mybatis.spring.SqlSessionFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!--mybatisæ ¸å¿ƒé…ç½®æ–‡ä»¶è·¯å¾„--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>configLocation<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mybatis.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token comment">&lt;!--æ³¨å…¥æ•°æ®æº--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token comment">&lt;!--èµ·åˆ«å--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>typeAliasesPackage<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cn.loulan.bean<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--äº‹åŠ¡ç®¡ç†å™¨--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>txManager<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--å¼€å¯äº‹åŠ¡æ³¨è§£--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>annotation-driven</span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>txManager<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span></code></pre><h3 id="ç¼–å†™æµ‹è¯•ç±»">ç¼–å†™æµ‹è¯•ç±»</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Account</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">AccountMapper</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>loulan<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">MybatisUtil</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSession</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">ClassPathXmlApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">mapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">MybatisUtil</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">AccountMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">AccountMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        mapper.insert(new Account("123",500.00));</span>        mapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token string">"234"</span><span class="token punctuation">,</span><span class="token number">500.00</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSpring</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"spring.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">AccountService</span> accountService <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"accountService"</span><span class="token punctuation">,</span> <span class="token class-name">AccountService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">></span></span> allAccounts <span class="token operator">=</span> accountService<span class="token punctuation">.</span><span class="token function">getAllAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        allAccounts<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>account <span class="token operator">-></span><span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"spring.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">AccountService</span> accountService <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"accountService"</span><span class="token punctuation">,</span> <span class="token class-name">AccountService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        accountService<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token string">"234"</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="æ€»ç»“">æ€»ç»“</h3><p>é…ç½®æ–‡ä»¶è¿˜æ˜¯è¦å†™å¥½å¤šï¼Œè€Œä¸”å®Œå…¨é è®°å¿†å˜›ã€‚ç®€å•æ•´ç†ä¸€ä¸‹è¿™äº›é…ç½®æ–‡ä»¶ï¼Œä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œspringçš„é…ç½®æ–‡ä»¶å’Œmybatisçš„é…ç½®æ–‡ä»¶ã€‚springé…ç½®æ–‡ä»¶ä¸­ä¸»è¦çš„é…ç½®æœ‰ï¼š</p><ol><li>æ³¨å†Œbeanï¼Œåœ¨ç”¨æ³¨è§£å¼€å‘æ—¶å¼€å¯ç»„å»ºè‡ªåŠ¨æ‰«æ</li><li>åŠ è½½æ•°æ®åº“é…ç½®æ–‡ä»¶ã€‚</li><li>é…ç½®æ•°æ®æºã€‚åŒ…æ‹¬æ•°æ®åº“çš„ä¸€ä¸‹é…ç½®ä¿¡æ¯ï¼Œé©±åŠ¨å™¨å•Šurlä¹‹ç±»çš„ã€‚</li><li>Mapperæ‰«æå™¨ã€‚ç›¸å½“äºåœ¨mybatisä¸­æ³¨å†Œmapperï¼Œä½¿ç”¨åŒ…åæ‰«æè¿™ä¸ªåŒ…ä¸‹çš„æ‰€æœ‰mapperã€‚</li><li>é…ç½®sqlSessionFactoryBeanåœ¨è¿™ä¸ªbeanä¸­ä»·å€¼mybatisçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œä»¥åŠä»·å€¼æ•°æ®æºï¼Œç±»å‹åˆ«åç­‰ç­‰å¯ä»¥åœ¨mybatisä¸­é…ç½®çš„å†…å®¹éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªbeanæ¥é…ç½®ã€‚</li><li>é…ç½®äº‹åŠ¡ç®¡ç†å™¨</li><li>å¼€å¯äº‹åŠ¡æ³¨è§£</li></ol><p>è¿™æ ·åœ¨MyBatisé…ç½®æ–‡ä»¶çš„å†…å®¹å°±å°‘å¾ˆå¤šäº†ï¼Œç”šè‡³å¯ä»¥ä¸é…æˆ–è€…æ²¡æœ‰ã€‚è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬é…ç½®äº†æ—¥å¿—å®ç°å’Œç±»å‹åˆ«åã€‚</p><p>æ„Ÿè§‰å¥½ä¹±ï¼Œè¯¾ç¨‹çš„è¿™ä¸€æ®µè®²å¾—å¤ªå¿«äº†ï¼Œè€æœæ˜¯ä¸æ˜¯èµ¶ç€åƒé¥­å•Šã€‚</p><p>Springæ¡†æ¶ä¸‹çš„mybatisè¿˜æ˜¯å’Œç›´æ¥ç”¨mybatisæœ‰å¾ˆå¤§åŒºåˆ«ã€‚Springä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¸€ä¸ªå·¥å…·ç±»ç”¨äºä»·å€¼mybatisé…ç½®æ–‡ä»¶ä»¥ä¾¿è·å–sqlsessionå¯¹è±¡äº†ã€‚äº‹åŠ¡çš„å¤„ç†ä¹Ÿä¸éœ€è¦ç®¡äº†ï¼Œè™½ç„¶ç®€åŒ–äº†å¾ˆå¤šä»£ç ï¼Œä½†æ˜¯æ€»æœ‰ä¸€ç§é¡¹ç›®è«åå…¶å¦™å°±è·‘èµ·æ¥çš„æ„Ÿè§‰ï¼Œç»ˆæè¿˜æ˜¯æˆ‘äº†è§£å¾—ä¸å¤Ÿå¤šäº†å§ã€‚</p>]]></content>
    
    
    <summary type="html">spring å­¦ä¹ ç¬”è®°</summary>
    
    
    
    <category term="java EE" scheme="https://trevoewu.github.io/categories/java-EE/"/>
    
    
    <category term="Spring" scheme="https://trevoewu.github.io/tags/Spring/"/>
    
    <category term="Java" scheme="https://trevoewu.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>MyBatiså­¦ä¹ ç¬”è®°</title>
    <link href="https://trevoewu.github.io/2023/05/27/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>https://trevoewu.github.io/2023/05/27/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2023-05-27T10:14:52.000Z</published>
    <updated>2023-06-09T04:41:45.731Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å…¥é—¨ä¹‹ç¯å¢ƒæ­å»º">å…¥é—¨ä¹‹ç¯å¢ƒæ­å»º</h2><ol><li><p>å¯¼å…¥ä¾èµ–çš„jaråŒ…</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.5.13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre></li><li><p>*è§£å†³Mavené™æ€èµ„æºè¿‡æ»¤é—®é¢˜ å¯¼è‡´ç”Ÿæˆçš„targetæ–‡ä»¶ä¸åŒ…å«xmlï¼Œå¯¼è‡´IOé”™è¯¯</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>src/main/java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>**/*.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>**/*.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filtering</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filtering</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>src/main/resources<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>**/*.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>**/*.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filtering</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filtering</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">></span></span></code></pre></li><li><p>æ–°å»ºMyBatisé…ç½®æ–‡ä»¶â†’<code>mybatis-config.xml</code>, æ”¾åœ¨<code>resource</code>ç›®å½•ä¸‹.</p><p>ç†è®ºä¸Šæ”¾åœ¨å“ªé‡Œéƒ½å¯ä»¥, æ–‡ä»¶åå«ä»€ä¹ˆä¹Ÿéšæ„, ä½†æ˜¯æŒ‰ç…§è§„èŒƒæ¥èƒ½è®©ä»£ç æ›´è§„èŒƒ, æ›´å…·æœ‰å¯è¯»æ€§.</p><p>æ ‡ç­¾:   <code> &lt;properties resource=&quot;db.properties&quot;/&gt;</code>æŒ‡ä»£æ•°æ®åº“çš„å±æ€§, ç”¨äºè¯»å–<code>properties</code>, è¿™æ ·æˆ‘ä»¬å°±é…ç½®æ•°æ®åº“çš„å±æ€§æ¯”å¦‚Driver, URLæ—¶ç›´æ¥ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„å˜é‡.</p><p>æ³¨æ„ XML å¤´éƒ¨çš„å£°æ˜ï¼Œå®ƒç”¨æ¥éªŒè¯ XML æ–‡æ¡£çš„æ­£ç¡®æ€§ã€‚</p><p>environment å…ƒç´ ä½“ä¸­åŒ…å«äº†äº‹åŠ¡ç®¡ç†å’Œè¿æ¥æ± çš„é…ç½®ã€‚mappers å…ƒç´ åˆ™åŒ…å«äº†ä¸€ç»„æ˜ å°„å™¨ï¼ˆmapperï¼‰ï¼Œè¿™äº›æ˜ å°„å™¨çš„ XML æ˜ å°„æ–‡ä»¶åŒ…å«äº† SQL ä»£ç å’Œæ˜ å°„å®šä¹‰ä¿¡æ¯ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">configuration</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Config 3.0//EN"</span>        <span class="token string">"https://mybatis.org/dtd/mybatis-3-config.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--    ä»db.propertiesè¯»å–æ•°æ®åº“å±æ€§--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>db.properties<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;DRIVER&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;URL&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;USERNAME&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;PASSWORD&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dao.book.BookMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span></code></pre></li><li><p>ç¼–å†™å®ä½“ç±»</p></li><li><p>ç¼–å†™daoå±‚æ¥å£</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BookMapper</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Book</span> <span class="token function">getRelativeBook</span><span class="token punctuation">(</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"bookDesc"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> bookDesc<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre></li></ol><p>è¿™æ®µä»£ç ç”¨äºæ¨¡ç³ŠæŸ¥è¯¢åŒç±»ä¹¦ç±, <code>@Param</code>æ³¨è§£ç”¨äºæŒ‡æ˜å‚æ•°, æŒ‡æ˜å‚æ•°ä¹Ÿå¯ä»¥é€šè¿‡xmlæ–‡æ¡£åœ¨æŒ‡æ˜</p><ol start="5"><li><p>ç¼–å†™SQL</p><p>ä¸€ä¸ªè¯­å¥æ—¢å¯ä»¥é€šè¿‡ XML å®šä¹‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ³¨è§£å®šä¹‰ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹ XML å®šä¹‰è¯­å¥çš„æ–¹å¼</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>        <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--namespaceï¼šç»‘å®šä¸€ä¸ªå¯¹åº”çš„Dao/Mapperæ¥å£--></span><span class="token comment">&lt;!--        dao.book.BookMapper--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dao.book.BookMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--selectæŸ¥è¯¢è¯­å¥--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getRelativeBook<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Bean.Book<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select * from smbms_provider where proDesc like #&#123;bookDesc&#125;  and id != #&#123;id&#125; limit 1;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></code></pre><ul><li><p><code>Namespace</code>: æŒ‡æ˜æ¥å£ç±»çš„å‘½åç©ºé—´, ç”¨æ¥å£ç±»çš„æƒé™å®šå</p><p>å‘½åç©ºé—´çš„ä½œç”¨æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯åˆ©ç”¨æ›´é•¿çš„å…¨é™å®šåæ¥å°†ä¸åŒçš„è¯­å¥éš”ç¦»å¼€æ¥ï¼ŒåŒæ—¶å®ç°äº†æ¥å£ç»‘å®šã€‚ å°†å‘½åç©ºé—´ç½®äºåˆé€‚çš„ Java åŒ…å‘½åç©ºé—´ä¹‹ä¸­ï¼Œä½ çš„ä»£ç ä¼šå˜å¾—æ›´åŠ æ•´æ´ï¼Œä¹Ÿæœ‰åˆ©äºä½ æ›´æ–¹ä¾¿åœ°ä½¿ç”¨ MyBatisã€‚</p></li><li><p><code>select</code>ä¾¿ç­¾: ç”¨äºæŸ¥è¯¢è¯­å¥</p></li><li><p><code>id</code>: åœ¨å‘½åç©ºé—´ä¸­å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå¯ä»¥è¢«ç”¨æ¥å¼•ç”¨è¿™æ¡è¯­å¥. å¯¹åº”æ¥å£ç±»çš„æ–¹æ³•å, <strong>å¿…é¡»å’Œæ¥å£ç±»çš„æ–¹æ³•åä¸€è‡´</strong></p></li><li><p><code>resultType</code>: æœŸæœ›ä»è¿™æ¡è¯­å¥ä¸­è¿”å›ç»“æœçš„<strong>ç±»å…¨é™å®šåæˆ–åˆ«å</strong>ã€‚ æ³¨æ„ï¼Œ<strong>å¦‚æœè¿”å›çš„æ˜¯é›†åˆï¼Œé‚£åº”è¯¥è®¾ç½®ä¸ºé›†åˆåŒ…å«çš„ç±»å‹ï¼Œè€Œä¸æ˜¯é›†åˆæœ¬èº«çš„ç±»å‹</strong>ã€‚ resultType å’Œ resultMap ä¹‹é—´åªèƒ½åŒæ—¶ä½¿ç”¨ä¸€ä¸ª.</p></li><li><p><code>parameterType</code>: å°†ä¼šä¼ å…¥è¿™æ¡è¯­å¥çš„å‚æ•°çš„<strong>ç±»å…¨é™å®šåæˆ–åˆ«å</strong>ã€‚è¿™ä¸ªå±æ€§æ˜¯<strong>å¯é€‰</strong>çš„ï¼Œå› ä¸º MyBatis å¯ä»¥æ ¹æ®è¯­å¥ä¸­å®é™…ä¼ å…¥çš„å‚æ•°è®¡ç®—å‡ºåº”è¯¥ä½¿ç”¨çš„ç±»å‹å¤„ç†å™¨ï¼ˆTypeHandlerï¼‰ï¼Œé»˜è®¤å€¼ä¸ºæœªè®¾ç½®ï¼ˆunsetï¼‰ã€‚</p></li></ul><p>ä¸ºäº†è¿™ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä¼¼ä¹å†™äº†ä¸å°‘é…ç½®ï¼Œä½†å…¶å®å¹¶ä¸å¤šã€‚<strong>åœ¨ä¸€ä¸ª XML æ˜ å°„æ–‡ä»¶ä¸­ï¼Œå¯ä»¥å®šä¹‰æ— æ•°ä¸ªæ˜ å°„è¯­å¥</strong>ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒXML å¤´éƒ¨å’Œæ–‡æ¡£ç±»å‹å£°æ˜éƒ¨åˆ†å°±æ˜¾å¾—å¾®ä¸è¶³é“äº†ã€‚æ–‡æ¡£çš„å…¶å®ƒéƒ¨åˆ†å¾ˆç›´ç™½ï¼Œå®¹æ˜“ç†è§£ã€‚ å®ƒåœ¨å‘½åç©ºé—´ <code>dao.book.BookMapper </code>ä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>selectBlog</code> çš„æ˜ å°„è¯­å¥</p></li><li><p>æ³¨å†ŒMapper</p><p>åœ¨mybatis-config.xmlä¸­æ³¨å†ŒMapper</p><pre class="language-markup" data-language="markup"><code class="language-markup"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        æ–¹å¼1ï¼š é€šè¿‡resourceæ³¨å†Œmapper--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dao/book/BookMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span></code></pre><ol start="7"><li><p>ç¼–å†™è·å–æ•°æ®åº“è¿æ¥çš„å·¥å…·ç±»Util</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MybatisUtil</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span><span class="token comment">//          ä» XML æ–‡ä»¶ä¸­æ„å»º SqlSessionFactory çš„å®ä¾‹</span>            <span class="token class-name">String</span> resource <span class="token operator">=</span> <span class="token string">"mybatis-config.xml"</span><span class="token punctuation">;</span>            inputStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>            sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SqlSession</span> <span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>æ¯ä¸ªåŸºäº MyBatis çš„åº”ç”¨éƒ½æ˜¯ä»¥ä¸€ä¸ª<code>SqlSessionFactory</code>çš„å®ä¾‹ä¸ºæ ¸å¿ƒçš„ã€‚<code>SqlSessionFactory </code>çš„å®ä¾‹å¯ä»¥é€šè¿‡ <code>SqlSessionFactoryBuilder</code> çš„<code>build</code>æ–¹æ³•è·å¾—ã€‚è€Œ<code>SqlSessionFactoryBuilder</code>åˆ™å¯ä»¥ä» XML é…ç½®æ–‡ä»¶æˆ–ä¸€ä¸ªé¢„å…ˆé…ç½®çš„ Configuration å®ä¾‹æ¥æ„å»ºå‡º <code>SqlSessionFactory</code> å®ä¾‹ã€‚(<strong>å·¥å‚æ¨¡å¼</strong>)</p><blockquote><p>å·¥å‚æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œç”¨äºå°è£…å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ã€‚å®ƒé€šè¿‡å®šä¹‰ä¸€ä¸ªå…±åŒçš„æ¥å£æˆ–åŸºç±»æ¥åˆ›å»ºå¯¹è±¡ï¼Œä½†å…·ä½“çš„å¯¹è±¡åˆ›å»ºé€»è¾‘è¢«ç§»åˆ°å·¥å‚ç±»ä¸­ã€‚è¿™æ ·ï¼Œå®¢æˆ·ç«¯ä»£ç åªéœ€è¦ä¸å·¥å‚ç±»äº¤äº’ï¼Œè€Œä¸éœ€è¦ç›´æ¥åˆ›å»ºå¯¹è±¡ï¼Œä»è€Œé™ä½äº†ä»£ç çš„è€¦åˆæ€§ã€‚</p><p>é€šè¿‡å·¥å‚æ¨¡å¼ï¼Œä»£ç å®ç°äº†å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨çš„åˆ†ç¦»ï¼Œä½¿å¾—ä»£ç æ›´å…·å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚å¦‚æœå°†æ¥éœ€è¦ä¿®æ”¹ <code>SqlSessionFactory</code> å¯¹è±¡çš„åˆ›å»ºé€»è¾‘ï¼Œåªéœ€ä¿®æ”¹ <code>MybatisUtil</code> ç±»ä¸­çš„ä»£ç ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç ã€‚åŒæ—¶ï¼Œå·¥å‚æ¨¡å¼ä¹Ÿéšè—äº†å…·ä½“å¯¹è±¡çš„åˆ›å»ºç»†èŠ‚ï¼Œä½¿å¾—å®¢æˆ·ç«¯ä»£ç æ›´åŠ ç®€æ´å’Œå¯è¯»ã€‚</p></blockquote><p>ä»£ç é€šè¿‡é™æ€ä»£ç å—åœ¨ç±»åŠ è½½æ—¶åˆå§‹åŒ–äº†ä¸€ä¸ªå…¨å±€çš„ <code>SqlSessionFactory</code> å¯¹è±¡ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªå…¬å…±çš„é™æ€æ–¹æ³•ç”¨äºè·å– <code>SqlSession</code> å®ä¾‹ã€‚è¿™æ ·å…¶ä»–ç±»åœ¨ä½¿ç”¨ MyBatis è¿›è¡Œæ•°æ®åº“æ“ä½œæ—¶ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ <code>MybatisUtil.getSqlSession()</code> æ–¹æ³•æ¥è·å– <code>SqlSession</code> å¯¹è±¡ï¼Œä»è€Œç®€åŒ–äº† MyBatis çš„é…ç½®å’Œä½¿ç”¨è¿‡ç¨‹ã€‚</p><p><code>SqlSession </code>æä¾›äº†åœ¨æ•°æ®åº“æ‰§è¡Œ SQL å‘½ä»¤æ‰€éœ€çš„æ‰€æœ‰æ–¹æ³•ã€‚ä½ å¯ä»¥é€šè¿‡ SqlSession å®ä¾‹æ¥ç›´æ¥æ‰§è¡Œå·²æ˜ å°„çš„ SQL è¯­å¥.</p></li><li><p>ç¼–å†™æµ‹è¯•ç±»</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetRelativeBook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">MybatisUtil</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token class-name">BookMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">BookMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token class-name">Book</span> relativeBook <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">getRelativeBook</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">"%è®¡ç®—æœº%"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>relativeBook<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></code></pre></li></ol></li></ol><h3 id="å‚æ•°">å‚æ•°</h3><ol><li><p>å¯¹äºå¤§å¤šæ•°ç®€å•çš„ä½¿ç”¨åœºæ™¯ï¼Œä½ éƒ½ä¸éœ€è¦ä½¿ç”¨å¤æ‚çš„å‚æ•°ï¼Œæ¯”å¦‚ï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUsers<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  select id, username, password from users where id = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>å‚æ•°ç±»å‹ï¼ˆparameterTypeï¼‰ä¼šè¢«è‡ªåŠ¨è®¾ç½®ä¸º <code>int</code>ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥<strong>éšæ„å‘½å</strong>ã€‚åŸå§‹ç±»å‹æˆ–ç®€å•æ•°æ®ç±»å‹ï¼ˆæ¯”å¦‚ <code>Integer</code> å’Œ <code>String</code>ï¼‰å› ä¸ºæ²¡æœ‰å…¶å®ƒå±æ€§ï¼Œä¼šç”¨å®ƒä»¬çš„å€¼æ¥ä½œä¸ºå‚æ•°.</p></li><li><p>ç„¶è€Œï¼Œå¦‚æœä¼ å…¥ä¸€ä¸ª<strong>å¤æ‚çš„å¯¹è±¡</strong>ï¼Œè¡Œä¸ºå°±ä¼šæœ‰ç‚¹ä¸ä¸€æ ·äº†ã€‚æ¯”å¦‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>insertUser<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  insert into users (id, username, password)  values (#&#123;id&#125;, #&#123;username&#125;, #&#123;password&#125;)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span></code></pre><p>å¦‚æœ User ç±»å‹çš„å‚æ•°å¯¹è±¡ä¼ é€’åˆ°äº†è¯­å¥ä¸­ï¼Œä¼šæŸ¥æ‰¾ idã€username å’Œ password å±æ€§ï¼Œç„¶åå°†å®ƒä»¬çš„å€¼ä¼ å…¥é¢„å¤„ç†è¯­å¥çš„å‚æ•°ä¸­ã€‚<strong>å¦‚æœå‚æ•°ç±»å‹æ˜¯å…·ä½“çš„ç±», å‚æ•°å¯ä»¥ç›´æ¥é€šè¿‡å±æ€§åç›´æ¥å¾—åˆ°, å³ä½¿å±æ€§æ˜¯ç§æœ‰çš„.</strong></p></li><li><p>å‚æ•°ç±»å‹æ˜¯HashMap</p><p>è¿™æ—¶å€™, å‚æ•°åä¼šè¢«æ˜ å°„ä¸ºMapä¸­çš„key.</p></li><li><p>@Paramæ³¨è§£ç”¨äºç»™æ–¹æ³•å‚æ•°èµ·ä¸€ä¸ªåå­—ã€‚ä»¥ä¸‹æ˜¯æ€»ç»“çš„ä½¿ç”¨åŸåˆ™ï¼š</p><ul><li>åœ¨æ–¹æ³•åªæ¥å—ä¸€ä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä¸ä½¿ç”¨@Paramã€‚</li><li>åœ¨æ–¹æ³•æ¥å—å¤šä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼Œå»ºè®®ä¸€å®šè¦ä½¿ç”¨@Paramæ³¨è§£ç»™å‚æ•°å‘½åã€‚</li><li><strong>å¦‚æœå‚æ•°æ˜¯ JavaBean ï¼Œ åˆ™ä¸èƒ½ä½¿ç”¨@Paramã€‚</strong></li><li>ä¸ä½¿ç”¨@Paramæ³¨è§£æ—¶ï¼Œå‚æ•°åªèƒ½æœ‰ä¸€ä¸ªï¼Œå¹¶ä¸”æ˜¯Javabeanã€‚</li></ul></li></ol><h4 id="å­—ç¬¦ä¸²æ›¿æ¢">å­—ç¬¦ä¸²æ›¿æ¢</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨ <code>#&#123;&#125;</code> å‚æ•°è¯­æ³•æ—¶ï¼ŒMyBatis ä¼šåˆ›å»º <code>PreparedStatement</code> å‚æ•°å ä½ç¬¦ï¼Œå¹¶é€šè¿‡å ä½ç¬¦å®‰å…¨åœ°è®¾ç½®å‚æ•°ï¼ˆå°±åƒä½¿ç”¨ <code>?</code> ä¸€æ ·ï¼‰ã€‚ è¿™æ ·åšæ›´å®‰å…¨ï¼Œæ›´è¿…é€Ÿï¼Œé€šå¸¸ä¹Ÿæ˜¯é¦–é€‰åšæ³•ï¼Œä¸è¿‡æœ‰æ—¶ä½ å°±æ˜¯æƒ³ç›´æ¥åœ¨ SQL è¯­å¥ä¸­ç›´æ¥æ’å…¥ä¸€ä¸ªä¸è½¬ä¹‰çš„å­—ç¬¦ä¸²ã€‚ æ¯”å¦‚ ORDER BY å­å¥ï¼Œè¿™æ—¶å€™ä½ å¯ä»¥ï¼š</p><pre class="language-none"><code class="language-none">ORDER BY $&#123;columnName&#125;</code></pre><p>è¿™æ ·ï¼ŒMyBatis å°±ä¸ä¼šä¿®æ”¹æˆ–è½¬ä¹‰è¯¥å­—ç¬¦ä¸²äº†ã€‚</p><p>å½“ SQL è¯­å¥ä¸­çš„å…ƒæ•°æ®ï¼ˆå¦‚è¡¨åæˆ–åˆ—åï¼‰æ˜¯åŠ¨æ€ç”Ÿæˆçš„æ—¶å€™ï¼Œå­—ç¬¦ä¸²æ›¿æ¢å°†ä¼šéå¸¸æœ‰ç”¨ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ æƒ³ <code>select</code> ä¸€ä¸ªè¡¨ä»»æ„ä¸€åˆ—çš„æ•°æ®æ—¶ï¼Œä¸éœ€è¦è¿™æ ·å†™ï¼š</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from user where id = #&#123;id&#125;"</span><span class="token punctuation">)</span><span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from user where name = #&#123;name&#125;"</span><span class="token punctuation">)</span><span class="token class-name">User</span> <span class="token function">findByName</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from user where email = #&#123;email&#125;"</span><span class="token punctuation">)</span><span class="token class-name">User</span> <span class="token function">findByEmail</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"email"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å…¶å®ƒçš„ "findByXxx" æ–¹æ³•</span></code></pre><p>è€Œæ˜¯å¯ä»¥åªå†™è¿™æ ·ä¸€ä¸ªæ–¹æ³•ï¼š</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from user where $&#123;column&#125; = #&#123;value&#125;"</span><span class="token punctuation">)</span><span class="token class-name">User</span> <span class="token function">findByColumn</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"column"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> column<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å…¶ä¸­ <code>$&#123;column&#125;</code> ä¼šè¢«ç›´æ¥æ›¿æ¢ï¼Œè€Œ <code>#&#123;value&#125;</code> ä¼šä½¿ç”¨ <code>?</code> é¢„å¤„ç†ã€‚ è¿™æ ·ï¼Œå°±èƒ½å®ŒæˆåŒæ ·çš„ä»»åŠ¡ï¼š</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">User</span> userOfId1 <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">findByColumn</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">User</span> userOfNameKid <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">findByColumn</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"kid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">User</span> userOfEmail <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">findByColumn</span><span class="token punctuation">(</span><span class="token string">"email"</span><span class="token punctuation">,</span> <span class="token string">"noone@nowhere.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è¿™ç§æ–¹å¼ä¹ŸåŒæ ·é€‚ç”¨äºæ›¿æ¢è¡¨åçš„æƒ…å†µã€‚</p><blockquote><p><strong>æç¤º</strong> :</p><p>ç”¨è¿™ç§æ–¹å¼æ¥å—ç”¨æˆ·çš„è¾“å…¥ï¼Œå¹¶ç”¨ä½œè¯­å¥å‚æ•°æ˜¯ä¸å®‰å…¨çš„ï¼Œä¼šå¯¼è‡´æ½œåœ¨çš„ SQL æ³¨å…¥æ”»å‡»ã€‚å› æ­¤ï¼Œè¦ä¹ˆä¸å…è®¸ç”¨æˆ·è¾“å…¥è¿™äº›å­—æ®µï¼Œè¦ä¹ˆè‡ªè¡Œè½¬ä¹‰å¹¶æ£€éªŒè¿™äº›å‚æ•°ã€‚</p></blockquote><h2 id="XMLé…ç½®è§£æ">XMLé…ç½®è§£æ</h2><p>MyBatis çš„é…ç½®æ–‡ä»¶åŒ…å«äº†ä¼šæ·±æ·±å½±å“ MyBatis è¡Œä¸ºçš„è®¾ç½®å’Œå±æ€§ä¿¡æ¯ã€‚</p><ul><li>èƒ½é…ç½®çš„å†…å®¹å¦‚ä¸‹ï¼š</li></ul><pre class="language-properties" data-language="properties"><code class="language-properties">configurationï¼ˆé…ç½®ï¼‰propertiesï¼ˆå±æ€§ï¼‰settingsï¼ˆè®¾ç½®ï¼‰typeAliasesï¼ˆç±»å‹åˆ«åï¼‰typeHandlersï¼ˆç±»å‹å¤„ç†å™¨ï¼‰objectFactoryï¼ˆå¯¹è±¡å·¥å‚ï¼‰pluginsï¼ˆæ’ä»¶ï¼‰environmentsï¼ˆç¯å¢ƒé…ç½®ï¼‰environmentï¼ˆç¯å¢ƒå˜é‡ï¼‰transactionManagerï¼ˆäº‹åŠ¡ç®¡ç†å™¨ï¼‰dataSourceï¼ˆæ•°æ®æºï¼‰databaseIdProviderï¼ˆæ•°æ®åº“å‚å•†æ ‡è¯†ï¼‰mappersï¼ˆæ˜ å°„å™¨ï¼‰<span class="token key attr-name">&lt;!--</span> <span class="token value attr-value">æ³¨æ„å…ƒç´ èŠ‚ç‚¹çš„é¡ºåºï¼é¡ºåºä¸å¯¹ä¼šæŠ¥é”™ --></span></code></pre><h3 id="environments">environments</h3><p>environments å…ƒç´ å®šä¹‰äº†å¦‚ä½•é…ç½®ç¯å¢ƒã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>...<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>...<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transactionManager</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;driver&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;url&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;username&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;password&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">></span></span></code></pre><p>æ³¨æ„ä¸€äº›å…³é”®ç‚¹:</p><ul><li><p>é»˜è®¤ä½¿ç”¨çš„ç¯å¢ƒ IDï¼ˆæ¯”å¦‚ï¼šdefault=â€œdevelopmentâ€ï¼‰ã€‚</p><p>ç¯å¢ƒï¼Œå°†SQLæ˜ å°„åˆ°å¤šä¸ªä¸åŒçš„æ•°æ®åº“ä¸Šï¼Œ**ä¸è¿‡è¦è®°ä½ï¼šå°½ç®¡å¯ä»¥é…ç½®å¤šä¸ªç¯å¢ƒï¼Œä½†æ¯ä¸ª SqlSessionFactory å®ä¾‹åªèƒ½é€‰æ‹©ä¸€ç§ç¯å¢ƒã€‚**å¿…é¡»æŒ‡å®šå…¶ä¸­ä¸€ä¸ªä¸ºé»˜è®¤è¿è¡Œç¯å¢ƒï¼ˆé€šè¿‡defaultæŒ‡å®šï¼‰</p><p>ç¯å¢ƒå¯ä»¥éšæ„å‘½åï¼Œä½†åŠ¡å¿…ä¿è¯é»˜è®¤çš„ç¯å¢ƒ ID è¦åŒ¹é…å…¶ä¸­ä¸€ä¸ªç¯å¢ƒ IDã€‚</p></li><li><p>äº‹åŠ¡ç®¡ç†å™¨çš„é…ç½®ï¼ˆæ¯”å¦‚ï¼štype=â€œJDBCâ€ï¼‰ã€‚</p><blockquote><p>åœ¨ MyBatis ä¸­æœ‰ä¸¤ç§ç±»å‹çš„äº‹åŠ¡ç®¡ç†å™¨ï¼ˆä¹Ÿå°±æ˜¯ type=â€œ[JDBC|MANAGED]â€ï¼‰ï¼š</p><ul><li>JDBC â€“ è¿™ä¸ªé…ç½®ç›´æ¥ä½¿ç”¨äº† JDBC çš„æäº¤å’Œå›æ»šåŠŸèƒ½</li><li>MANAGED â€“ è¿™ä¸ªé…ç½®å‡ ä¹æ²¡åšä»€ä¹ˆã€‚å®ƒä»ä¸æäº¤æˆ–å›æ»šä¸€ä¸ªè¿æ¥ï¼Œè€Œæ˜¯è®©å®¹å™¨æ¥ç®¡ç†äº‹åŠ¡çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼ˆæ¯”å¦‚ JEE åº”ç”¨æœåŠ¡å™¨çš„ä¸Šä¸‹æ–‡ï¼‰ã€‚ é»˜è®¤æƒ…å†µä¸‹å®ƒä¼šå…³é—­è¿æ¥ã€‚</li></ul><p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Spring + MyBatisï¼Œåˆ™æ²¡æœ‰å¿…è¦é…ç½®äº‹åŠ¡ç®¡ç†å™¨ï¼Œå› ä¸º Spring æ¨¡å—ä¼šä½¿ç”¨è‡ªå¸¦çš„ç®¡ç†å™¨æ¥è¦†ç›–å‰é¢çš„é…ç½®ã€‚</p></blockquote></li><li><p>æ•°æ®æºçš„é…ç½®ï¼ˆæ¯”å¦‚ï¼štype=â€œPOOLEDâ€ï¼‰ã€‚</p><p>dataSource å…ƒç´ ä½¿ç”¨æ ‡å‡†çš„ JDBC æ•°æ®æºæ¥å£æ¥é…ç½® JDBC è¿æ¥å¯¹è±¡çš„èµ„æºã€‚</p></li><li><p>æ•°æ®æºæ˜¯å¿…é¡»é…ç½®çš„ã€‚</p></li><li><p>æœ‰ä¸‰ç§å†…å»ºçš„æ•°æ®æºç±»å‹</p><pre class="language-none"><code class="language-none">type&#x3D;&quot;[UNPOOLED|POOLED|JNDI]&quot;ï¼‰</code></pre></li><li><p>unpooledï¼š</p><p>è¿™ä¸ªæ•°æ®æºçš„å®ç°ä¼šæ¯æ¬¡è¯·æ±‚æ—¶æ‰“å¼€å’Œå…³é—­è¿æ¥ã€‚è™½ç„¶æœ‰ç‚¹æ…¢ï¼Œä½†å¯¹é‚£äº›æ•°æ®åº“è¿æ¥å¯ç”¨æ€§è¦æ±‚ä¸é«˜çš„ç®€å•åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ æ€§èƒ½è¡¨ç°åˆ™ä¾èµ–äºä½¿ç”¨çš„æ•°æ®åº“ï¼Œå¯¹æŸäº›æ•°æ®åº“æ¥è¯´ï¼Œä½¿ç”¨è¿æ¥æ± å¹¶ä¸é‡è¦ï¼Œè¿™ä¸ªé…ç½®å°±å¾ˆé€‚åˆè¿™ç§æƒ…å½¢ã€‚</p></li><li><p><strong>pooled</strong>ï¼š</p><p>è¿™ç§æ•°æ®æºçš„å®ç°åˆ©ç”¨â€œæ± â€çš„æ¦‚å¿µå°† JDBC è¿æ¥å¯¹è±¡ç»„ç»‡èµ·æ¥ , é¿å…äº†åˆ›å»ºæ–°çš„è¿æ¥å®ä¾‹æ—¶æ‰€å¿…éœ€çš„åˆå§‹åŒ–å’Œè®¤è¯æ—¶é—´ã€‚ è¿™ç§å¤„ç†æ–¹å¼å¾ˆæµè¡Œï¼Œèƒ½ä½¿å¹¶å‘ Web åº”ç”¨å¿«é€Ÿå“åº”è¯·æ±‚ã€‚</p></li><li><p>jndiï¼š</p><p>è¿™ä¸ªæ•°æ®æºçš„å®ç°æ˜¯ä¸ºäº†èƒ½åœ¨å¦‚ Spring æˆ–åº”ç”¨æœåŠ¡å™¨è¿™ç±»å®¹å™¨ä¸­ä½¿ç”¨ï¼Œå®¹å™¨å¯ä»¥é›†ä¸­æˆ–åœ¨å¤–éƒ¨é…ç½®æ•°æ®æºï¼Œç„¶åæ”¾ç½®ä¸€ä¸ª JNDI ä¸Šä¸‹æ–‡çš„å¼•ç”¨ã€‚</p></li></ul><h3 id="æ˜ å°„å™¨ï¼ˆmappersï¼‰">æ˜ å°„å™¨ï¼ˆmappersï¼‰</h3><p>æˆ‘ä»¬éœ€è¦å‘Šè¯‰ MyBatis åˆ°å“ªé‡Œå»æ‰¾åˆ°è¿™äº›è¯­å¥ã€‚ åœ¨è‡ªåŠ¨æŸ¥æ‰¾èµ„æºæ–¹é¢ï¼ŒJava å¹¶æ²¡æœ‰æä¾›ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæ‰€ä»¥æœ€å¥½çš„åŠæ³•æ˜¯ç›´æ¥å‘Šè¯‰ MyBatis åˆ°å“ªé‡Œå»æ‰¾æ˜ å°„æ–‡ä»¶ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- ä½¿ç”¨ç›¸å¯¹äºç±»è·¯å¾„çš„èµ„æºå¼•ç”¨ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org/mybatis/builder/AuthorMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org/mybatis/builder/BlogMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org/mybatis/builder/PostMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- ä½¿ç”¨å®Œå…¨é™å®šèµ„æºå®šä½ç¬¦ï¼ˆURLï¼‰ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file:///var/mappers/AuthorMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file:///var/mappers/BlogMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file:///var/mappers/PostMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- ä½¿ç”¨æ˜ å°„å™¨æ¥å£å®ç°ç±»çš„å®Œå…¨é™å®šç±»å --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.mybatis.builder.AuthorMapper<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.mybatis.builder.BlogMapper<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.mybatis.builder.PostMapper<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- å°†åŒ…å†…çš„æ˜ å°„å™¨æ¥å£å…¨éƒ¨æ³¨å†Œä¸ºæ˜ å°„å™¨ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.mybatis.builder<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span></code></pre><p>âš ï¸æ³¨æ„: ä½¿ç”¨å°†åŒ…å†…çš„æ˜ å°„å™¨æ¥å£å…¨éƒ¨æ³¨å†Œä¸ºæ˜ å°„å™¨æ—¶, å¿…é¡»ä¿è¯æ¥å£å’Œå¯¹åº”çš„mapper.xmlæ–‡ä»¶åä¸€è‡´</p><h3 id="ç±»å‹åˆ«åï¼ˆtypeAliasesï¼‰">ç±»å‹åˆ«åï¼ˆtypeAliasesï¼‰</h3><p>ç±»å‹åˆ«åå¯ä¸º Java ç±»å‹è®¾ç½®ä¸€ä¸ªç¼©å†™åå­—ã€‚ å®ƒä»…ç”¨äº XML é…ç½®ï¼Œç”¨äºé™ä½å†—ä½™çš„å…¨é™å®šç±»åä¹¦å†™ã€‚ä¾‹å¦‚ï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>domain.blog.Author<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>domain.blog.Blog<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Comment<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>domain.blog.Comment<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>domain.blog.Post<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Section<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>domain.blog.Section<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Tag<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>domain.blog.Tag<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">></span></span></code></pre><p>å½“è¿™æ ·é…ç½®æ—¶ï¼Œ<code>Blog</code> å¯ä»¥ç”¨åœ¨ä»»ä½•ä½¿ç”¨ <code>domain.blog.Blog</code> çš„åœ°æ–¹ã€‚</p><p>ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªåŒ…åï¼ŒMyBatis ä¼šåœ¨åŒ…åä¸‹é¢æœç´¢éœ€è¦çš„ Java Beanï¼Œæ¯”å¦‚ï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>domain.blog<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">></span></span></code></pre><p>æ¯ä¸€ä¸ªåœ¨åŒ… <code>domain.blog</code> ä¸­çš„ Java Beanï¼Œ<strong>åœ¨æ²¡æœ‰æ³¨è§£çš„æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ Bean çš„é¦–å­—æ¯å°å†™çš„éé™å®šç±»åæ¥ä½œä¸ºå®ƒçš„åˆ«å</strong>ã€‚ æ¯”å¦‚ <code>domain.blog.Author</code> çš„åˆ«åä¸º <code>author</code>ï¼›è‹¥æœ‰æ³¨è§£ï¼Œåˆ™åˆ«åä¸ºå…¶æ³¨è§£å€¼.</p><h2 id="ä½œç”¨åŸŸï¼ˆScopeï¼‰å’Œç”Ÿå‘½å‘¨æœŸ">ä½œç”¨åŸŸï¼ˆScopeï¼‰å’Œç”Ÿå‘½å‘¨æœŸ</h2><p>ä½œç”¨åŸŸå’Œç”Ÿå‘½å‘¨æœŸç±»åˆ«æ˜¯è‡³å…³é‡è¦çš„ï¼Œå› ä¸ºé”™è¯¯çš„ä½¿ç”¨ä¼šå¯¼è‡´éå¸¸ä¸¥é‡çš„<strong>å¹¶å‘é—®é¢˜ã€‚</strong></p><h3 id="SqlSessionFactoryBuilder">SqlSessionFactoryBuilder</h3><p>è¿™ä¸ªç±»å¯ä»¥è¢«å®ä¾‹åŒ–ã€ä½¿ç”¨å’Œä¸¢å¼ƒï¼Œ<strong>ä¸€æ—¦åˆ›å»ºäº† SqlSessionFactoryï¼Œå°±ä¸å†éœ€è¦å®ƒäº†</strong>ã€‚å› æ­¤ SqlSessionFactoryBuilder å®ä¾‹çš„æœ€ä½³ä½œç”¨åŸŸæ˜¯æ–¹æ³•ä½œç”¨åŸŸï¼ˆä¹Ÿå°±æ˜¯<strong>å±€éƒ¨æ–¹æ³•å˜é‡</strong>ï¼‰ã€‚</p><h3 id="SqlSessionFactory">SqlSessionFactory</h3><p><strong>SqlSessionFactory ä¸€æ—¦è¢«åˆ›å»ºå°±åº”è¯¥åœ¨åº”ç”¨çš„è¿è¡ŒæœŸé—´ä¸€ç›´å­˜åœ¨</strong>ï¼Œ<strong>æ²¡æœ‰ä»»ä½•ç†ç”±ä¸¢å¼ƒå®ƒæˆ–é‡æ–°åˆ›å»ºå¦ä¸€ä¸ªå®ä¾‹</strong>ã€‚ ä½¿ç”¨ SqlSessionFactory çš„æœ€ä½³å®è·µæ˜¯åœ¨åº”ç”¨è¿è¡ŒæœŸé—´ä¸è¦é‡å¤åˆ›å»ºå¤šæ¬¡ï¼Œå¤šæ¬¡é‡å»º SqlSessionFactory è¢«è§†ä¸ºä¸€ç§ä»£ç â€œåä¹ æƒ¯â€ã€‚å› æ­¤ SqlSessionFactory çš„æœ€ä½³ä½œç”¨åŸŸæ˜¯<strong>åº”ç”¨ä½œç”¨åŸŸ(Application)</strong>ã€‚ æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥åšåˆ°ï¼Œæœ€ç®€å•çš„å°±æ˜¯ä½¿ç”¨<strong>å•ä¾‹æ¨¡å¼</strong>æˆ–è€…<strong>é™æ€å•ä¾‹æ¨¡å¼ã€‚</strong></p><blockquote><p>å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œç”¨äºç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹æ¥è®¿é—®è¯¥å®ä¾‹ã€‚å®ƒé€šå¸¸é€‚ç”¨äºéœ€è¦åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«çŠ¶æ€æˆ–èµ„æºçš„æƒ…å†µï¼Œä»¥åŠéœ€è¦å¯¹å®ä¾‹è¿›è¡Œä¸¥æ ¼æ§åˆ¶çš„æƒ…å†µã€‚</p><p>å®ç°å•ä¾‹æ¨¡å¼çš„å…³é”®æ˜¯å°†ç±»çš„æ„é€ å‡½æ•°ç§æœ‰åŒ–ï¼Œè¿™æ ·å°±æ— æ³•é€šè¿‡å¸¸è§„çš„æ–¹å¼åˆ›å»ºç±»çš„å®ä¾‹ã€‚ç„¶åï¼Œé€šè¿‡ä¸€ä¸ªé™æ€æ–¹æ³•æˆ–å±æ€§æ¥åˆ›å»ºå¹¶è¿”å›ç±»çš„å”¯ä¸€å®ä¾‹ã€‚æ¯æ¬¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œéƒ½ä¼šè¿”å›åŒä¸€ä¸ªå®ä¾‹ã€‚</p><p>é™æ€å•ä¾‹æ¨¡å¼æ˜¯å•ä¾‹æ¨¡å¼çš„ä¸€ç§å˜ä½“ï¼Œå®ƒä½¿ç”¨é™æ€å˜é‡æ¥ä¿å­˜å•ä¾‹å®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªé™æ€æ–¹æ³•æ¥è·å–è¯¥å®ä¾‹ã€‚åœ¨é™æ€å•ä¾‹æ¨¡å¼ä¸­ï¼Œå®ä¾‹çš„åˆ›å»ºå’Œè·å–æ–¹æ³•éƒ½æ˜¯é™æ€çš„ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ç±»åç›´æ¥è°ƒç”¨ï¼Œæ— éœ€å®ä¾‹åŒ–ç±»ã€‚</p><p><strong>å•ä¾‹æ¨¡å¼ç¤ºä¾‹ï¼š</strong></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token operator">></span>javaCopy code<span class="token operator">></span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span>   <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       <span class="token comment">// ç§æœ‰åŒ–æ„é€ å‡½æ•°</span>   <span class="token punctuation">&#125;</span>   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>           instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>       <span class="token keyword">return</span> instance<span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token comment">// å…¶ä»–æ–¹æ³•...</span><span class="token operator">></span><span class="token punctuation">&#125;</span></code></pre></blockquote><h3 id="SqlSession">SqlSession</h3><p><strong>æ¯ä¸ªçº¿ç¨‹éƒ½åº”è¯¥æœ‰å®ƒè‡ªå·±çš„ SqlSession å®ä¾‹</strong>ã€‚SqlSession çš„å®ä¾‹ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤æ˜¯ä¸èƒ½è¢«å…±äº«çš„ï¼Œæ‰€ä»¥<strong>å®ƒçš„æœ€ä½³çš„ä½œç”¨åŸŸæ˜¯è¯·æ±‚æˆ–æ–¹æ³•ä½œç”¨åŸŸ</strong>ã€‚</p><p>å¦‚æœè¯´ SqlSessionFactory ç›¸å½“äºæ•°æ®åº“è¿æ¥æ± ï¼Œé‚£ä¹ˆ SqlSession å°±ç›¸å½“äºä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼ˆConnection å¯¹è±¡ï¼‰ï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œé¢æ‰§è¡Œå¤šæ¡ SQLï¼Œç„¶åé€šè¿‡å®ƒçš„ commitã€rollback ç­‰æ–¹æ³•ï¼Œæäº¤æˆ–è€…å›æ»šäº‹åŠ¡ã€‚<strong>æ‰€ä»¥å®ƒåº”è¯¥å­˜æ´»åœ¨ä¸€ä¸ªä¸šåŠ¡è¯·æ±‚ä¸­ï¼Œå¤„ç†å®Œæ•´ä¸ªè¯·æ±‚åï¼Œåº”è¯¥å…³é—­è¿™æ¡è¿æ¥ï¼Œè®©å®ƒå½’è¿˜ç»™ SqlSessionFactoryï¼Œå¦åˆ™æ•°æ®åº“èµ„æºå°±å¾ˆå¿«è¢«è€—è´¹ç²¾å…‰ï¼Œç³»ç»Ÿå°±ä¼šç˜«ç—ª</strong>ï¼Œæ‰€ä»¥ç”¨ tryâ€¦catchâ€¦finallyâ€¦ è¯­å¥æ¥ä¿è¯å…¶æ­£ç¡®å…³é—­ã€‚</p><p>æ¯”å¦‚ Servlet æ¡†æ¶ä¸­çš„ HttpSession, æ¯æ¬¡æ”¶åˆ° HTTP è¯·æ±‚ï¼Œå°±å¯ä»¥æ‰“å¼€ä¸€ä¸ª SqlSessionï¼Œè¿”å›ä¸€ä¸ªå“åº”åï¼Œå°±å…³é—­å®ƒã€‚</p><h3 id="æ˜ å°„å™¨-Mapper-å®ä¾‹">æ˜ å°„å™¨(Mapper)å®ä¾‹</h3><p>æ˜ å°„å™¨å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸä¸ SqlSession ç›¸å…³è”ï¼Œä½œç”¨åŸŸæ˜¯æ¯ä¸ª SqlSessionã€‚å®ƒä»¬åœ¨æ¯ä¸ª SqlSession ä¸­åˆ›å»ºï¼Œå¹¶åœ¨ SqlSession å…³é—­æ—¶é”€æ¯ã€‚å¯ä»¥é€šè¿‡ä¾èµ–æ³¨å…¥ç­‰æ–¹å¼å®ç°æ˜ å°„å™¨å®ä¾‹åœ¨ä¸åŒ SqlSession ä¸­çš„é‡ç”¨ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æ˜ å°„å™¨å®ä¾‹çš„æ­£ç¡®æ€§å’Œèµ„æºçš„æœ‰æ•ˆåˆ©ç”¨ã€‚</p><h2 id="ResultMap">ResultMap</h2><h4 id="é—®é¢˜å¼•å‡º">é—®é¢˜å¼•å‡º</h4><p>ç±»å±æ€§åpropertyå’Œæ•°æ®åº“å­—æ®µåcolumnåä¸ä¸€è‡´çš„é—®é¢˜:</p><p>å¦‚æœæˆ‘ä»¬æ›´æ”¹å®ä½“ç±»çš„å±æ€§åæŠŠproNameæ”¹ä¸ºBookName, å†æ¬¡æ‰§è¡ŒæŸ¥è¯¢æˆ‘ä»¬ä¼šå¾—åˆ°å€¼ä¸ºnull.</p><p>è¿™æ˜¯å› ä¸ºmybatisä¼šæ ¹æ®è¿™äº›æŸ¥è¯¢çš„åˆ—å(ä¼šå°†åˆ—åè½¬åŒ–ä¸ºå°å†™,æ•°æ®åº“ä¸åŒºåˆ†å¤§å°å†™) , å»å¯¹åº”çš„å®ä½“ç±»ä¸­æŸ¥æ‰¾ç›¸åº”åˆ—åçš„setæ–¹æ³•è®¾å€¼ , ç”±äºæ‰¾ä¸åˆ°setProName() , æ‰€ä»¥è¿”å›null .</p><p><img src="image-20230527214201597.png" alt="image-20230527214201597" loading="lazy"></p><p>ä¸‹é¢ä»‹ç»ResultMapæ¥è§£å†³è¿™ä¸ªé—®é¢˜:</p><h4 id="è§£å†³">è§£å†³</h4><p>**<code>resultMap</code> å…ƒç´ æ˜¯ MyBatis ä¸­æœ€é‡è¦æœ€å¼ºå¤§çš„å…ƒç´ ã€‚å®ƒå¯ä»¥è®©ä½ ä» 90% çš„ JDBC <code>ResultSets</code> æ•°æ®æå–ä»£ç ä¸­è§£æ”¾å‡ºæ¥ã€‚**å®é™…ä¸Šï¼Œåœ¨ä¸ºä¸€äº›æ¯”å¦‚è¿æ¥çš„å¤æ‚è¯­å¥ç¼–å†™æ˜ å°„ä»£ç çš„æ—¶å€™ï¼Œä¸€ä»½ <code>resultMap</code> èƒ½å¤Ÿä»£æ›¿å®ç°åŒç­‰åŠŸèƒ½çš„é•¿è¾¾æ•°åƒè¡Œçš„ä»£ç .</p><p>ResultMap çš„è®¾è®¡æ€æƒ³æ˜¯ï¼Œå¯¹äºç®€å•çš„è¯­å¥æ ¹æœ¬ä¸éœ€è¦é…ç½®æ˜¾å¼çš„ç»“æœæ˜ å°„ï¼Œè€Œå¯¹äºå¤æ‚ä¸€ç‚¹çš„è¯­å¥åªéœ€è¦æè¿°å®ƒä»¬çš„å…³ç³»å°±è¡Œäº†ã€‚</p><p>ä½ å·²ç»è§è¿‡ç®€å•æ˜ å°„è¯­å¥çš„ç¤ºä¾‹äº†ï¼Œä½†å¹¶æ²¡æœ‰æ˜¾å¼æŒ‡å®š <code>resultMap</code>ã€‚æ¯”å¦‚ï¼š</p><pre class="language-none"><code class="language-none">&lt;select id&#x3D;&quot;selectUserById&quot; resultType&#x3D;&quot;map&quot;&gt;select id , name , pwd  from user  where id &#x3D; #&#123;id&#125;&lt;&#x2F;select&gt;</code></pre><p>ä¸Šè¿°è¯­å¥åªæ˜¯ç®€å•åœ°å°†æ‰€æœ‰çš„åˆ—æ˜ å°„åˆ° <code>HashMap</code> çš„é”®ä¸Šï¼Œè¿™ç”± <code>resultType</code> å±æ€§æŒ‡å®šã€‚è™½ç„¶åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½å¤Ÿç”¨ï¼Œä½†æ˜¯ HashMap ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ¨¡å‹ã€‚ä½ çš„ç¨‹åºæ›´å¯èƒ½ä¼šä½¿ç”¨ JavaBean æˆ– POJOï¼ˆPlain Old Java Objectsï¼Œæ™®é€šè€å¼ Java å¯¹è±¡ï¼‰ä½œä¸ºæ¨¡å‹ã€‚</p><p><code>ResultMap</code> æœ€ä¼˜ç§€çš„åœ°æ–¹åœ¨äºï¼Œè™½ç„¶ä½ å·²ç»å¯¹å®ƒç›¸å½“äº†è§£äº†ï¼Œä½†æ˜¯æ ¹æœ¬å°±ä¸éœ€è¦æ˜¾å¼åœ°ç”¨åˆ°ä»–ä»¬ã€‚çœ‹çœ‹ä¸‹é¢è¿™ä¸ª JavaBeanï¼š</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>  <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>  <span class="token keyword">private</span> <span class="token class-name">String</span> hashedPassword<span class="token punctuation">;</span><span class="token comment">/** setter and getter...*/</span><span class="token punctuation">&#125;</span></code></pre><p>åŸºäº JavaBean çš„è§„èŒƒï¼Œä¸Šé¢è¿™ä¸ªç±»æœ‰ 3 ä¸ªå±æ€§ï¼šidï¼Œusername å’Œ hashedPasswordã€‚<strong>è¿™äº›å±æ€§ä¼šå¯¹åº”åˆ° select è¯­å¥ä¸­çš„åˆ—å</strong>ã€‚</p><p>è¿™æ ·çš„ä¸€ä¸ª JavaBean å¯ä»¥è¢«æ˜ å°„åˆ° <code>ResultSet</code>ï¼Œå°±åƒæ˜ å°„åˆ° <code>HashMap</code> ä¸€æ ·ç®€å•ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUsers<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.someapp.model.User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  select id, username, hashedPassword  from some_table  where id = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>ç±»å‹åˆ«åæ˜¯ä½ çš„å¥½å¸®æ‰‹ã€‚ä½¿ç”¨å®ƒä»¬ï¼Œä½ å°±å¯ä»¥ä¸ç”¨è¾“å…¥ç±»çš„å…¨é™å®šåäº†ã€‚æ¯”å¦‚ï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- mybatis-config.xml ä¸­ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.someapp.model.User<span class="token punctuation">"</span></span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token comment">&lt;!-- SQL æ˜ å°„ XML ä¸­ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUsers<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  select id, username, hashedPassword  from some_table  where id = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>åœ¨è¿™äº›æƒ…å†µä¸‹ï¼ŒMyBatis ä¼šåœ¨å¹•åè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª <code>ResultMap</code>ï¼Œå†æ ¹æ®å±æ€§åæ¥æ˜ å°„åˆ—åˆ° JavaBean çš„å±æ€§ä¸Šã€‚å¦‚æœåˆ—åå’Œå±æ€§åä¸èƒ½åŒ¹é…ä¸Šï¼Œå¯ä»¥åœ¨ SELECT è¯­å¥ä¸­è®¾ç½®åˆ—åˆ«åï¼ˆè¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ SQL ç‰¹æ€§ï¼‰æ¥å®ŒæˆåŒ¹é…ã€‚æ¯”å¦‚ï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUsers<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  select    user_id             as "id",    user_name           as "userName",    hashed_password     as "hashedPassword"  from some_table  where id = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>åœ¨å­¦ä¹ äº†ä¸Šé¢çš„çŸ¥è¯†åï¼Œä½ ä¼šå‘ç°ä¸Šé¢çš„ä¾‹å­æ²¡æœ‰ä¸€ä¸ªéœ€è¦æ˜¾å¼é…ç½® <code>ResultMap</code>ï¼Œè¿™å°±æ˜¯ <code>ResultMap</code> çš„ä¼˜ç§€ä¹‹å¤„â€”â€”ä½ å®Œå…¨å¯ä»¥ä¸ç”¨æ˜¾å¼åœ°é…ç½®å®ƒä»¬ã€‚ è™½ç„¶ä¸Šé¢çš„ä¾‹å­ä¸ç”¨æ˜¾å¼é…ç½® <code>ResultMap</code>ã€‚ ä½†ä¸ºäº†è®²è§£ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚æœåœ¨åˆšåˆšçš„ç¤ºä¾‹ä¸­ï¼Œæ˜¾å¼ä½¿ç”¨å¤–éƒ¨çš„ <code>resultMap</code> ä¼šæ€æ ·ï¼Œè¿™ä¹Ÿæ˜¯è§£å†³åˆ—åä¸åŒ¹é…çš„å¦å¤–ä¸€ç§æ–¹å¼ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hashed_password<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p>ç„¶ååœ¨å¼•ç”¨å®ƒçš„è¯­å¥ä¸­è®¾ç½® <code>resultMap</code> å±æ€§å°±è¡Œäº†ï¼ˆæ³¨æ„æˆ‘ä»¬å»æ‰äº† <code>resultType</code> å±æ€§ï¼‰ã€‚æ¯”å¦‚:</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUsers<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userResultMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  select user_id, user_name, hashed_password  from some_table  where id = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p><strong>å¦‚æœè¿™ä¸ªä¸–ç•Œæ€»æ˜¯è¿™ä¹ˆç®€å•å°±å¥½äº†ã€‚</strong></p><h2 id="æ—¥å¿—å·¥å‚">æ—¥å¿—å·¥å‚</h2><p>æ—¥å¿—è®°å½•æ˜¯ä»»ä½•ä¼˜ç§€è½¯ä»¶å¼€å‘è¿‡ç¨‹çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚é€šè¿‡æ—¥å¿—è®°å½•ï¼Œæ‚¨å¯ä»¥æ£€æµ‹å’Œä¿®å¤é—®é¢˜ã€äº†è§£ç”¨æˆ·çš„è¡Œä¸º. å¦‚æœä¸€ä¸ª æ•°æ®åº“ç›¸å…³çš„æ“ä½œå‡ºç°äº†é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¾“å‡ºçš„SQLè¯­å¥å¿«é€Ÿæ’æŸ¥é—®é¢˜ã€‚</p><p>å¯¹äºä»¥å¾€çš„å¼€å‘è¿‡ç¨‹ï¼Œæˆ‘ä»¬ä¼šç»å¸¸ä½¿ç”¨åˆ°debugæ¨¡å¼æ¥è°ƒèŠ‚ï¼Œè·Ÿè¸ªæˆ‘ä»¬çš„ä»£ç æ‰§è¡Œè¿‡ç¨‹ã€‚ä½†æ˜¯ç°åœ¨ä½¿ç”¨Mybatisæ˜¯åŸºäºæ¥å£ï¼Œé…ç½®æ–‡ä»¶çš„æºä»£ç æ‰§è¡Œè¿‡ç¨‹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»é€‰æ‹©æ—¥å¿—å·¥å…·æ¥ä½œä¸ºæˆ‘ä»¬å¼€å‘ï¼Œè°ƒèŠ‚ç¨‹åºçš„å·¥å…·ã€‚</p><p>Mybatiså†…ç½®çš„æ—¥å¿—å·¥å‚æä¾›æ—¥å¿—åŠŸèƒ½ï¼Œå…·ä½“çš„æ—¥å¿—å®ç°æœ‰ä»¥ä¸‹å‡ ç§å·¥å…·ï¼š</p><ul><li>SLF4J</li><li>Apache Commons Logging</li><li><strong>Log4j 2</strong></li><li>Log4j (3.5.9 èµ·åºŸå¼ƒï¼‰</li><li>JDK logging</li><li>STDOUT_LOGGING</li><li>NO_LOGGING</li></ul><p>å…·ä½“é€‰æ‹©å“ªä¸ªæ—¥å¿—å®ç°å·¥å…·ç”±MyBatisçš„å†…ç½®æ—¥å¿—å·¥å‚ç¡®å®šã€‚å®ƒä¼šä½¿ç”¨æœ€å…ˆæ‰¾åˆ°çš„ï¼ˆæŒ‰ä¸Šæ–‡åˆ—ä¸¾çš„é¡ºåºæŸ¥æ‰¾ï¼‰ã€‚å¦‚æœä¸€ä¸ªéƒ½æœªæ‰¾åˆ°ï¼Œæ—¥å¿—åŠŸèƒ½å°±ä¼šè¢«ç¦ç”¨ã€‚</p><h3 id="æ ‡å‡†æ—¥å¿—å®ç°-STDOUT-LOGGING">**æ ‡å‡†æ—¥å¿—å®ç° **STDOUT_LOGGING</h3><p>æŒ‡å®š MyBatis åº”è¯¥ä½¿ç”¨å“ªä¸ªæ—¥å¿—è®°å½•å®ç°ã€‚å¦‚æœæ­¤è®¾ç½®ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨å‘ç°æ—¥å¿—è®°å½•å®ç°ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logImpl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>STDOUT_LOGGING<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">></span></span></code></pre><p>æµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°æœ‰å¤§é‡çš„è¾“å‡ºï¼æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº›è¾“å‡ºæ¥åˆ¤æ–­ç¨‹åºåˆ°åº•å“ªé‡Œå‡ºäº†Bug</p><h3 id="Log4j2"><strong>Log4j2</strong></h3><p><strong>ç®€ä»‹ï¼š</strong></p><ul><li><a href="https://www.scalyr.com/blog/get-started-quickly-java-logging/">Log4j2 æ˜¯Java</a>è¯­è¨€çš„æ—¥å¿—è®°å½•æ¡†æ¶ï¼Œç”± Apache åŸºé‡‘ä¼šç»´æŠ¤ã€‚Log4j2 æ˜¯å¯¹å…¶å‰èº« Log4j çš„æ”¹è¿›ã€‚å®ƒçš„ä¸»è¦å¥½å¤„æ˜¯ï¼š<ul><li>APIç‹¬ç«‹äºå®ç°</li><li>æ›´å¥½åœ°æ”¯æŒå¹¶å‘</li><li>é€šè¿‡æ„å»ºè‡ªå®šä¹‰ç»„ä»¶è½»æ¾æ‰©å±•</li></ul></li></ul><p><strong>ä½¿ç”¨æ­¥éª¤ï¼š</strong></p><p>1ã€å¯¼å…¥log4j2çš„åŒ…</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--      log4j-core- æ ¸å¿ƒLog4jå®ç°ç±»ã€‚--></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>log4j-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.20.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--      log4j-api- æä¾›å®ç°è€…åˆ›å»ºæ—¥å¿—å®ç°æ‰€éœ€çš„é€‚é…å™¨ç»„ä»¶ã€‚--></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>log4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.20.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>2ã€é…ç½®æ–‡ä»¶ç¼–å†™</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Configuration</span> <span class="token attr-name">status</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Appenders</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Console</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ConsoleAppender<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>SYSTEM_OUT<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%d&#123;HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Console</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>File</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>FileAppender<span class="token punctuation">"</span></span> <span class="token attr-name">fileName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>application-$&#123;date:yyyyMMdd&#125;.log<span class="token punctuation">"</span></span> <span class="token attr-name">immediateFlush</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">append</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%d&#123;yyy-MM-dd HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>File</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Appenders</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Loggers</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>debug<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ConsoleAppender<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AppenderRef</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>FileAppender<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Root</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Loggers</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Configuration</span><span class="token punctuation">></span></span></code></pre><p>ä»”ç»†çœ‹çœ‹æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ã€‚å®ƒé¦–å…ˆå®šä¹‰ä¸¤ä¸ª appenderï¼Œä¸€ä¸ªç§°ä¸ºâ€œFileAppenderâ€ï¼Œå¦ä¸€ä¸ªç§°ä¸ºâ€œConsoleAppenderâ€appender æ˜¯æœ‰æ•ˆåœ°å°†æ—¥å¿—æ¶ˆæ¯å†™å…¥å…¶ç›®çš„åœ°çš„ç»„ä»¶ã€‚</p><p>ç¬¬ä¸€ä¸ª appender å°† stdout å®šä¹‰ä¸ºå…¶ç›®æ ‡ï¼Œè€Œç¬¬äºŒä¸ª appender å®šä¹‰æ–‡ä»¶åçš„æ¨¡å¼ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œç¬¬ä¸€ä¸ª appender è®°å½•åˆ°æ ‡å‡†è¾“å‡ºï¼Œè€Œç¬¬äºŒä¸ª appender è®°å½•åˆ°ä¸€ä¸ªæ–‡ä»¶ã€‚</p><p>ç„¶åè¯¥æ–‡ä»¶ç»§ç»­å®šä¹‰è®°å½•å™¨ã€‚è®°å½•å™¨è´Ÿè´£å®é™…è®°å½•ä¼ é€’ç»™å®ƒçš„æ¶ˆæ¯ã€‚æ¯ä¸ªè®°å½•å™¨éƒ½å¯ä»¥å¼•ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªé™„åŠ ç¨‹åºï¼Œè¿™æ­£æ˜¯è¿™é‡Œå‘ç”Ÿçš„äº‹æƒ…ã€‚è®°å½•å™¨å¼•ç”¨äº†ä¸¤ä¸ªé™„åŠ ç¨‹åºï¼Œå› æ­¤å½“å®ƒè¢«è°ƒç”¨æ—¶ï¼Œå®ƒå°†åŒæ—¶è®°å½•åˆ°æ ‡å‡†è¾“å‡ºå’Œæ—¥å¿—æ–‡ä»¶ä¸­ã€‚</p><p>3ã€settingè®¾ç½®æ—¥å¿—å®ç°</p><pre class="language-none"><code class="language-none">&lt;settings&gt;   &lt;setting name&#x3D;&quot;logImpl&quot; value&#x3D;&quot;LOG4J2&quot;&#x2F;&gt;&lt;&#x2F;settings&gt;</code></pre><p>4ã€åœ¨ç¨‹åºä¸­ä½¿ç”¨Log4jè¿›è¡Œè¾“å‡ºï¼</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span></span><span class="token class-name">LogManager</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LogManager</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">App</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token string">"Hello World!"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span> <span class="token string">"åˆæµªè´¹äº†ä¸€æ—©ä¸Šï¼Œ éƒ½åœ¨å¼„è¿™ä¸ªç ´log4j fuck!"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"We've just greeted the user!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"We've just greeted the user!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"We've just greeted the user!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"We've just greeted the user!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"We've just greeted the user!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">fatal</span><span class="token punctuation">(</span><span class="token string">"We've just greeted the user!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>5ã€æµ‹è¯•ï¼Œçœ‹æ§åˆ¶å°è¾“å‡ºï¼</p><ul><li><p>ä½¿ç”¨Log4j 2è¾“å‡ºæ—¥å¿—</p><p><img src="image-20230530173545142.png" alt="image-20230530173545142" loading="lazy"></p></li><li><p>å¯ä»¥çœ‹åˆ°è¿˜ç”Ÿæˆäº†ä¸€ä¸ªæ—¥å¿—çš„æ–‡ä»¶ ã€éœ€è¦ä¿®æ”¹fileçš„æ—¥å¿—çº§åˆ«ã€‘</p></li></ul><p><img src="image-20230530173652533.png" alt="image-20230530173652533" loading="lazy"></p><p>Ref:</p><ul><li><a href="https://www.docs4dev.com/docs/zh/log4j2/2.x/all/manual-webapp.html#Servlet-2.5">åœ¨ Web åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ Log4j 2</a></li><li><a href="https://www.dataset.com/blog/maven-log4j2-project/">Log4j2 in a Maven Project: How to Setup, Configure, and Use</a></li></ul><h2 id="å¤šå¯¹ä¸€å¤„ç†ä¹‹é«˜çº§ç»“æœæ˜ å°„">å¤šå¯¹ä¸€å¤„ç†ä¹‹é«˜çº§ç»“æœæ˜ å°„</h2><p>MyBatis åˆ›å»ºæ—¶çš„ä¸€ä¸ªæ€æƒ³æ˜¯ï¼š</p><p>æ•°æ®åº“ä¸å¯èƒ½æ°¸è¿œæ˜¯ä½ æ‰€æƒ³æˆ–æ‰€éœ€çš„é‚£ä¸ªæ ·å­ã€‚ æˆ‘ä»¬å¸Œæœ›æ¯ä¸ªæ•°æ®åº“éƒ½å…·å¤‡è‰¯å¥½çš„ç¬¬ä¸‰èŒƒå¼æˆ– BCNF èŒƒå¼ï¼Œå¯æƒœå®ƒä»¬å¹¶ä¸éƒ½æ˜¯é‚£æ ·ã€‚ å¦‚æœèƒ½æœ‰ä¸€ç§æ•°æ®åº“æ˜ å°„æ¨¡å¼ï¼Œå®Œç¾é€‚é…æ‰€æœ‰çš„åº”ç”¨ç¨‹åºï¼Œé‚£å°±å¤ªå¥½äº†ï¼Œä½†å¯æƒœä¹Ÿæ²¡æœ‰ã€‚ è€Œ ResultMap å°±æ˜¯ MyBatis å¯¹è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆã€‚</p><blockquote><ol><li><p>ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰ï¼šè¡¨ä¸­çš„æ¯ä¸ªå±æ€§éƒ½æ˜¯åŸå­çš„ï¼Œå³ä¸å¯å†åˆ†ã€‚æ¯ä¸ªå±æ€§åªåŒ…å«å•ä¸ªå€¼ï¼Œä¸åŒ…å«å¤šä¸ªå€¼æˆ–é‡å¤çš„ç»„åˆå€¼ã€‚</p></li><li><p>ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ï¼šè¡¨ä¸­çš„éä¸»é”®å±æ€§å¿…é¡»å®Œå…¨ä¾èµ–äºä¸»é”®ã€‚æ¢å¥è¯è¯´ï¼Œè¡¨ä¸­çš„æ¯ä¸ªéä¸»é”®å±æ€§å¿…é¡»å®Œå…¨ä¾èµ–äºè¡¨ä¸­çš„ä¸»é”®ï¼Œè€Œä¸æ˜¯éƒ¨åˆ†ä¾èµ–äºä¸»é”®çš„æŸä¸ªå­é›†ã€‚</p></li><li><p>ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ï¼šè¡¨ä¸­çš„éä¸»é”®å±æ€§ä¹‹é—´ä¸åº”è¯¥å­˜åœ¨ä¼ é€’ä¾èµ–å…³ç³»ã€‚æ¢å¥è¯è¯´ï¼Œè¡¨ä¸­çš„æ¯ä¸ªéä¸»é”®å±æ€§åº”è¯¥ç›´æ¥ä¾èµ–äºä¸»é”®ï¼Œè€Œä¸æ˜¯ä¾èµ–äºå…¶ä»–éä¸»é”®å±æ€§ã€‚</p></li></ol><p>é€šè¿‡å°†è¡¨è®¾è®¡ä¸ºç¬¬ä¸‰èŒƒå¼ï¼Œå¯ä»¥é¿å…æ•°æ®å†—ä½™å’Œä¸ä¸€è‡´æ€§ï¼Œæé«˜æ•°æ®å­˜å‚¨çš„æ•ˆç‡å’Œä¸€è‡´æ€§ã€‚è¿™æ ·çš„è®¾è®¡æœ‰åŠ©äºå‡å°‘æ•°æ®ä¿®æ”¹çš„å¤æ‚æ€§ï¼Œæé«˜æ•°æ®æŸ¥è¯¢å’Œæ›´æ–°çš„æ€§èƒ½ï¼Œå¹¶æ”¯æŒæ›´å¥½çš„æ•°æ®ä¸€è‡´æ€§ç»´æŠ¤ã€‚</p><p>ç„¶è€Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸¥æ ¼éµå¾ªç¬¬ä¸‰èŒƒå¼å¹¶ä¸ä¸€å®šæ˜¯æœ€ä½³é€‰æ‹©ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸ºäº†æ»¡è¶³ç‰¹å®šçš„æ€§èƒ½éœ€æ±‚æˆ–ç®€åŒ–å¤æ‚æŸ¥è¯¢ï¼Œå¯èƒ½éœ€è¦åœ¨è®¾è®¡ä¸­å¼•å…¥ä¸€äº›å†—ä½™æ•°æ®æˆ–éèŒƒå¼åŒ–çš„ç»“æ„ã€‚åœ¨æ•°æ®åº“è®¾è®¡è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚å’Œæ€§èƒ½è€ƒè™‘ï¼Œæƒè¡¡èŒƒå¼åŒ–å’ŒéèŒƒå¼åŒ–çš„è®¾è®¡é€‰æ‹©ã€‚</p></blockquote><p>å…ˆä»ç®€å•çš„å¼€å§‹, è€å¸ˆå’Œå­¦ç”Ÿçš„å…³ç³», å¤šä¸ªå­¦ç”Ÿå­˜åœ¨åŒå±äºä¸€ä¸ªè€å¸ˆ, è¿™å°±æ˜¯å¤šå¯¹ä¸€å…³ç³», æˆ‘ä»¬è®¾è®¡ä»¥ä¸‹Java Bean</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> tId<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Teacher</span> teacher<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Teacher</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¦‚æœæˆ‘ä»¬éœ€è¦æŸ¥è¯¢æ‰€æœ‰çš„å­¦ç”Ÿä¿¡æ¯ä»¥åŠå­¦ç”Ÿå¯¹åº”çš„è€å¸ˆ, æˆ‘ä»¬ç¼–å†™SQL</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span>  s<span class="token punctuation">.</span>id<span class="token punctuation">,</span> s<span class="token punctuation">.</span>name <span class="token keyword">as</span> sName<span class="token punctuation">,</span> tid<span class="token punctuation">,</span>t<span class="token punctuation">.</span>name <span class="token keyword">as</span> tName <span class="token keyword">from</span> students s<span class="token punctuation">,</span> teachers t <span class="token keyword">where</span> s<span class="token punctuation">.</span>tid <span class="token operator">=</span> t<span class="token punctuation">.</span>id<span class="token punctuation">;</span></code></pre><p>æ‰§è¡ŒSQLå¯ä»¥å¾—åˆ°</p><p><img src="image-20230531151419612.png" alt="image-20230531151419612" loading="lazy"></p><p>ä½†æ˜¯è¿™æ ·æ˜¯å¾—ä¸åˆ°Teacherå¯¹è±¡çš„å€¼çš„ï¼Œåªèƒ½å¾—åˆ°nullï¼Œæ‰€ä»¥æˆ‘éœ€è¦ç¼–å†™ResutlMap</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span>resultMap id<span class="token operator">=</span><span class="token string">"ST"</span> type<span class="token operator">=</span><span class="token string">"org.example.Bean.Student"</span><span class="token operator">></span>    <span class="token operator">&lt;</span>id property<span class="token operator">=</span><span class="token string">"id"</span> column<span class="token operator">=</span><span class="token string">"id"</span><span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"name"</span> column<span class="token operator">=</span><span class="token string">"sName"</span><span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span>association property<span class="token operator">=</span><span class="token string">"teacher"</span> javaType<span class="token operator">=</span><span class="token string">"org.example.Bean.Teacher"</span><span class="token operator">></span>        <span class="token operator">&lt;</span>id property<span class="token operator">=</span><span class="token string">"id"</span> column<span class="token operator">=</span><span class="token string">"tid"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>id<span class="token operator">></span>        <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"name"</span> column<span class="token operator">=</span><span class="token string">"tName"</span><span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>association<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>resultMap</code></pre><p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ª MyBatis çš„ç»“æœæ˜ å°„é…ç½®ï¼ˆresultMapï¼‰ï¼Œç”¨äºå°†æŸ¥è¯¢ç»“æœæ˜ å°„åˆ° Java å¯¹è±¡ã€‚æ ¹æ®ç»™å®šçš„é…ç½®ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªåä¸º â€œSTâ€ çš„ç»“æœæ˜ å°„ï¼Œå°†æŸ¥è¯¢ç»“æœæ˜ å°„åˆ° org.example.Bean.Student ç±»å‹çš„å¯¹è±¡ã€‚</p><p>è¯¥ resultMap åŒ…å«ä¸‰ä¸ªæ˜ å°„é¡¹ï¼š</p><ol><li><p>id æ˜ å°„ï¼šå°†æŸ¥è¯¢ç»“æœçš„ â€œidâ€ åˆ—æ˜ å°„åˆ° Student å¯¹è±¡çš„ â€œidâ€ å±æ€§ã€‚<strong>æ ‡è®°å‡ºä½œä¸º ID çš„ç»“æœå¯ä»¥å¸®åŠ©æé«˜æ•´ä½“æ€§èƒ½</strong></p></li><li><p>name æ˜ å°„ï¼šå°†æŸ¥è¯¢ç»“æœçš„ â€œsNameâ€ åˆ—æ˜ å°„åˆ° Student å¯¹è±¡çš„ â€œnameâ€ å±æ€§ã€‚</p></li><li><p>associationï¼ˆå…³è”ï¼‰æ˜ å°„ï¼šå°†æŸ¥è¯¢ç»“æœä¸­çš„éƒ¨åˆ†å­—æ®µæ˜ å°„åˆ°å…³è”çš„ Teacher å¯¹è±¡ã€‚</p><ul><li><p>id æ˜ å°„ï¼šå°†æŸ¥è¯¢ç»“æœçš„ â€œtidâ€ åˆ—æ˜ å°„åˆ° Teacher å¯¹è±¡çš„ â€œidâ€ å±æ€§ã€‚</p></li><li><p>name æ˜ å°„ï¼šå°†æŸ¥è¯¢ç»“æœçš„ â€œtNameâ€ åˆ—æ˜ å°„åˆ° Teacher å¯¹è±¡çš„ â€œnameâ€ å±æ€§ã€‚</p></li></ul></li></ol><p>é€šè¿‡ä½¿ç”¨ resultMapï¼ŒMyBatis å¯ä»¥æ ¹æ®æŸ¥è¯¢ç»“æœè‡ªåŠ¨å°†æ•°æ®å¡«å……åˆ° Student å¯¹è±¡ä¸­ï¼Œå¹¶å¯é€šè¿‡è®¿é—® Student å¯¹è±¡çš„å±æ€§æ¥è·å–æŸ¥è¯¢ç»“æœçš„å€¼ã€‚æ­¤å¤–ï¼Œå…³è”æ˜ å°„å…è®¸å°†å…³è”è¡¨çš„éƒ¨åˆ†å­—æ®µæ˜ å°„åˆ°å…³è”å¯¹è±¡ä¸­ï¼Œä»¥ä¾¿åœ¨æŸ¥è¯¢ç»“æœä¸­åŒ…å«å…³è”å¯¹è±¡çš„ç›¸å…³ä¿¡æ¯ã€‚</p><ul><li><p>ç¼–å†™æµ‹è¯•ç±»</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapperTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">MybatisUtil</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">StudentMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">StudentMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> students <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">getStudents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Student</span> student <span class="token operator">:</span> students<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>student<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre></li></ul><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»™Teacherå¯¹è±¡èµ‹å€¼äº†</p><p><img src="image-20230531185420784.png" alt="image-20230531185420784" loading="lazy"></p><p>å®é™…é¡¹ç›®ä¸­æˆ‘ä»¬å¯èƒ½å¯¹å¤šä¸ªè¡¨è¿›è¡Œè¿è¡¨æŸ¥è¯¢ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬å¦‚ä½•æ˜ å°„ä¸‹é¢è¿™ä¸ªè¯­å¥ï¼Ÿ</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- éå¸¸å¤æ‚çš„è¯­å¥ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectBlogDetails<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>detailedBlogResultMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  select       B.id as blog_id,       B.title as blog_title,       B.author_id as blog_author_id,       A.id as author_id,       A.username as author_username,       A.password as author_password,       A.email as author_email,       A.bio as author_bio,       A.favourite_section as author_favourite_section,       P.id as post_id,       P.blog_id as post_blog_id,       P.author_id as post_author_id,       P.created_on as post_created_on,       P.section as post_section,       P.subject as post_subject,       P.draft as draft,       P.body as post_body,       C.id as comment_id,       C.post_id as comment_post_id,       C.name as comment_name,       C.comment as comment_text,       T.id as tag_id,       T.name as tag_name  from Blog B       left outer join Author A on B.author_id = A.id       left outer join Post P on B.id = P.blog_id       left outer join Comment C on P.id = C.post_id       left outer join Post_Tag PT on PT.post_id = P.id       left outer join Tag T on PT.tag_id = T.id  where B.id = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>ä½ å¯èƒ½æƒ³æŠŠå®ƒæ˜ å°„åˆ°ä¸€ä¸ªæ™ºèƒ½çš„å¯¹è±¡æ¨¡å‹ï¼Œè¿™ä¸ªå¯¹è±¡è¡¨ç¤ºäº†ä¸€ç¯‡åšå®¢ï¼Œå®ƒç”±æŸä½ä½œè€…æ‰€å†™ï¼Œæœ‰å¾ˆå¤šçš„åšæ–‡ï¼Œæ¯ç¯‡åšæ–‡æœ‰é›¶æˆ–å¤šæ¡çš„è¯„è®ºå’Œæ ‡ç­¾ã€‚ æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ªå®Œæ•´çš„ä¾‹å­ï¼Œå®ƒæ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„ç»“æœæ˜ å°„ï¼ˆå‡è®¾ä½œè€…ï¼Œåšå®¢ï¼Œåšæ–‡ï¼Œè¯„è®ºå’Œæ ‡ç­¾éƒ½æ˜¯ç±»å‹åˆ«åï¼‰ã€‚ ä¸ç”¨ç´§å¼ ï¼Œæˆ‘ä»¬ä¼šä¸€æ­¥ä¸€æ­¥åœ°æ¥è¯´æ˜ã€‚è™½ç„¶å®ƒçœ‹èµ·æ¥ä»¤äººæœ›è€Œç”Ÿç•ï¼Œä½†å…¶å®éå¸¸ç®€å•ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- éå¸¸å¤æ‚çš„ç»“æœæ˜ å°„ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>detailedBlogResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>idArg</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_id<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_title<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_password<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_email<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bio<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_bio<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>favouriteSection<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_favourite_section<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>posts<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subject<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_subject<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comments<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Comment<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tags<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Tag<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tag_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>discriminator</span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>draft<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>case</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DraftPost<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>discriminator</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p><code>resultMap</code> å…ƒç´ æœ‰å¾ˆå¤šå­å…ƒç´ å’Œä¸€ä¸ªå€¼å¾—æ·±å…¥æ¢è®¨çš„ç»“æ„ã€‚ ä¸‹é¢æ˜¯<code>resultMap</code> å…ƒç´ çš„æ¦‚å¿µè§†å›¾ã€‚</p><h4 id="ç»“æœæ˜ å°„ï¼ˆresultMapï¼‰">ç»“æœæ˜ å°„ï¼ˆresultMapï¼‰</h4><ul><li><p><code>constructor</code>- ç”¨äºåœ¨å®ä¾‹åŒ–ç±»æ—¶ï¼Œæ³¨å…¥ç»“æœåˆ°æ„é€ æ–¹æ³•ä¸­</p><ul><li><code>idArg</code> - ID å‚æ•°ï¼›æ ‡è®°å‡ºä½œä¸º ID çš„ç»“æœå¯ä»¥å¸®åŠ©æé«˜æ•´ä½“æ€§èƒ½</li><li><code>arg</code> - å°†è¢«æ³¨å…¥åˆ°æ„é€ æ–¹æ³•çš„ä¸€ä¸ªæ™®é€šç»“æœ</li></ul></li><li><p><code>id</code> â€“ ä¸€ä¸ª ID ç»“æœï¼›æ ‡è®°å‡ºä½œä¸º ID çš„ç»“æœå¯ä»¥å¸®åŠ©æé«˜æ•´ä½“æ€§èƒ½</p></li><li><p><code>result</code> â€“ æ³¨å…¥åˆ°å­—æ®µæˆ– JavaBean å±æ€§çš„æ™®é€šç»“æœ</p></li><li><p><code>association</code>â€“ ä¸€ä¸ªå¤æ‚ç±»å‹çš„å…³è”ï¼›è®¸å¤šç»“æœå°†åŒ…è£…æˆè¿™ç§ç±»å‹</p><ul><li>åµŒå¥—ç»“æœæ˜ å°„ â€“ å…³è”å¯ä»¥æ˜¯ <code>resultMap</code> å…ƒç´ ï¼Œæˆ–æ˜¯å¯¹å…¶å®ƒç»“æœæ˜ å°„çš„å¼•ç”¨</li></ul></li><li><p><code>collection</code>â€“ ä¸€ä¸ªå¤æ‚ç±»å‹çš„é›†åˆ</p><ul><li>åµŒå¥—ç»“æœæ˜ å°„ â€“ é›†åˆå¯ä»¥æ˜¯ <code>resultMap</code> å…ƒç´ ï¼Œæˆ–æ˜¯å¯¹å…¶å®ƒç»“æœæ˜ å°„çš„å¼•ç”¨</li></ul></li><li><p><code>discriminator</code>â€“ ä½¿ç”¨ç»“æœå€¼æ¥å†³å®šä½¿ç”¨å“ªä¸ª<code>resultMap</code></p><ul><li><code>case</code>â€“ åŸºäºæŸäº›å€¼çš„ç»“æœæ˜ å°„<ul><li>åµŒå¥—ç»“æœæ˜ å°„ â€“ <code>case</code> ä¹Ÿæ˜¯ä¸€ä¸ªç»“æœæ˜ å°„ï¼Œå› æ­¤å…·æœ‰ç›¸åŒçš„ç»“æ„å’Œå…ƒç´ ï¼›æˆ–è€…å¼•ç”¨å…¶å®ƒçš„ç»“æœæ˜ å°„</li></ul></li></ul></li></ul><p><strong>ResultMap çš„å±æ€§åˆ—è¡¨</strong></p><table><thead><tr><th style="text-align:left">å±æ€§</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><code>id</code></td><td style="text-align:left">å½“å‰å‘½åç©ºé—´ä¸­çš„ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ï¼Œç”¨äºæ ‡è¯†ä¸€ä¸ªç»“æœæ˜ å°„ã€‚</td></tr><tr><td style="text-align:left"><code>type</code></td><td style="text-align:left">ç±»çš„å®Œå…¨é™å®šå, æˆ–è€…ä¸€ä¸ªç±»å‹åˆ«åï¼ˆå…³äºå†…ç½®çš„ç±»å‹åˆ«åï¼Œå¯ä»¥å‚è€ƒä¸Šé¢çš„è¡¨æ ¼ï¼‰ã€‚</td></tr><tr><td style="text-align:left"><code>autoMapping</code></td><td style="text-align:left">å¦‚æœè®¾ç½®è¿™ä¸ªå±æ€§ï¼ŒMyBatis å°†ä¼šä¸ºæœ¬ç»“æœæ˜ å°„å¼€å¯æˆ–è€…å…³é—­è‡ªåŠ¨æ˜ å°„ã€‚ è¿™ä¸ªå±æ€§ä¼šè¦†ç›–å…¨å±€çš„å±æ€§ autoMappingBehaviorã€‚é»˜è®¤å€¼ï¼šæœªè®¾ç½®ï¼ˆunsetï¼‰ã€‚</td></tr></tbody></table><blockquote><p>æœ€å¥½é€æ­¥å»ºç«‹ç»“æœæ˜ å°„ã€‚å•å…ƒæµ‹è¯•å¯ä»¥åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­èµ·åˆ°å¾ˆå¤§å¸®åŠ©ã€‚ å¦‚æœä½ å°è¯•ä¸€æ¬¡æ€§åˆ›å»ºåƒä¸Šé¢ç¤ºä¾‹é‚£ä¹ˆå·¨å¤§çš„ç»“æœæ˜ å°„ï¼Œä¸ä»…å®¹æ˜“å‡ºé”™ï¼Œéš¾åº¦ä¹Ÿä¼šç›´çº¿ä¸Šå‡ã€‚ æ‰€ä»¥ï¼Œä»æœ€ç®€å•çš„å½¢æ€å¼€å§‹ï¼Œé€æ­¥è¿­ä»£ã€‚è€Œä¸”åˆ«å¿˜äº†å•å…ƒæµ‹è¯•ï¼ æœ‰æ—¶å€™ï¼Œæ¡†æ¶çš„è¡Œä¸ºåƒæ˜¯ä¸€ä¸ªé»‘ç›’å­ï¼ˆæ— è®ºæ˜¯å¦å¼€æºï¼‰ã€‚å› æ­¤ï¼Œä¸ºäº†ç¡®ä¿å®ç°çš„è¡Œä¸ºä¸ä½ çš„æœŸæœ›ç›¸ä¸€è‡´ï¼Œæœ€å¥½ç¼–å†™å•å…ƒæµ‹è¯•ã€‚ å¹¶ä¸”å•å…ƒæµ‹è¯•åœ¨æäº¤ bug æ—¶ä¹Ÿèƒ½èµ·åˆ°å¾ˆå¤§çš„ä½œç”¨ã€‚</p></blockquote><h3 id="ä¸‹ä¸€éƒ¨åˆ†å°†è¯¦ç»†è¯´æ˜æ¯ä¸ªå…ƒç´ ã€‚"><strong>ä¸‹ä¸€éƒ¨åˆ†å°†è¯¦ç»†è¯´æ˜æ¯ä¸ªå…ƒç´ ã€‚</strong></h3><h4 id="id-result">id &amp; result</h4><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subject<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_subject<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><p>è¿™äº›å…ƒç´ æ˜¯ç»“æœæ˜ å°„çš„åŸºç¡€ã€‚<em>id</em> å’Œ <em>result</em> å…ƒç´ éƒ½å°†ä¸€ä¸ªåˆ—çš„å€¼æ˜ å°„åˆ°ä¸€ä¸ªç®€å•æ•°æ®ç±»å‹ï¼ˆString, int, double, Date ç­‰ï¼‰çš„å±æ€§æˆ–å­—æ®µã€‚</p><p>è¿™ä¸¤è€…ä¹‹é—´çš„å”¯ä¸€ä¸åŒæ˜¯ï¼Œ<em>id</em> å…ƒç´ å¯¹åº”çš„å±æ€§ä¼šè¢«æ ‡è®°ä¸ºå¯¹è±¡çš„æ ‡è¯†ç¬¦ï¼Œåœ¨æ¯”è¾ƒå¯¹è±¡å®ä¾‹æ—¶ä½¿ç”¨ã€‚ è¿™æ ·å¯ä»¥æé«˜æ•´ä½“çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯è¿›è¡Œç¼“å­˜å’ŒåµŒå¥—ç»“æœæ˜ å°„ï¼ˆä¹Ÿå°±æ˜¯è¿æ¥æ˜ å°„ï¼‰çš„æ—¶å€™ã€‚</p><p>ä¸¤ä¸ªå…ƒç´ éƒ½æœ‰ä¸€äº›å±æ€§ï¼š</p><table><thead><tr><th style="text-align:left"><strong>å±æ€§</strong></th><th style="text-align:left"><strong>æè¿°</strong></th></tr></thead><tbody><tr><td style="text-align:left"><strong><code>property</code></strong></td><td style="text-align:left"><strong>æ˜ å°„åˆ°åˆ—ç»“æœçš„å­—æ®µæˆ–å±æ€§ã€‚å¦‚æœ JavaBean æœ‰è¿™ä¸ªåå­—çš„å±æ€§ï¼ˆpropertyï¼‰ï¼Œä¼šå…ˆä½¿ç”¨è¯¥å±æ€§ã€‚å¦åˆ™ MyBatis å°†ä¼šå¯»æ‰¾ç»™å®šåç§°çš„å­—æ®µï¼ˆfieldï¼‰ã€‚ æ— è®ºæ˜¯å“ªä¸€ç§æƒ…å½¢ï¼Œä½ éƒ½å¯ä»¥ä½¿ç”¨å¸¸è§çš„ç‚¹å¼åˆ†éš”å½¢å¼è¿›è¡Œå¤æ‚å±æ€§å¯¼èˆªã€‚ æ¯”å¦‚ï¼Œä½ å¯ä»¥è¿™æ ·æ˜ å°„ä¸€äº›ç®€å•çš„ä¸œè¥¿ï¼šâ€œusernameâ€ï¼Œæˆ–è€…æ˜ å°„åˆ°ä¸€äº›å¤æ‚çš„ä¸œè¥¿ä¸Šï¼šâ€œaddress.street.numberâ€ã€‚</strong></td></tr><tr><td style="text-align:left"><strong><code>column</code></strong></td><td style="text-align:left"><strong>æ•°æ®åº“ä¸­çš„åˆ—åï¼Œæˆ–è€…æ˜¯åˆ—çš„åˆ«åã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™å’Œä¼ é€’ç»™ <code>resultSet.getString(columnName)</code> æ–¹æ³•çš„å‚æ•°ä¸€æ ·ã€‚</strong></td></tr><tr><td style="text-align:left"><code>*javaType</code>*</td><td style="text-align:left"><em>ä¸€ä¸ª Java ç±»çš„å…¨é™å®šåï¼Œæˆ–ä¸€ä¸ªç±»å‹åˆ«åï¼ˆå…³äºå†…ç½®çš„ç±»å‹åˆ«åï¼Œå¯ä»¥å‚è€ƒä¸Šé¢çš„è¡¨æ ¼ï¼‰ã€‚ å¦‚æœä½ æ˜ å°„åˆ°ä¸€ä¸ª JavaBeanï¼ŒMyBatis é€šå¸¸å¯ä»¥æ¨æ–­ç±»å‹ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æ˜ å°„åˆ°çš„æ˜¯ HashMapï¼Œé‚£ä¹ˆä½ åº”è¯¥æ˜ç¡®åœ°æŒ‡å®š javaType æ¥ä¿è¯è¡Œä¸ºä¸æœŸæœ›çš„ç›¸ä¸€è‡´ã€‚</em></td></tr><tr><td style="text-align:left"><em><code>jdbcType</code></em></td><td style="text-align:left"><em>JDBC ç±»å‹</em></td></tr><tr><td style="text-align:left"><em><code>typeHandler</code></em></td><td style="text-align:left"><em>æˆ‘ä»¬åœ¨å‰é¢è®¨è®ºè¿‡é»˜è®¤çš„ç±»å‹å¤„ç†å™¨ã€‚ä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œä½ å¯ä»¥è¦†ç›–é»˜è®¤çš„ç±»å‹å¤„ç†å™¨ã€‚ è¿™ä¸ªå±æ€§å€¼æ˜¯ä¸€ä¸ªç±»å‹å¤„ç†å™¨å®ç°ç±»çš„å…¨é™å®šåï¼Œæˆ–è€…æ˜¯ç±»å‹åˆ«åã€‚</em></td></tr></tbody></table><h4 id="æ„é€ æ–¹æ³•">æ„é€ æ–¹æ³•</h4><p>æ„é€ æ–¹æ³•æ³¨å…¥å…è®¸ä½ åœ¨åˆå§‹åŒ–æ—¶ä¸ºç±»è®¾ç½®å±æ€§çš„å€¼ï¼Œè€Œä¸ç”¨æš´éœ²å‡ºå…¬æœ‰æ–¹æ³•ã€‚MyBatis ä¹Ÿæ”¯æŒç§æœ‰å±æ€§å’Œç§æœ‰ JavaBean å±æ€§æ¥å®Œæˆæ³¨å…¥ï¼Œä½†æœ‰ä¸€äº›äººæ›´é’çäºé€šè¿‡æ„é€ æ–¹æ³•è¿›è¡Œæ³¨å…¥ã€‚ <em>constructor</em> å…ƒç´ å°±æ˜¯ä¸ºæ­¤è€Œç”Ÿçš„ã€‚</p><p>çœ‹çœ‹ä¸‹é¢è¿™ä¸ªæ„é€ æ–¹æ³•:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>   <span class="token comment">//...</span>   <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token comment">//...</span>  <span class="token punctuation">&#125;</span><span class="token comment">//...</span><span class="token punctuation">&#125;</span></code></pre><p>ä¸ºäº†å°†ç»“æœæ³¨å…¥æ„é€ æ–¹æ³•ï¼ŒMyBatis éœ€è¦é€šè¿‡æŸç§æ–¹å¼å®šä½ç›¸åº”çš„æ„é€ æ–¹æ³•ã€‚ åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒMyBatis æœç´¢ä¸€ä¸ªå£°æ˜äº†ä¸‰ä¸ªå½¢å‚çš„æ„é€ æ–¹æ³•ï¼Œå‚æ•°ç±»å‹ä»¥ <code>java.lang.Integer</code>, <code>java.lang.String</code> å’Œ <code>int</code> çš„é¡ºåºç»™å‡ºã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>idArg</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>String<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_int<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor</span><span class="token punctuation">></span></span></code></pre><p>å½“ä½ åœ¨å¤„ç†ä¸€ä¸ªå¸¦æœ‰å¤šä¸ªå½¢å‚çš„æ„é€ æ–¹æ³•æ—¶ï¼Œå¾ˆå®¹æ˜“æä¹± arg å…ƒç´ çš„é¡ºåºã€‚ ä»ç‰ˆæœ¬ 3.4.3 å¼€å§‹ï¼Œå¯ä»¥åœ¨æŒ‡å®šå‚æ•°åç§°çš„å‰æä¸‹ï¼Œä»¥ä»»æ„é¡ºåºç¼–å†™ arg å…ƒç´ ã€‚ ä¸ºäº†é€šè¿‡åç§°æ¥å¼•ç”¨æ„é€ æ–¹æ³•å‚æ•°ï¼Œä½ å¯ä»¥æ·»åŠ  <code>@Param</code> æ³¨è§£ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç­‰ä»·çš„ä¾‹å­ï¼Œå°½ç®¡å‡½æ•°ç­¾åä¸­ç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªå½¢å‚çš„é¡ºåºä¸ constructor å…ƒç´ ä¸­å‚æ•°å£°æ˜çš„é¡ºåºä¸åŒ¹é…ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>idArg</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_int<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>String<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor</span><span class="token punctuation">></span></span></code></pre><p>å¦‚æœå­˜åœ¨åç§°å’Œç±»å‹ç›¸åŒçš„å¯å†™å±æ€§ï¼Œé‚£ä¹ˆå¯ä»¥çœç•¥ <code>javaType</code> ã€‚</p><p>å‰©ä½™çš„å±æ€§å’Œè§„åˆ™å’Œæ™®é€šçš„ id å’Œ result å…ƒç´ æ˜¯ä¸€æ ·çš„ã€‚</p><h4 id="å…³è”">å…³è”</h4><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_author_id<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">></span></span></code></pre><p>å…³è”ï¼ˆassociationï¼‰å…ƒç´ å¤„ç†â€œæœ‰ä¸€ä¸ªâ€ç±»å‹çš„å…³ç³»ã€‚ æ¯”å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œä¸€ä¸ªåšå®¢æœ‰ä¸€ä¸ªç”¨æˆ·ã€‚å…³è”ç»“æœæ˜ å°„å’Œå…¶å®ƒç±»å‹çš„æ˜ å°„å·¥ä½œæ–¹å¼å·®ä¸å¤šã€‚ ä½ éœ€è¦æŒ‡å®šç›®æ ‡å±æ€§åä»¥åŠå±æ€§çš„<code>javaType</code>ï¼ˆå¾ˆå¤šæ—¶å€™ MyBatis å¯ä»¥è‡ªå·±æ¨æ–­å‡ºæ¥ï¼‰ã€‚</p><p>å…³è”çš„ä¸åŒä¹‹å¤„æ˜¯ï¼Œä½ éœ€è¦å‘Šè¯‰ MyBatis å¦‚ä½•åŠ è½½å…³è”ã€‚MyBatis æœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼åŠ è½½å…³è”ï¼š</p><ul><li>åµŒå¥— Select æŸ¥è¯¢ï¼šé€šè¿‡æ‰§è¡Œå¦å¤–ä¸€ä¸ª SQL æ˜ å°„è¯­å¥æ¥åŠ è½½æœŸæœ›çš„å¤æ‚ç±»å‹ã€‚</li><li>åµŒå¥—ç»“æœæ˜ å°„ï¼šä½¿ç”¨åµŒå¥—çš„ç»“æœæ˜ å°„æ¥å¤„ç†è¿æ¥ç»“æœçš„é‡å¤å­é›†ã€‚</li></ul><p>é¦–å…ˆï¼Œå…ˆè®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªå…ƒç´ çš„å±æ€§ã€‚ä½ å°†ä¼šå‘ç°ï¼Œå’Œæ™®é€šçš„ç»“æœæ˜ å°„ç›¸æ¯”ï¼Œå®ƒåªåœ¨ select å’Œ resultMap å±æ€§ä¸Šæœ‰æ‰€ä¸åŒã€‚</p><table><thead><tr><th style="text-align:left">å±æ€§</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><code>column</code></td><td style="text-align:left">æ•°æ®åº“ä¸­çš„åˆ—åï¼Œæˆ–è€…æ˜¯åˆ—çš„åˆ«åã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™å’Œä¼ é€’ç»™ <code>resultSet.getString(columnName)</code> æ–¹æ³•çš„å‚æ•°ä¸€æ ·ã€‚</td></tr><tr><td style="text-align:left"><code>javaType</code></td><td style="text-align:left">ä¸€ä¸ª Java ç±»çš„å®Œå…¨é™å®šåï¼Œæˆ–ä¸€ä¸ªç±»å‹åˆ«åï¼ˆå…³äºå†…ç½®çš„ç±»å‹åˆ«åï¼Œå¯ä»¥å‚è€ƒä¸Šé¢çš„è¡¨æ ¼ï¼‰ã€‚ å¦‚æœä½ æ˜ å°„åˆ°ä¸€ä¸ª JavaBeanï¼ŒMyBatis é€šå¸¸å¯ä»¥æ¨æ–­ç±»å‹ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æ˜ å°„åˆ°çš„æ˜¯ HashMapï¼Œé‚£ä¹ˆä½ åº”è¯¥æ˜ç¡®åœ°æŒ‡å®š javaType æ¥ä¿è¯è¡Œä¸ºä¸æœŸæœ›çš„ç›¸ä¸€è‡´ã€‚</td></tr><tr><td style="text-align:left"><code>jdbcType</code></td><td style="text-align:left">JDBC ç±»å‹</td></tr><tr><td style="text-align:left"><code>typeHandler</code></td><td style="text-align:left"><em>æˆ‘ä»¬åœ¨å‰é¢è®¨è®ºè¿‡é»˜è®¤çš„ç±»å‹å¤„ç†å™¨ã€‚ä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œä½ å¯ä»¥è¦†ç›–é»˜è®¤çš„ç±»å‹å¤„ç†å™¨ã€‚ è¿™ä¸ªå±æ€§å€¼æ˜¯ä¸€ä¸ªç±»å‹å¤„ç†å™¨å®ç°ç±»çš„å®Œå…¨é™å®šåï¼Œæˆ–è€…æ˜¯ç±»å‹åˆ«åã€‚</em></td></tr><tr><td style="text-align:left"><code>select</code></td><td style="text-align:left">ç”¨äºåŠ è½½å¤æ‚ç±»å‹å±æ€§çš„æ˜ å°„è¯­å¥çš„ IDï¼Œå®ƒä¼šä» column å±æ€§ä¸­æŒ‡å®šçš„åˆ—æ£€ç´¢æ•°æ®ï¼Œä½œä¸ºå‚æ•°ä¼ é€’ç»™æ­¤ select è¯­å¥ã€‚å…·ä½“è¯·å‚è€ƒå…³è”å…ƒç´ ã€‚</td></tr><tr><td style="text-align:left"><code>resultMap</code></td><td style="text-align:left">ç»“æœæ˜ å°„çš„ IDï¼Œå¯ä»¥å°†åµŒå¥—çš„ç»“æœé›†æ˜ å°„åˆ°ä¸€ä¸ªåˆé€‚çš„å¯¹è±¡æ ‘ä¸­ã€‚ å®ƒå¯ä»¥ä½œä¸ºä½¿ç”¨é¢å¤– select è¯­å¥çš„æ›¿ä»£æ–¹æ¡ˆã€‚å®ƒå¯ä»¥å°†å¤šè¡¨è¿æ¥æ“ä½œçš„ç»“æœæ˜ å°„æˆä¸€ä¸ªå•ä¸€çš„ <code>ResultSet</code>ã€‚è¿™æ ·çš„ <code>ResultSet</code> å°†ä¼šå°†åŒ…å«é‡å¤æˆ–éƒ¨åˆ†æ•°æ®é‡å¤çš„ç»“æœé›†ã€‚ä¸ºäº†å°†ç»“æœé›†æ­£ç¡®åœ°æ˜ å°„åˆ°åµŒå¥—çš„å¯¹è±¡æ ‘ä¸­ï¼ŒMyBatis å…è®¸ä½  â€œä¸²è”â€ç»“æœæ˜ å°„ï¼Œä»¥ä¾¿è§£å†³åµŒå¥—ç»“æœé›†çš„é—®é¢˜ã€‚æƒ³äº†è§£æ›´å¤šå†…å®¹ï¼Œè¯·å‚è€ƒä¸‹é¢çš„å…³è”å…ƒç´ ã€‚</td></tr><tr><td style="text-align:left"><code>name</code></td><td style="text-align:left">æ„é€ æ–¹æ³•å½¢å‚çš„åå­—ã€‚ä» 3.4.3 ç‰ˆæœ¬å¼€å§‹ï¼Œé€šè¿‡æŒ‡å®šå…·ä½“çš„å‚æ•°åï¼Œä½ å¯ä»¥ä»¥ä»»æ„é¡ºåºå†™å…¥ arg å…ƒç´ ã€‚å‚çœ‹ä¸Šé¢çš„è§£é‡Šã€‚</td></tr></tbody></table><h4 id="å…³è”çš„åµŒå¥—-Select-æŸ¥è¯¢">å…³è”çš„åµŒå¥— Select æŸ¥è¯¢</h4><table><thead><tr><th style="text-align:left">å±æ€§</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><code>column</code></td><td style="text-align:left">æ•°æ®åº“ä¸­çš„åˆ—åï¼Œæˆ–è€…æ˜¯åˆ—çš„åˆ«åã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™å’Œä¼ é€’ç»™ <code>resultSet.getString(columnName)</code> æ–¹æ³•çš„å‚æ•°ä¸€æ ·ã€‚ æ³¨æ„ï¼šåœ¨ä½¿ç”¨å¤åˆä¸»é”®çš„æ—¶å€™ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>column=&quot;&#123;prop1=col1,prop2=col2&#125;&quot;</code> è¿™æ ·çš„è¯­æ³•æ¥æŒ‡å®šå¤šä¸ªä¼ é€’ç»™åµŒå¥— Select æŸ¥è¯¢è¯­å¥çš„åˆ—åã€‚è¿™ä¼šä½¿å¾— <code>prop1</code> å’Œ <code>prop2</code> ä½œä¸ºå‚æ•°å¯¹è±¡ï¼Œè¢«è®¾ç½®ä¸ºå¯¹åº”åµŒå¥— Select è¯­å¥çš„å‚æ•°ã€‚</td></tr><tr><td style="text-align:left"><code>select</code></td><td style="text-align:left">ç”¨äºåŠ è½½å¤æ‚ç±»å‹å±æ€§çš„æ˜ å°„è¯­å¥çš„ IDï¼Œå®ƒä¼šä» column å±æ€§æŒ‡å®šçš„åˆ—ä¸­æ£€ç´¢æ•°æ®ï¼Œä½œä¸ºå‚æ•°ä¼ é€’ç»™ç›®æ ‡ select è¯­å¥ã€‚ å…·ä½“è¯·å‚è€ƒä¸‹é¢çš„ä¾‹å­ã€‚æ³¨æ„ï¼šåœ¨ä½¿ç”¨å¤åˆä¸»é”®çš„æ—¶å€™ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>column=&quot;&#123;prop1=col1,prop2=col2&#125;&quot;</code> è¿™æ ·çš„è¯­æ³•æ¥æŒ‡å®šå¤šä¸ªä¼ é€’ç»™åµŒå¥— Select æŸ¥è¯¢è¯­å¥çš„åˆ—åã€‚è¿™ä¼šä½¿å¾— <code>prop1</code> å’Œ <code>prop2</code> ä½œä¸ºå‚æ•°å¯¹è±¡ï¼Œè¢«è®¾ç½®ä¸ºå¯¹åº”åµŒå¥— Select è¯­å¥çš„å‚æ•°ã€‚</td></tr><tr><td style="text-align:left"><code>fetchType</code></td><td style="text-align:left">å¯é€‰çš„ã€‚æœ‰æ•ˆå€¼ä¸º <code>lazy</code> å’Œ <code>eager</code>ã€‚ æŒ‡å®šå±æ€§åï¼Œå°†åœ¨æ˜ å°„ä¸­å¿½ç•¥å…¨å±€é…ç½®å‚æ•° <code>lazyLoadingEnabled</code>ï¼Œä½¿ç”¨å±æ€§çš„å€¼ã€‚</td></tr></tbody></table><p>ç¤ºä¾‹ï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_id<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectAuthor<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectBlog<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  SELECT * FROM BLOG WHERE ID = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectAuthor<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  SELECT * FROM AUTHOR WHERE ID = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚æˆ‘ä»¬æœ‰ä¸¤ä¸ª select æŸ¥è¯¢è¯­å¥ï¼šä¸€ä¸ªç”¨æ¥åŠ è½½åšå®¢ï¼ˆBlogï¼‰ï¼Œå¦å¤–ä¸€ä¸ªç”¨æ¥åŠ è½½ä½œè€…ï¼ˆAuthorï¼‰ï¼Œè€Œä¸”åšå®¢çš„ç»“æœæ˜ å°„æè¿°äº†åº”è¯¥ä½¿ç”¨ <code>selectAuthor</code> è¯­å¥åŠ è½½å®ƒçš„ author å±æ€§ã€‚</p><p>å…¶å®ƒæ‰€æœ‰çš„å±æ€§å°†ä¼šè¢«è‡ªåŠ¨åŠ è½½ï¼Œåªè¦å®ƒä»¬çš„åˆ—åå’Œå±æ€§åç›¸åŒ¹é…ã€‚</p><p><strong>è¿™ç§æ–¹å¼è™½ç„¶å¾ˆç®€å•ï¼Œä½†åœ¨å¤§å‹æ•°æ®é›†æˆ–å¤§å‹æ•°æ®è¡¨ä¸Šè¡¨ç°ä¸ä½³</strong>ã€‚è¿™ä¸ªé—®é¢˜è¢«ç§°ä¸ºâ€œ<strong>N+1 æŸ¥è¯¢é—®é¢˜</strong>â€ã€‚ æ¦‚æ‹¬åœ°è®²ï¼ŒN+1 æŸ¥è¯¢é—®é¢˜æ˜¯è¿™æ ·å­çš„ï¼š</p><ul><li>ä½ æ‰§è¡Œäº†ä¸€ä¸ªå•ç‹¬çš„ SQL è¯­å¥æ¥è·å–ç»“æœçš„ä¸€ä¸ªåˆ—è¡¨ï¼ˆå°±æ˜¯â€œ+1â€ï¼‰ã€‚</li><li>å¯¹åˆ—è¡¨è¿”å›çš„æ¯æ¡è®°å½•ï¼Œä½ æ‰§è¡Œä¸€ä¸ª select æŸ¥è¯¢è¯­å¥æ¥ä¸ºæ¯æ¡è®°å½•åŠ è½½è¯¦ç»†ä¿¡æ¯ï¼ˆå°±æ˜¯â€œNâ€ï¼‰ã€‚</li></ul><p>è¿™ä¸ªé—®é¢˜ä¼šå¯¼è‡´æˆç™¾ä¸Šåƒçš„ SQL è¯­å¥è¢«æ‰§è¡Œã€‚æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›äº§ç”Ÿè¿™æ ·çš„åæœã€‚</p><p>å¥½æ¶ˆæ¯æ˜¯ï¼ŒMyBatis èƒ½å¤Ÿå¯¹è¿™æ ·çš„æŸ¥è¯¢è¿›è¡Œå»¶è¿ŸåŠ è½½ï¼Œå› æ­¤å¯ä»¥å°†å¤§é‡è¯­å¥åŒæ—¶è¿è¡Œçš„å¼€é”€åˆ†æ•£å¼€æ¥ã€‚ ç„¶è€Œï¼Œå¦‚æœä½ åŠ è½½è®°å½•åˆ—è¡¨ä¹‹åç«‹åˆ»å°±éå†åˆ—è¡¨ä»¥è·å–åµŒå¥—çš„æ•°æ®ï¼Œå°±ä¼šè§¦å‘æ‰€æœ‰çš„å»¶è¿ŸåŠ è½½æŸ¥è¯¢ï¼Œæ€§èƒ½å¯èƒ½ä¼šå˜å¾—å¾ˆç³Ÿç³•ã€‚</p><p>æ‰€ä»¥è¿˜æœ‰å¦å¤–ä¸€ç§æ–¹æ³•ã€‚</p><h4 id="å…³è”çš„åµŒå¥—ç»“æœæ˜ å°„">å…³è”çš„åµŒå¥—ç»“æœæ˜ å°„</h4><table><thead><tr><th style="text-align:left">å±æ€§</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><code>resultMap</code></td><td style="text-align:left">ç»“æœæ˜ å°„çš„ IDï¼Œå¯ä»¥å°†æ­¤å…³è”çš„åµŒå¥—ç»“æœé›†æ˜ å°„åˆ°ä¸€ä¸ªåˆé€‚çš„å¯¹è±¡æ ‘ä¸­ã€‚ å®ƒå¯ä»¥ä½œä¸ºä½¿ç”¨é¢å¤– select è¯­å¥çš„æ›¿ä»£æ–¹æ¡ˆã€‚å®ƒå¯ä»¥å°†å¤šè¡¨è¿æ¥æ“ä½œçš„ç»“æœæ˜ å°„æˆä¸€ä¸ªå•ä¸€çš„ <code>ResultSet</code>ã€‚è¿™æ ·çš„ <code>ResultSet</code> æœ‰éƒ¨åˆ†æ•°æ®æ˜¯é‡å¤çš„ã€‚ ä¸ºäº†å°†ç»“æœé›†æ­£ç¡®åœ°æ˜ å°„åˆ°åµŒå¥—çš„å¯¹è±¡æ ‘ä¸­, MyBatis å…è®¸ä½ â€œä¸²è”â€ç»“æœæ˜ å°„ï¼Œä»¥ä¾¿è§£å†³åµŒå¥—ç»“æœé›†çš„é—®é¢˜ã€‚ä½¿ç”¨åµŒå¥—ç»“æœæ˜ å°„çš„ä¸€ä¸ªä¾‹å­åœ¨è¡¨æ ¼ä»¥åã€‚</td></tr><tr><td style="text-align:left"><code>columnPrefix</code></td><td style="text-align:left">å½“è¿æ¥å¤šä¸ªè¡¨æ—¶ï¼Œä½ å¯èƒ½ä¼šä¸å¾—ä¸ä½¿ç”¨åˆ—åˆ«åæ¥é¿å…åœ¨ <code>ResultSet</code> ä¸­äº§ç”Ÿé‡å¤çš„åˆ—åã€‚æŒ‡å®š columnPrefix åˆ—åå‰ç¼€å…è®¸ä½ å°†å¸¦æœ‰è¿™äº›å‰ç¼€çš„åˆ—æ˜ å°„åˆ°ä¸€ä¸ªå¤–éƒ¨çš„ç»“æœæ˜ å°„ä¸­ã€‚ è¯¦ç»†è¯´æ˜è¯·å‚è€ƒåé¢çš„ä¾‹å­ã€‚</td></tr><tr><td style="text-align:left"><code>notNullColumn</code></td><td style="text-align:left">é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨è‡³å°‘ä¸€ä¸ªè¢«æ˜ å°„åˆ°å±æ€§çš„åˆ—ä¸ä¸ºç©ºæ—¶ï¼Œå­å¯¹è±¡æ‰ä¼šè¢«åˆ›å»ºã€‚ ä½ å¯ä»¥åœ¨è¿™ä¸ªå±æ€§ä¸ŠæŒ‡å®šéç©ºçš„åˆ—æ¥æ”¹å˜é»˜è®¤è¡Œä¸ºï¼ŒæŒ‡å®šåï¼ŒMybatis å°†åªåœ¨è¿™äº›åˆ—ä¸­ä»»æ„ä¸€åˆ—éç©ºæ—¶æ‰åˆ›å»ºä¸€ä¸ªå­å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨é€—å·åˆ†éš”æ¥æŒ‡å®šå¤šä¸ªåˆ—ã€‚é»˜è®¤å€¼ï¼šæœªè®¾ç½®ï¼ˆunsetï¼‰ã€‚</td></tr><tr><td style="text-align:left"><code>autoMapping</code></td><td style="text-align:left">å¦‚æœè®¾ç½®è¿™ä¸ªå±æ€§ï¼ŒMyBatis å°†ä¼šä¸ºæœ¬ç»“æœæ˜ å°„å¼€å¯æˆ–è€…å…³é—­è‡ªåŠ¨æ˜ å°„ã€‚ è¿™ä¸ªå±æ€§ä¼šè¦†ç›–å…¨å±€çš„å±æ€§ autoMappingBehaviorã€‚æ³¨æ„ï¼Œæœ¬å±æ€§å¯¹å¤–éƒ¨çš„ç»“æœæ˜ å°„æ— æ•ˆï¼Œæ‰€ä»¥ä¸èƒ½æ­é… <code>select</code> æˆ– <code>resultMap</code> å…ƒç´ ä½¿ç”¨ã€‚é»˜è®¤å€¼ï¼šæœªè®¾ç½®ï¼ˆunsetï¼‰ã€‚</td></tr></tbody></table><p>ä¹‹å‰ï¼Œä½ å·²ç»çœ‹åˆ°äº†ä¸€ä¸ªéå¸¸å¤æ‚çš„åµŒå¥—å…³è”çš„ä¾‹å­ã€‚ ä¸‹é¢çš„ä¾‹å­åˆ™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ï¼Œç”¨äºæ¼”ç¤ºåµŒå¥—ç»“æœæ˜ å°„å¦‚ä½•å·¥ä½œã€‚ ç°åœ¨æˆ‘ä»¬å°†åšå®¢è¡¨å’Œä½œè€…è¡¨è¿æ¥åœ¨ä¸€èµ·ï¼Œè€Œä¸æ˜¯æ‰§è¡Œä¸€ä¸ªç‹¬ç«‹çš„æŸ¥è¯¢è¯­å¥ï¼Œå°±åƒè¿™æ ·ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">&lt;</span><span class="token keyword">select</span> id<span class="token operator">=</span><span class="token string">"selectBlog"</span> resultMap<span class="token operator">=</span><span class="token string">"blogResult"</span><span class="token operator">></span>  <span class="token keyword">select</span>    B<span class="token punctuation">.</span>id            <span class="token keyword">as</span> blog_id<span class="token punctuation">,</span>    B<span class="token punctuation">.</span>title         <span class="token keyword">as</span> blog_title<span class="token punctuation">,</span>    B<span class="token punctuation">.</span>author_id     <span class="token keyword">as</span> blog_author_id<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>id            <span class="token keyword">as</span> author_id<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>username      <span class="token keyword">as</span> author_username<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>password      <span class="token keyword">as</span> author_password<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>email         <span class="token keyword">as</span> author_email<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>bio           <span class="token keyword">as</span> author_bio  <span class="token keyword">from</span> Blog B <span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> Author A <span class="token keyword">on</span> B<span class="token punctuation">.</span>author_id <span class="token operator">=</span> A<span class="token punctuation">.</span>id  <span class="token keyword">where</span> B<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token comment">#&#123;id&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">select</span><span class="token operator">></span></code></pre><p>æ³¨æ„æŸ¥è¯¢ä¸­çš„è¿æ¥ï¼Œä»¥åŠä¸ºç¡®ä¿ç»“æœèƒ½å¤Ÿæ‹¥æœ‰å”¯ä¸€ä¸”æ¸…æ™°çš„åå­—ï¼Œæˆ‘ä»¬è®¾ç½®çš„åˆ«åã€‚ è¿™ä½¿å¾—è¿›è¡Œæ˜ å°„éå¸¸ç®€å•ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥æ˜ å°„è¿™ä¸ªç»“æœï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_title<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_author_id<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>authorResult<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>authorResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_password<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_email<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bio<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_bio<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œåšå®¢ï¼ˆBlogï¼‰ä½œè€…ï¼ˆauthorï¼‰çš„å…³è”å…ƒç´ å§”æ‰˜åä¸º â€œauthorResultâ€ çš„ç»“æœæ˜ å°„æ¥åŠ è½½ä½œè€…å¯¹è±¡çš„å®ä¾‹ã€‚</p><p><strong>éå¸¸é‡è¦ï¼š id å…ƒç´ åœ¨åµŒå¥—ç»“æœæ˜ å°„ä¸­æ‰®æ¼”ç€éå¸¸é‡è¦çš„è§’è‰²ã€‚ä½ åº”è¯¥æ€»æ˜¯æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªå¯ä»¥å”¯ä¸€æ ‡è¯†ç»“æœçš„å±æ€§ã€‚</strong> è™½ç„¶ï¼Œå³ä½¿ä¸æŒ‡å®šè¿™ä¸ªå±æ€§ï¼ŒMyBatis ä»ç„¶å¯ä»¥å·¥ä½œï¼Œä½†æ˜¯ä¼šäº§ç”Ÿä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚ åªéœ€è¦æŒ‡å®šå¯ä»¥å”¯ä¸€æ ‡è¯†ç»“æœçš„æœ€å°‘å±æ€§ã€‚æ˜¾ç„¶ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸»é”®ï¼ˆå¤åˆä¸»é”®ä¹Ÿå¯ä»¥ï¼‰ã€‚</p><p>ç°åœ¨ï¼Œä¸Šé¢çš„ç¤ºä¾‹ä½¿ç”¨äº†å¤–éƒ¨çš„ç»“æœæ˜ å°„å…ƒç´ æ¥æ˜ å°„å…³è”ã€‚è¿™ä½¿å¾— Author çš„ç»“æœæ˜ å°„å¯ä»¥è¢«é‡ç”¨ã€‚ ç„¶è€Œï¼Œå¦‚æœä½ ä¸æ‰“ç®—é‡ç”¨å®ƒï¼Œæˆ–è€…ä½ æ›´å–œæ¬¢å°†ä½ æ‰€æœ‰çš„ç»“æœæ˜ å°„æ”¾åœ¨ä¸€ä¸ªå…·æœ‰æè¿°æ€§çš„ç»“æœæ˜ å°„å…ƒç´ ä¸­ã€‚ ä½ å¯ä»¥ç›´æ¥å°†ç»“æœæ˜ å°„ä½œä¸ºå­å…ƒç´ åµŒå¥—åœ¨å†…ã€‚è¿™é‡Œç»™å‡ºä½¿ç”¨è¿™ç§æ–¹å¼çš„ç­‰æ•ˆä¾‹å­ï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_title<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_password<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_email<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bio<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_bio<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p>é‚£å¦‚æœåšå®¢ï¼ˆblogï¼‰æœ‰ä¸€ä¸ªå…±åŒä½œè€…ï¼ˆco-authorï¼‰è¯¥æ€ä¹ˆåŠï¼Ÿselect è¯­å¥çœ‹èµ·æ¥ä¼šæ˜¯è¿™æ ·çš„ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">&lt;</span><span class="token keyword">select</span> id<span class="token operator">=</span><span class="token string">"selectBlog"</span> resultMap<span class="token operator">=</span><span class="token string">"blogResult"</span><span class="token operator">></span>  <span class="token keyword">select</span>    B<span class="token punctuation">.</span>id            <span class="token keyword">as</span> blog_id<span class="token punctuation">,</span>    B<span class="token punctuation">.</span>title         <span class="token keyword">as</span> blog_title<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>id            <span class="token keyword">as</span> author_id<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>username      <span class="token keyword">as</span> author_username<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>password      <span class="token keyword">as</span> author_password<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>email         <span class="token keyword">as</span> author_email<span class="token punctuation">,</span>    A<span class="token punctuation">.</span>bio           <span class="token keyword">as</span> author_bio<span class="token punctuation">,</span>    CA<span class="token punctuation">.</span>id           <span class="token keyword">as</span> co_author_id<span class="token punctuation">,</span>    CA<span class="token punctuation">.</span>username     <span class="token keyword">as</span> co_author_username<span class="token punctuation">,</span>    CA<span class="token punctuation">.</span>password     <span class="token keyword">as</span> co_author_password<span class="token punctuation">,</span>    CA<span class="token punctuation">.</span>email        <span class="token keyword">as</span> co_author_email<span class="token punctuation">,</span>    CA<span class="token punctuation">.</span>bio          <span class="token keyword">as</span> co_author_bio  <span class="token keyword">from</span> Blog B  <span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> Author A <span class="token keyword">on</span> B<span class="token punctuation">.</span>author_id <span class="token operator">=</span> A<span class="token punctuation">.</span>id  <span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> Author CA <span class="token keyword">on</span> B<span class="token punctuation">.</span>co_author_id <span class="token operator">=</span> CA<span class="token punctuation">.</span>id  <span class="token keyword">where</span> B<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token comment">#&#123;id&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">select</span><span class="token operator">></span></code></pre><p>å›å¿†ä¸€ä¸‹ï¼ŒAuthor çš„ç»“æœæ˜ å°„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>authorResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_password<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_email<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bio<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_bio<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p>ç”±äºç»“æœä¸­çš„åˆ—åä¸ç»“æœæ˜ å°„ä¸­çš„åˆ—åä¸åŒã€‚ä½ éœ€è¦æŒ‡å®š <code>columnPrefix</code> ä»¥ä¾¿é‡å¤ä½¿ç”¨è¯¥ç»“æœæ˜ å°„æ¥æ˜ å°„ co-author çš„ç»“æœã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_title<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span>    <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>authorResult<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>coAuthor<span class="token punctuation">"</span></span>    <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>authorResult<span class="token punctuation">"</span></span>    <span class="token attr-name">columnPrefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>co_<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><h4 id="å…³è”çš„å¤šç»“æœé›†ï¼ˆResultSetï¼‰">å…³è”çš„å¤šç»“æœé›†ï¼ˆResultSetï¼‰</h4><table><thead><tr><th style="text-align:left">å±æ€§</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><code>column</code></td><td style="text-align:left">å½“ä½¿ç”¨å¤šä¸ªç»“æœé›†æ—¶ï¼Œè¯¥å±æ€§æŒ‡å®šç»“æœé›†ä¸­ç”¨äºä¸ <code>foreignColumn</code> åŒ¹é…çš„åˆ—ï¼ˆå¤šä¸ªåˆ—åä»¥é€—å·éš”å¼€ï¼‰ï¼Œä»¥è¯†åˆ«å…³ç³»ä¸­çš„çˆ¶ç±»å‹ä¸å­ç±»å‹ã€‚</td></tr><tr><td style="text-align:left"><code>foreignColumn</code></td><td style="text-align:left">æŒ‡å®šå¤–é”®å¯¹åº”çš„åˆ—åï¼ŒæŒ‡å®šçš„åˆ—å°†ä¸çˆ¶ç±»å‹ä¸­ <code>column</code> çš„ç»™å‡ºçš„åˆ—è¿›è¡ŒåŒ¹é…ã€‚</td></tr><tr><td style="text-align:left"><code>resultSet</code></td><td style="text-align:left">æŒ‡å®šç”¨äºåŠ è½½å¤æ‚ç±»å‹çš„ç»“æœé›†åå­—ã€‚</td></tr></tbody></table><p>ä»ç‰ˆæœ¬ 3.2.3 å¼€å§‹ï¼ŒMyBatis æä¾›äº†å¦ä¸€ç§è§£å†³ N+1 æŸ¥è¯¢é—®é¢˜çš„æ–¹æ³•ã€‚</p><p>æŸäº›æ•°æ®åº“å…è®¸å­˜å‚¨è¿‡ç¨‹è¿”å›å¤šä¸ªç»“æœé›†ï¼Œæˆ–ä¸€æ¬¡æ€§æ‰§è¡Œå¤šä¸ªè¯­å¥ï¼Œæ¯ä¸ªè¯­å¥è¿”å›ä¸€ä¸ªç»“æœé›†ã€‚ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œåœ¨ä¸ä½¿ç”¨è¿æ¥çš„æƒ…å†µä¸‹ï¼Œåªè®¿é—®æ•°æ®åº“ä¸€æ¬¡å°±èƒ½è·å¾—ç›¸å…³æ•°æ®ã€‚</p><p>åœ¨ä¾‹å­ä¸­ï¼Œå­˜å‚¨è¿‡ç¨‹æ‰§è¡Œä¸‹é¢çš„æŸ¥è¯¢å¹¶è¿”å›ä¸¤ä¸ªç»“æœé›†ã€‚ç¬¬ä¸€ä¸ªç»“æœé›†ä¼šè¿”å›åšå®¢ï¼ˆBlogï¼‰çš„ç»“æœï¼Œç¬¬äºŒä¸ªåˆ™è¿”å›ä½œè€…ï¼ˆAuthorï¼‰çš„ç»“æœã€‚</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> BLOG <span class="token keyword">WHERE</span> ID <span class="token operator">=</span> <span class="token comment">#&#123;id&#125;</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> AUTHOR <span class="token keyword">WHERE</span> ID <span class="token operator">=</span> <span class="token comment">#&#123;id&#125;</span></code></pre><p>åœ¨æ˜ å°„è¯­å¥ä¸­ï¼Œå¿…é¡»é€šè¿‡ <code>resultSets</code> å±æ€§ä¸ºæ¯ä¸ªç»“æœé›†æŒ‡å®šä¸€ä¸ªåå­—ï¼Œå¤šä¸ªåå­—ä½¿ç”¨é€—å·éš”å¼€ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectBlog<span class="token punctuation">"</span></span> <span class="token attr-name">resultSets</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogs,authors<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span> <span class="token attr-name">statementType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CALLABLE<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  &#123;call getBlogsAndAuthors(#&#123;id,jdbcType=INTEGER,mode=IN&#125;)&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æŒ‡å®šä½¿ç”¨ â€œauthorsâ€ ç»“æœé›†çš„æ•°æ®æ¥å¡«å…… â€œauthorâ€ å…³è”ï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span> <span class="token attr-name">resultSet</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>authors<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author_id<span class="token punctuation">"</span></span> <span class="token attr-name">foreignColumn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bio<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bio<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p>ä½ å·²ç»åœ¨ä¸Šé¢çœ‹åˆ°äº†å¦‚ä½•å¤„ç†â€œæœ‰ä¸€ä¸ªâ€ç±»å‹çš„å…³è”ã€‚ä½†æ˜¯è¯¥æ€ä¹ˆå¤„ç†â€œæœ‰å¾ˆå¤šä¸ªâ€ç±»å‹çš„å…³è”å‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦ä»‹ç»çš„ã€‚</p><h2 id="ä¸€å¯¹å¤šå¤„ç†ä¹‹é›†åˆ">ä¸€å¯¹å¤šå¤„ç†ä¹‹é›†åˆ</h2><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>posts<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>domain.blog.Post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subject<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_subject<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_body<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">></span></span></code></pre><p>é›†åˆå…ƒç´ å’Œå…³è”å…ƒç´ å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œå®ƒä»¬ç›¸ä¼¼çš„ç¨‹åº¦ä¹‹é«˜ï¼Œä»¥è‡´äºæ²¡æœ‰å¿…è¦å†ä»‹ç»é›†åˆå…ƒç´ çš„ç›¸ä¼¼éƒ¨åˆ†ã€‚ æ‰€ä»¥è®©æˆ‘ä»¬æ¥å…³æ³¨å®ƒä»¬çš„ä¸åŒä¹‹å¤„å§ã€‚</p><p>æˆ‘ä»¬æ¥ç»§ç»­ä¸Šé¢çš„ç¤ºä¾‹ï¼Œä¸€ä¸ªåšå®¢ï¼ˆBlogï¼‰åªæœ‰ä¸€ä¸ªä½œè€…ï¼ˆAuthor)ã€‚ä½†ä¸€ä¸ªåšå®¢æœ‰å¾ˆå¤šæ–‡ç« ï¼ˆPost)ã€‚ åœ¨åšå®¢ç±»ä¸­ï¼Œè¿™å¯ä»¥ç”¨ä¸‹é¢çš„å†™æ³•æ¥è¡¨ç¤ºï¼š</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Post</span><span class="token punctuation">></span></span> posts<span class="token punctuation">;</span></code></pre><p>è¦åƒä¸Šé¢è¿™æ ·ï¼Œæ˜ å°„åµŒå¥—ç»“æœé›†åˆåˆ°ä¸€ä¸ª List ä¸­ï¼Œå¯ä»¥ä½¿ç”¨é›†åˆå…ƒç´ ã€‚ å’Œå…³è”å…ƒç´ ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åµŒå¥— Select æŸ¥è¯¢ï¼Œæˆ–åŸºäºè¿æ¥çš„åµŒå¥—ç»“æœæ˜ å°„é›†åˆã€‚</p><h4 id="é›†åˆçš„åµŒå¥—-Select-æŸ¥è¯¢">é›†åˆçš„åµŒå¥— Select æŸ¥è¯¢</h4><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨åµŒå¥— Select æŸ¥è¯¢æ¥ä¸ºåšå®¢åŠ è½½æ–‡ç« ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>posts<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ArrayList<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectPostsForBlog<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectBlog<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  SELECT * FROM BLOG WHERE ID = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectPostsForBlog<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  SELECT * FROM POST WHERE BLOG_ID = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>ä½ å¯èƒ½ä¼šç«‹åˆ»æ³¨æ„åˆ°å‡ ä¸ªä¸åŒï¼Œä½†å¤§éƒ¨åˆ†éƒ½å’Œæˆ‘ä»¬ä¸Šé¢å­¦ä¹ è¿‡çš„å…³è”å…ƒç´ éå¸¸ç›¸ä¼¼ã€‚ é¦–å…ˆï¼Œä½ ä¼šæ³¨æ„åˆ°æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯é›†åˆå…ƒç´ ã€‚ æ¥<strong>ä¸‹æ¥ä½ ä¼šæ³¨æ„åˆ°æœ‰ä¸€ä¸ªæ–°çš„ â€œofTypeâ€ å±æ€§ã€‚è¿™ä¸ªå±æ€§éå¸¸é‡è¦ï¼Œå®ƒç”¨æ¥å°† JavaBeanï¼ˆæˆ–å­—æ®µï¼‰å±æ€§çš„ç±»å‹å’Œé›†åˆå­˜å‚¨çš„ç±»å‹åŒºåˆ†å¼€æ¥ã€‚</strong> æ‰€ä»¥ä½ å¯ä»¥æŒ‰ç…§ä¸‹é¢è¿™æ ·æ¥é˜…è¯»æ˜ å°„ï¼š</p><pre class="language-xnl" data-language="xnl"><code class="language-xnl">&lt;collection property&#x3D;&quot;posts&quot; javaType&#x3D;&quot;ArrayList&quot; column&#x3D;&quot;id&quot; ofType&#x3D;&quot;Post&quot; select&#x3D;&quot;selectPostsForBlog&quot;&#x2F;&gt;</code></pre><p>è¯»ä½œï¼š â€œposts æ˜¯ä¸€ä¸ªå­˜å‚¨ Post çš„ ArrayList é›†åˆâ€</p><p>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒMyBatis å¯ä»¥æ¨æ–­ javaType å±æ€§ï¼Œå› æ­¤å¹¶ä¸éœ€è¦å¡«å†™ã€‚æ‰€ä»¥å¾ˆå¤šæ—¶å€™ä½ å¯ä»¥ç®€ç•¥æˆï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>posts<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectPostsForBlog<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><h4 id="é›†åˆçš„åµŒå¥—ç»“æœæ˜ å°„">é›†åˆçš„åµŒå¥—ç»“æœæ˜ å°„</h4><p>ç°åœ¨ä½ å¯èƒ½å·²ç»çŒœåˆ°äº†é›†åˆçš„åµŒå¥—ç»“æœæ˜ å°„æ˜¯æ€æ ·å·¥ä½œçš„â€”â€”é™¤äº†æ–°å¢çš„ â€œofTypeâ€ å±æ€§ï¼Œå®ƒå’Œå…³è”çš„å®Œå…¨ç›¸åŒã€‚</p><p>é¦–å…ˆ, è®©æˆ‘ä»¬çœ‹çœ‹å¯¹åº”çš„ SQL è¯­å¥ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token operator">&lt;</span><span class="token keyword">select</span> id<span class="token operator">=</span><span class="token string">"selectBlog"</span> resultMap<span class="token operator">=</span><span class="token string">"blogResult"</span><span class="token operator">></span>  <span class="token keyword">select</span>  B<span class="token punctuation">.</span>id <span class="token keyword">as</span> blog_id<span class="token punctuation">,</span>  B<span class="token punctuation">.</span>title <span class="token keyword">as</span> blog_title<span class="token punctuation">,</span>  B<span class="token punctuation">.</span>author_id <span class="token keyword">as</span> blog_author_id<span class="token punctuation">,</span>  P<span class="token punctuation">.</span>id <span class="token keyword">as</span> post_id<span class="token punctuation">,</span>  P<span class="token punctuation">.</span>subject <span class="token keyword">as</span> post_subject<span class="token punctuation">,</span>  P<span class="token punctuation">.</span>body <span class="token keyword">as</span> post_body<span class="token punctuation">,</span>  <span class="token keyword">from</span> Blog B  <span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> Post P <span class="token keyword">on</span> B<span class="token punctuation">.</span>id <span class="token operator">=</span> P<span class="token punctuation">.</span>blog_id  <span class="token keyword">where</span> B<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token comment">#&#123;id&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">select</span><span class="token operator">></span></code></pre><p>æˆ‘ä»¬å†æ¬¡è¿æ¥äº†åšå®¢è¡¨å’Œæ–‡ç« è¡¨ï¼Œå¹¶ä¸”ä¸ºæ¯ä¸€åˆ—éƒ½èµ‹äºˆäº†ä¸€ä¸ªæœ‰æ„ä¹‰çš„åˆ«åï¼Œä»¥ä¾¿æ˜ å°„ä¿æŒç®€å•ã€‚ è¦æ˜ å°„åšå®¢é‡Œé¢çš„æ–‡ç« é›†åˆï¼Œå°±è¿™ä¹ˆç®€å•ï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_title<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>posts<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subject<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_subject<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_body<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p>å†æé†’ä¸€æ¬¡ï¼Œè¦è®°å¾—ä¸Šé¢ id å…ƒç´ çš„é‡è¦æ€§ï¼Œå¦‚æœä½ ä¸è®°å¾—äº†ï¼Œè¯·é˜…è¯»å…³è”éƒ¨åˆ†çš„ç›¸å…³éƒ¨åˆ†ã€‚</p><p>å¦‚æœä½ å–œæ¬¢æ›´è¯¦ç•¥çš„ã€å¯é‡ç”¨çš„ç»“æœæ˜ å°„ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ç­‰ä»·å½¢å¼ï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blog_title<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>posts<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogPostResult<span class="token punctuation">"</span></span> <span class="token attr-name">columnPrefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post_<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogPostResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subject<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subject<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><h2 id="ç¼“å­˜">ç¼“å­˜</h2><p>MyBatis å†…ç½®äº†ä¸€ä¸ªå¼ºå¤§çš„äº‹åŠ¡æ€§æŸ¥è¯¢ç¼“å­˜æœºåˆ¶ï¼Œå®ƒå¯ä»¥éå¸¸æ–¹ä¾¿åœ°é…ç½®å’Œå®šåˆ¶ã€‚ ä¸ºäº†ä½¿å®ƒæ›´åŠ å¼ºå¤§è€Œä¸”æ˜“äºé…ç½®ï¼Œæˆ‘ä»¬å¯¹ MyBatis 3 ä¸­çš„ç¼“å­˜å®ç°è¿›è¡Œäº†è®¸å¤šæ”¹è¿›ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåªå¯ç”¨äº†æœ¬åœ°çš„ä¼šè¯ç¼“å­˜ï¼Œå®ƒä»…ä»…å¯¹ä¸€ä¸ªä¼šè¯ä¸­çš„æ•°æ®è¿›è¡Œç¼“å­˜ã€‚ è¦å¯ç”¨å…¨å±€çš„äºŒçº§ç¼“å­˜ï¼Œåªéœ€è¦åœ¨ä½ çš„ SQL æ˜ å°„æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span><span class="token punctuation">/></span></span></code></pre><p>åŸºæœ¬ä¸Šå°±æ˜¯è¿™æ ·ã€‚è¿™ä¸ªç®€å•è¯­å¥çš„æ•ˆæœå¦‚ä¸‹:</p><ul><li>æ˜ å°„è¯­å¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰ select è¯­å¥çš„ç»“æœå°†ä¼šè¢«ç¼“å­˜ã€‚</li><li>æ˜ å°„è¯­å¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰ insertã€update å’Œ delete è¯­å¥ä¼šåˆ·æ–°ç¼“å­˜ã€‚</li><li>ç¼“å­˜ä¼šä½¿ç”¨æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ï¼ˆLRU, Least Recently Usedï¼‰ç®—æ³•æ¥æ¸…é™¤ä¸éœ€è¦çš„ç¼“å­˜ã€‚</li><li>ç¼“å­˜ä¸ä¼šå®šæ—¶è¿›è¡Œåˆ·æ–°ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰åˆ·æ–°é—´éš”ï¼‰ã€‚</li><li>ç¼“å­˜ä¼šä¿å­˜åˆ—è¡¨æˆ–å¯¹è±¡ï¼ˆæ— è®ºæŸ¥è¯¢æ–¹æ³•è¿”å›å“ªç§ï¼‰çš„ 1024 ä¸ªå¼•ç”¨ã€‚</li><li>ç¼“å­˜ä¼šè¢«è§†ä¸ºè¯»/å†™ç¼“å­˜ï¼Œè¿™æ„å‘³ç€è·å–åˆ°çš„å¯¹è±¡å¹¶ä¸æ˜¯å…±äº«çš„ï¼Œå¯ä»¥å®‰å…¨åœ°è¢«è°ƒç”¨è€…ä¿®æ”¹ï¼Œè€Œä¸å¹²æ‰°å…¶ä»–è°ƒç”¨è€…æˆ–çº¿ç¨‹æ‰€åšçš„æ½œåœ¨ä¿®æ”¹ã€‚</li></ul><p><strong>æç¤º</strong> ç¼“å­˜åªä½œç”¨äº cache æ ‡ç­¾æ‰€åœ¨çš„æ˜ å°„æ–‡ä»¶ä¸­çš„è¯­å¥ã€‚å¦‚æœä½ æ··åˆä½¿ç”¨ Java API å’Œ XML æ˜ å°„æ–‡ä»¶ï¼Œåœ¨å…±ç”¨æ¥å£ä¸­çš„è¯­å¥å°†ä¸ä¼šè¢«é»˜è®¤ç¼“å­˜ã€‚ä½ éœ€è¦ä½¿ç”¨ @CacheNamespaceRef æ³¨è§£æŒ‡å®šç¼“å­˜ä½œç”¨åŸŸã€‚</p><p>è¿™äº›å±æ€§å¯ä»¥é€šè¿‡ cache å…ƒç´ çš„å±æ€§æ¥ä¿®æ”¹ã€‚æ¯”å¦‚ï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span>  <span class="token attr-name">eviction</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>FIFO<span class="token punctuation">"</span></span>  <span class="token attr-name">flushInterval</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>60000<span class="token punctuation">"</span></span>  <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>512<span class="token punctuation">"</span></span>  <span class="token attr-name">readOnly</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><p>è¿™ä¸ªæ›´é«˜çº§çš„é…ç½®åˆ›å»ºäº†ä¸€ä¸ª FIFO ç¼“å­˜ï¼Œæ¯éš” 60 ç§’åˆ·æ–°ï¼Œæœ€å¤šå¯ä»¥å­˜å‚¨ç»“æœå¯¹è±¡æˆ–åˆ—è¡¨çš„ 512 ä¸ªå¼•ç”¨ï¼Œè€Œä¸”è¿”å›çš„å¯¹è±¡è¢«è®¤ä¸ºæ˜¯åªè¯»çš„ï¼Œå› æ­¤å¯¹å®ƒä»¬è¿›è¡Œä¿®æ”¹å¯èƒ½ä¼šåœ¨ä¸åŒçº¿ç¨‹ä¸­çš„è°ƒç”¨è€…äº§ç”Ÿå†²çªã€‚</p><p>å¯ç”¨çš„æ¸…é™¤ç­–ç•¥æœ‰ï¼š</p><ul><li><code>LRU</code> â€“ æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼šç§»é™¤æœ€é•¿æ—¶é—´ä¸è¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚</li><li><code>FIFO</code> â€“ å…ˆè¿›å…ˆå‡ºï¼šæŒ‰å¯¹è±¡è¿›å…¥ç¼“å­˜çš„é¡ºåºæ¥ç§»é™¤å®ƒä»¬ã€‚</li><li><code>SOFT</code> â€“ è½¯å¼•ç”¨ï¼šåŸºäºåƒåœ¾å›æ”¶å™¨çŠ¶æ€å’Œè½¯å¼•ç”¨è§„åˆ™ç§»é™¤å¯¹è±¡ã€‚</li><li><code>WEAK</code> â€“ å¼±å¼•ç”¨ï¼šæ›´ç§¯æåœ°åŸºäºåƒåœ¾æ”¶é›†å™¨çŠ¶æ€å’Œå¼±å¼•ç”¨è§„åˆ™ç§»é™¤å¯¹è±¡ã€‚</li></ul><p>é»˜è®¤çš„æ¸…é™¤ç­–ç•¥æ˜¯ LRUã€‚</p><p>flushIntervalï¼ˆåˆ·æ–°é—´éš”ï¼‰å±æ€§å¯ä»¥è¢«è®¾ç½®ä¸ºä»»æ„çš„æ­£æ•´æ•°ï¼Œè®¾ç½®çš„å€¼åº”è¯¥æ˜¯ä¸€ä¸ªä»¥æ¯«ç§’ä¸ºå•ä½çš„åˆç†æ—¶é—´é‡ã€‚ é»˜è®¤æƒ…å†µæ˜¯ä¸è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰åˆ·æ–°é—´éš”ï¼Œç¼“å­˜ä»…ä»…ä¼šåœ¨è°ƒç”¨è¯­å¥æ—¶åˆ·æ–°ã€‚</p><p>sizeï¼ˆå¼•ç”¨æ•°ç›®ï¼‰å±æ€§å¯ä»¥è¢«è®¾ç½®ä¸ºä»»æ„æ­£æ•´æ•°ï¼Œè¦æ³¨æ„æ¬²ç¼“å­˜å¯¹è±¡çš„å¤§å°å’Œè¿è¡Œç¯å¢ƒä¸­å¯ç”¨çš„å†…å­˜èµ„æºã€‚é»˜è®¤å€¼æ˜¯ 1024ã€‚</p><p>readOnlyï¼ˆåªè¯»ï¼‰å±æ€§å¯ä»¥è¢«è®¾ç½®ä¸º true æˆ– falseã€‚åªè¯»çš„ç¼“å­˜ä¼šç»™æ‰€æœ‰è°ƒç”¨è€…è¿”å›ç¼“å­˜å¯¹è±¡çš„ç›¸åŒå®ä¾‹ã€‚ å› æ­¤è¿™äº›å¯¹è±¡ä¸èƒ½è¢«ä¿®æ”¹ã€‚è¿™å°±æä¾›äº†å¯è§‚çš„æ€§èƒ½æå‡ã€‚è€Œå¯è¯»å†™çš„ç¼“å­˜ä¼šï¼ˆé€šè¿‡åºåˆ—åŒ–ï¼‰è¿”å›ç¼“å­˜å¯¹è±¡çš„æ‹·è´ã€‚ é€Ÿåº¦ä¸Šä¼šæ…¢ä¸€äº›ï¼Œä½†æ˜¯æ›´å®‰å…¨ï¼Œå› æ­¤é»˜è®¤å€¼æ˜¯ falseã€‚</p><p><strong>æç¤º</strong> äºŒçº§ç¼“å­˜æ˜¯äº‹åŠ¡æ€§çš„ã€‚è¿™æ„å‘³ç€ï¼Œå½“ SqlSession å®Œæˆå¹¶æäº¤æ—¶ï¼Œæˆ–æ˜¯å®Œæˆå¹¶å›æ»šï¼Œä½†æ²¡æœ‰æ‰§è¡Œ flushCache=true çš„ insert/delete/update è¯­å¥æ—¶ï¼Œç¼“å­˜ä¼šè·å¾—æ›´æ–°ã€‚</p><h4 id="ä½¿ç”¨è‡ªå®šä¹‰ç¼“å­˜">ä½¿ç”¨è‡ªå®šä¹‰ç¼“å­˜</h4><p>é™¤äº†ä¸Šè¿°è‡ªå®šä¹‰ç¼“å­˜çš„æ–¹å¼ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡å®ç°ä½ è‡ªå·±çš„ç¼“å­˜ï¼Œæˆ–ä¸ºå…¶ä»–ç¬¬ä¸‰æ–¹ç¼“å­˜æ–¹æ¡ˆåˆ›å»ºé€‚é…å™¨ï¼Œæ¥å®Œå…¨è¦†ç›–ç¼“å­˜è¡Œä¸ºã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.domain.something.MyCustomCache<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><p>è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰çš„ç¼“å­˜å®ç°ã€‚type å±æ€§æŒ‡å®šçš„ç±»å¿…é¡»å®ç° org.apache.ibatis.cache.Cache æ¥å£ï¼Œä¸”æä¾›ä¸€ä¸ªæ¥å— String å‚æ•°ä½œä¸º id çš„æ„é€ å™¨ã€‚ è¿™ä¸ªæ¥å£æ˜¯ MyBatis æ¡†æ¶ä¸­è®¸å¤šå¤æ‚çš„æ¥å£ä¹‹ä¸€ï¼Œä½†æ˜¯è¡Œä¸ºå´éå¸¸ç®€å•ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Cache</span> <span class="token punctuation">&#123;</span>  <span class="token class-name">String</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> <span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">void</span> <span class="token function">putObject</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">Object</span> <span class="token function">getObject</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">boolean</span> <span class="token function">hasKey</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">Object</span> <span class="token function">removeObject</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>ä¸ºäº†å¯¹ä½ çš„ç¼“å­˜è¿›è¡Œé…ç½®ï¼Œåªéœ€è¦ç®€å•åœ°åœ¨ä½ çš„ç¼“å­˜å®ç°ä¸­æ·»åŠ å…¬æœ‰çš„ JavaBean å±æ€§ï¼Œç„¶åé€šè¿‡ cache å…ƒç´ ä¼ é€’å±æ€§å€¼ï¼Œä¾‹å¦‚ï¼Œä¸‹é¢çš„ä¾‹å­å°†åœ¨ä½ çš„ç¼“å­˜å®ç°ä¸Šè°ƒç”¨ä¸€ä¸ªåä¸º <code>setCacheFile(String file)</code> çš„æ–¹æ³•ï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.domain.something.MyCustomCache<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cacheFile<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/tmp/my-custom-cache.tmp<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cache</span><span class="token punctuation">></span></span></code></pre><p>ä½ å¯ä»¥ä½¿ç”¨æ‰€æœ‰ç®€å•ç±»å‹ä½œä¸º JavaBean å±æ€§çš„ç±»å‹ï¼ŒMyBatis ä¼šè¿›è¡Œè½¬æ¢ã€‚ ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å ä½ç¬¦ï¼ˆå¦‚ <code>$&#123;cache.file&#125;</code>ï¼‰ï¼Œä»¥ä¾¿æ›¿æ¢æˆåœ¨<a href="https://mybatis.org/mybatis-3/zh/configuration.html#properties">é…ç½®æ–‡ä»¶å±æ€§</a>ä¸­å®šä¹‰çš„å€¼ã€‚</p><p>ä»ç‰ˆæœ¬ 3.4.2 å¼€å§‹ï¼ŒMyBatis å·²ç»æ”¯æŒåœ¨æ‰€æœ‰å±æ€§è®¾ç½®å®Œæ¯•ä¹‹åï¼Œè°ƒç”¨ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ã€‚ å¦‚æœæƒ³è¦ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œè¯·åœ¨ä½ çš„è‡ªå®šä¹‰ç¼“å­˜ç±»é‡Œå®ç° <code>org.apache.ibatis.builder.InitializingObject</code> æ¥å£ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">InitializingObject</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>æç¤º</strong> ä¸Šä¸€èŠ‚ä¸­å¯¹ç¼“å­˜çš„é…ç½®ï¼ˆå¦‚æ¸…é™¤ç­–ç•¥ã€å¯è¯»æˆ–å¯è¯»å†™ç­‰ï¼‰ï¼Œä¸èƒ½åº”ç”¨äºè‡ªå®šä¹‰ç¼“å­˜ã€‚</p><p>è¯·æ³¨æ„ï¼Œç¼“å­˜çš„é…ç½®å’Œç¼“å­˜å®ä¾‹ä¼šè¢«ç»‘å®šåˆ° SQL æ˜ å°„æ–‡ä»¶çš„å‘½åç©ºé—´ä¸­ã€‚ å› æ­¤ï¼ŒåŒä¸€å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰è¯­å¥å’Œç¼“å­˜å°†é€šè¿‡å‘½åç©ºé—´ç»‘å®šåœ¨ä¸€èµ·ã€‚ æ¯æ¡è¯­å¥å¯ä»¥è‡ªå®šä¹‰ä¸ç¼“å­˜äº¤äº’çš„æ–¹å¼ï¼Œæˆ–å°†å®ƒä»¬å®Œå…¨æ’é™¤äºç¼“å­˜ä¹‹å¤–ï¼Œè¿™å¯ä»¥é€šè¿‡åœ¨æ¯æ¡è¯­å¥ä¸Šä½¿ç”¨ä¸¤ä¸ªç®€å•å±æ€§æ¥è¾¾æˆã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯­å¥ä¼šè¿™æ ·æ¥é…ç½®ï¼š</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">...</span> <span class="token attr-name">flushCache</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">useCache</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">...</span> <span class="token attr-name">flushCache</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">...</span> <span class="token attr-name">flushCache</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">...</span> <span class="token attr-name">flushCache</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><p>é‰´äºè¿™æ˜¯é»˜è®¤è¡Œä¸ºï¼Œæ˜¾ç„¶ä½ æ°¸è¿œä¸åº”è¯¥ä»¥è¿™æ ·çš„æ–¹å¼æ˜¾å¼é…ç½®ä¸€æ¡è¯­å¥ã€‚ä½†å¦‚æœä½ æƒ³æ”¹å˜é»˜è®¤çš„è¡Œä¸ºï¼Œåªéœ€è¦è®¾ç½® flushCache å’Œ useCache å±æ€§ã€‚æ¯”å¦‚ï¼ŒæŸäº›æƒ…å†µä¸‹ä½ å¯èƒ½å¸Œæœ›ç‰¹å®š select è¯­å¥çš„ç»“æœæ’é™¤äºç¼“å­˜ä¹‹å¤–ï¼Œæˆ–å¸Œæœ›ä¸€æ¡ select è¯­å¥æ¸…ç©ºç¼“å­˜ã€‚ç±»ä¼¼åœ°ï¼Œä½ å¯èƒ½å¸Œæœ›æŸäº› update è¯­å¥æ‰§è¡Œæ—¶ä¸è¦åˆ·æ–°ç¼“å­˜ã€‚</p><h4 id="cache-ref">cache-ref</h4><p>å›æƒ³ä¸€ä¸‹ä¸Šä¸€èŠ‚çš„å†…å®¹ï¼Œå¯¹æŸä¸€å‘½åç©ºé—´çš„è¯­å¥ï¼Œåªä¼šä½¿ç”¨è¯¥å‘½åç©ºé—´çš„ç¼“å­˜è¿›è¡Œç¼“å­˜æˆ–åˆ·æ–°ã€‚ ä½†ä½ å¯èƒ½ä¼šæƒ³è¦åœ¨å¤šä¸ªå‘½åç©ºé—´ä¸­å…±äº«ç›¸åŒçš„ç¼“å­˜é…ç½®å’Œå®ä¾‹ã€‚è¦å®ç°è¿™ç§éœ€æ±‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ cache-ref å…ƒç´ æ¥å¼•ç”¨å¦ä¸€ä¸ªç¼“å­˜ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache-ref</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.someone.application.data.SomeMapper<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre>]]></content>
    
    
    <summary type="html">MyBatiså­¦ä¹ ç¬”è®°</summary>
    
    
    
    <category term="java web" scheme="https://trevoewu.github.io/categories/java-web/"/>
    
    
    <category term="MyBatis" scheme="https://trevoewu.github.io/tags/MyBatis/"/>
    
    <category term="Java Web" scheme="https://trevoewu.github.io/tags/Java-Web/"/>
    
  </entry>
  
  <entry>
    <title>è¶…å¸‚ç®¡ç†ç³»ç»Ÿ</title>
    <link href="https://trevoewu.github.io/2023/05/15/%E8%B6%85%E5%B8%82%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"/>
    <id>https://trevoewu.github.io/2023/05/15/%E8%B6%85%E5%B8%82%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/</id>
    <published>2023-05-15T13:15:33.000Z</published>
    <updated>2023-05-19T13:42:46.033Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å®æˆ˜-è¶…å¸‚è®¢å•ç®¡ç†ç³»ç»Ÿ">å®æˆ˜: è¶…å¸‚è®¢å•ç®¡ç†ç³»ç»Ÿ</h2><p>ä¸ºäº†æ–¹ä¾¿è¡¨è¿°å’Œç†è§£, åœ¨ç¼–å†™MVCä¸‰å±‚å¯¹åº”çš„ä»£ç æ—¶, ä½¿ç”¨è‡ªé¡¶å‘ä¸‹, ä½†åœ¨å®é™…çš„é¡¹ç›®ä¸­, ç¼–å†™ä»£ç å·¥ä½œå¾€å¾€æ˜¯è‡ªåº•å‘ä¸Šçš„.</p><h3 id="æ­å»ºé¡¹ç›®æ¡†æ¶">æ­å»ºé¡¹ç›®æ¡†æ¶</h3><p><img src="%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6.png" alt="æœªå‘½åæ–‡ä»¶" loading="lazy"></p><h4 id="ç¼–å†™æ•°æ®åº“æ“ä½œçš„åŸºç¡€å…¬å…±ç±»DB">ç¼–å†™æ•°æ®åº“æ“ä½œçš„åŸºç¡€å…¬å…±ç±»DB</h4><ul><li><p>æ•°æ®åº“é…ç½®æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªèµ„æºæ–‡ä»¶ï¼Œåº”è¯¥åˆ›å»ºåœ¨mavené¡¹ç›®çš„resourcesæ–‡ä»¶ä¸­</p><pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">DRIVER</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span><span class="token key attr-name">URL</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3307/smbms?useUnicode=true&amp;characterEncoding=utf-8</span><span class="token key attr-name">USERNAME</span><span class="token punctuation">=</span><span class="token value attr-value">root</span><span class="token key attr-name">PASSWORD</span><span class="token punctuation">=</span></code></pre></li><li><p>ä½¿ç”¨é™æ€ä»£ç å—å®ç°åˆå§‹åŒ–å‚æ•°</p><p>è¯¥ç±»ä¸ºæ•°æ®åº“è®¿é—®å·¥å…·ç±»ï¼Œæä¾›äº†è·å–æ•°æ®åº“è¿æ¥ã€æ‰§è¡ŒæŸ¥è¯¢å’Œæ›´æ–°ç­‰å¸¸ç”¨æ“ä½œçš„æ–¹æ³•ã€‚</p><ol><li><p>ç±»åï¼šDB</p></li><li><p>å±æ€§ï¼š</p></li></ol><ul><li>DRIVERï¼šStringç±»å‹ï¼Œè¡¨ç¤ºæ•°æ®åº“é©±åŠ¨åã€‚</li><li>URLï¼šStringç±»å‹ï¼Œè¡¨ç¤ºæ•°æ®åº“è¿æ¥åœ°å€ã€‚</li><li>USERNAMEï¼šStringç±»å‹ï¼Œè¡¨ç¤ºè¿æ¥æ•°æ®åº“çš„ç”¨æˆ·åã€‚</li><li>PASSWORDï¼šStringç±»å‹ï¼Œè¡¨ç¤ºè¿æ¥æ•°æ®åº“çš„å¯†ç ã€‚</li></ul><ol start="3"><li>æ–¹æ³•ï¼š</li></ol><ul><li>closeï¼šç”¨äºé‡Šæ”¾æ•°æ®åº“è¿æ¥ã€é¢„å¤„ç†è¯­å¥å’Œç»“æœé›†èµ„æºã€‚</li><li>getConnectionï¼šç”¨äºè·å–æ•°æ®åº“è¿æ¥ã€‚</li><li>executeQueryï¼šç”¨äºæ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œè¿”å›ä¸€ä¸ªç»“æœé›†ã€‚</li><li>executeUpdateï¼šç”¨äºæ‰§è¡Œæ›´æ–°æ“ä½œï¼Œè¿”å›å—å½±å“çš„è¡Œæ•°ã€‚</li></ul><ol start="4"><li>æ–¹æ³•çš„å‚æ•°ï¼š</li></ol><ul><li>connï¼šConnectionç±»å‹ï¼Œè¡¨ç¤ºæ•°æ®åº“è¿æ¥ã€‚</li><li>pstmtï¼šPreparedStatementç±»å‹ï¼Œè¡¨ç¤ºé¢„å¤„ç†è¯­å¥ã€‚</li><li>resSetï¼šResultSetç±»å‹ï¼Œè¡¨ç¤ºç»“æœé›†ã€‚</li><li>queryï¼šStringç±»å‹ï¼Œè¡¨ç¤ºè¦æ‰§è¡Œçš„SQLè¯­å¥ã€‚</li><li>paramsï¼šObject[]ç±»å‹ï¼Œè¡¨ç¤ºSQLè¯­å¥ä¸­çš„å‚æ•°å€¼ã€‚</li></ul><p>åœ¨ç±»ä¸­è¿˜å®šä¹‰äº†ä¸€ä¸ªé™æ€ä»£ç å—ï¼Œè¯¥ä»£ç å—åœ¨ç±»åŠ è½½æ—¶ä¼šè¢«æ‰§è¡Œã€‚é™æ€ä»£ç å—ä¸­çš„ä¸»è¦ä½œç”¨æ˜¯è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®åº“è¿æ¥å‚æ•°ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ç±»çš„é™æ€å±æ€§ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><ul><li>åˆ›å»ºPropertieså¯¹è±¡ã€‚</li><li>é€šè¿‡ç±»åŠ è½½å™¨åŠ è½½é…ç½®æ–‡ä»¶ä¸ºå­—èŠ‚è¾“å…¥æµã€‚</li><li>ä½¿ç”¨Propertieså¯¹è±¡çš„load()æ–¹æ³•åŠ è½½å­—èŠ‚è¾“å…¥æµä¸­çš„å†…å®¹ã€‚</li><li>ä»Propertieså¯¹è±¡ä¸­è·å–æ•°æ®åº“è¿æ¥å‚æ•°ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ç±»çš„é™æ€å±æ€§ã€‚</li></ul><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥åœ¨ä¸ä¿®æ”¹Javaä»£ç çš„æƒ…å†µä¸‹ï¼Œæ›´æ”¹æ•°æ®åº“è¿æ¥å‚æ•°ï¼Œæé«˜äº†ä»£ç çš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DB</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">DRIVER</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">URL</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">USERNAME</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">PASSWORD</span><span class="token punctuation">;</span>    <span class="token comment">//é™æ€ä»£ç å—ï¼Œ ç±»åŠ è½½çš„æ—¶å€™æ‰§è¡Œ</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//è¯»å–é…ç½®æ–‡ä»¶</span>        <span class="token comment">//1ã€åˆ›å»ºpropertieså¯¹è±¡</span>        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2ã€é€šè¿‡ç±»åŠ è½½å™¨åŠ è½½èµ„æºæ–‡ä»¶ä¸ºå­—èŠ‚è¾“å…¥æµ</span>        <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"db.properties"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token constant">DRIVER</span> <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"DRIVER"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">URL</span> <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"URL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">USERNAME</span> <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"USERNAME"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">PASSWORD</span> <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"PASSWORD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre></li><li><p>ç¼–å†™æ•°æ®åº“æ“ä½œçš„å…¬å…±æ–¹æ³•</p><p>è¯¥ç±»ä¸ºæ•°æ®åº“è®¿é—®å·¥å…·ç±»ï¼Œæä¾›äº†è·å–æ•°æ®åº“è¿æ¥ã€æ‰§è¡ŒæŸ¥è¯¢å’Œæ›´æ–°ç­‰å¸¸ç”¨æ“ä½œçš„æ–¹æ³•ã€‚</p><ol><li><p>ç±»åï¼šDB</p></li><li><p>å±æ€§ï¼š</p></li></ol><ul><li>DRIVERï¼šStringç±»å‹ï¼Œè¡¨ç¤ºæ•°æ®åº“é©±åŠ¨åã€‚</li><li>URLï¼šStringç±»å‹ï¼Œè¡¨ç¤ºæ•°æ®åº“è¿æ¥åœ°å€ã€‚</li><li>USERNAMEï¼šStringç±»å‹ï¼Œè¡¨ç¤ºè¿æ¥æ•°æ®åº“çš„ç”¨æˆ·åã€‚</li><li>PASSWORDï¼šStringç±»å‹ï¼Œè¡¨ç¤ºè¿æ¥æ•°æ®åº“çš„å¯†ç ã€‚</li></ul><ol start="3"><li>æ–¹æ³•ï¼š</li></ol><ul><li>closeï¼šç”¨äºé‡Šæ”¾æ•°æ®åº“è¿æ¥ã€é¢„å¤„ç†è¯­å¥å’Œç»“æœé›†èµ„æºã€‚</li><li>getConnectionï¼šç”¨äºè·å–æ•°æ®åº“è¿æ¥ã€‚</li><li>executeQueryï¼šç”¨äºæ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œè¿”å›ä¸€ä¸ªç»“æœé›†ã€‚</li><li>executeUpdateï¼šç”¨äºæ‰§è¡Œæ›´æ–°æ“ä½œï¼Œè¿”å›å—å½±å“çš„è¡Œæ•°ã€‚</li></ul><ol start="4"><li>æ–¹æ³•çš„å‚æ•°ï¼š</li></ol><ul><li>connï¼šConnectionç±»å‹ï¼Œè¡¨ç¤ºæ•°æ®åº“è¿æ¥ã€‚</li><li>pstmtï¼šPreparedStatementç±»å‹ï¼Œè¡¨ç¤ºé¢„å¤„ç†è¯­å¥ã€‚</li><li>resSetï¼šResultSetç±»å‹ï¼Œè¡¨ç¤ºç»“æœé›†ã€‚</li><li>queryï¼šStringç±»å‹ï¼Œè¡¨ç¤ºè¦æ‰§è¡Œçš„SQLè¯­å¥ã€‚</li><li>paramsï¼šObject[]ç±»å‹ï¼Œè¡¨ç¤ºSQLè¯­å¥ä¸­çš„å‚æ•°å€¼ã€‚</li></ul><p>è¯¥ç±»è¿˜åŒ…å«ä¸€ä¸ªé™æ€ä»£ç å—ï¼Œç”¨äºåˆå§‹åŒ–æ•°æ®åº“è¿æ¥å‚æ•°ï¼Œä½†ä»£ç å—çš„å†…å®¹æœªç»™å‡ºï¼Œéœ€è¦è¿›è¡Œè¡¥å……ã€‚</p><p><em>åŒæ—¶éœ€è¦æ³¨æ„ï¼Œè¯¥ç±»å¹¶æ²¡æœ‰å®ç°å•ä¾‹æ¨¡å¼ï¼Œæ¯æ¬¡è·å–æ•°æ®åº“è¿æ¥éƒ½ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚</em></p></li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">util</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DB</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">DRIVER</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">URL</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">USERNAME</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">PASSWORD</span><span class="token punctuation">;</span>  <span class="token comment">/*      é™æ€ä»£ç å—ï¼Œ ç±»åŠ è½½çš„æ—¶å€™æ‰§è¡Œ  */</span>    <span class="token comment">//é‡Šæ”¾é“¾æ¥èµ„æº</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">PreparedStatement</span> pstmt<span class="token punctuation">,</span> <span class="token class-name">ResultSet</span> resSet<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>resSet <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            resSet<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>pstmt <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            pstmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//è·å–æ•°æ®åº“é“¾æ¥</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token constant">DRIVER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token constant">USERNAME</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token constant">PASSWORD</span><span class="token punctuation">;</span>        <span class="token comment">// 2.è¿æ¥æ•°æ®åº“,ä»£è¡¨æ•°æ®åº“</span>        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span>  connection<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æ‰§è¡ŒæŸ¥è¯¢, è¿”å›ç»“æœé›†</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ResultSet</span> <span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span><span class="token class-name">String</span> query<span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">&#123;</span>        <span class="token class-name">ResultSet</span> resultSet <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>query<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> params <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//é¢„å¤„ç†</span>            <span class="token class-name">PreparedStatement</span> statement <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> params<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//è®¾ç½®SQL è¯­å¥ä¸­çš„å‚æ•°</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    statement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Integer</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    statement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    statement<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">//æ‰§è¡Œ</span>            resultSet <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> resultSet<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æ‰§è¡Œæ›´æ–°ï¼Œ è¿”å›å½±å“è¡Œæ•°</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span><span class="token class-name">String</span> query<span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> affectedRows <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>query<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> params <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//é¢„å¤„ç†</span>            <span class="token class-name">PreparedStatement</span> statement <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> params<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//è®¾ç½®SQL è¯­å¥ä¸­çš„å‚æ•°</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    statement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Integer</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    statement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    statement<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">//æ‰§è¡Œ</span>             affectedRows <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> affectedRows<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="ç™»å½•åŠŸèƒ½å®ç°">ç™»å½•åŠŸèƒ½å®ç°</h3><h4 id="å‰ç«¯é¡µé¢ç¼–å†™">å‰ç«¯é¡µé¢ç¼–å†™</h4><p>å‰ç«¯é¡µé¢ç”±kuangæä¾›</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;%-- header--%&gt;&lt;form class&#x3D;&quot;loginForm&quot; action&#x3D;&quot;$&#123;pageContext.request.contextPath&#125;&#x2F;login.do&quot; name&#x3D;&quot;actionForm&quot; id&#x3D;&quot;actionForm&quot; method&#x3D;&quot;post&quot;&gt;  &lt;div class&#x3D;&quot;info&quot;&gt;$&#123;error&#125;&lt;&#x2F;div&gt;  &lt;div class&#x3D;&quot;inputbox&quot;&gt;      &lt;label&gt;ç”¨æˆ·åï¼š&lt;&#x2F;label&gt;      &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;input-text&quot; id&#x3D;&quot;userCode&quot; name&#x3D;&quot;userCode&quot; placeholder&#x3D;&quot;è¯·è¾“å…¥ç”¨æˆ·å&quot; required&#x2F;&gt;  &lt;&#x2F;div&gt;  &lt;div class&#x3D;&quot;inputbox&quot;&gt;      &lt;label&gt;å¯†ç ï¼š&lt;&#x2F;label&gt;      &lt;input type&#x3D;&quot;password&quot; id&#x3D;&quot;userPassword&quot; name&#x3D;&quot;userPassword&quot; placeholder&#x3D;&quot;è¯·è¾“å…¥å¯†ç &quot; required&#x2F;&gt;  &lt;&#x2F;div&gt;  &lt;div class&#x3D;&quot;subBtn&quot;&gt;      &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;ç™»å½•&quot;&#x2F;&gt;      &lt;input type&#x3D;&quot;reset&quot; value&#x3D;&quot;é‡ç½®&quot;&#x2F;&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;form&gt;&lt;%-- footer--%&gt;</code></pre><h4 id="ç™»å½•å¤„ç†Servletå®ç°">ç™»å½•å¤„ç†Servletå®ç°</h4><p>åœ¨å‰ç«¯formè¡¨å•çš„actionå±æ€§å€¼æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æäº¤çš„URL, æ‰€ä»¥, æˆ‘ä»¬éœ€è¦ç¼–å†™å¯¹åº”çš„Servletæ¥å¤„ç†è¿™ä¸ªè¯·æ±‚</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">action&#x3D;&quot;$&#123;pageContext.request.contextPath&#125;&#x2F;login.do&quot;</code></pre><ul><li><p>åˆ›å»ºç™»å½•å¤„ç†Servlet</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªåä¸ºâ€œLoginâ€çš„Java servletç±»ï¼Œç”¨äºå¤„ç†HTTP GETè¯·æ±‚ã€‚è¯¥ç±»åŒ…æ‹¬å¯¹â€œUserServiceâ€å®ä¾‹çš„å¼•ç”¨ï¼Œè¯¥å®ä¾‹ç”¨äºä»æ•°æ®åº“ä¸­æ£€ç´¢ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>åœ¨â€œdoGetâ€æ–¹æ³•ä¸­ï¼Œservletä»HTTPè¯·æ±‚ä¸­æ£€ç´¢userCodeå’Œpasswordå‚æ•°ã€‚ç„¶åå®ƒåˆ›å»ºä¸€ä¸ªâ€œUserServiceImplâ€ç±»çš„æ–°å®ä¾‹ï¼ˆè¯¥ç±»å®ç°äº†â€œUserServiceâ€æ¥å£ï¼‰ï¼Œå¹¶è°ƒç”¨å…¶â€œfindByUserCodeâ€æ–¹æ³•ï¼Œä»¥æ ¹æ®ç»™å®šçš„ç”¨æˆ·ä»£ç ä»æ•°æ®åº“ä¸­æ£€ç´¢ç”¨æˆ·å¯¹è±¡ã€‚</p><p>å¦‚æœç”¨æˆ·å¯¹è±¡ä¸ä¸ºnullï¼Œåˆ™servletæ£€æŸ¥ç”¨æˆ·å¯†ç æ˜¯å¦ä¸ç»™å®šå¯†ç åŒ¹é…ã€‚å¦‚æœåŒ¹é…ï¼Œåˆ™servletä½¿ç”¨ç”¨æˆ·å¯¹è±¡è®¾ç½®åä¸ºâ€œUSER_SESSIONâ€çš„ä¼šè¯å±æ€§ï¼Œå¹¶å°†ç”¨æˆ·é‡å®šå‘åˆ°â€œ/jsp/frame.jspâ€ã€‚å¦‚æœå¯†ç ä¸åŒ¹é…ï¼Œåˆ™servletä½¿ç”¨é”™è¯¯æ¶ˆæ¯è®¾ç½®åä¸ºâ€œerrorâ€çš„ä¼šè¯å±æ€§ï¼Œå¹¶å°†ç”¨æˆ·é‡å®šå‘å›â€œ/login.jspâ€ã€‚</p><p><em>è¯·æ³¨æ„ï¼Œæ­¤ä»£ç ç‰‡æ®µä¸å®Œæ•´ï¼Œå› ä¸ºå®ƒç¼ºå°‘æœ‰å…³å¯¼å…¥ï¼Œå®ƒæ‰€ä¾èµ–çš„æ¥å£å’Œç±»ï¼Œä»¥åŠservleté…ç½®çš„ä¿¡æ¯ã€‚</em></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Login</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">UserService</span> service<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> userCode <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"userCode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"userPassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        user <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">findByUserCode</span><span class="token punctuation">(</span>userCode<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">,</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>                resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/jsp/frame.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span><span class="token string">"username or password incorrect"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/login.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span></code></pre></li><li><p>æ˜ å°„ servlet</p><p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ª servlet é…ç½®çš„ XML éƒ¨åˆ†ï¼Œå®ƒç”¨äºå°†è¯·æ±‚çš„ URL æ˜ å°„åˆ°ç‰¹å®šçš„ servlet ä¸Šã€‚è¿™æ®µé…ç½®æŒ‡å®šäº†ä¸€ä¸ªåä¸º â€œLoginâ€ çš„ servletï¼Œä½¿ç”¨äº†å®Œæ•´çš„ç±»å <code>servlet.Login</code>ï¼Œå¹¶å°†å®ƒæ˜ å°„åˆ° URL â€œ/login.doâ€ ä¸Šã€‚</p><p>è¿™æ„å‘³ç€ï¼Œå½“ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è®¿é—® â€œ/login.doâ€ æ—¶ï¼Œå®¹å™¨å°†è°ƒç”¨ <code>servlet.Login</code> çš„ service() æ–¹æ³•æ¥å¤„ç†è¯¥è¯·æ±‚ã€‚æ˜ å°„ servlet çš„æ“ä½œæ˜¯ web åº”ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒåœ¨ web.xml æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>servlet.Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/login.do<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre></li><li><p>ç¼–å†™Serviceå±‚ä»£ç </p><p>è¯¥ä»£ç æ˜¯ä¸€ä¸ª Java ç±» <code>UserServiceImpl</code>ï¼Œå®ç°äº†ä¸€ä¸ªæ¥å£ <code>UserService</code>ã€‚è¯¥ç±»åŒ…å«äº†ä¸¤ä¸ªæ–¹æ³•ï¼š</p><ol><li><code>findByUserCode(String userCode)</code>ï¼šæŸ¥æ‰¾æ•°æ®åº“ä¸­å¯¹åº”ç”¨æˆ·çš„ä¿¡æ¯ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª <code>User</code> å¯¹è±¡ã€‚</li><li><code>updateUser(Integer id, String key, String value)</code>ï¼šæ›´æ–°æ•°æ®åº“ä¸­ç”¨æˆ·çš„ä¿¡æ¯ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª <code>boolean</code> ç±»å‹çš„å€¼ï¼Œè¡¨ç¤ºæ›´æ–°æ˜¯å¦æˆåŠŸã€‚</li></ol><p>åœ¨è¿™ä¸ªç±»ä¸­ï¼Œç§æœ‰æˆå‘˜å˜é‡ <code>dao</code> æ˜¯ä¸€ä¸ª <code>UserDao</code> ç±»å‹çš„å˜é‡ï¼Œé€šè¿‡è¯¥å˜é‡è°ƒç”¨ <code>UserDaoImpl</code> ç±»ä¸­çš„æ–¹æ³•æ¥è®¿é—®æ•°æ®åº“ã€‚åœ¨ <code>findByUserCode</code> å’Œ <code>updateUser</code> æ–¹æ³•ä¸­ï¼Œéƒ½éœ€è¦å…ˆé€šè¿‡ <code>dao</code> å®ä¾‹åŒ–ä¸€ä¸ª <code>UserDaoImpl</code> å¯¹è±¡æ¥è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> dao<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findByUserCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> userCode<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        dao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">findByUserCode</span><span class="token punctuation">(</span>userCode<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span>  user<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> value<span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>        dao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        i <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">updateUser</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> i <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre></li><li><p>DAOå±‚ä»£ç </p><p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªDaoå±‚çš„å®ç°ç±»ï¼Œç”¨äºå’Œæ•°æ®åº“äº¤äº’ï¼Œæä¾›äº†å¯¹Userè¡¨çš„æŸ¥è¯¢å’Œæ›´æ–°æ–¹æ³•ã€‚ä¸‹é¢æ˜¯ä»£ç çš„åˆ†æï¼š</p><ul><li><code>findByUserCode(String userCode)</code> æ–¹æ³•ï¼šæ ¹æ®ä¼ å…¥çš„ç”¨æˆ·åå‚æ•° <code>userCode</code> æŸ¥è¯¢å¯¹åº”çš„ç”¨æˆ·è®°å½•ï¼Œå¹¶è¿”å›ä¸€ä¸ªUserå¯¹è±¡ã€‚è¯¥æ–¹æ³•ä½¿ç”¨äº†æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯ï¼Œåœ¨æ‰§è¡Œå®ŒæŸ¥è¯¢åä¼šå…³é—­è¿æ¥ã€‚æ–¹æ³•ä¸­é¦–å…ˆåˆå§‹åŒ–å‚æ•°ï¼Œç„¶åæ‰§è¡ŒSQLè¯­å¥æŸ¥è¯¢ç»“æœé›†ï¼Œéå†ç»“æœé›†å°†æ•°æ®å°è£…åˆ°Userå¯¹è±¡ä¸­ï¼Œæœ€åå…³é—­è¿æ¥å’Œç»“æœé›†ï¼Œè¿”å›Userå¯¹è±¡ã€‚</li><li><code>updateUser(Integer id, String key,String value)</code> æ–¹æ³•ï¼šæ ¹æ®ä¼ å…¥çš„å‚æ•°æ›´æ–°Userè¡¨ä¸­çš„æ•°æ®ã€‚è¯¥æ–¹æ³•ä¹Ÿä½¿ç”¨äº†æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯ï¼Œåœ¨æ‰§è¡Œå®Œæ›´æ–°åä¼šå…³é—­è¿æ¥ã€‚æ–¹æ³•ä¸­é¦–å…ˆåˆ¤æ–­ä¼ å…¥çš„å‚æ•°æ˜¯å¦ä¸ºç©ºï¼Œç„¶åæ‰§è¡ŒSQLè¯­å¥æ›´æ–°æ•°æ®ï¼Œæœ€åå…³é—­è¿æ¥ï¼Œè¿”å›æ›´æ–°ç»“æœçš„å½±å“è¡Œæ•°ã€‚</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDao</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Connection</span> conn<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> sql<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findByUserCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> userCode<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//2. åˆå§‹åŒ–å‚æ•°</span>        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>userCode<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token class-name">ResultSet</span> set<span class="token punctuation">;</span>        sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM smbms_user Where userCode = ?"</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            conn <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            set <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">,</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>set <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    user<span class="token punctuation">.</span><span class="token function">setUserPassword</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userPassword"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//ä¸€å¤§ä¸²èµ‹å€¼ä»£ç ...</span>                    user<span class="token punctuation">.</span><span class="token function">setWorkPicPath</span><span class="token punctuation">(</span><span class="token string">"workPicPath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">//å…³é—­é“¾æ¥å’Œç»“æœé›†</span>            <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> user<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> affectedRow <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token operator">&amp;&amp;</span> value <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            sql <span class="token operator">=</span> <span class="token string">"UPDATE smbms_user SET "</span><span class="token operator">+</span>key<span class="token operator">+</span><span class="token string">" = ? WHERE id = ? "</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>value<span class="token punctuation">,</span>id<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                conn <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                affectedRow <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> affectedRow<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre></li></ul><h3 id="å¯†ç ä¿®æ”¹å®ç°">å¯†ç ä¿®æ”¹å®ç°</h3><h4 id="å‰ç«¯é¡µé¢">å‰ç«¯é¡µé¢</h4><p><strong>JSPéƒ¨åˆ†: é¡µé¢æ˜¾ç¤º</strong></p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ page contentType&#x3D;&quot;text&#x2F;html;charset&#x3D;UTF-8&quot; language&#x3D;&quot;java&quot; %&gt;&lt;%@include file&#x3D;&quot;&#x2F;jsp&#x2F;common&#x2F;head.jsp&quot; %&gt;&lt;div class&#x3D;&quot;right&quot;&gt;    &lt;div class&#x3D;&quot;location&quot;&gt;        &lt;strong&gt;ä½ ç°åœ¨æ‰€åœ¨çš„ä½ç½®æ˜¯:&lt;&#x2F;strong&gt;        &lt;span&gt;å¯†ç ä¿®æ”¹é¡µé¢&lt;&#x2F;span&gt;    &lt;&#x2F;div&gt;    &lt;div class&#x3D;&quot;providerAdd&quot;&gt;        &lt;form id&#x3D;&quot;userForm&quot; name&#x3D;&quot;userForm&quot; method&#x3D;&quot;post&quot; action&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;jsp&#x2F;user.do&quot;&gt;            &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;method&quot; value&#x3D;&quot;savepwd&quot;&#x2F;&gt;            &lt;!--divçš„class ä¸ºerroræ˜¯éªŒè¯é”™è¯¯ï¼Œokæ˜¯éªŒè¯æˆåŠŸ--&gt;            &lt;div class&#x3D;&quot;info&quot;&gt;$&#123;message&#125;&lt;&#x2F;div&gt;            &lt;div class&#x3D;&quot;&quot;&gt;                &lt;label for&#x3D;&quot;oldPassword&quot;&gt;æ—§å¯†ç ï¼š&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;oldpassword&quot; id&#x3D;&quot;oldpassword&quot; value&#x3D;&quot;&quot;&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;                &lt;label for&#x3D;&quot;newPassword&quot;&gt;æ–°å¯†ç ï¼š&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;newpassword&quot; id&#x3D;&quot;newpassword&quot; value&#x3D;&quot;&quot;&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;                &lt;label for&#x3D;&quot;newPassword&quot;&gt;ç¡®è®¤æ–°å¯†ç ï¼š&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;rnewpassword&quot; id&#x3D;&quot;rnewpassword&quot; value&#x3D;&quot;&quot;&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div class&#x3D;&quot;providerAddBtn&quot;&gt;                &lt;!--&lt;a href&#x3D;&quot;#&quot;&gt;ä¿å­˜&lt;&#x2F;a&gt;--&gt;                &lt;input type&#x3D;&quot;button&quot; name&#x3D;&quot;save&quot; id&#x3D;&quot;save&quot; value&#x3D;&quot;ä¿å­˜&quot; class&#x3D;&quot;input-button&quot;&gt;            &lt;&#x2F;div&gt;        &lt;&#x2F;form&gt;    &lt;&#x2F;div&gt;&lt;&#x2F;div&gt;&lt;&#x2F;section&gt;&lt;%@include file&#x3D;&quot;&#x2F;jsp&#x2F;common&#x2F;foot.jsp&quot; %&gt;&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;statics&#x2F;js&#x2F;pwdmodify.js&quot;&gt;&lt;&#x2F;script&gt;</code></pre><p>è¿™æ˜¯ä¸€ä¸ªç”¨ JSPï¼ˆJavaServer Pagesï¼‰ç¼–å†™çš„ç½‘é¡µä»£ç ï¼Œç”¨äºä¿®æ”¹å¯†ç ã€‚é¡µé¢åŒ…æ‹¬ä¸€ä¸ªè¡¨å•ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­è¾“å…¥æ—§å¯†ç ã€æ–°å¯†ç å’Œç¡®è®¤æ–°å¯†ç ã€‚è¡¨å•ä½¿ç”¨POSTæ–¹æ³•æäº¤åˆ°æœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨â€œ/jsp/user.doâ€ URLã€‚</p><p>é¡µé¢åŒ…æ‹¬ä¸€ä¸ªæ¶ˆæ¯åŒºåŸŸï¼Œç”¨äºæ˜¾ç¤ºä»»ä½•é”™è¯¯æ¶ˆæ¯ã€‚é¡µé¢è¿˜åŒ…æ‹¬æŒ‡å‘åä¸ºâ€œpwdmodify.jsâ€çš„ JavaScript æ–‡ä»¶çš„é“¾æ¥ã€‚è¿™ä¸ªæ–‡ä»¶åº”è¯¥åŒ…å«è¡¨å•çš„å®¢æˆ·ç«¯éªŒè¯é€»è¾‘ã€‚</p><p>é¡µé¢ä½¿ç”¨ JSP è¡¨è¾¾å¼è¯­è¨€ï¼ˆELï¼‰å°†åŠ¨æ€å†…å®¹æ’å…¥åˆ° HTML ä¸­ã€‚ä¾‹å¦‚ï¼Œé¡µé¢ä½¿ç”¨è¡¨è¾¾å¼ â€œ${pageContext.request.contextPath}/statics/js/pwdmodify.jsâ€ æ’å…¥ä¸€ä¸ªé“¾æ¥åˆ° CSS æ–‡ä»¶ã€‚â€œ${pageContext.request.contextPath}â€ è¡¨è¾¾å¼è®¡ç®—ä¸º web åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡è·¯å¾„ï¼Œç”¨äºæ„é€  CSS æ–‡ä»¶çš„å®Œæ•´ URLã€‚</p><p><strong>JavaScript è¡¨å•çš„å®¢æˆ·ç«¯éªŒè¯é€»è¾‘</strong></p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> oldpassword <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> newpassword <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> rnewpassword <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> saveBtn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   oldpassword <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#oldpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   newpassword <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#newpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   rnewpassword <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#rnewpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   saveBtn <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#save"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   oldpassword<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>         <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span>         <span class="token literal-property property">url</span><span class="token operator">:</span>path<span class="token operator">+</span><span class="token string">"/jsp/user.do"</span><span class="token punctuation">,</span>         <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">"pwdmodify"</span><span class="token punctuation">,</span><span class="token literal-property property">oldpassword</span><span class="token operator">:</span>oldpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>         <span class="token literal-property property">dataType</span><span class="token operator">:</span><span class="token string">"json"</span><span class="token punctuation">,</span>         <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//æ—§å¯†ç æ­£ç¡®</span>               <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//æ—§å¯†ç è¾“å…¥ä¸æ­£ç¡®</span>               <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" åŸå¯†ç è¾“å…¥ä¸æ­£ç¡®"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">"sessionerror"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//å½“å‰ç”¨æˆ·sessionè¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•</span>               <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" å½“å‰ç”¨æˆ·sessionè¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//æ—§å¯†ç è¾“å…¥ä¸ºç©º</span>               <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" è¯·è¾“å…¥æ—§å¯†ç "</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>         <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>         <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//è¯·æ±‚å‡ºé”™</span>            <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" è¯·æ±‚é”™è¯¯"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* è¯·è¾“å…¥åŸå¯†ç "</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   newpassword<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* å¯†ç é•¿åº¦å¿…é¡»æ˜¯å¤§äº6å°äº20"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">5</span>         <span class="token operator">&amp;&amp;</span> newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" å¯†ç è¾“å…¥ä¸ç¬¦åˆè§„èŒƒï¼Œè¯·é‡æ–°è¾“å…¥"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   rnewpassword<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* è¯·è¾“å…¥ä¸ä¸Šé¢ä¸€è‡´çš„å¯†ç "</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">5</span>         <span class="token operator">&amp;&amp;</span> rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token operator">&amp;&amp;</span> newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´ï¼Œè¯·é‡æ–°è¾“å…¥"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   saveBtn<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      oldpassword<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      newpassword<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      rnewpassword<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>         oldpassword<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span> <span class="token operator">&amp;&amp;</span>          newpassword<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span>         <span class="token operator">&amp;&amp;</span> rnewpassword<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">"ç¡®å®šè¦ä¿®æ”¹å¯†ç ï¼Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#userForm"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è¿™æ˜¯ä¸€ä¸ª JavaScript ä»£ç æ®µï¼Œå®ƒä½¿ç”¨ jQuery åº“ä¸ºä¸€ä¸ªåŒ…å«å¯†ç ä¿®æ”¹è¡¨å•çš„ç½‘é¡µæ·»åŠ äº†å®¢æˆ·ç«¯éªŒè¯é€»è¾‘ã€‚ä»£ç ä½¿ç”¨ AJAX æŠ€æœ¯ä»æœåŠ¡å™¨è·å– JSON æ ¼å¼çš„å“åº”æ•°æ®ï¼Œä»¥éªŒè¯ç”¨æˆ·è¾“å…¥çš„æ—§å¯†ç æ˜¯å¦æ­£ç¡®ï¼Œå¹¶åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºç›¸å…³æç¤ºä¿¡æ¯ã€‚</p><p>ä»£ç ä¸­é¦–å…ˆå®šä¹‰äº†å››ä¸ªå˜é‡ï¼Œåˆ†åˆ«æ˜¯æ—§å¯†ç ã€æ–°å¯†ç ã€ç¡®è®¤æ–°å¯†ç å’Œæäº¤æŒ‰é’®çš„ jQuery å¯¹è±¡ã€‚ç„¶åä½¿ç”¨ $() å‡½æ•°å°†ä»£ç åŒ…è£…åœ¨ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­ï¼Œç¡®ä¿ä»£ç åœ¨æ–‡æ¡£åŠ è½½å®Œæˆåæ‰æ‰§è¡Œã€‚å›è°ƒå‡½æ•°å†…éƒ¨åšäº†ä»¥ä¸‹å·¥ä½œï¼š</p><ol><li><p>é€šè¿‡é€‰æ‹©å™¨è·å–é¡µé¢ä¸Šçš„æ—§å¯†ç è¾“å…¥æ¡†ã€æ–°å¯†ç è¾“å…¥æ¡†ã€ç¡®è®¤æ–°å¯†ç è¾“å…¥æ¡†å’Œæäº¤æŒ‰é’®ï¼Œå¹¶å°†å®ƒä»¬çš„ jQuery å¯¹è±¡èµ‹å€¼ç»™å‰é¢å®šä¹‰çš„å››ä¸ªå˜é‡ã€‚</p></li><li><p>ä¸ºæ—§å¯†ç è¾“å…¥æ¡†ç»‘å®š blur äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå½“è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶ï¼Œä½¿ç”¨ $.ajax() å‡½æ•°å‘æœåŠ¡å™¨å‘é€ GET è¯·æ±‚ï¼ŒéªŒè¯ç”¨æˆ·è¾“å…¥çš„æ—§å¯†ç æ˜¯å¦æ­£ç¡®ï¼Œå¹¶æ ¹æ®æœåŠ¡å™¨è¿”å›çš„å“åº”æ•°æ®æ˜¾ç¤ºç›¸åº”çš„æç¤ºä¿¡æ¯ã€‚åœ¨æˆåŠŸå›è°ƒå‡½æ•°ä¸­ï¼Œæ ¹æ® data.result çš„å€¼åˆ¤æ–­æ—§å¯†ç æ˜¯å¦æ­£ç¡®ï¼Œå¹¶é€šè¿‡ validateTip() å‡½æ•°æ˜¾ç¤ºç›¸åº”çš„æç¤ºä¿¡æ¯ã€‚åœ¨å¤±è´¥å›è°ƒå‡½æ•°ä¸­ï¼Œæ˜¾ç¤ºè¯·æ±‚å‡ºé”™çš„æç¤ºä¿¡æ¯ã€‚</p></li><li><p>ä¸ºæ—§å¯†ç è¾“å…¥æ¡†ç»‘å®š focus äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå½“è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹æ—¶ï¼Œæ˜¾ç¤ºè¾“å…¥æç¤ºä¿¡æ¯ã€‚</p></li><li><p>ä¸ºæ–°å¯†ç è¾“å…¥æ¡†ç»‘å®š focus å’Œ blur äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå½“è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹æ—¶ï¼Œæ˜¾ç¤ºè¾“å…¥æç¤ºä¿¡æ¯ï¼›å½“è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶ï¼Œåˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„æ–°å¯†ç æ˜¯å¦ç¬¦åˆè§„èŒƒï¼Œå¦‚æœç¬¦åˆåˆ™æ˜¾ç¤ºæ­£ç¡®æç¤ºï¼Œå¦åˆ™æ˜¾ç¤ºé”™è¯¯æç¤ºã€‚</p></li><li><p>ä¸ºç¡®è®¤æ–°å¯†ç è¾“å…¥æ¡†ç»‘å®š focus å’Œ blur äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå½“è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹æ—¶ï¼Œæ˜¾ç¤ºè¾“å…¥æç¤ºä¿¡æ¯ï¼›å½“è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶ï¼Œåˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„ç¡®è®¤æ–°å¯†ç æ˜¯å¦ä¸æ–°å¯†ç ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™æ˜¾ç¤ºæ­£ç¡®æç¤ºï¼Œå¦åˆ™æ˜¾ç¤ºé”™è¯¯æç¤ºã€‚</p></li><li><p>ä¸ºæäº¤æŒ‰é’®ç»‘å®š click äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå½“æŒ‰é’®è¢«ç‚¹å‡»æ—¶ï¼Œå…ˆè®©æ—§å¯†ç ã€æ–°å¯†ç å’Œç¡®è®¤æ–°å¯†ç è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹ï¼Œç„¶ååˆ¤æ–­å®ƒä»¬çš„éªŒè¯çŠ¶æ€æ˜¯å¦éƒ½ä¸º trueï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ˜¾ç¤ºç¡®è®¤ä¿®æ”¹å¯†ç çš„æç¤ºæ¡†ï¼Œå¦‚æœç”¨æˆ·ç‚¹å‡»ç¡®å®šï¼Œåˆ™æäº¤è¡¨å•ï¼Œå°†æ–°å¯†ç ä¿å­˜åˆ°æœåŠ¡å™¨ä¸Šã€‚</p></li></ol><h4 id="ç¼–å†™å¤„ç†Servlet">ç¼–å†™å¤„ç†Servlet</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDo</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">UserService</span> service<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"savepwd"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">savePwd</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"pwdmodify"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">pwdModify</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">savePwd</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//æ‹¿åˆ°USer Session , ç”¨äºå¾—åˆ°ç”¨æˆ·id</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> newPwd <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"newpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·è¾“å…¥çš„ï¼šnew password: "</span><span class="token operator">+</span>newPwd<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Session password: "</span><span class="token operator">+</span>user<span class="token punctuation">.</span><span class="token function">getUserPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">", id: "</span><span class="token operator">+</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Integer</span> id <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">boolean</span> flag<span class="token punctuation">;</span>        <span class="token comment">//method å€¼ä¸º  savepwd, è¡¨ç¤ºç”¨æˆ·æ‰§è¡Œä¿®æ”¹å¯†ç æ“ä½œ</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>newPwd <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            flag <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">updateUser</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">"userPassword"</span><span class="token punctuation">,</span> newPwd<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//ä¿®æ”¹æˆåŠŸ</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¿®æ”¹æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span><span class="token string">"å¯†ç ä¿®æ”¹æˆåŠŸï¼Œ è¯·é‡æ–°ç™»å½•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//  ç§»é™¤Session</span>                session<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¯†ç ä¿®æ”¹å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span><span class="token string">"å¯†ç ä¿®æ”¹å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span><span class="token string">"æ–°å¯†ç æ ¼å¼é”™è¯¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//è½¬å‘åˆ°å½“å‰é¡µé¢, ä¸ç”¨é‡å®šå‘è€Œä½¿ç”¨è½¬å‘æ˜¯ä¸ºäº†ä¼ ç»Ÿå‚æ•°ï¼ˆattribute) é€šçŸ¥å‰ç«¯å¯†ç ä¿®æ”¹ç»“æœï¼ˆby attribute messageï¼‰</span>        req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"/jsp/pwdmodify.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/*    ç”±ajaxå‘èµ·çš„å¯†ç æŸ¥è¯¢è¯·æ±‚ï¼Œ ç”¨æˆ·è¿›è¡Œå¯†ç ä¿®æ”¹æ—¶è§¦å‘    æ”¾å›å‰ç«¯jsonï¼Œ ajaxç”¨äºæ¯”å¯¹æ—§å¯†ç æ­£ç¡®æ€§,     */</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">pwdModify</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> user <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUserPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> inputPwd <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"oldpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>inputPwd <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> inputPwd<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//æ—§å¯†ç æ­£ç¡®</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>inputPwd<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span><span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">//æ—§å¯†ç ä¸æ­£ç¡®</span>                    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span><span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token comment">//å¯†ç è¾“å…¥ä¸ºç©º</span>                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//session timeout</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span><span class="token string">"sessionerror"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//è¿”å›å‰ç«¯jsonæ•°æ®</span>        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">JSONArray</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªJava Webåº”ç”¨ç¨‹åºä¸­çš„Servletï¼Œç”¨äºå¤„ç†ç”¨æˆ·å¯†ç ä¿®æ”¹æ“ä½œã€‚</p><p>åœ¨doGet()æ–¹æ³•ä¸­ï¼Œæ ¹æ®è¯·æ±‚å‚æ•°&quot;method&quot;çš„å€¼è¿›è¡Œä¸åŒçš„æ“ä½œã€‚å¦‚æœ&quot;method&quot;çš„å€¼æ˜¯&quot;savepwd&quot;ï¼Œåˆ™è°ƒç”¨savePwd()æ–¹æ³•ï¼Œä¿å­˜æ–°å¯†ç ï¼›å¦‚æœ&quot;method&quot;çš„å€¼æ˜¯&quot;pwdmodify&quot;ï¼Œåˆ™è°ƒç”¨pwdModify()æ–¹æ³•ï¼Œç”¨äºæ£€æŸ¥æ—§å¯†ç æ˜¯å¦æ­£ç¡®ã€‚</p><p>åœ¨savePwd()æ–¹æ³•ä¸­ï¼Œé¦–å…ˆä»Sessionä¸­è·å–å½“å‰ç”¨æˆ·çš„ä¿¡æ¯ï¼Œç„¶åè·å–æ–°å¯†ç ï¼Œå¹¶ä½¿ç”¨UserServiceæ¥å£çš„å®ç°ç±»UserServiceImplæ¥æ›´æ–°ç”¨æˆ·å¯†ç ã€‚å¦‚æœæ›´æ–°æˆåŠŸï¼Œå°†ä¿¡æ¯å­˜å‚¨åœ¨è¯·æ±‚å±æ€§ä¸­ï¼Œå¹¶ç§»é™¤Sessionä¸­çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæœ€åå°†è¯·æ±‚è½¬å‘åˆ°å¯†ç ä¿®æ”¹é¡µé¢ã€‚</p><p>åœ¨pwdModify()æ–¹æ³•ä¸­ï¼Œé¦–å…ˆè·å–å½“å‰ç”¨æˆ·çš„ä¿¡æ¯ï¼Œç„¶åè·å–æ—§å¯†ç ã€‚å¦‚æœæ—§å¯†ç ä¸ä¸ºç©ºï¼Œåˆ™å°†è¾“å…¥çš„æ—§å¯†ç ä¸Sessionä¸­å­˜å‚¨çš„æ—§å¯†ç è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœè¾“å…¥çš„æ—§å¯†ç ä¸Sessionä¸­çš„æ—§å¯†ç ç›¸åŒï¼Œåˆ™è¿”å›å‰ç«¯JSONæ•°æ®ï¼Œè¡¨ç¤ºæ—§å¯†ç æ­£ç¡®ï¼›å¦åˆ™è¿”å›JSONæ•°æ®ï¼Œè¡¨ç¤ºæ—§å¯†ç ä¸æ­£ç¡®ã€‚</p><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿”å›JSONæ•°æ®ä¹‹å‰ï¼Œéœ€è¦è®¾ç½®å“åº”çš„Content-Typeä¸º&quot;application/json&quot;ã€‚</strong></p><h5 id="æ˜ å°„Servlet">æ˜ å°„Servlet</h5><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>userDo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>servlet.UserDo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>userDo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/jsp/user.do<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre><h3 id="ç”¨æˆ·ç®¡ç†åº•å±‚å®ç°">ç”¨æˆ·ç®¡ç†åº•å±‚å®ç°</h3><h3 id="åˆ†é¡µå®ç°">åˆ†é¡µå®ç°</h3><ol><li><p>å¯¼å…¥åˆ†é¡µæ”¯æŒ</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">util</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PageSupport</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å½“å‰é¡µç -æ¥è‡ªäºç”¨æˆ·è¾“å…¥ï¼Œ 1è¡¨ç¤ºç¬¬ä¸€é¡µï¼Œ ç”¨äºsqlåšlimitæŸ¥è¯¢ limit startPage, length</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> currentPageNo <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">//æ€»æ•°é‡ï¼ˆè¡¨ï¼‰</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> totalCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">//é¡µé¢å®¹é‡,æ¯ä¸€é¡µå±•ç¤ºå¤šå°‘æ•°æ®</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> pageSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">//æ€»é¡µæ•°: totalCount/pageSizeï¼ˆ+1ï¼‰</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> totalPageCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>      <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCurrentPageNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> currentPageNo<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCurrentPageNo</span><span class="token punctuation">(</span><span class="token keyword">int</span> currentPageNo<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>currentPageNo <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>currentPageNo <span class="token operator">=</span> currentPageNo<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getTotalCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> totalCount<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTotalCount</span><span class="token punctuation">(</span><span class="token keyword">int</span> totalCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>totalCount <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>totalCount <span class="token operator">=</span> totalCount<span class="token punctuation">;</span>            <span class="token comment">//è®¾ç½®æ€»é¡µæ•°</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setTotalPageCountByRs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> pageSize<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPageSize</span><span class="token punctuation">(</span><span class="token keyword">int</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>pageSize <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize <span class="token operator">=</span> pageSize<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getTotalPageCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> totalPageCount<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTotalPageCount</span><span class="token punctuation">(</span><span class="token keyword">int</span> totalPageCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>totalPageCount <span class="token operator">=</span> totalPageCount<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTotalPageCountByRs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>totalCount <span class="token operator">%</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>totalPageCount <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalCount <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>totalCount <span class="token operator">%</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>totalPageCount <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalCount <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>totalPageCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªç”¨äºåˆ†é¡µçš„å·¥å…·ç±» <code>PageSupport</code>ã€‚å®ƒåŒ…å«äº†ç”¨äºå¤„ç†åˆ†é¡µé€»è¾‘çš„å±æ€§å’Œæ–¹æ³•ã€‚</p><p>è®©æˆ‘ä»¬é€ä¸ªåˆ†æè¿™äº›å±æ€§å’Œæ–¹æ³•ï¼š</p><ol><li><p><code>currentPageNo</code>ï¼ˆå½“å‰é¡µç ï¼‰: ä¿å­˜å½“å‰é¡µçš„é¡µç ï¼Œé»˜è®¤ä¸º1ï¼ˆè¡¨ç¤ºç¬¬ä¸€é¡µï¼‰ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡è°ƒç”¨ <code>setCurrentPageNo()</code> æ–¹æ³•æ¥è®¾ç½®å½“å‰é¡µç ã€‚</p></li><li><p><code>totalCount</code>ï¼ˆæ€»æ•°é‡ï¼‰: è¡¨ç¤ºæ€»çš„æ•°æ®é‡ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡è°ƒç”¨ <code>setTotalCount()</code> æ–¹æ³•æ¥è®¾ç½®æ€»æ•°é‡ã€‚</p></li><li><p><code>pageSize</code>ï¼ˆé¡µé¢å®¹é‡ï¼‰: æ¯ä¸€é¡µæ˜¾ç¤ºçš„æ•°æ®æ•°é‡ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡è°ƒç”¨ <code>setPageSize()</code> æ–¹æ³•æ¥è®¾ç½®é¡µé¢å®¹é‡ã€‚</p></li><li><p><code>totalPageCount</code>ï¼ˆæ€»é¡µæ•°ï¼‰: è¡¨ç¤ºæ€»çš„é¡µæ•°ï¼Œæ ¹æ®æ€»æ•°é‡å’Œé¡µé¢å®¹é‡è®¡ç®—å¾—å‡ºã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡è°ƒç”¨ <code>getTotalPageCount()</code> æ–¹æ³•æ¥è·å–æ€»é¡µæ•°ã€‚</p></li><li><p><code>setTotalPageCountByRs()</code> æ–¹æ³•: æ ¹æ®æ€»æ•°é‡å’Œé¡µé¢å®¹é‡è®¡ç®—æ€»é¡µæ•°ï¼Œå¹¶å°†ç»“æœè®¾ç½®ç»™ <code>totalPageCount</code> å±æ€§ã€‚</p></li></ol><p>æ­¤å¤–ï¼Œå¯¹äºä¸€äº›å±æ€§çš„è®¾ç½®ï¼Œä»£ç ä¸­è¿›è¡Œäº†ä¸€äº›é™åˆ¶æ¡ä»¶çš„åˆ¤æ–­ï¼š</p><ul><li><p><code>currentPageNo</code> å’Œ <code>pageSize</code> å¿…é¡»å¤§äº0ï¼Œå¦åˆ™å°†ä¸è¿›è¡Œè®¾ç½®ã€‚</p></li><li><p><code>totalCount</code> å¿…é¡»å¤§äº0ï¼Œå¦åˆ™å°†ä¸è¿›è¡Œè®¾ç½®ï¼Œå¹¶ä¸”ä¼šå°† <code>totalPageCount</code> è®¾ç½®ä¸º0ã€‚</p></li></ul><p>è¿™ä¸ªå·¥å…·ç±»ä¸»è¦ç”¨äºåœ¨åˆ†é¡µæŸ¥è¯¢ä¸­è®¡ç®—æ€»é¡µæ•°å’Œè¿›è¡Œå½“å‰é¡µç çš„è®¾ç½®ã€‚</p></li></ol><ul><li><p>å‰ç«¯</p><p><strong>Headerä¸‹ç”¨æˆ·ç®¡ç†äºŒçº§èœå•</strong></p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;li&gt;&lt;a href&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;jsp&#x2F;user.do?method&#x3D;query&quot;&gt;ç”¨æˆ·ç®¡ç†&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</code></pre><p>ç‚¹å‡»è¿™ä¸ªèœå•, è·³è½¬åˆ°<code>/jsp/user.do?method=query</code>è¿™ä¸ªè¯·æ±‚,<code> user.do</code>æ˜¯å¯¹åº”çš„å¤„ç†è¯·æ±‚çš„Servlet, é—®å·åé¢æ˜¯é€šè¿‡è¯·æ±‚ä¼ é€’çš„å‚æ•°, ä¸º<code>method = query, Servlet</code>å¯ä»¥æ ¹æ®è¿™ä¸ªå‚æ•°å¯¹è¯·æ±‚çš„ä¸åŒç±»å‹åšå¯¹åº”çš„å¤„ç†, å®ç°Servletçš„å¤ç”¨.</p><p><strong>ç”¨æˆ·ç®¡ç†ç•Œé¢:</strong></p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">    &lt;div class&#x3D;&quot;search&quot;&gt;        &lt;form method&#x3D;&quot;get&quot; action&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;jsp&#x2F;user.do&quot;&gt;            &lt;input name&#x3D;&quot;method&quot; value&#x3D;&quot;query&quot; class&#x3D;&quot;input-text&quot; type&#x3D;&quot;hidden&quot;&gt;            &lt;span&gt;ç”¨æˆ·åï¼š&lt;&#x2F;span&gt;            &lt;input name&#x3D;&quot;queryname&quot; class&#x3D;&quot;input-text&quot; type&#x3D;&quot;text&quot; value&#x3D;&quot;$&#123;queryUserName &#125;&quot;&gt;            &lt;span&gt;ç”¨æˆ·è§’è‰²ï¼š&lt;&#x2F;span&gt;            &lt;select name&#x3D;&quot;queryUserRole&quot;&gt;                &lt;c:if test&#x3D;&quot;$&#123;roleList !&#x3D; null &#125;&quot;&gt;                    &lt;option value&#x3D;&quot;0&quot;&gt;--è¯·é€‰æ‹©--&lt;&#x2F;option&gt;                    &lt;c:forEach var&#x3D;&quot;role&quot; items&#x3D;&quot;$&#123;roleList&#125;&quot;&gt;                        &lt;option &lt;c:if test&#x3D;&quot;$&#123;role.id &#x3D;&#x3D; queryUserRole &#125;&quot;&gt;selected&#x3D;&quot;selected&quot;&lt;&#x2F;c:if&gt;                                value&#x3D;&quot;$&#123;role.id&#125;&quot;&gt;$&#123;role.roleName&#125;&lt;&#x2F;option&gt;                    &lt;&#x2F;c:forEach&gt;                &lt;&#x2F;c:if&gt;            &lt;&#x2F;select&gt;            &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;pageIndex&quot; value&#x3D;&quot;1&quot;&#x2F;&gt;            &lt;input value&#x3D;&quot;æŸ¥ è¯¢&quot; type&#x3D;&quot;submit&quot; id&#x3D;&quot;searchbutton&quot;&gt;        &lt;&#x2F;form&gt;    &lt;&#x2F;div&gt;    &lt;!--ç”¨æˆ·--&gt;&#x2F;*ç”¨æˆ·çš„mappingä»£ç *&#x2F;    &lt;input type&#x3D;&quot;hidden&quot; id&#x3D;&quot;totalPageCount&quot; value&#x3D;&quot;$&#123;totalPageCount&#125;&quot;&#x2F;&gt;    &lt;c:import url&#x3D;&quot;rollpage.jsp&quot;&gt;        &lt;c:param name&#x3D;&quot;totalCount&quot; value&#x3D;&quot;$&#123;totalCount&#125;&quot;&#x2F;&gt;        &lt;c:param name&#x3D;&quot;currentPageNo&quot; value&#x3D;&quot;$&#123;currentPageNo&#125;&quot;&#x2F;&gt;        &lt;c:param name&#x3D;&quot;totalPageCount&quot; value&#x3D;&quot;$&#123;totalPageCount&#125;&quot;&#x2F;&gt;    &lt;&#x2F;c:import&gt;&lt;&#x2F;div&gt;&lt;&#x2F;section&gt;</code></pre></li></ul><p>è¿™æ®µä»£ç å±•ç¤ºäº†ä¸€ä¸ªæœç´¢è¡¨å•å’Œä¸åˆ†é¡µç›¸å…³çš„éƒ¨åˆ†ã€‚</p><ol><li><code>&lt;div class=&quot;search&quot;&gt;</code> æ ‡ç­¾: å®šä¹‰ä¸€ä¸ªæœç´¢çš„åŒºåŸŸã€‚</li><li><code>&lt;form&gt;</code> æ ‡ç­¾: å®šä¹‰äº†ä¸€ä¸ªè¡¨å•ï¼Œä½¿ç”¨ GET æ–¹æ³•æäº¤åˆ° <code>$&#123;pageContext.request.contextPath&#125;/jsp/user.do</code>ã€‚</li><li><code>&lt;input&gt;</code> æ ‡ç­¾: è®¾ç½®äº†ä¸€ä¸ªéšè—å­—æ®µ <code>method</code>ï¼Œå€¼ä¸º <code>&quot;query&quot;</code>ï¼Œç”¨äºæŒ‡å®šæŸ¥è¯¢çš„æ–¹æ³•ã€‚</li><li><code>&lt;input&gt;</code> æ ‡ç­¾: åˆ›å»ºäº†ä¸€ä¸ªæ–‡æœ¬è¾“å…¥æ¡†ï¼Œåç§°ä¸º <code>queryname</code>ï¼Œå€¼ä¸º <code>$&#123;queryUserName&#125;</code>ï¼Œæ˜¾ç¤ºäº†ä¹‹å‰æŸ¥è¯¢çš„ç”¨æˆ·åã€‚</li><li><code>&lt;select&gt;</code> æ ‡ç­¾: åˆ›å»ºäº†ä¸€ä¸ªä¸‹æ‹‰é€‰æ‹©æ¡†ï¼Œåç§°ä¸º <code>queryUserRole</code>ã€‚ä½¿ç”¨äº† JSTL æ ‡ç­¾ <code>&lt;c:if&gt;</code> è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œå¦‚æœ <code>roleList</code> ä¸ä¸º nullï¼Œå°†ä¼šæ˜¾ç¤ºé€‰é¡¹ã€‚</li><li><code>&lt;option&gt;</code> æ ‡ç­¾: è®¾ç½®äº†ä¸€ä¸ªé»˜è®¤é€‰é¡¹ <code>&lt;option value=&quot;0&quot;&gt;--è¯·é€‰æ‹©--&lt;/option&gt;</code>ï¼Œç„¶åä½¿ç”¨ <code>&lt;c:forEach&gt;</code> éå† <code>roleList</code> ä¸­çš„è§’è‰²ï¼Œå¹¶å°†è§’è‰²çš„åç§°å’Œ ID è®¾ç½®ä¸ºé€‰é¡¹çš„å€¼ã€‚ä½¿ç”¨ <code>&lt;c:if&gt;</code> åˆ¤æ–­å½“å‰è§’è‰²æ˜¯å¦ä¸ <code>queryUserRole</code> ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™è®¾ç½®è¯¥é€‰é¡¹ä¸ºé€‰ä¸­çŠ¶æ€ã€‚</li><li><code>&lt;input&gt;</code> æ ‡ç­¾: è®¾ç½®äº†ä¸€ä¸ªéšè—å­—æ®µ <code>pageIndex</code>ï¼Œå€¼ä¸º 1</li><li><code>&lt;input&gt;</code> æ ‡ç­¾: è®¾ç½®äº†ä¸€ä¸ªéšè—å­—æ®µ <code>totalPageCount</code>ï¼Œå€¼ä¸º <code>$&#123;totalPageCount&#125;</code>ã€‚</li><li><code>&lt;c:import&gt;</code> æ ‡ç­¾: å¯¼å…¥äº†ä¸€ä¸ªåä¸º <code>rollpage.jsp</code> çš„é¡µé¢ï¼Œå¹¶ä¼ é€’äº†ä¸‰ä¸ªå‚æ•° <code>totalCount</code>ã€<code>currentPageNo</code> å’Œ <code>totalPageCount</code> çš„å€¼ã€‚</li></ol><p>è¿™æ®µä»£ç å±•ç¤ºäº†ä¸€ä¸ªæœç´¢è¡¨å•ï¼Œç”¨æˆ·å¯ä»¥è¾“å…¥ç”¨æˆ·åå’Œé€‰æ‹©ç”¨æˆ·è§’è‰²è¿›è¡ŒæŸ¥è¯¢ã€‚åŒæ—¶ï¼Œè¿˜åŒ…å«äº†ä¸åˆ†é¡µç›¸å…³çš„éƒ¨åˆ†ï¼ŒåŒ…æ‹¬å½“å‰é¡µç ã€æ€»é¡µæ•°å’Œæ€»æ•°é‡çš„æ˜¾ç¤ºã€‚</p><p>æˆ‘ä»¬è§‚å¯Ÿè¿™æ®µä»£ç , è¿™ä¸ªformè¡¨å•çš„ä¸€éƒ¨åˆ†ä»£ç , åˆ†åˆ«å±•ç¤ºäº†æäº¤çš„ç›®çš„åœ° <code>$&#123;pageContext.request.contextPath &#125;/jsp/user.do</code>  ä»¥åŠ ä¸€ä¸ªéšè—åŸŸ, åŒ…å«ä¸€ä¸ªç†Ÿæ‚‰ <code>method</code> å€¼ä¸º <code>query</code>, æ˜¯ä¸æ˜¯, å¾ˆç†Ÿæ‚‰, æ²¡é”™, è¿™ä¸ªServletå’ŒHeaderèœå•è¿›å…¥ç®¡ç†ç”¨æˆ·ç•Œé¢æ‰€å‘èµ·çš„è¯·æ±‚æ˜¯ä¸€æ ·çš„, ä¹Ÿå°±æ˜¯è¯´, æ˜¯ä¸€ä¸ªServletçš„ç›¸åŒå¤„ç†è¿‡ç¨‹. ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢?  è¿™æ˜¯å› ä¸ºæŸ¥è¯¢å’Œå±•ç¤ºç”¨æˆ·ä¿¡æ¯(æœªç­›é€‰æ—¶) æœ¬è´¨æ˜¯ä¸€æ ·çš„.</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;form method&#x3D;&quot;get&quot; action&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;jsp&#x2F;user.do&quot;&gt;    &lt;input name&#x3D;&quot;method&quot; value&#x3D;&quot;query&quot; class&#x3D;&quot;input-text&quot; type&#x3D;&quot;hidden&quot;&gt;</code></pre><ul><li><p>DAOå±‚</p><p><code>int getUserCount()</code></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getUserCount</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token keyword">int</span> userRole<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token class-name">StringBuffer</span> sql <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"SELECT count(1) as count from smbms_user s, smbms_role r where s.userRole = r.id"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span>  <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>userName <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" and userName like ? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"%"</span><span class="token operator">+</span>userName<span class="token operator">+</span><span class="token string">"%"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>userRole <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" and userRole like ? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"%"</span><span class="token operator">+</span>userRole<span class="token operator">+</span><span class="token string">"%"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"sql----> "</span><span class="token operator">+</span>sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        rs <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            count <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"count"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> count<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªæ–¹æ³• <code>getUserCount</code>ï¼Œç”¨äºæŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„ç”¨æˆ·æ•°é‡ã€‚</p><p>è®©æˆ‘ä»¬é€è¡Œè§£é‡Šè¿™æ®µä»£ç ï¼š</p><ol><li><p><code>int getUserCount(Connection conn, String userName, int userRole)</code>: è¿™æ˜¯ä¸€ä¸ªæ–¹æ³•å£°æ˜ï¼Œå®ƒæ¥å—ä¸€ä¸ªæ•°æ®åº“è¿æ¥å¯¹è±¡ <code>conn</code>ã€ä¸€ä¸ªç”¨æˆ·å <code>userName</code> å’Œä¸€ä¸ªç”¨æˆ·è§’è‰² <code>userRole</code> ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºç¬¦åˆæ¡ä»¶çš„ç”¨æˆ·æ•°é‡ã€‚</p></li><li><p><code>int count = 0;</code>: åˆå§‹åŒ–ä¸€ä¸ªè®¡æ•°å™¨å˜é‡ <code>count</code>ï¼Œç”¨äºå­˜å‚¨æŸ¥è¯¢ç»“æœçš„æ•°é‡ã€‚</p></li><li><p><code>StringBuffer sql = new StringBuffer();</code>: åˆ›å»ºä¸€ä¸ª <code>StringBuffer</code> å¯¹è±¡ <code>sql</code>ï¼Œç”¨äºæ„å»º SQL æŸ¥è¯¢è¯­å¥ã€‚</p></li><li><p><code>sql.append(&quot;SELECT count(1) as count from smbms_user s, smbms_role r where s.userRole = r.id&quot;);</code>: å°†åŸºæœ¬çš„æŸ¥è¯¢è¯­å¥æ·»åŠ åˆ° <code>sql</code> å¯¹è±¡ä¸­ï¼ŒæŸ¥è¯¢ç”¨æˆ·è¡¨ <code>smbms_user</code> å’Œè§’è‰²è¡¨ <code>smbms_role</code>ï¼Œå¹¶é€šè¿‡ <code>userRole</code> å­—æ®µè¿›è¡Œå…³è”ã€‚</p></li><li><p><code>ArrayList&lt;Object&gt; list = new ArrayList&lt;Object&gt;();</code>: åˆ›å»ºä¸€ä¸ª <code>ArrayList</code> å¯¹è±¡ <code>list</code>ï¼Œç”¨äºå­˜å‚¨æŸ¥è¯¢æ¡ä»¶çš„å‚æ•°å€¼ã€‚</p></li><li><p><code>ResultSet rs =  null;</code>: åˆå§‹åŒ–ä¸€ä¸ª <code>ResultSet</code> å¯¹è±¡ <code>rs</code>ï¼Œç”¨äºå­˜å‚¨æŸ¥è¯¢ç»“æœé›†ã€‚</p></li><li><p><code>if(userName != null) &#123; ... &#125;</code>: å¦‚æœ <code>userName</code> ä¸ä¸º nullï¼Œåˆ™å°†ä¸€ä¸ªæ¡ä»¶å­å¥æ·»åŠ åˆ° <code>sql</code> å¯¹è±¡ä¸­ï¼Œä½¿ç”¨ <code>LIKE</code> è¿ç®—ç¬¦è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ï¼Œå¹¶å°†åŒ¹é…å‚æ•°æ·»åŠ åˆ° <code>list</code> ä¸­ã€‚</p></li><li><p><code>if(userRole &gt; 0) &#123; ... &#125;</code>: å¦‚æœ <code>userRole</code> å¤§äº 0ï¼Œåˆ™å°†å¦ä¸€ä¸ªæ¡ä»¶å­å¥æ·»åŠ åˆ° <code>sql</code> å¯¹è±¡ä¸­ï¼ŒåŒæ ·ä½¿ç”¨ <code>LIKE</code> è¿ç®—ç¬¦è¿›è¡ŒåŒ¹é…ï¼Œå¹¶å°†åŒ¹é…å‚æ•°æ·»åŠ åˆ° <code>list</code> ä¸­ã€‚</p></li><li><p><code>System.out.println(&quot;sql----&gt; &quot;+sql.toString());</code>: æ‰“å°è¾“å‡ºæœ€ç»ˆç”Ÿæˆçš„ SQL æŸ¥è¯¢è¯­å¥ï¼Œæ–¹ä¾¿è°ƒè¯•å’ŒæŸ¥çœ‹ã€‚</p></li><li><p><code>rs = DB.executeQuery(conn, sql.toString(), list.toArray());</code>: æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨ <code>rs</code> ä¸­ã€‚<code>DB.executeQuery()</code> æ˜¯ä¸€ä¸ªæ‰§è¡ŒæŸ¥è¯¢è¯­å¥çš„æ–¹æ³•ï¼Œæ¥å—æ•°æ®åº“è¿æ¥å¯¹è±¡ã€SQL æŸ¥è¯¢è¯­å¥å’Œå‚æ•°å€¼æ•°ç»„ä½œä¸ºå‚æ•°ã€‚</p></li><li><p><code>while (rs.next()) &#123; ... &#125;</code>: éå†æŸ¥è¯¢ç»“æœé›†ï¼Œå°†æ¯è¡Œçš„è®¡æ•°å€¼å­˜å‚¨åˆ° <code>count</code> å˜é‡ä¸­ã€‚</p></li><li><p><code>DB.close(null,null,rs);</code>: å…³é—­ç»“æœé›†ã€è¯­å¥å’Œè¿æ¥å¯¹è±¡ï¼Œé‡Šæ”¾èµ„æºã€‚<code>DB.close()</code> æ˜¯ä¸€ä¸ªå…³é—­æ•°æ®åº“èµ„æºçš„æ–¹æ³•ï¼Œæ¥å—ä¸‰ä¸ªå‚æ•°ï¼šç»“æœé›†ã€è¯­å¥å’Œè¿æ¥å¯¹è±¡ã€‚</p></li><li><p><code>return count;</code>: è¿”å›ç¬¦åˆæ¡ä»¶çš„ç”¨æˆ·æ•°é‡ã€‚</p></li></ol><p>è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯æŸ¥è¯¢æ•°æ®åº“ä¸­ç¬¦åˆç»™å®šç”¨æˆ·åå’Œç”¨æˆ·è§’è‰²æ¡ä»¶çš„ç”¨æˆ·æ•°é‡ï¼Œå¹¶å°†ç»“æœè¿”å›ã€‚</p><p>==getUserList==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> <span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token keyword">int</span> userRole<span class="token punctuation">,</span><span class="token keyword">int</span> currPage<span class="token punctuation">,</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> userList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//å‡†å¤‡è¦ä½¿ç”¨çš„å¯¹è±¡</span>            <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token class-name">StringBuffer</span> sql <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token comment">//ç¼–å†™sql</span>                sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"SELECT * from smbms_user u ,smbms_role r Where u.userRole = r.id "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//å¦‚æœç”¨æˆ·åä¸ä¸ºç©ºï¼Œ è¡¨ç¤ºæœ‰ç”¨æˆ·åæŸ¥è¯¢è¦æ±‚ï¼Œè¿½åŠ é™å®šæ¡ä»¶</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>userName <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" AND userName like ? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    params<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"%"</span><span class="token operator">+</span>userName<span class="token operator">+</span><span class="token string">"%"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token comment">//åŒä¸Š...</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>userRole <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" and userRole = ?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    params<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>userRole<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" ORDER BY u.creationDate DESC LIMIT ?,? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åœ¨sqlæœ€åè¿½åŠ ä¸€ä¸ªæ’åºå’Œåˆ†é¡µ</span>                <span class="token comment">//5</span>                <span class="token comment">//1     5</span>                <span class="token comment">//2     10</span>                <span class="token comment">//3     15</span>                currPage <span class="token operator">=</span> <span class="token punctuation">(</span>currPage<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>pageSize<span class="token punctuation">;</span><span class="token comment">//å‡ä¸€çš„åŸå› å°±æ˜¯MYSQLåˆ†é¡µçš„indexä»0å¼€å§‹</span>                params<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>currPage<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä»å“ªä¸€ä¸ªä¸‹æ ‡å¼€å§‹</span>                params<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä»currentPageNoè¿ç»­å–å‡ ä¸ª</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"sql--->"</span><span class="token operator">+</span>sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//æ‰§è¡Œsqlï¼Œ è¿”å›ç»“æœé›†, âš ï¸éœ€è¦æŠŠsqlè½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œ params è½¬åŒ–ä¸ºæ•°ç»„</span>                rs <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>params<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>rs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setUserPassword</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userPassword"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setUserCode</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userCode"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setBirthday</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Date</span><span class="token punctuation">)</span> rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"birthday"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setPhone</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setIdPicPath</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"idPicPath"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setUserRole</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"userRole"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setCreatedBy</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"createdBy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setCreationDate</span><span class="token punctuation">(</span> rs<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"creationDate"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setModifyBy</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"modifyBy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setModifyDate</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"modifyDate"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        user<span class="token punctuation">.</span><span class="token function">setUserRoleName</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"roleName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        userList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//                        System.out.println(user.toString());</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>                <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> userList<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre></li></ul><p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªæ–¹æ³• <code>getUserList</code>ï¼Œç”¨äºæ ¹æ®ç»™å®šçš„ç”¨æˆ·åã€ç”¨æˆ·è§’è‰²ã€å½“å‰é¡µç å’Œé¡µé¢å¤§å°è·å–ç¬¦åˆæ¡ä»¶çš„ç”¨æˆ·åˆ—è¡¨ã€‚</p><p>è®©æˆ‘ä»¬é€è¡Œè§£é‡Šè¿™æ®µä»£ç ï¼š</p><ol><li><p><code>public List&lt;User&gt; getUserList(Connection conn, String userName, int userRole, int currPage, int pageSize)</code>: è¿™æ˜¯ä¸€ä¸ªæ–¹æ³•å£°æ˜ï¼Œå®ƒæ¥å—ä¸€ä¸ªæ•°æ®åº“è¿æ¥å¯¹è±¡ <code>conn</code>ã€ä¸€ä¸ªç”¨æˆ·å <code>userName</code>ã€ä¸€ä¸ªç”¨æˆ·è§’è‰² <code>userRole</code>ã€å½“å‰é¡µç  <code>currPage</code> å’Œé¡µé¢å¤§å° <code>pageSize</code> ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ª <code>List&lt;User&gt;</code> ç±»å‹çš„ç”¨æˆ·åˆ—è¡¨ã€‚</p></li><li><p><code>List&lt;User&gt; userList = new ArrayList&lt;&gt;();</code>: åˆ›å»ºä¸€ä¸ª <code>ArrayList</code> å¯¹è±¡ <code>userList</code>ï¼Œç”¨äºå­˜å‚¨ç”¨æˆ·åˆ—è¡¨ã€‚</p></li><li><p><code>if(conn != null) &#123; ... &#125; else &#123; return null; &#125;</code>: æ£€æŸ¥æ•°æ®åº“è¿æ¥å¯¹è±¡æ˜¯å¦ä¸º nullï¼Œå¦‚æœä¸º nullï¼Œåˆ™ç›´æ¥è¿”å› nullã€‚</p></li><li><p><code>ArrayList&lt;Object&gt; params = new ArrayList&lt;&gt;();</code>: åˆ›å»ºä¸€ä¸ª <code>ArrayList</code> å¯¹è±¡ <code>params</code>ï¼Œç”¨äºå­˜å‚¨æŸ¥è¯¢æ¡ä»¶çš„å‚æ•°å€¼ã€‚</p></li><li><p><code>ResultSet rs = null;</code>: åˆå§‹åŒ–ä¸€ä¸ª <code>ResultSet</code> å¯¹è±¡ <code>rs</code>ï¼Œç”¨äºå­˜å‚¨æŸ¥è¯¢ç»“æœé›†ã€‚</p></li><li><p><code>StringBuffer sql = new StringBuffer();</code>: åˆ›å»ºä¸€ä¸ª <code>StringBuffer</code> å¯¹è±¡ <code>sql</code>ï¼Œç”¨äºæ„å»º SQL æŸ¥è¯¢è¯­å¥ã€‚</p></li><li><p><code>sql.append(&quot;SELECT * from smbms_user u ,smbms_role r Where u.userRole = r.id &quot;);</code>: å°†åŸºæœ¬çš„æŸ¥è¯¢è¯­å¥æ·»åŠ åˆ° <code>sql</code> å¯¹è±¡ä¸­ï¼ŒæŸ¥è¯¢ç”¨æˆ·è¡¨ <code>smbms_user</code>ï¼Œå’Œè§’è‰²è¡¨<code>smbms_role </code>, è¿™é‡Œè¿›è¡Œäº†å¤šè¡¨çš„è”åˆæŸ¥è¯¢, æ˜¯ä¸ºäº†ç»™user(Bean)çš„RoleNa m eèµ‹å€¼, ä»¥ä¾¿å‰ç«¯ä½¿ç”¨.</p></li><li><p><code>if(userName != null) &#123; ... &#125;</code>: å¦‚æœ <code>userName</code> ä¸ä¸º nullï¼Œåˆ™å°†ä¸€ä¸ªæ¡ä»¶å­å¥æ·»åŠ åˆ° <code>sql</code> å¯¹è±¡ä¸­ï¼Œä½¿ç”¨ <code>LIKE</code> è¿ç®—ç¬¦è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ï¼Œå¹¶å°†åŒ¹é…å‚æ•°æ·»åŠ åˆ° <code>params</code> ä¸­ã€‚</p></li><li><p><code>if(userRole != 0) &#123; ... &#125;</code>: å¦‚æœ <code>userRole</code> ä¸ä¸º 0ï¼Œåˆ™å°†å¦ä¸€ä¸ªæ¡ä»¶å­å¥æ·»åŠ åˆ° <code>sql</code> å¯¹è±¡ä¸­ï¼Œé™å®šç”¨æˆ·è§’è‰²ï¼Œå¹¶å°†è§’è‰²å‚æ•°æ·»åŠ åˆ° <code>params</code> ä¸­ã€‚</p></li><li><p><code>sql.append(&quot; ORDER BY u.creationDate DESC LIMIT ?,? &quot;);</code>: åœ¨æŸ¥è¯¢è¯­å¥çš„æœ«å°¾è¿½åŠ ä¸€ä¸ªæ’åºå’Œåˆ†é¡µçš„éƒ¨åˆ†ï¼ŒæŒ‰ç…§ <code>creationDate</code> å­—æ®µé™åºæ’åˆ—ï¼Œå¹¶ä½¿ç”¨ <code>LIMIT</code> é™åˆ¶æŸ¥è¯¢ç»“æœçš„èµ·å§‹ä½ç½®å’Œæ•°é‡ã€‚</p></li><li><p><code>currPage = (currPage-1)*pageSize;</code>: è®¡ç®—å®é™…çš„èµ·å§‹ä½ç½®ï¼Œæ ¹æ®å½“å‰é¡µç å’Œé¡µé¢å¤§å°ï¼Œå‡ä¸€æ˜¯å› ä¸º MYSQL åˆ†é¡µçš„ç´¢å¼•ä» 0 å¼€å§‹ã€‚</p></li><li><p><code>params.add(currPage);</code>: å°†èµ·å§‹ä½ç½®å‚æ•°æ·»åŠ åˆ° <code>params</code> ä¸­ã€‚</p></li><li><p><code>params.add(pageSize);</code>: å°†é¡µé¢å¤§å°å‚æ•°æ·»åŠ åˆ° <code>params</code> ä¸­ã€‚</p></li><li><p><code>System.out.println(&quot;sql---&gt;&quot;+sql.toString());</code>: æ‰“å°è¾“å‡ºæœ€ç»ˆç”Ÿæˆçš„ SQL æŸ¥è¯¢è¯­å¥ï¼Œæ–¹ä¾¿è°ƒè¯•å’ŒæŸ¥çœ‹ã€‚</p></li><li><p><code>rs = DB.executeQuery(conn, sql.toString(), params.toArray());</code>: æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨ <code>rs</code> ä¸­ã€‚`</p></li></ol><p>â€‹==getRoleList==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> <span class="token function">getRolelist</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//prevent roleList</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> roleList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">StringBuffer</span> sql <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//edit sql expression</span>            sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM smbms_role "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//è¾“å…¥0è¡¨æŸ¥è¯¢å…¨è¡¨ï¼Œ è¾“å…¥>0 ä¸ºsqlæ‹¼æ¥æ¡ä»¶ï¼Œ åŒæ—¶å‡†å¤‡å‚æ•°åˆ—è¡¨</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" WHERE id = ? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                params<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"sql---->"</span><span class="token operator">+</span>sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            rs <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>rs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">//èµ‹å€¼</span>                    <span class="token class-name">Role</span> role <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Role</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    role<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    role<span class="token punctuation">.</span><span class="token function">setRoleCode</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"roleCode"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    role<span class="token punctuation">.</span><span class="token function">setRoleName</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"roleName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    role<span class="token punctuation">.</span><span class="token function">setCreatedBy</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"createdBy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    role<span class="token punctuation">.</span><span class="token function">setModifyDate</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"creationDate"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    role<span class="token punctuation">.</span><span class="token function">setCreationDate</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"creationDate"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    role<span class="token punctuation">.</span><span class="token function">setModifyBy</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"modifyBy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    roleList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> roleList<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><ul><li><p>Serviceå±‚</p><p>==getUserCount==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getUserCount</span><span class="token punctuation">(</span><span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token class-name">UserRole</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            conn <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            dao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            count <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">getUserCount</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> userName<span class="token punctuation">,</span> <span class="token class-name">UserRole</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> count<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>==getUserlist==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> <span class="token function">getUserlist</span><span class="token punctuation">(</span><span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token keyword">int</span> userRole<span class="token punctuation">,</span><span class="token keyword">int</span> currPage<span class="token punctuation">,</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> usersList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        usersList <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">getUserList</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> userName<span class="token punctuation">,</span> userRole<span class="token punctuation">,</span>currPage<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> usersList<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>==getRoleList==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> <span class="token function">getRoleList</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> roles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">RoleDao</span> dao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RoleDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        roles <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">getRolelist</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> roles<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre></li><li><p>Servletå±‚</p><p>ç±»åŠ è½½è¯»å–é…ç½®æ–‡ä»¶ï¼š ç›®å‰éœ€è¦è¯»å–çš„æ•°æ®æœ‰ï¼šPAGE_SIZE ç”¨äºè®¾ç½®é¡µé¢å¤§å°</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//è¯»å–é…ç½®æ–‡ä»¶</span>    <span class="token comment">//1ã€åˆ›å»ºpropertieså¯¹è±¡</span>    <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//2ã€é€šè¿‡ç±»åŠ è½½å™¨åŠ è½½èµ„æºæ–‡ä»¶ä¸ºå­—èŠ‚è¾“å…¥æµ</span>    <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"db.properties"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token constant">PAGE_SIZE</span> <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"PAGE_SIZE"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"savepwd"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">savePwd</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"pwdmodify"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">pwdModify</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"query"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">query</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯æ ¹æ®ä¸åŒçš„<code>method</code>å€¼è°ƒç”¨ä¸åŒçš„æ–¹æ³•å¤„ç†GETè¯·æ±‚ï¼Œå®ç°ä¸åŒçš„åŠŸèƒ½æ“ä½œã€‚</p></li></ul><p>å…·ä½“å®ç°:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1. ä»å‰ç«¯è·å–ç”¨æˆ·è¾“å…¥çš„å‚æ•° queryname -> userNameï¼ŒqueryUserRole -> userRole,pageIndex</span>        <span class="token class-name">String</span> userName <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"queryname"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> userRole <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"queryUserRole"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> pageIndex <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"pageIndex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ£€éªŒå‚æ•°çš„åˆæ³•æ€§</span>        <span class="token keyword">if</span><span class="token punctuation">(</span> userName <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            userName <span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>userRole <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> userRole<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            userRole <span class="token operator">=</span> <span class="token string">"0"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>pageIndex <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> pageIndex<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            pageIndex <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//3. å‡†å¤‡å‰ç«¯éœ€è¦çš„å‚æ•°ï¼š queryUserNameï¼ŒqueryUserRole ,roleListï¼ŒuserList,</span>        <span class="token class-name">String</span> queryUserName <span class="token operator">=</span> userName<span class="token punctuation">;</span>        <span class="token class-name">String</span> queryUserRole <span class="token operator">=</span> userRole<span class="token punctuation">;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> roleList<span class="token punctuation">;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> userList<span class="token punctuation">;</span>        <span class="token comment">// ä»¥åŠä¸‹åˆ—å‚æ•°ï¼š totalPageCountï¼ˆæ€»é¡µæ•°ï¼‰ï¼ŒtotalCountï¼ˆæŸ¥è¯¢åˆ°çš„ç”¨æˆ·æ•°ï¼‰ï¼ŒcurrentPageNoï¼ˆå½“å‰é¡µï¼‰</span>        <span class="token comment">// è¿™äº›å‚æ•°çš„è·å–éœ€è¦å…ˆè°ƒç”¨userService.getUserCountæŸ¥è¯¢ç”¨æˆ·æ•°ï¼Œ ç„¶åè°ƒç”¨PageSupportæä¾›åˆ†é¡µæ”¯æŒ</span>        <span class="token class-name">UserServiceImpl</span> userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">RoleServiceImpl</span> roleService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RoleServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> totalCount <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUserCount</span><span class="token punctuation">(</span>userName<span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>userRole<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">PageSupport</span> pageSupport <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageSupport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pageSupport<span class="token punctuation">.</span><span class="token function">setPageSize</span><span class="token punctuation">(</span><span class="token constant">PAGE_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pageSupport<span class="token punctuation">.</span><span class="token function">setTotalCount</span><span class="token punctuation">(</span>totalCount<span class="token punctuation">)</span><span class="token punctuation">;</span>        pageSupport<span class="token punctuation">.</span><span class="token function">setTotalPageCountByRs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pageSupport<span class="token punctuation">.</span><span class="token function">setCurrentPageNo</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>pageIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> totalPageCount <span class="token operator">=</span> pageSupport<span class="token punctuation">.</span><span class="token function">getTotalPageCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æŸ¥è¯¢ç”¨æˆ·å’Œè§’è‰²</span>        userList <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getUserlist</span><span class="token punctuation">(</span>userName<span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>userRole<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>pageIndex<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">PAGE_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        roleList <span class="token operator">=</span> roleService<span class="token punctuation">.</span><span class="token function">getRoleList</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2. æ ¹æ®å‚æ•°è¿”å›ç”¨æˆ·è¡¨å’Œè§’è‰²è¡¨</span>        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"roleList"</span><span class="token punctuation">,</span>roleList<span class="token punctuation">)</span><span class="token punctuation">;</span>        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"userList"</span><span class="token punctuation">,</span>userList<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3. è¿”å›ç”¨æˆ·éœ€è¦çš„å‚æ•°</span>        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"queryUserName"</span><span class="token punctuation">,</span>queryUserName<span class="token punctuation">)</span><span class="token punctuation">;</span>        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"queryUserRole"</span><span class="token punctuation">,</span>queryUserRole<span class="token punctuation">)</span><span class="token punctuation">;</span>        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"totalPageCount"</span><span class="token punctuation">,</span> totalPageCount<span class="token punctuation">)</span><span class="token punctuation">;</span>        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"totalCount"</span><span class="token punctuation">,</span>totalCount<span class="token punctuation">)</span><span class="token punctuation">;</span>        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"currentPageNo"</span><span class="token punctuation">,</span>pageIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//4. è½¬å‘åˆ°jsp/userlist.jspï¼Œ è¦ä½¿ç”¨è½¬å‘è€Œä¸æ˜¯é‡å®šå‘ï¼Œ ä¾¿äºæºå¸¦å‚æ•°</span>        req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"userlist.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>è¿™æ®µä»£ç å®ç°äº†ä¸€ä¸ªæŸ¥è¯¢ç”¨æˆ·çš„åŠŸèƒ½ï¼Œä»¥ä¸‹æ˜¯ä»£ç å®ç°çš„æ­¥éª¤ï¼š</p><ol><li><p>ä»å‰ç«¯è·å–ç”¨æˆ·è¾“å…¥çš„å‚æ•°ï¼šuserNameï¼ˆç”¨æˆ·åï¼‰ï¼ŒuserRoleï¼ˆç”¨æˆ·è§’è‰²ï¼‰ï¼ŒpageIndexï¼ˆå½“å‰é¡µç ï¼‰ã€‚</p></li><li><p>æ ¹æ®å‚æ•°è¿”å›ç”¨æˆ·è¡¨å’Œè§’è‰²è¡¨ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºè¯·æ±‚çš„å±æ€§ï¼Œä¾›jspæ–‡ä»¶ä½¿ç”¨ã€‚</p></li><li><p>å‡†å¤‡å‰ç«¯éœ€è¦çš„å‚æ•°ï¼š queryUserNameï¼ˆæŸ¥è¯¢ç”¨æˆ·åï¼‰ï¼ŒqueryUserRoleï¼ˆæŸ¥è¯¢ç”¨æˆ·è§’è‰²ï¼‰ï¼ŒroleListï¼ˆè§’è‰²åˆ—è¡¨ï¼‰ï¼ŒuserListï¼ˆç”¨æˆ·åˆ—è¡¨ï¼‰,totalPageCountï¼ˆæ€»é¡µæ•°ï¼‰ï¼ŒtotalCountï¼ˆæŸ¥è¯¢åˆ°çš„ç”¨æˆ·æ•°ï¼‰ï¼ŒcurrentPageNoï¼ˆå½“å‰é¡µï¼‰ã€‚</p></li><li><p>æŸ¥è¯¢ç”¨æˆ·æ•°ï¼Œå¹¶è®¾ç½®pageSupportçš„totalCountï¼ŒcurrentPageNoï¼ŒpageSizeå±æ€§ã€‚</p></li><li><p>æŸ¥è¯¢ç”¨æˆ·å’Œè§’è‰²ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºè¯·æ±‚çš„å±æ€§ï¼Œä¾›jspæ–‡ä»¶ä½¿ç”¨ã€‚</p></li><li><p>å°†å‰ç«¯éœ€è¦çš„å‚æ•°è®¾ç½®ä¸ºè¯·æ±‚çš„å±æ€§ï¼Œä¾›jspæ–‡ä»¶ä½¿ç”¨ã€‚</p></li><li><p>å°†è¯·æ±‚è½¬å‘åˆ°userlist.jspæ–‡ä»¶ï¼Œä¾¿äºæºå¸¦å‚æ•°ã€‚</p></li></ol><p>å…¶ä¸­ï¼Œä»£ç ä¸­è°ƒç”¨äº†UserServiceç±»å’ŒRoleServiceç±»çš„æ–¹æ³•å®ç°å…·ä½“çš„æŸ¥è¯¢æ“ä½œã€‚åŒæ—¶ï¼Œä»£ç ä¸­ä¹Ÿå¯¹è·å–çš„å‚æ•°è¿›è¡Œäº†ä¸€äº›åˆæ³•æ€§çš„æ£€éªŒå’Œè®¾ç½®é»˜è®¤å€¼çš„æ“ä½œã€‚æœ€ç»ˆï¼Œå°†æŸ¥è¯¢åˆ°çš„ç»“æœè®¾ç½®ä¸ºè¯·æ±‚çš„å±æ€§ï¼Œé€šè¿‡è½¬å‘çš„æ–¹å¼è¿”å›åˆ°jspæ–‡ä»¶ä¸­ä¾›å‰ç«¯å±•ç¤ºã€‚</p><h3 id="ç”¨æˆ·åˆ é™¤å®ç°">ç”¨æˆ·åˆ é™¤å®ç°</h3><p>åœ¨å‰ç«¯é¡µé¢æ‰¾åˆ°ç”¨æˆ·åˆ é™¤çš„æŒ‰é’®(é”š), hrefæ˜¯: <code>javascript:</code>,</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;td&gt;    &lt;span&gt;&lt;a class&#x3D;&quot;viewUser&quot; href&#x3D;&quot;javascript:;&quot; userid&#x3D;$&#123;user.id &#125; username&#x3D;$&#123;user.userName &#125;&gt;&lt;img src&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;statics&#x2F;images&#x2F;read.png&quot; alt&#x3D;&quot;æŸ¥çœ‹&quot; title&#x3D;&quot;æŸ¥çœ‹&quot;&#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;span&gt;    &lt;span&gt;&lt;a class&#x3D;&quot;modifyUser&quot; href&#x3D;&quot;javascript:;&quot; userid&#x3D;$&#123;user.id &#125; username&#x3D;$&#123;user.userName &#125;&gt;&lt;img src&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;statics&#x2F;images&#x2F;xiugai.png&quot; alt&#x3D;&quot;ä¿®æ”¹&quot; title&#x3D;&quot;ä¿®æ”¹&quot;&#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;span&gt;    &lt;span&gt;&lt;a class&#x3D;&quot;deleteUser&quot; href&#x3D;&quot;javascript:;&quot; userid&#x3D;$&#123;user.id &#125; username&#x3D;$&#123;user.userName &#125;&gt;&lt;img src&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;statics&#x2F;images&#x2F;schu.png&quot; alt&#x3D;&quot;åˆ é™¤&quot; title&#x3D;&quot;åˆ é™¤&quot;&#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;span&gt;&lt;&#x2F;td&gt;</code></pre><p>æ‰¾åˆ°å¯¹åº”çš„javascript</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".deleteUser"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>userObj <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">changeDLGContent</span><span class="token punctuation">(</span><span class="token string">"ä½ ç¡®å®šè¦åˆ é™¤ç”¨æˆ·ã€"</span><span class="token operator">+</span>userObj<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"ã€‘å—ï¼Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">openYesOrNoDLG</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å½“åˆ é™¤è¢«ç‚¹å‡»å, jsè°ƒç”¨å‡½æ•°<code>userObj</code>, æ¥ç€æˆ‘ä»¬å»çœ‹è¿™ä¸ªå‡½æ•°</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span>      <span class="token literal-property property">url</span><span class="token operator">:</span>path<span class="token operator">+</span><span class="token string">"/jsp/user.do"</span><span class="token punctuation">,</span>      <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">"deluser"</span><span class="token punctuation">,</span><span class="token literal-property property">uid</span><span class="token operator">:</span>obj<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"userid"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token literal-property property">dataType</span><span class="token operator">:</span><span class="token string">"json"</span><span class="token punctuation">,</span>      <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>delResult <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//åˆ é™¤æˆåŠŸï¼šç§»é™¤åˆ é™¤è¡Œ</span>            <span class="token function">cancleBtn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            obj<span class="token punctuation">.</span><span class="token function">parents</span><span class="token punctuation">(</span><span class="token string">"tr"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>delResult <span class="token operator">==</span> <span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//åˆ é™¤å¤±è´¥</span>            <span class="token function">changeDLGContent</span><span class="token punctuation">(</span><span class="token string">"å¯¹ä¸èµ·ï¼Œåˆ é™¤ç”¨æˆ·ã€"</span><span class="token operator">+</span>obj<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"ã€‘å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>delResult <span class="token operator">==</span> <span class="token string">"notexist"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">changeDLGContent</span><span class="token punctuation">(</span><span class="token string">"å¯¹ä¸èµ·ï¼Œç”¨æˆ·ã€"</span><span class="token operator">+</span>obj<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"ã€‘ä¸å­˜åœ¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token function">changeDLGContent</span><span class="token punctuation">(</span><span class="token string">"å¯¹ä¸èµ·ï¼Œåˆ é™¤å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ª JavaScript å‡½æ•°ï¼Œå®ƒä½¿ç”¨ jQuery çš„ <code>$.ajax</code> æ–¹æ³•å‘é€ä¸€ä¸ª GET è¯·æ±‚åˆ°æœåŠ¡å™¨ã€‚ä»¥ä¸‹æ˜¯å¯¹ä»£ç çš„åˆ†æï¼š</p><ol><li><p><code>function deleteUser(obj)</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå‘½åä¸º <code>deleteUser</code> çš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‚æ•° <code>obj</code>ï¼Œè¡¨ç¤ºè¦åˆ é™¤çš„ç”¨æˆ·å¯¹è±¡ã€‚</p></li><li><p><code>$.ajax</code>ï¼šè¿™æ˜¯ jQuery æä¾›çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå‘é€ AJAX è¯·æ±‚åˆ°æœåŠ¡å™¨ã€‚</p></li><li><p>AJAX è¯·æ±‚çš„é…ç½®é€‰é¡¹åŒ…æ‹¬ï¼š</p><ul><li><code>type: &quot;GET&quot;</code>ï¼šæŒ‡å®šè¯·æ±‚ç±»å‹ä¸º GETã€‚</li><li><code>url: path + &quot;/jsp/user.do&quot;</code>ï¼šæŒ‡å®šè¯·æ±‚çš„ URL åœ°å€ï¼Œå…¶ä¸­ <code>path</code> æ˜¯ä¸€ä¸ªå˜é‡æˆ–å¸¸é‡ï¼Œè¡¨ç¤ºæœåŠ¡å™¨è·¯å¾„ã€‚</li><li><code>data: &#123;method: &quot;deluser&quot;, uid: obj.attr(&quot;userid&quot;)&#125;</code>ï¼šæŒ‡å®šè¯·æ±‚å‘é€çš„æ•°æ®ï¼ŒåŒ…æ‹¬ <code>method</code> å’Œ <code>uid</code> ä¸¤ä¸ªå‚æ•°ã€‚<code>method</code> çš„å€¼ä¸º <code>&quot;deluser&quot;</code>ï¼Œ<code>uid</code> çš„å€¼é€šè¿‡ <code>obj.attr(&quot;userid&quot;)</code> è·å–ã€‚</li><li><code>dataType: &quot;json&quot;</code>ï¼šæŒ‡å®šé¢„æœŸçš„å“åº”æ•°æ®ç±»å‹ä¸º JSONã€‚</li></ul></li><li><p><code>success</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæˆåŠŸå›è°ƒå‡½æ•°ï¼Œåœ¨æœåŠ¡å™¨æˆåŠŸå“åº”æ—¶è¢«è°ƒç”¨ã€‚å®ƒæ¥å—ä¸€ä¸ªå‚æ•° <code>data</code>ï¼Œè¡¨ç¤ºä»æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€‚å‡½æ•°å†…éƒ¨æ ¹æ®è¿”å›çš„æ•°æ®æ‰§è¡Œä¸åŒçš„æ“ä½œï¼š</p><ul><li>å¦‚æœ <code>data.delResult</code> çš„å€¼ä¸º <code>&quot;true&quot;</code>ï¼Œè¡¨ç¤ºåˆ é™¤æˆåŠŸã€‚å‡½æ•°è°ƒç”¨ <code>cancleBtn()</code> å–æ¶ˆæŒ‰é’®ï¼Œå¹¶ç§»é™¤ <code>obj</code> å¯¹åº”çš„çˆ¶çº§ <code>&lt;tr&gt;</code> è¡Œã€‚</li><li>å¦‚æœ <code>data.delResult</code> çš„å€¼ä¸º <code>&quot;false&quot;</code>ï¼Œè¡¨ç¤ºåˆ é™¤å¤±è´¥ã€‚å‡½æ•°è°ƒç”¨ <code>changeDLGContent</code> ä¿®æ”¹å¯¹è¯æ¡†çš„å†…å®¹ï¼Œæ˜¾ç¤ºåˆ é™¤å¤±è´¥çš„æç¤ºä¿¡æ¯ã€‚</li><li>å¦‚æœ <code>data.delResult</code> çš„å€¼ä¸º <code>&quot;notexist&quot;</code>ï¼Œè¡¨ç¤ºç”¨æˆ·ä¸å­˜åœ¨ã€‚å‡½æ•°è°ƒç”¨ <code>changeDLGContent</code> ä¿®æ”¹å¯¹è¯æ¡†çš„å†…å®¹ï¼Œæ˜¾ç¤ºç”¨æˆ·ä¸å­˜åœ¨çš„æç¤ºä¿¡æ¯ã€‚</li></ul></li><li><p><code>error</code>ï¼šè¿™æ˜¯ä¸€ä¸ªé”™è¯¯å›è°ƒå‡½æ•°ï¼Œåœ¨è¯·æ±‚å‘ç”Ÿé”™è¯¯æ—¶è¢«è°ƒç”¨ã€‚å®ƒæ¥å—ä¸€ä¸ªå‚æ•° <code>data</code>ï¼Œè¡¨ç¤ºé”™è¯¯ä¿¡æ¯ã€‚å‡½æ•°è°ƒç”¨ <code>changeDLGContent</code> ä¿®æ”¹å¯¹è¯æ¡†çš„å†…å®¹ï¼Œæ˜¾ç¤ºåˆ é™¤å¤±è´¥çš„æç¤ºä¿¡æ¯ã€‚</p></li></ol><p>è¿™æ®µä»£ç ç”¨äºé€šè¿‡ AJAX è¯·æ±‚å‘æœåŠ¡å™¨å‘é€åˆ é™¤ç”¨æˆ·çš„è¯·æ±‚ï¼Œå¹¶æ ¹æ®æœåŠ¡å™¨è¿”å›çš„ç»“æœæ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚æˆåŠŸæ—¶ç§»é™¤å¯¹åº”çš„è¡Œï¼Œå¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯æç¤ºä¿¡æ¯ã€‚</p><p>é€šè¿‡è¿™äº›ä¿¡æ¯,æˆ‘ä»¬å¯ä»¥å¾—çŸ¥å¦‚ä½•ç¼–å†™æˆ‘ä»¬çš„åå°ç¨‹åº</p><ol><li>ç¼–å†™å¯¹åº”çš„Servlet, æ ¹æ®methodå€¼ä¸åŒ, è°ƒç”¨delUserå‡½æ•°</li><li>ç¼–å†™è¯·æ±‚å¤„ç†å‡½æ•°delUser</li><li>delUserè°ƒç”¨Serviceåˆ é™¤ç”¨æˆ·, å¹¶è¿”å›ç»“æœ<ol><li>å¦‚æœåˆ é™¤ç”¨æˆ·æˆåŠŸ, è¿”å›trueæˆ–è€…å—å½±å“è¡Œæ•°ä¸º1, é€šè¿‡å“åº”å‘å‰ç«¯è¿”å›æ•°æ®delResult = true</li><li>å¦‚æœServiceè¿”å›falseæˆ–è€…å—å½±å“è¡Œæ•°ä¸º0, å‘å‰ç«¯è¿”å›delResult = no exist, è¡¨ç¤ºåˆ é™¤çš„ç”¨æˆ·ä¸å­˜åœ¨.</li></ol></li><li>å‡ºç°å¼‚å¸¸åˆ™è¿”å›delResult = false(åœ¨è¿™é‡Œæ˜¯ç”¨æˆ·æƒé™ä¸å¤Ÿæ—¶è¿”å›ä¼šfalse)</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">delUser</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span><span class="token punctuation">&#123;</span>    <span class="token comment">//1. è·å–ç”¨æˆ·è§’è‰²ï¼Œ å¦‚æœç”¨æˆ·ä¸æ˜¯ç³»ç»Ÿç®¡ç†å‘˜ï¼Œ åˆ™æ²¡æœ‰åˆ é™¤ç”¨æˆ·çš„æƒé™</span>    <span class="token class-name">User</span> o <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">getUserRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> uid <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">boolean</span> res <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">delUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"delResult"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"delResult"</span><span class="token punctuation">,</span> <span class="token string">"notexist"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"delResult"</span><span class="token punctuation">,</span><span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å°è£…jsonæ•°æ®ï¼Œ å¹¶å†™åˆ°å‰ç«¯</span>    <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">JSONArray</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>æ¥ä¸‹æ¥, æˆ‘ä»¬è¿˜éœ€è¦ç¼–å†™å¯¹åº”çš„Serviceå±‚ä»¥åŠDaoå±‚ä»£ç , ç”±äºserviceå®é™…ä¸Šå¹¶æ²¡æœ‰åšä»€ä¹ˆäº‹, è¿™é‡Œåªå±•ç¤ºDaoå±‚ä»£ç </p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">delUser</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> affectedRow <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"Delete from smbms_user where id = ?"</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>id<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>            affectedRow <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> affectedRow<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™æ®µä»£ç åŠå…¶ç®€å•, åªéœ€è¦å†™ä¸€æ®µsql, ç„¶åäº¤ç»™DBå»æ‰§è¡Œå°±å¥½äº†, DBè¿™ä¸ªç±»ä¼šé¢„å¤„ç†sql, ä»¥åŠç»™å ä½ç¬¦èµ‹å€¼, æœ€åæ‰§è¡Œsqlè¿”å›ç»“æœ.</p><h3 id="æŸ¥çœ‹ç”¨æˆ·å®ç°">æŸ¥çœ‹ç”¨æˆ·å®ç°</h3><p>å’Œåˆ é™¤ç”¨æˆ·ç±»ä¼¼, æ‰¾åˆ°å¯¹åº”çš„jsè¯·æ±‚</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".viewUser"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token comment">//å°†è¢«ç»‘å®šçš„å…ƒç´ ï¼ˆaï¼‰è½¬æ¢æˆjqueryå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨jqueryæ–¹æ³•</span>   <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token operator">=</span>path<span class="token operator">+</span><span class="token string">"/jsp/user.do?method=view&amp;uid="</span><span class="token operator">+</span> obj<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"userid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ç¼–å†™Servlet</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span><span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> uid <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">User</span> user <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"/jsp/userview.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>ç¼–å†™daoå±‚, serviceå±‚å®ç°</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//2. åˆå§‹åŒ–å‚æ•°</span>    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>id<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token class-name">ResultSet</span> set<span class="token punctuation">;</span>    sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM smbms_user,smbms_role Where smbms_user.userRole = smbms_role.id and smbms_user.id = ?"</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        conn <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        set <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">,</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>set <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                user<span class="token punctuation">.</span><span class="token function">setUserRoleName</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"roleName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setUserPassword</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userPassword"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setUserCode</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userCode"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setBirthday</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Date</span><span class="token punctuation">)</span> set<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"birthday"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setPhone</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setIdPicPath</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"idPicPath"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setUserRole</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"userRole"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setCreatedBy</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"createdBy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setCreationDate</span><span class="token punctuation">(</span> set<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"creationDate"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setModifyBy</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"modifyBy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setModifyDate</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"modifyDate"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                user<span class="token punctuation">.</span><span class="token function">setWorkPicPath</span><span class="token punctuation">(</span><span class="token string">"workPicPath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//å…³é—­é“¾æ¥å’Œç»“æœé›†</span>        <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> user<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="ä¿®æ”¹ç”¨æˆ·å®ç°">ä¿®æ”¹ç”¨æˆ·å®ç°</h3><p>é‡å¤é‡å¤å†é‡å¤â€¦</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".modifyUser"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token operator">=</span>path<span class="token operator">+</span><span class="token string">"/jsp/user.do?method=modify&amp;uid="</span><span class="token operator">+</span> obj<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"userid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span><span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> uid <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">User</span> user <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"/jsp/usermodify.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å’Œä¹‹å‰ä¸åŒçš„æ˜¯, è¿™æ¬¡ä¿®æ”¹ç”¨æˆ·æŒ‡å‘ä¸€ä¸ªæ–°çš„jspé¡µé¢, ä¹Ÿå°±æ˜¯ä¿®æ”¹ç”¨æˆ·çš„é¡µé¢. ä¹Ÿå°±æ˜¯è¯´, åˆ é™¤ç”¨æˆ·çš„è¯·æ±‚æäº¤ä»¥å, æˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªè¯·æ±‚è½¬å‘åˆ°<code>/jsp/usermodify.jsp</code>è¿™ä¸ªURLå¯¹åº”çš„jspé¡µé¢å», ç”±äºè¿™ä¸ªjspé¡µé¢éœ€è¦ä¿®æ”¹å‰çš„useræ•°æ®, æˆ‘ä»¬éœ€è¦æŸ¥è¯¢å¯¹åº”çš„id,å¾—åˆ°useræ•°æ®åæŠŠæ•°æ®ä¼ é€’ç»™<code>usermodify.jsp</code>è¿™ä¸ªjspé¡µé¢, jspé¡µé¢éœ€è¦è¿™äº›æ•°æ®æ¥å‘ç”¨æˆ·å±•ç¤ºä¿®æ”¹å‰çš„æ•°æ®. ä¸‹é¢æˆ‘ä»¬å»çœ‹è¿™ä¸ªjspé¡µé¢</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ page contentType&#x3D;&quot;text&#x2F;html;charset&#x3D;UTF-8&quot; language&#x3D;&quot;java&quot; %&gt;&lt;%@include file&#x3D;&quot;&#x2F;jsp&#x2F;common&#x2F;head.jsp&quot;%&gt;&lt;div class&#x3D;&quot;right&quot;&gt;    &lt;div class&#x3D;&quot;location&quot;&gt;        &lt;strong&gt;ä½ ç°åœ¨æ‰€åœ¨çš„ä½ç½®æ˜¯:&lt;&#x2F;strong&gt;        &lt;span&gt;ç”¨æˆ·ç®¡ç†é¡µé¢ &gt;&gt; ç”¨æˆ·ä¿®æ”¹é¡µé¢&lt;&#x2F;span&gt;    &lt;&#x2F;div&gt;    &lt;div class&#x3D;&quot;providerAdd&quot;&gt;        &lt;form id&#x3D;&quot;userForm&quot; name&#x3D;&quot;userForm&quot; method&#x3D;&quot;post&quot; action&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;jsp&#x2F;user.do&quot;&gt;            &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;method&quot; value&#x3D;&quot;modifyexe&quot;&gt;            &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;uid&quot; value&#x3D;&quot;$&#123;user.id &#125;&quot;&#x2F;&gt;            &lt;div&gt;                &lt;label for&#x3D;&quot;userName&quot;&gt;ç”¨æˆ·åç§°ï¼š&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;userName&quot; id&#x3D;&quot;userName&quot; value&#x3D;&quot;$&#123;user.userName &#125;&quot;&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;                &lt;label &gt;ç”¨æˆ·æ€§åˆ«ï¼š&lt;&#x2F;label&gt;                &lt;select name&#x3D;&quot;gender&quot; id&#x3D;&quot;gender&quot;&gt;                    &lt;c:choose&gt;                        &lt;c:when test&#x3D;&quot;$&#123;user.gender &#x3D;&#x3D; 1 &#125;&quot;&gt;                            &lt;option value&#x3D;&quot;1&quot; selected&#x3D;&quot;selected&quot;&gt;ç”·&lt;&#x2F;option&gt;                            &lt;option value&#x3D;&quot;2&quot;&gt;å¥³&lt;&#x2F;option&gt;                        &lt;&#x2F;c:when&gt;                        &lt;c:otherwise&gt;                            &lt;option value&#x3D;&quot;1&quot;&gt;ç”·&lt;&#x2F;option&gt;                            &lt;option value&#x3D;&quot;2&quot; selected&#x3D;&quot;selected&quot;&gt;å¥³&lt;&#x2F;option&gt;                        &lt;&#x2F;c:otherwise&gt;                    &lt;&#x2F;c:choose&gt;                &lt;&#x2F;select&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;                &lt;label &gt;å‡ºç”Ÿæ—¥æœŸï¼š&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;text&quot; Class&#x3D;&quot;Wdate&quot; id&#x3D;&quot;birthday&quot; name&#x3D;&quot;birthday&quot; value&#x3D;&quot;$&#123;user.birthday &#125;&quot;                       readonly&#x3D;&quot;readonly&quot; onclick&#x3D;&quot;WdatePicker();&quot;&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;                &lt;label &gt;ç”¨æˆ·ç”µè¯ï¼š&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;phone&quot; id&#x3D;&quot;phone&quot; value&#x3D;&quot;$&#123;user.phone &#125;&quot;&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;                &lt;label &gt;ç”¨æˆ·åœ°å€ï¼š&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;address&quot; id&#x3D;&quot;address&quot; value&#x3D;&quot;$&#123;user.address &#125;&quot;&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;                &lt;label &gt;ç”¨æˆ·è§’è‰²ï¼š&lt;&#x2F;label&gt;                &lt;!-- åˆ—å‡ºæ‰€æœ‰çš„è§’è‰²åˆ†ç±» --&gt;                &lt;input type&#x3D;&quot;hidden&quot; value&#x3D;&quot;$&#123;user.userRole&#125;&quot; id&#x3D;&quot;rid&quot; &#x2F;&gt;                &lt;select name&#x3D;&quot;userRole&quot; id&#x3D;&quot;userRole&quot;&gt;&lt;&#x2F;select&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div class&#x3D;&quot;providerAddBtn&quot;&gt;                &lt;input type&#x3D;&quot;button&quot; name&#x3D;&quot;save&quot; id&#x3D;&quot;save&quot; value&#x3D;&quot;ä¿å­˜&quot; &#x2F;&gt;                &lt;input type&#x3D;&quot;button&quot; id&#x3D;&quot;back&quot; name&#x3D;&quot;back&quot; value&#x3D;&quot;è¿”å›&quot;&#x2F;&gt;            &lt;&#x2F;div&gt;        &lt;&#x2F;form&gt;    &lt;&#x2F;div&gt;&lt;&#x2F;div&gt;&lt;&#x2F;section&gt;&lt;%@include file&#x3D;&quot;&#x2F;jsp&#x2F;common&#x2F;foot.jsp&quot; %&gt;&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;statics&#x2F;js&#x2F;usermodify.js&quot;&gt;&lt;&#x2F;script&gt;</code></pre><p>å…ˆè§‚å¯Ÿè¡¨å•æäº¤çš„ç›®çš„åœ°, <code>&#123;pageContext.request.contextPath &#125;/jsp/user.do</code>, å¯¹åº”ä¸€ä¸ªServlet, ä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰æäº¤çš„æŒ‰é’®, ä½†æ˜¯æˆ‘å‘ç°è¿™é‡Œæœ‰ä¸€ä¸ª<code>usermodify.js</code>çš„è„šæœ¬æ–‡ä»¶, å®šä½åˆ°è¿™ä¸ªè„šæœ¬æ–‡ä»¶</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> userName <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> birthday <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> phone <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> userRole <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> saveBtn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> backBtn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   userName <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#userName"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   birthday <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#birthday"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   phone <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#phone"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   userRole <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#userRole"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   saveBtn <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#save"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   backBtn <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#back"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      userName<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   birthday<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   phone<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   userRole<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span><span class="token comment">//è¯·æ±‚ç±»å‹</span>      <span class="token literal-property property">url</span><span class="token operator">:</span>path<span class="token operator">+</span><span class="token string">"/jsp/user.do"</span><span class="token punctuation">,</span><span class="token comment">//è¯·æ±‚çš„url</span>      <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">"getrolelist"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token comment">//è¯·æ±‚å‚æ•°</span>      <span class="token literal-property property">dataType</span><span class="token operator">:</span><span class="token string">"json"</span><span class="token punctuation">,</span><span class="token comment">//ajaxæ¥å£ï¼ˆè¯·æ±‚urlï¼‰è¿”å›çš„æ•°æ®ç±»å‹</span>      <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//dataï¼šè¿”å›æ•°æ®ï¼ˆjsonå¯¹è±¡ï¼‰</span>         <span class="token keyword">if</span><span class="token punctuation">(</span>data <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">var</span> rid <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#rid"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            userRole<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token string">"&lt;option value=\"0\">è¯·é€‰æ‹©&lt;/option>"</span><span class="token punctuation">;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>               <span class="token keyword">if</span><span class="token punctuation">(</span>rid <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> rid <span class="token operator">!=</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">==</span> rid <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                  options <span class="token operator">+=</span> <span class="token string">"&lt;option selected=\"selected\" value=\""</span><span class="token operator">+</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token operator">+</span><span class="token string">"\" >"</span><span class="token operator">+</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>roleName<span class="token operator">+</span><span class="token string">"&lt;/option>"</span><span class="token punctuation">;</span>               <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                  options <span class="token operator">+=</span> <span class="token string">"&lt;option value=\""</span><span class="token operator">+</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token operator">+</span><span class="token string">"\" >"</span><span class="token operator">+</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>roleName<span class="token operator">+</span><span class="token string">"&lt;/option>"</span><span class="token punctuation">;</span>               <span class="token punctuation">&#125;</span>                           <span class="token punctuation">&#125;</span>            userRole<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//å½“è®¿é—®æ—¶å€™ï¼Œ404ï¼Œ500 ç­‰é200çš„é”™è¯¯çŠ¶æ€ç </span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>userRole<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo<span class="token operator">+</span><span class="token string">" è·å–ç”¨æˆ·è§’è‰²åˆ—è¡¨error"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         userName<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>userName<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* ç”¨æˆ·åé•¿åº¦å¿…é¡»æ˜¯å¤§äº1å°äº10çš„å­—ç¬¦"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>userName<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> userName<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">1</span>             <span class="token operator">&amp;&amp;</span> userName<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>userName<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>userName<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo<span class="token operator">+</span><span class="token string">" ç”¨æˆ·åè¾“å…¥çš„ä¸ç¬¦åˆè§„èŒƒï¼Œè¯·é‡æ–°è¾“å…¥"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>         <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      birthday<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>birthday<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* ç‚¹å‡»è¾“å…¥æ¡†ï¼Œé€‰æ‹©æ—¥æœŸ"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>birthday<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> birthday<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>birthday<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>birthday<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" é€‰æ‹©çš„æ—¥æœŸä¸æ­£ç¡®,è¯·é‡æ–°è¾“å…¥"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      phone<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>phone<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* è¯·è¾“å…¥æ‰‹æœºå·"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">var</span> patrn<span class="token operator">=</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(13[0-9]|15[0-9]|18[0-9])\d&#123;8&#125;$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>phone<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>patrn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>phone<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>phone<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" æ‚¨è¾“å…¥çš„æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      userRole<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>userRole<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* è¯·é€‰æ‹©ç”¨æˆ·è§’è‰²"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>userRole<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> userRole<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>userRole<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>userRole<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo<span class="token operator">+</span><span class="token string">" è¯·é‡æ–°é€‰æ‹©ç”¨æˆ·è§’è‰²"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>         <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      saveBtn<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      userName<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      phone<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      birthday<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      userRole<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>userName<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span>          <span class="token operator">&amp;&amp;</span> phone<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span>         <span class="token operator">&amp;&amp;</span> birthday<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span>         <span class="token operator">&amp;&amp;</span> userRole<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">"æ˜¯å¦ç¡®è®¤è¦æäº¤æ•°æ®ï¼Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#userForm"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      backBtn<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token comment">//alert("modify: "+referer);</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>referer <span class="token operator">!=</span> <span class="token keyword">undefined</span>          <span class="token operator">&amp;&amp;</span> <span class="token keyword">null</span> <span class="token operator">!=</span> referer          <span class="token operator">&amp;&amp;</span> <span class="token string">""</span> <span class="token operator">!=</span> referer         <span class="token operator">&amp;&amp;</span> <span class="token string">"null"</span> <span class="token operator">!=</span> referer         <span class="token operator">&amp;&amp;</span> referer<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>       window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> referer<span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>         history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>ç›´æ¥ä¸¢ç»™chatGPTåˆ†æ:</strong></p><ul><li><p>ä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†æ˜¯ä»¥ä¸‹éƒ¨åˆ†ï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript">$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>  <span class="token literal-property property">url</span><span class="token operator">:</span> path <span class="token operator">+</span> <span class="token string">"/jsp/user.do"</span><span class="token punctuation">,</span>  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"getrolelist"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span>  <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">var</span> rid <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#rid"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      userRole<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token string">"&lt;option value=\"0\">è¯·é€‰æ‹©&lt;/option>"</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>rid <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> rid <span class="token operator">!=</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">==</span> rid<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          options <span class="token operator">+=</span> <span class="token string">"&lt;option selected=\"selected\" value=\""</span> <span class="token operator">+</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">"\" >"</span> <span class="token operator">+</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>roleName <span class="token operator">+</span> <span class="token string">"&lt;/option>"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>          options <span class="token operator">+=</span> <span class="token string">"&lt;option value=\""</span> <span class="token operator">+</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">"\" >"</span> <span class="token operator">+</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>roleName <span class="token operator">+</span> <span class="token string">"&lt;/option>"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>      userRole<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">validateTip</span><span class="token punctuation">(</span>userRole<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"color"</span><span class="token operator">:</span> <span class="token string">"red"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> imgNo <span class="token operator">+</span> <span class="token string">" è·å–ç”¨æˆ·è§’è‰²åˆ—è¡¨error"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è¿™éƒ¨åˆ†ä»£ç ä½¿ç”¨äº† <code>$.ajax</code> å‡½æ•°å‘èµ·ä¸€ä¸ª GET è¯·æ±‚ï¼Œè¯·æ±‚çš„ç›®æ ‡ URL æ˜¯ <code>path + &quot;/jsp/user.do&quot;</code>ã€‚è¯·æ±‚çš„æ•°æ®å‚æ•°ä¸­åŒ…å«äº†ä¸€ä¸ªåä¸º <code>method</code> çš„å‚æ•°ï¼Œå…¶å€¼ä¸º <code>&quot;getrolelist&quot;</code>ã€‚é¢„æœŸçš„å“åº”æ•°æ®ç±»å‹ä¸º JSONã€‚</p><p>åœ¨æˆåŠŸå›è°ƒå‡½æ•°ä¸­ï¼Œé¦–å…ˆåˆ¤æ–­è¿”å›çš„æ•°æ® <code>data</code> æ˜¯å¦ä¸ºéç©ºã€‚å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™ç»§ç»­æ‰§è¡Œåç»­é€»è¾‘ã€‚</p><p>é€šè¿‡è·å– <code>$(&quot;#rid&quot;).val()</code> è·å–ä¸€ä¸ªè¡¨ç¤ºè§’è‰²çš„ ID å€¼ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæ¸…ç©º <code>userRole</code> å…ƒç´ çš„å†…å®¹ï¼Œç„¶åä½¿ç”¨å¾ªç¯éå†è¿”å›çš„æ•°æ®æ•°ç»„ <code>data</code>ã€‚å¯¹äºæ¯ä¸ªæ•°æ®é¡¹ï¼Œæ ¹æ®å…¶ ID å€¼å’Œå½“å‰é€‰ä¸­çš„è§’è‰² ID (<code>rid</code>) è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœä¸¤è€…ç›¸ç­‰ï¼Œè¯´æ˜è¯¥é€‰é¡¹åº”è¯¥è¢«é€‰ä¸­ï¼Œå¦åˆ™ä¸ºæ™®é€šé€‰é¡¹ã€‚åœ¨å¾ªç¯è¿‡ç¨‹ä¸­ï¼ŒåŠ¨æ€ç”Ÿæˆäº†ä¸€æ®µ HTML å­—ç¬¦ä¸² <code>options</code>ï¼ŒåŒ…å«äº†æ‰€æœ‰çš„é€‰é¡¹ã€‚</p><p>æœ€åï¼Œå°†ç”Ÿæˆçš„é€‰é¡¹å­—ç¬¦ä¸²è®¾ç½®ä¸º <code>userRole</code> å…ƒç´ çš„ HTML å†…å®¹ï¼Œä»è€Œåœ¨é¡µé¢ä¸Šæ˜¾ç¤ºè¿™äº›é€‰é¡¹ã€‚</p><p>åœ¨é”™è¯¯å›è°ƒå‡½æ•°ä¸­ï¼Œå¯¹è·å–ç”¨æˆ·è§’è‰²åˆ—è¡¨å‡ºé”™çš„æƒ…å†µè¿›è¡Œå¤„ç†ï¼Œè°ƒç”¨ <code>validateTip</code> å‡½æ•°æ˜¾ç¤ºç›¸åº”çš„é”™è¯¯æç¤ºä¿¡æ¯ã€‚</p><p>è¯¥éƒ¨åˆ†ä»£ç çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯é€šè¿‡ AJAX è¯·æ±‚è·å–ç”¨æˆ·è§’è‰²åˆ—è¡¨ï¼Œå¹¶æ ¹æ®è¿”å›çš„æ•°æ®åŠ¨æ€ç”Ÿæˆä¸‹æ‹‰é€‰é¡¹ï¼Œç”¨äºç”¨æˆ·åœ¨è¡¨å•ä¸­é€‰æ‹©è§’è‰²ã€‚</p><p>æ‰€ä»¥, æˆ‘ä»¬éœ€è¦ä¸€ä¸ªservletæ¥å¤„ç†è¿™æ®µajaxè¯·æ±‚, è¿™ä¸ªè¯·æ±‚éœ€è¦ä¸€ä¸ªè§’è‰²è¡¨</p></li></ul><p>,æ•´ç†å‰ç«¯æä¾›çš„æ•°æ®, ä»¥åŠå‰ç«¯éœ€è¦çš„æ•°æ®</p><ul><li><p>æä¾›çš„æ•°æ®:</p><ul><li><code>name=&quot;method&quot; value=&quot;modifyexe&quot;</code></li><li><code>name=&quot;uid&quot; value=&quot;$&#123;user.id &#125;</code></li><li><code>name=&quot;userName&quot; value=&quot;$&#123;user.userName &#125;</code></li><li><code>name=&quot;gender&quot;</code></li><li><code>name=&quot;birthday&quot; value=&quot;$&#123;user.birthday &#125;</code></li><li><code>name=&quot;phone&quot; value=&quot;$&#123;user.phone &#125;</code></li><li><code>name=&quot;address&quot;  value=&quot;$&#123;user.address &#125;</code></li><li><code>name=&quot;userRole&quot;</code></li></ul></li><li><p>éœ€è¦çš„æ•°æ®</p><ul><li><code>name=&quot;birthday&quot; value=&quot;$&#123;user.birthday &#125;</code></li><li><code>name=&quot;phone&quot; value=&quot;$&#123;user.phone &#125;</code></li><li><code>name=&quot;address&quot;  value=&quot;$&#123;user.address &#125;</code></li><li><code>name=&quot;uid&quot; value=&quot;$&#123;user.id &#125;</code></li><li><code>name=&quot;userName&quot; value=&quot;$&#123;user.userName &#125;</code></li><li>è§’è‰²è¡¨</li></ul></li></ul><p><strong>ä¸‹é¢æˆ‘ä»¬æ¥ç¼–å†™servlet</strong></p><ol><li><p>é€šè¿‡methodçš„å€¼å¯¹è¯·æ±‚åšä¸åŒå¤„ç†, è¿™é‡Œæœ‰ä¸‰ä¸ªä¸ªè¯·æ±‚, åˆ†åˆ«æ˜¯</p><ol><li><code>method=modify</code></li><li><code>method = getrolelist</code></li><li><code>metho=modidyexe</code></li></ol></li><li><p><code>method=modify</code> è¿™ä¸ªè¯·æ±‚å½“ç”¨æˆ·ç‚¹å‡»ä¿®æ”¹æŒ‰é’®æ—¶è¢«è§¦å‘, ç›®çš„æ˜¯å¯¼èˆªåˆ°ç”¨æˆ·ä¿®æ”¹é¡µé¢, ä»¥åŠè¿”å›ä¿®æ”¹ç”¨æˆ·çš„ä¿¡æ¯</p></li><li><p><code>method = getrolelist</code> è¿™ä¸ªè¯·æ±‚å½“ç”¨æˆ·è·³è½¬åˆ°ç”¨æˆ·ä¿®æ”¹é¡µé¢è§¦å‘, ç›®çš„æ˜¯é€šè¿‡ AJAX è¯·æ±‚è·å–ç”¨æˆ·è§’è‰²åˆ—è¡¨ï¼Œå¹¶æ ¹æ®è¿”å›çš„æ•°æ®åŠ¨æ€ç”Ÿæˆä¸‹æ‹‰é€‰é¡¹ï¼Œç”¨äºç”¨æˆ·åœ¨è¡¨å•ä¸­é€‰æ‹©è§’è‰²ã€‚</p></li><li><p><code>metho=modidyexe</code>, è¿™ä¸ªè¯·æ±‚å½“ç”¨æˆ·æäº¤ä¿®æ”¹ä¿¡æ¯çš„æ—¶å€™è§¦å‘, ä¿®æ”¹æ•°æ®åº“å†…å®¹</p><p>ä¸€ä¸ªå¤ç”¨çš„Servlet, ç”¨æ¥å“åº”å¯¹ç”¨æˆ·è¡¨è¿›è¡Œæ“ä½œçš„è¯·æ±‚. (å®é™…ä¸Šç»„åˆæŸ¥è¯¢äº†è§’è‰²è¡¨)</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"savepwd"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">savePwd</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"pwdmodify"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">pwdModify</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"query"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">query</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"add"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">addUser</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"getrolelist"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">getRoleList</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"ucexist"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ajaxåå°éªŒè¯--userCodeæ˜¯å¦å·²å­˜åœ¨</span>        <span class="token comment">//    //user.do?method=ucexist&amp;userCode=**</span>        <span class="token function">isUserCodeExit</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"view"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">view</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"deluser"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">delUser</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"modifyexe"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">modifyExe</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"modify"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">modify</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>â€‹       ==getRoleList(req, resp)==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">getRoleList</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">RoleServiceImpl</span> roleService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RoleServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">></span></span> roleList <span class="token operator">=</span> roleService<span class="token punctuation">.</span><span class="token function">getRoleList</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    resp<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">JSONArray</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>roleList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>â€‹        ==modify(req, resp);==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span><span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> uid <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">User</span> user <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"/jsp/usermodify.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>â€‹        ==modifyExe(req, resp);==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">modifyExe</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 1. ä»å‰ç«¯è·å–å‚æ•°: userCode userName password gender birthday phone address userRole</span>    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> uid <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"userName"</span><span class="token punctuation">,</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"userName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">,</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">,</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"userRole"</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"userRole"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> birthday <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"birthday"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>birthday<span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"birthday"</span><span class="token punctuation">,</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ParseException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 2. å°è£…æ•°æ®</span>    <span class="token class-name">User</span> o <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"modifyBy"</span><span class="token punctuation">,</span>o<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Date</span> modifyDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"modifyDate"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//3. è°ƒç”¨service</span>    service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> map<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">boolean</span> res <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"/jsp/user.do?method=query"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å‰©ä¸‹çš„ç¼–å†™Serviceä»¥åŠDaoå±‚å®ç°å¯¹æ•°æ®åº“çš„æ“ä½œ, æ•´ä¸ªåŠŸèƒ½å°±å®ç°äº†. è¿™é‡Œä¸åœ¨å™è¿°.</p><h2 id="å°¾å·´">å°¾å·´</h2><p>â€‹åˆ°è¿™é‡Œ, è¿™ä¸ªé¡¹ç›®çš„æ­å»ºç®—æ˜¯å‘Šä¸€æ®µè½äº†. åœ¨è¿™ä¸ªé¡¹ç›®ä¸­, æˆ‘åŸºæœ¬ä¸Šæ˜¯ä»é›¶å¼€å§‹æ­å»º. è¯´æ¥æƒ­æ„§, ç°åœ¨å¤§ä¸‰ä¸‹ä¸‹å­¦æœŸå·²ç»è¿‡åŠ, å­¦æ ¡çš„JavaEEä¹Ÿç»“è¯¾ä¸¤å‘¨. æˆ‘å¯¹æ•´ä¸ªè¯¾ç¨‹å´æ²¡ä»€ä¹ˆå°è±¡, è¿™å½“ç„¶ä¹Ÿå’Œæˆ‘æ ¹æœ¬æ²¡å»ä¸Šå‡ æ¬¡è¯¾æœ‰å…³ç³», é™¤äº†å®éªŒè¯¾æˆ‘åŸºæœ¬å°±ä¸å»äº†. è¿™ä¹Ÿä¸æ˜¯æˆ‘ä¸æƒ³å­¦, åªæ˜¯è§‰å¾—è¦æ˜¯è·Ÿç€è€å¸ˆå­¦æˆ‘ä¼šæ›´ç³Ÿ. è€å¸ˆä¸Šè¯¾å®Œå…¨ä¸é¡¾å­¦ç”Ÿ, åªå°†ç”µè„‘çš„ideaæŠ•å±åˆ°æŠ•å½±ä»ªä¸Šä¾¿èƒ½è‡ªé¡¾è‡ªçš„è®²ä¸€èŠ‚è¯¾. æŠ•å½±ä»ªæœ¬æ¥äº®åº¦å°±ä¸é«˜, ideaå­—ä½“åˆå°,å®Œå…¨ä¸çŸ¥é“æ€ä¹ˆå¬. å¬è¿‡å‡ æ¬¡æˆ‘å°±æ˜¯åœ¨ä¸æƒ³å»äº†.</p><p>â€‹åŠ ä¹‹åˆæœ‰è€ƒç ”çš„è®¡åˆ’, åŸºæœ¬éƒ½å‘†åœ¨å›¾ä¹¦é¦†å­¦ä¹ é«˜æ•°å’Œè®¡ç®—æœºç½‘ç»œäº†, JavaEEåŸºæœ¬ä¸Šæ²¡æ€ä¹ˆç¢°äº†, è¿åˆ†ç»„çš„å®è·µä¹Ÿæ˜¯å®Œå…¨ä¸¢ä¸‹ç»™å°ç»„å…¶ä»–åŒå­¦äº†(å°ç»„å®è·µèƒ½ä¸èƒ½ä»å¤§å­¦æ¶ˆå¤±å•Š). å°ç»„å…¶ä»–å‡ ä¸ªä¹Ÿéƒ½æ˜¯æ··å­, è¿™ç•™ä¸‹æˆ‘çš„æ—è¾¹åºŠé“ºçš„å®¤å‹äº†, è¿™è®©æˆ‘æ„Ÿè§‰å®åœ¨å¾ˆæƒ­æ„§. å½“ç„¶æœ€åçš„ç»“æœä¹Ÿæ˜¯å‹æ ¹æ²¡äººç®¡è¿™ä¸ªå°ç»„å®è·µäº†, ç›´åˆ°deadlineçš„å‰ä¸€å¤©æ™šä¸Š, è¿™äº‹æ‰è¢«é‡æ–°æèµ·. å½“ç„¶ä¹Ÿåªèƒ½ä»githubåŒ†åŒ†æ‰¾ä¸€ä¸ªåº”ä»˜äº¤ä½œä¸šäº†.</p><p>â€‹é‚£ä¹ˆå¦‚æœæ€»ç»“è¿™åŠå­¦æœŸå­¦åˆ°äº†ä»€ä¹ˆçš„è¯, åªå‰©ä¸‹æŠŠè®¡ç®—æœºç½‘ç»œç®—æ˜¯å®Œå®Œæ•´æ•´çš„å­¦å®Œäº†, ä¸è¿‡è¿™ä¹Ÿæ˜¯è¡¥äº†ä¹‹å‰æ¬ ä¸‹çš„å€ºäº†. é«˜æ•°æˆ‘å·²ç»æ¥è¿‘ä¸€ä¸ªæœˆæ²¡æœ‰çœ‹è¿‡äº†, ç°åœ¨ä¹Ÿå·²ç»æ²¡ä»€ä¹ˆå°è±¡äº†, ä¸çŸ¥é“è€ƒç ”è¦æ€ä¹ˆåŠäº†.  æˆ‘ä¹Ÿå·²ç»åšå¥½äº†äºŒæˆ˜çš„å‡†å¤‡äº†.</p><p>â€‹å†™è¿™ä¸ªé¡¹ç›®çš„å¥‘æœº, ä¹Ÿæ˜¯å­¦æ ¡åˆè«åå…¶å¦™å¤šäº†ä¸ªè¯¾ç¨‹è®¾è®¡, ç›¸æ¯”å­¦æ ¡çš„ä»€ä¹ˆç ´å®éªŒå®è·µ, æˆ‘å¾ˆå–œæ¬¢å­¦æ ¡çš„è¯¾ç¨‹è®¾è®¡, ä¸Šæ¬¡æ“ä½œç³»ç»Ÿçš„å®è·µè®¾è®¡æ˜¯å…³äºxv6çš„, é‚£æ¬¡è®©æˆ‘å¯¹æ“ä½œç³»ç»Ÿçš„ç†è§£æå‡äº†å¾ˆå¤š, ç°åœ¨æˆ‘éƒ½ä¸èˆå¾—åˆ æ‰ç”µè„‘é‡Œçš„qemuæ¨¡æ‹Ÿå™¨. ä¸è¿‡è¿™å’Œè€å¸ˆæ²¡ä»€ä¹ˆå…³ç³», è€å¸ˆåŸºæœ¬ä¸Šåªæ˜¯æŠŠè¯¾é¢˜æ‰”åœ¨é‚£, æˆ‘ä»¬è‡ªå·±ç‹¬ç«‹å®Œæˆ. ä½†ä¹ŸåŒæ—¶æˆ‘æœ‰äº†æ›´å¤šçš„æ—¶é—´å»å®Œæˆè¿™ä¸ªè¯¾ç¨‹è®¾è®¡, æ²¡æœ‰å…¶ä»–è¯¾ç¨‹ä»»åŠ¡çš„å¹²æ‰°, æˆ‘å¯ä»¥å…¨å¿ƒå…¨æ„çš„æŠ•å…¥åˆ°è¿™ä¸ªè¯¾ç¨‹è®¾è®¡ä¸­å». è¿™å¾ˆç¬¦åˆæˆ‘è‡ªå·±çš„å­¦ä¹ ä¹ æƒ¯, æˆ‘æ›´å–œæ¬¢æŠŠä¸€ä¸ªè¯¾ç¨‹å­¦å®Œäº†, æˆ–è€…æ˜¯ä¸€ä¸ªé˜¶æ®µçš„ä»»åŠ¡å®Œæˆäº†, æ‰å»å¼€å§‹ä¸‹ä¸€é¡¹å­¦ä¹ è®¡åˆ’. ç›¸æ¯”äºå»è¯¾å ‚ä¸Šå¬æ— æ„ä¹‰çš„è¯¾ç¨‹, è¿™ç§æŠŠæ—¶é—´ç•™ç»™å­¦ç”Ÿè‡ªå·±çš„åšæ³•, åœ¨è¿™ä¸ªå¤§å­¦è€å¸ˆåŸºæœ¬ä¸Šèµ·ä¸åˆ°ä»€ä¹ˆå¸®åŠ©çš„ç ´å¤§å­¦é‡Œ, æ˜¾ç„¶æ˜¯æ›´å€¼å¾—çš„.</p><p>â€‹è¯´å›å†™è¿™ä¸ªé¡¹ç›®çš„å¥‘æœº, ä¹Ÿæ˜¯å­¦æ ¡çš„è¯¾ç¨‹è®¾è®¡. åˆ°è¿™ä¸ªæ—¶å€™æ‰€ä»¥çš„è¯¾ç¨‹ä¹Ÿå·²ç»ç»“æŸäº†, æˆ‘æœ¬ä»¥ä¸ºå¯ä»¥å®Œå®Œå…¨å…¨çš„å¼€å§‹è‡ªå·±çš„å­¦ä¹ è®¡åˆ’çš„æ—¶å€™, æ¥è¿™ä¹ˆä¸€ä¸ªä»»åŠ¡ä¸€å¼€å§‹æˆ‘æ˜¯è›®ä¸å¼€å¿ƒçš„. è¿™æ¬¡çš„ä»»åŠ¡æ˜¯å†™ä¸€ä¸ªå›¾ä¹¦ç®¡ç†ç³»ç»Ÿ, ç‹‚ç¥è¿™ä¸ªè¯¾ç¨‹å†™äº†ä¸€ä¸ªè¶…å¸‚ç®¡ç†ç³»ç»Ÿ, ä½†æ˜¯è¿™äº›ä»€ä¹ˆå­¦ç”Ÿç®¡ç†ç³»ç»Ÿå•Š, å›¾ä¹¦ç®¡ç†ç³»ç»Ÿä¹‹ç±»çš„, éƒ½æ²¡åŒºåˆ«, éšä¾¿æ”¹ä¸€æ”¹å°±å¯ä»¥.</p><p>â€‹è¿™æ¬¡çš„è¯¾ç¨‹è®¾è®¡åˆ†ä¸ºäº†å‡ ä¸ªå°ç»„, å’Œå…¶ä»–å°ç»„ä¸åŒçš„æ˜¯, æˆ‘ä»¬å°ç»„çš„è€å¸ˆè¦æ±‚æ¯ä¸ªåŒå­¦ç‹¬ç«‹å®Œæˆ, è¿™è®©æˆ‘å¾ˆå–œè¿™ä¸ªè€å¸ˆçš„åšæ³•. è€Œæˆ‘ä»¬æ¯å¤©ä¸Šè¯¾çš„å†…å®¹ä¹Ÿå°±æ˜¯åœ¨è‡ªä¹ å®¤å†™è‡ªå·±çš„é¡¹ç›®ç½¢äº†, é™¤äº†æ—©ä¸Šå…«ç‚¹è¦çˆ¬ä¸Š11æ¥¼å¤–, æˆ‘æ²¡ä»€ä¹ˆæŠ±æ€¨çš„.</p><p>â€‹æ¥ä¸‹æ¥çš„å­¦ä¹ è®¡åˆ’, æˆ‘å‡†å¤‡æŠŠCSAPPçš„å†…å®¹è¡¥ä¸Š, è¿™ä¸ªä»å¤§ä¸€å¼€å§‹ä¾¿ä¸€ç›´è®¡åˆ’è¦å­¦çš„å†…å®¹, åˆ°ç°åœ¨ä¹Ÿæ²¡å¼€å§‹, æˆ‘çœŸæ˜¯åºŸç‰©å•Š. å¦‚æœå¯ä»¥ç©¿è¶Šå›å¤§ä¸€åˆ°è¯, å½“ç„¶æ˜¯å¸¦ç€ç°åœ¨çš„è®°å¿†ç©¿è¶Šå›å», ä¸ç„¶ç»“å±€ä¹Ÿæ˜¯æ·¹æ²¡åœ¨å¤§å­¦çš„æ— æ„ä¹‰çš„è¯¾ç¨‹ä¸­äº†. ä¸è¿‡å¸¦ç€è®°å¿†çš„è¯, ä¸å…¶å¹»æƒ³è¿™ä¸ªä¸åˆ‡å®é™…çš„æ¢¦, è¿™ä¸ªå¹»æƒ³å…¶æœ¬è´¨å’Œæˆ‘æ¥ä¸‹æŠŠè‡ªå·±ç¼ºå¤±çš„è¡¥ä¸Šæ˜¯ä¸€æ ·çš„.</p><p>â€‹å³ä½¿æˆ‘å¯¹è‡ªå·±çš„èƒ½åŠ›ä¸æ»¡æ„, ä½†æˆ‘ä¹Ÿç¡®å®æ²¡ä»€ä¹ˆå¯ä»¥æŠ±æ€¨çš„, æ¯•ç«Ÿè¿™å°±æ˜¯æˆ‘, è¿™æ‰æ˜¯æˆ‘. é™¤äº†æš‘å‡çš„æ—¶é—´é¡¾ç€ç©äº†, å¤§å­¦çš„ç”Ÿæ´»æˆ‘çš„å­¦ä¹ æ­¥ä¼ä¸€ç›´éƒ½æ˜¯è¸è¸å®å®çš„. æˆ‘ä¸å¾—ä¸è¯´æˆ‘å·²ç»å¤ŸåŠªåŠ›äº†, é ç€æˆ‘ä¸€ä¸ªäºº, åœ¨ä¸€ä¸ªè¿œç¦»å®¶ä¹¡çš„åŸå¸‚. è¿™ä¸ªæŒ‡æœ›ä¸ä¸Šè€å¸ˆçš„åœ°æ–¹, æˆ‘åšåˆ°ç°åœ¨æˆ‘å·²ç»å’Œæ»¡æ„äº†, ä»å¤§ä¸€åˆ°ç°åœ¨çš„æˆ‘, ä»¥åŠå­¦ä¼šäº†å¤ªå¤šå¤ªå¤š, å®Œå®Œå…¨å…¨æˆé•¿äº†å¾ˆå¤š, å­¦åˆ°å¾ˆå¤š. å‰©ä¸‹çš„é—æ†¾, ç•™ä¸‹æ²¡æœ‰ä¸€ä¸ªå¥½çš„ç¯å¢ƒ, ä¸€ä¸ªè‰¯å¸ˆç›Šå‹å¼•å¯¼æˆ‘. ä¸çŸ¥é“è¿™ä¸ªé—æ†¾èƒ½ä¸èƒ½åœ¨ç ”ç©¶ç”Ÿç”Ÿæ´»ä¸­è¡¥ä¸Šå‘¢, è‡³å°‘ç°åœ¨å…ˆè€ƒä¸Šä¸€ä¸ªå¥½å¤šå¤§å­¦, è¡¥å®Œè¿™äº›é—æ†¾å§. åŠ æ²¹å•Š, è‡ªå·±.</p><p>ä»¥ä¸‹æ˜¯æ”¹ä¸ºå›¾ä¹¦ç®¡ç†ç³»ç»Ÿçš„å­—æ®µæ›¿æ¢:</p><pre class="language-none"><code class="language-none">ä¾›åº”å•†è¡¨-&gt; å›¾ä¹¦ISBNï¼š-&gt;provider.proCodeä¹¦åï¼š-&gt;provider.proNameä½œè€…ï¼š-&gt;provider.proContactå®šä»·ï¼š-&gt;provider.proPhone å‡ºç‰ˆç¤¾-&gt;provider.proFax åˆ†ç±»ï¼š-&gt;provider.proDescè®¢å•ç®¡ç†-&gt;å€Ÿé˜…è®°å½•ç®¡ç†æœªå½’è¿˜ -&gt; queryIsPayment &#x3D;&#x3D; 1 å·²å½’è¿˜-&gt; queryIsPayment &#x3D;&#x3D; 2 ç”¨æˆ·ï¼š-&gt;queryProductNameå€Ÿé˜…è®°å½•ç¼–ç -&gt;billCodeå›¾ä¹¦ -&gt;providerNameé‡‘é¢-&gt;totalPrice</code></pre></li></ol>]]></content>
    
    
    <summary type="html">å†™è¿™ä¸ªé¡¹ç›®çš„å¥‘æœº, ä¹Ÿæ˜¯å­¦æ ¡åˆè«åå…¶å¦™å¤šäº†ä¸ªè¯¾ç¨‹è®¾è®¡, ç›¸æ¯”å­¦æ ¡çš„ä»€ä¹ˆç ´å®éªŒå®è·µ, æˆ‘å¾ˆå–œæ¬¢å­¦æ ¡çš„è¯¾ç¨‹è®¾è®¡, ä¸Šæ¬¡æ“ä½œç³»ç»Ÿçš„å®è·µè®¾è®¡æ˜¯å…³äºxv6çš„, é‚£æ¬¡è®©æˆ‘å¯¹æ“ä½œç³»ç»Ÿçš„ç†è§£æå‡äº†å¾ˆå¤š, ç°åœ¨æˆ‘éƒ½ä¸èˆå¾—åˆ æ‰ç”µè„‘é‡Œçš„qemuæ¨¡æ‹Ÿå™¨. ä¸è¿‡è¿™å’Œè€å¸ˆæ²¡ä»€ä¹ˆå…³ç³», è€å¸ˆåŸºæœ¬ä¸Šåªæ˜¯æŠŠè¯¾é¢˜æ‰”åœ¨é‚£, æˆ‘ä»¬è‡ªå·±ç‹¬ç«‹å®Œæˆ. ä½†ä¹ŸåŒæ—¶æˆ‘æœ‰äº†æ›´å¤šçš„æ—¶é—´å»å®Œæˆè¿™ä¸ªè¯¾ç¨‹è®¾è®¡, æ²¡æœ‰å…¶ä»–è¯¾ç¨‹ä»»åŠ¡çš„å¹²æ‰°, æˆ‘å¯ä»¥å…¨å¿ƒå…¨æ„çš„æŠ•å…¥åˆ°è¿™ä¸ªè¯¾ç¨‹è®¾è®¡ä¸­å». è¿™å¾ˆç¬¦åˆæˆ‘è‡ªå·±çš„å­¦ä¹ ä¹ æƒ¯, æˆ‘æ›´å–œæ¬¢æŠŠä¸€ä¸ªè¯¾ç¨‹å­¦å®Œäº†, æˆ–è€…æ˜¯ä¸€ä¸ªé˜¶æ®µçš„ä»»åŠ¡å®Œæˆäº†, æ‰å»å¼€å§‹ä¸‹ä¸€é¡¹å­¦ä¹ è®¡åˆ’. ç›¸æ¯”äºå»è¯¾å ‚ä¸Šå¬æ— æ„ä¹‰çš„è¯¾ç¨‹, è¿™ç§æŠŠæ—¶é—´ç•™ç»™å­¦ç”Ÿè‡ªå·±çš„åšæ³•, åœ¨è¿™ä¸ªå¤§å­¦è€å¸ˆåŸºæœ¬ä¸Šèµ·ä¸åˆ°ä»€ä¹ˆå¸®åŠ©çš„ç ´å¤§å­¦é‡Œ, æ˜¾ç„¶æ˜¯æ›´å€¼å¾—çš„.</summary>
    
    
    
    <category term="Java web" scheme="https://trevoewu.github.io/categories/Java-web/"/>
    
    
    <category term="java web" scheme="https://trevoewu.github.io/tags/java-web/"/>
    
    <category term="jsp" scheme="https://trevoewu.github.io/tags/jsp/"/>
    
    <category term="servlet" scheme="https://trevoewu.github.io/tags/servlet/"/>
    
    <category term="jdbc" scheme="https://trevoewu.github.io/tags/jdbc/"/>
    
    <category term="fullstack" scheme="https://trevoewu.github.io/tags/fullstack/"/>
    
    <category term="smbms" scheme="https://trevoewu.github.io/tags/smbms/"/>
    
  </entry>
  
  <entry>
    <title>Java Web å¿«é€Ÿå…¥é—¨</title>
    <link href="https://trevoewu.github.io/2023/05/12/Java-Web-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"/>
    <id>https://trevoewu.github.io/2023/05/12/Java-Web-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/</id>
    <published>2023-05-12T09:45:29.000Z</published>
    <updated>2023-06-10T12:58:44.545Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é™æ€webå’ŒåŠ¨æ€web">é™æ€webå’ŒåŠ¨æ€web</h2><p>é™æ€Webå’ŒåŠ¨æ€Webéƒ½æ˜¯Webåº”ç”¨ç¨‹åºçš„ä¸åŒç±»å‹ï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äºé¡µé¢å†…å®¹æ˜¯å¦‚ä½•ç”Ÿæˆå’Œå‘ˆç°çš„ã€‚</p><p>é™æ€Webæ˜¯ç”±é™æ€ç½‘é¡µç»„æˆçš„Webåº”ç”¨ç¨‹åºï¼Œç½‘é¡µçš„å†…å®¹åœ¨é¡µé¢è¯·æ±‚æ—¶å·²ç»å­˜åœ¨ï¼Œå¹¶ä¸”ä¸ä¼šéšç€ç”¨æˆ·çš„è¯·æ±‚è€Œå‘ç”Ÿå˜åŒ–ã€‚ç½‘é¡µå†…å®¹é€šå¸¸æ˜¯ç”±HTMLã€CSSã€JavaScriptç­‰é™æ€æ–‡ä»¶ç»„æˆçš„ï¼Œè¿™äº›æ–‡ä»¶éƒ½æ˜¯åœ¨æœåŠ¡å™¨ç«¯é¢„å…ˆç”Ÿæˆçš„ï¼Œå½“ç”¨æˆ·è®¿é—®è¿™äº›ç½‘é¡µæ—¶ï¼ŒæœåŠ¡å™¨åªéœ€å°†è¿™äº›æ–‡ä»¶å‘é€ç»™ç”¨æˆ·çš„æµè§ˆå™¨ï¼Œæµè§ˆå™¨å°†æ–‡ä»¶è§£æå¹¶æ˜¾ç¤ºç»™ç”¨æˆ·å³å¯ã€‚é™æ€Webé€šå¸¸åŒ…å«å°‘é‡çš„ç½‘é¡µï¼Œå†…å®¹ä¸ä¼šå‘ç”Ÿé¢‘ç¹å˜åŒ–ï¼Œé€‚åˆäºå±•ç¤ºä¼ä¸šå®£ä¼ ç½‘ç«™ã€ä¸ªäººåšå®¢ç­‰ç®€å•çš„ç½‘ç«™ã€‚</p><p>åŠ¨æ€Webæ˜¯ç”±åŠ¨æ€ç½‘é¡µç»„æˆçš„Webåº”ç”¨ç¨‹åºï¼Œç½‘é¡µå†…å®¹æ˜¯åœ¨ç”¨æˆ·è¯·æ±‚æ—¶æ ¹æ®è¯·æ±‚å‚æ•°å’ŒæœåŠ¡å™¨ç«¯çš„å¤„ç†ç”Ÿæˆçš„ã€‚ç½‘é¡µå†…å®¹å¯ä»¥æ ¹æ®ç”¨æˆ·çš„ä¸åŒè¯·æ±‚å‚æ•°ã€æ•°æ®åº“æŸ¥è¯¢ç»“æœç­‰å®æ—¶ç”Ÿæˆã€‚åŠ¨æ€Webéœ€è¦ä½¿ç”¨æœåŠ¡å™¨ç«¯è„šæœ¬è¯­è¨€ï¼ˆå¦‚Javaã€PHPã€Python Servlet/JSPç­‰ï¼‰æ¥ç”ŸæˆHTMLé¡µé¢å†…å®¹ï¼Œé€šå¸¸ä½¿ç”¨æ•°æ®åº“æ¥å­˜å‚¨å’Œç®¡ç†æ•°æ®ã€‚åŠ¨æ€Webå¯ä»¥å®ç°æ›´å¤æ‚çš„åŠŸèƒ½ï¼Œä¾‹å¦‚åœ¨çº¿å•†åŸã€ç¤¾äº¤ç½‘ç»œã€æ–°é—»é—¨æˆ·ç­‰ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œé™æ€Webé€‚åˆäºå†…å®¹ä¸ä¼šé¢‘ç¹å˜åŒ–ï¼Œç½‘ç«™è§„æ¨¡è¾ƒå°çš„åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨ç®€å•çš„HTMLã€CSSã€JavaScriptç­‰å‰ç«¯æŠ€æœ¯æ¥å®ç°ï¼›è€ŒåŠ¨æ€Webé€‚åˆäºå†…å®¹éœ€è¦é¢‘ç¹å˜åŒ–ã€ç½‘ç«™è§„æ¨¡è¾ƒå¤§çš„åœºæ™¯ï¼Œéœ€è¦ä½¿ç”¨æœåŠ¡å™¨ç«¯è„šæœ¬è¯­è¨€å’Œæ•°æ®åº“æ¥å®ç°ã€‚</p><h2 id="webæœåŠ¡å™¨">webæœåŠ¡å™¨</h2><h3 id="Tomcat">Tomcat</h3><p>WebæœåŠ¡å™¨æ˜¯ä¸€ç§è½¯ä»¶ç¨‹åºï¼Œä¸»è¦ç”¨äºå¤„ç†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„HTTPè¯·æ±‚å’Œå“åº”ã€‚å®ƒå¯ä»¥æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯Webæµè§ˆå™¨ï¼‰çš„HTTPè¯·æ±‚ï¼Œå¹¶è¿”å›å¤„ç†åçš„HTTPå“åº”ã€‚WebæœåŠ¡å™¨é€šå¸¸è¿è¡Œåœ¨äº’è”ç½‘ä¸Šï¼Œæä¾›å„ç§å„æ ·çš„æœåŠ¡ï¼Œä¾‹å¦‚Webç½‘ç«™ã€ç”µå­é‚®ä»¶æœåŠ¡ã€æ–‡ä»¶ä¼ è¾“ç­‰ã€‚</p><p><img src="image-20230512175355319.png" alt="image-20230512175355319" loading="lazy"></p><p><a href="https://tomcat.apache.org/">Tomcat</a>æ˜¯ä¸€ç§æµè¡Œçš„å¼€æºWebæœåŠ¡å™¨ï¼Œå®ƒå®ç°äº†Java Servletå’ŒJavaServer Pages (JSP) è§„èŒƒã€‚Tomcatæ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿï¼ŒåŒ…æ‹¬Windowsã€Linuxå’ŒMac OSç­‰ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç®€å•çš„ã€æ˜“äºä½¿ç”¨çš„ç®¡ç†ç•Œé¢ï¼Œå…è®¸ç®¡ç†å‘˜å¯¹æœåŠ¡å™¨è¿›è¡Œé…ç½®å’Œç®¡ç†ã€‚</p><p>Tomcatçš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p><ol><li><p>æ”¯æŒJava Servletå’ŒJSPè§„èŒƒï¼šTomcatå¯ä»¥è¿è¡Œå’Œå¤„ç†Java Webåº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚Java Servletã€JSPå’ŒJavaServer Faces (JSF) ç­‰ã€‚</p></li><li><p>å¯æ‰©å±•æ€§ï¼šTomcatæ”¯æŒå„ç§æ’ä»¶å’Œæ‰©å±•ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ æ–°åŠŸèƒ½æˆ–ä¿®æ”¹ç°æœ‰åŠŸèƒ½ã€‚</p></li><li><p>æ˜“äºé…ç½®å’Œç®¡ç†ï¼šTomcatæä¾›äº†ä¸€ä¸ªç®€å•çš„ç®¡ç†ç•Œé¢ï¼Œå…è®¸ç®¡ç†å‘˜è½»æ¾åœ°é…ç½®å’Œç®¡ç†WebæœåŠ¡å™¨ï¼ŒåŒ…æ‹¬æ·»åŠ æˆ–åˆ é™¤Webåº”ç”¨ç¨‹åºã€é…ç½®è®¿é—®æƒé™ç­‰ã€‚</p></li><li><p>å¼€æºå…è´¹ï¼šTomcatæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå¯ä»¥å…è´¹ä½¿ç”¨å’Œä¿®æ”¹ã€‚è¿™æ„å‘³ç€ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦è¿›è¡Œå®šåˆ¶å’Œä¿®æ”¹ï¼Œè€Œä¸éœ€è¦æ”¯ä»˜é«˜æ˜‚çš„æˆæƒè´¹ç”¨ã€‚</p></li></ol><p>æ€»çš„æ¥è¯´ï¼ŒTomcatæ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§çš„WebæœåŠ¡å™¨ï¼Œéå¸¸é€‚åˆè¿è¡ŒJava Webåº”ç”¨ç¨‹åºã€‚å®ƒå…·æœ‰å¯æ‰©å±•æ€§ã€æ˜“äºé…ç½®å’Œç®¡ç†ã€å¼€æºå…è´¹ç­‰ä¼˜ç‚¹ï¼Œå› æ­¤åœ¨ä¼ä¸šå’Œä¸ªäººç”¨æˆ·ä¸­éå¸¸å—æ¬¢è¿ã€‚</p><h4 id="Tomcatæ–‡ä»¶ç»“æ„">Tomcatæ–‡ä»¶ç»“æ„</h4><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/tomcat //tomcart å®‰è£…ç›®å½•</code></pre><p><img src="image-20230512175943702.png" alt="image-20230512175943702" loading="lazy"></p><p><img src="image-20230512180405774.png" alt="image-20230512180405774" loading="lazy"></p><p>è®¿é—®æµ‹è¯•ï¼š<a href="http://localhost:8080">http://localhost:8080</a></p><p>é»˜è®¤ç«¯å£8080</p><h4 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶</h4><p><img src="image-20230512180642215.png" alt="image-20230512180642215" loading="lazy"></p><ul><li>å¯ä»¥ä¿®æ”¹é…ç½®çš„å¯åŠ¨ç«¯å£å·, é»˜è®¤ä¸º8080</li></ul><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8080<span class="token punctuation">"</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTP/1.1<span class="token punctuation">"</span></span>           <span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>20000<span class="token punctuation">"</span></span>           <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8443<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><ul><li><p>å¯ä»¥é…ç½®ä¸»æœºçš„åç§°, é»˜è®¤ç½‘ç«™çš„å­˜æ”¾ä½ç½®</p><ul><li>name=â€œlocahostâ€ é»˜è®¤ä¸»æœºåå¯¹äºçš„ipåœ°å€ 127.0.0.1</li><li>é»˜è®¤ç½‘ç«™å­˜æ”¾åœ°å€: webapps</li></ul><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Host</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>localhost<span class="token punctuation">"</span></span>  <span class="token attr-name">appBase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>webapps<span class="token punctuation">"</span></span>           <span class="token attr-name">unpackWARs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">autoDeploy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre></li></ul><h4 id="å‘å¸ƒä¸€ä¸ªç½‘ç«™">å‘å¸ƒä¸€ä¸ªç½‘ç«™</h4><ul><li>å°†è‡ªå·±å†™çš„ç½‘ç«™ï¼Œæ”¾åˆ°æœåŠ¡å™¨(Tomcat)ä¸­æŒ‡å®šçš„webåº”ç”¨çš„æ–‡ä»¶å¤¹ï¼ˆwebappsï¼‰ä¸‹ï¼Œå°±å¯ä»¥è®¿é—®äº†ã€‚</li></ul><h3 id="HTTP">HTTP</h3><p>HTPP è¯·æ±‚</p><pre class="language-json" data-language="json"><code class="language-json">Request URL<span class="token operator">:</span>https<span class="token operator">:</span><span class="token comment">//www.baidu.com/   è¯·æ±‚åœ°å€</span>Request Method<span class="token operator">:</span>GET    getæ–¹æ³•/postæ–¹æ³•Status Code<span class="token operator">:</span><span class="token number">200</span> OK    çŠ¶æ€ç ï¼š<span class="token number">200</span>Remoteï¼ˆè¿œç¨‹ï¼‰ Address<span class="token operator">:</span><span class="token number">14.215</span>.<span class="token number">177.39</span><span class="token operator">:</span><span class="token number">443</span>Accept<span class="token operator">:</span>text/html  å®¢æˆ·ç«¯å¯ä»¥æ¥å—çš„è¯­è¨€Accept-Encoding<span class="token operator">:</span>gzip<span class="token punctuation">,</span> deflate<span class="token punctuation">,</span> br ç¼–ç Accept-Language<span class="token operator">:</span>zh-CN<span class="token punctuation">,</span>zh;q=<span class="token number">0.9</span>    è¯­è¨€Cache-Control<span class="token operator">:</span>max-age=<span class="token number">0</span> æ˜¯å¦è®¾ç½®ç¼“å­˜Connection<span class="token operator">:</span>keep-alive æ˜¯å¦ä¸ºæŒç»­æ€§é“¾æ¥</code></pre><h2 id="Servlet">Servlet</h2><h3 id="ç®€ä»‹">ç®€ä»‹</h3><ul><li>Servletå°±æ˜¯sunå…¬å¸å¼€å‘åŠ¨æ€webçš„ä¸€é—¨æŠ€æœ¯ã€‚</li><li>Sunåœ¨è¿™äº›APIä¸­æä¾›ä¸€ä¸ªæ¥å£å«åšï¼šServletï¼Œå¦‚æœä½ æƒ³å¼€å‘ä¸€ä¸ªServletç¨‹åºï¼Œåªéœ€è¦å®Œæˆä¸¤ä¸ªå°æ­¥éª¤ï¼š<ul><li>ç¼–å†™ä¸€ä¸ªç±»ï¼Œå®ç°Servletæ¥å£ã€‚</li><li>æŠŠå¼€å‘å¥½çš„Javaç±»éƒ¨ç½²åˆ°webæœåŠ¡å™¨ä¸­ã€‚</li></ul></li><li><strong>æŠŠå®ç°äº†Servletæ¥å£çš„Javaç¨‹åºå«åšï¼ŒServlet</strong>ã€‚</li></ul><h3 id="ç¬¬ä¸€ä¸ªServletç¨‹åº-HelloServlet">ç¬¬ä¸€ä¸ªServletç¨‹åº HelloServlet</h3><ol><li>ä¿®æ”¹web.xmlä¸ºæœ€æ–°çš„</li></ol><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://xmlns.jcp.org/xml/ns/javaee<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://xmlns.jcp.org/xml/ns/javaee                      http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd<span class="token punctuation">"</span></span>         <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4.0<span class="token punctuation">"</span></span>         <span class="token attr-name">metadata-complete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">></span></span></code></pre><ol start="2"><li>ç¼–å†™ä¸€ä¸ªServletç¨‹åºã€‚</li></ol><p><img src="image-20230512182111384.png" alt="image-20230512182111384" loading="lazy"></p><ol start="3"><li><p>ç¼–å†™ä¸€ä¸ªæ™®é€šç±»Bean</p></li><li><p>å®ç°servletæ¥å£, è¿™é‡Œæˆ‘ä»¬ç›´æ¥ç»§æ‰¿HttpServlet</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ç”±äºgetæˆ–poståªæ˜¯è¯·æ±‚å®ç°çš„ä¸åŒçš„æ–¹å¼ï¼Œå¯ä»¥ç›¸äº’è°ƒç”¨ï¼Œä¸šåŠ¡é€»è¾‘éƒ½æ˜¯ä¸€æ ·ï¼›</span>  <span class="token comment">//HttpServletRequestä»£è¡¨å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç”¨æˆ·é€šè¿‡Httpåè®®è®¿é—®æœåŠ¡å™¨ï¼Œ</span><span class="token comment">//HTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰ä¿¡æ¯ä¼šè¢«å°è£…åˆ°HttpServletRequestï¼Œ</span><span class="token comment">//é€šè¿‡è¿™ä¸ªHttpServletRequestçš„æ–¹æ³•ï¼Œè·å¾—å®¢æˆ·ç«¯çš„æ‰€æœ‰ä¿¡æ¯ï¼›</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å“åº”æµ</span>        writer<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Hello,Serlvet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span></code></pre></li></ol><h4 id="write-å’Œprintln">write( )å’Œprintln( )</h4><p><code>servletResponse.getWriter().write()``servletResponse.getWriter().println()</code>éƒ½æ˜¯ç”¨äºå°†å­—ç¬¦ä¸²å†™å…¥åˆ°HTTPå“åº”ä¸­çš„æ–¹æ³•ï¼Œä½†æ˜¯å®ƒä»¬ä¹‹é—´æœ‰ä¸€äº›å…³é”®çš„åŒºåˆ«ã€‚</p><p><code>servletResponse.getWriter().write()</code>æ–¹æ³•æ˜¯å°†æŒ‡å®šçš„å­—ç¬¦ä¸²å†™å…¥åˆ°HTTPå“åº”è¾“å‡ºæµä¸­ï¼Œå®ƒä¸ä¼šåœ¨å­—ç¬¦ä¸²æœ«å°¾æ·»åŠ ä»»ä½•æ¢è¡Œç¬¦æˆ–å…¶ä»–å­—ç¬¦ã€‚å¦‚æœéœ€è¦åœ¨è¾“å‡ºçš„å­—ç¬¦ä¸²åé¢æ·»åŠ æ¢è¡Œç¬¦æˆ–å…¶ä»–å­—ç¬¦ï¼Œå°±éœ€è¦åœ¨å­—ç¬¦ä¸²åé¢æ˜¾å¼æ·»åŠ è¿™äº›å­—ç¬¦ã€‚</p><p><code>servletResponse.getWriter().println()</code>æ–¹æ³•ä¹Ÿæ˜¯å°†æŒ‡å®šçš„å­—ç¬¦ä¸²å†™å…¥åˆ°HTTPå“åº”è¾“å‡ºæµä¸­ï¼Œä½†æ˜¯å®ƒä¼šåœ¨å­—ç¬¦ä¸²æœ«å°¾è‡ªåŠ¨æ·»åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚è¿™ä¸ªæ¢è¡Œç¬¦çš„æ ·å¼å’Œæ“ä½œç³»ç»Ÿç›¸å…³ï¼Œé€šå¸¸æ˜¯<code>\n</code>æˆ–<code>\r\n</code>ã€‚ä½¿ç”¨<code>println()</code>æ–¹æ³•å¯ä»¥è®©æ¯ä¸ªè¾“å‡ºçš„å­—ç¬¦ä¸²éƒ½ç‹¬å ä¸€è¡Œï¼Œä½¿å¾—è¾“å‡ºæ›´æ˜“äºé˜…è¯»å’Œå¤„ç†ã€‚</p><p>å› æ­¤ï¼Œ<code>write()</code>æ–¹æ³•é€‚åˆäºéœ€è¦å°†å¤šä¸ªå­—ç¬¦ä¸²å†™å…¥åˆ°åŒä¸€è¡Œçš„æƒ…å†µï¼Œä¾‹å¦‚è¾“å‡ºCSVæ ¼å¼çš„æ•°æ®æˆ–è€…HTMLä»£ç çš„ç‰‡æ®µã€‚è€Œ<code>println()</code>æ–¹æ³•é€‚åˆäºéœ€è¦è¾“å‡ºå¤šè¡Œå­—ç¬¦ä¸²çš„æƒ…å†µï¼Œä¾‹å¦‚è¾“å‡ºæ—¥å¿—ä¿¡æ¯æˆ–HTMLä»£ç çš„æ•´ä¸ªé¡µé¢ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ— è®ºä½¿ç”¨å“ªç§æ–¹æ³•ï¼Œéƒ½éœ€è¦åœ¨ä½¿ç”¨å®Œä¹‹åè°ƒç”¨<code>servletResponse.getWriter().flush()</code>æ–¹æ³•å°†è¾“å‡ºæµåˆ·æ–°å¹¶å°†æ•°æ®å‘é€åˆ°å®¢æˆ·ç«¯ã€‚å¦‚æœä¸è°ƒç”¨<code>flush()</code>æ–¹æ³•ï¼Œå¯èƒ½ä¼šå¯¼è‡´å“åº”æ•°æ®æ— æ³•æ­£å¸¸å‘é€åˆ°å®¢æˆ·ç«¯ã€‚</p><ol start="5"><li><p>ç¼–å†™Servletçš„æ˜ å°„</p><ul><li>ä¸ºä»€ä¹ˆéœ€è¦æ˜ å°„ï¼šæˆ‘ä»¬å†™çš„æ˜¯JAVAç¨‹åºï¼Œä½†æ˜¯è¦é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼Œè€Œæµè§ˆå™¨éœ€è¦è¿æ¥webæœåŠ¡å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å†webæœåŠ¡ä¸­æ³¨å†Œæˆ‘ä»¬å†™çš„Servletï¼Œè¿˜éœ€ç»™ä»–ä¸€ä¸ªæµè§ˆå™¨èƒ½å¤Ÿè®¿é—®çš„è·¯å¾„ï¼›</li></ul><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--æ³¨å†ŒServlet--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>cn.loulan.servlet.HelloServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--Servletçš„è¯·æ±‚è·¯å¾„--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre></li></ol><h4 id="Servlet-Mapping">Servlet Mapping</h4><ol><li><p>ä¸€ä¸ªServletå¯ä»¥æŒ‡å®šä¸€ä¸ªæ˜ å°„è·¯å¾„ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre></li><li><p>ä¸€ä¸ªServletå¯ä»¥æŒ‡å®šå¤šä¸ªæ˜ å°„è·¯å¾„ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/hello2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/hello3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/hello4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/hello5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre></li><li><p>ä¸€ä¸ªServletå¯ä»¥æŒ‡å®šé€šç”¨æ˜ å°„è·¯å¾„ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/hello/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre></li><li><p>é»˜è®¤è¯·æ±‚è·¯å¾„ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--é»˜è®¤è¯·æ±‚è·¯å¾„--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre></li><li><p>æŒ‡å®šä¸€äº›åç¼€æˆ–è€…å‰ç¼€ç­‰ç­‰â€¦.</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- å¯ä»¥è‡ªå®šä¹‰åç¼€å®ç°è¯·æ±‚æ˜ å°„     æ³¨æ„ç‚¹ï¼Œ*å‰é¢ä¸èƒ½åŠ é¡¹ç›®æ˜ å°„çš„è·¯å¾„     hello/subei.github    --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>*.github<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre></li><li><p>ä¼˜å…ˆçº§é—®é¢˜ã€‚</p><ul><li>æŒ‡å®šäº†å›ºæœ‰çš„æ˜ å°„è·¯å¾„ä¼˜å…ˆçº§æœ€é«˜ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±ä¼šèµ°é»˜è®¤çš„å¤„ç†è¯·æ±‚ï¼›</li></ul></li></ol><h3 id="Servlet-Context">Servlet Context</h3><ul><li>webå®¹å™¨åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œå®ƒä¼šä¸ºæ¯ä¸ªwebç¨‹åºéƒ½åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ServletContextå¯¹è±¡ï¼Œå®ƒä»£è¡¨äº†å½“å‰çš„webåº”ç”¨(Application)ï¼›</li></ul><p>ServletContextæ˜¯Java Webåº”ç”¨ç¨‹åºçš„ä¸€ä¸ªæ¥å£ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªWebåº”ç”¨ç¨‹åºçš„è¿è¡Œç¯å¢ƒï¼Œå¯ä»¥è®¿é—®åº”ç”¨ç¨‹åºçš„é…ç½®ä¿¡æ¯ã€èµ„æºã€è¯·æ±‚å’Œä¼šè¯ç­‰ã€‚æ¯ä¸ªWebåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªServletContextå®ä¾‹ï¼Œå¯ä»¥é€šè¿‡getServletContext()æ–¹æ³•è·å–ã€‚</p><p>ServletContextæä¾›äº†ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ol><li><p>åº”ç”¨ç¨‹åºä½œç”¨åŸŸï¼šServletContextå¯¹è±¡æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºçº§åˆ«çš„å¯¹è±¡ï¼Œå¯ä»¥åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºèŒƒå›´å†…å…±äº«æ•°æ®ã€‚</p></li><li><p>åº”ç”¨ç¨‹åºé…ç½®ä¿¡æ¯ï¼šServletContextå¯¹è±¡æä¾›äº†è®¿é—®Webåº”ç”¨ç¨‹åºçš„é…ç½®ä¿¡æ¯çš„æ–¹æ³•ï¼Œä¾‹å¦‚Web.xmlä¸­é…ç½®çš„ä¸Šä¸‹æ–‡å‚æ•°ï¼Œåˆå§‹åŒ–å‚æ•°ç­‰ã€‚</p></li><li><p>èµ„æºè®¿é—®ï¼šServletContextå¯¹è±¡æä¾›äº†ä¸€äº›æ–¹æ³•ï¼Œä¾‹å¦‚getRealPath()å’ŒgetResourceAsStream()ï¼Œå¯ä»¥è®¿é—®Webåº”ç”¨ç¨‹åºä¸­çš„èµ„æºæ–‡ä»¶ã€‚</p></li><li><p>è¯·æ±‚è½¬å‘ï¼šServletContextå¯¹è±¡æä¾›äº†getRequestDispatcher()æ–¹æ³•ï¼Œå¯ä»¥å°†è¯·æ±‚è½¬å‘åˆ°å…¶ä»–Webç»„ä»¶ï¼Œä¾‹å¦‚Servletæˆ–JSPã€‚</p></li><li><p>ä¼šè¯ç®¡ç†ï¼šServletContextå¯¹è±¡æä¾›äº†åˆ›å»ºå’Œç®¡ç†ä¼šè¯çš„æ–¹æ³•ï¼Œä¾‹å¦‚getSession()å’ŒgetSessionCookieConfig()ã€‚</p></li></ol><p>ServletContexä¸ºJava Webåº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªç¯å¢ƒï¼Œä½¿å¼€å‘äººå‘˜å¯ä»¥è®¿é—®åº”ç”¨ç¨‹åºçš„é…ç½®ä¿¡æ¯ã€èµ„æºã€è¯·æ±‚å’Œä¼šè¯ç­‰ï¼Œå¹¶ä¸”å¯ä»¥å°†è¯·æ±‚è½¬å‘åˆ°å…¶ä»–Webç»„ä»¶ã€‚è¿™ä½¿å¾—Java Webåº”ç”¨ç¨‹åºå¼€å‘å˜å¾—æ›´åŠ å®¹æ˜“å’Œçµæ´»ã€‚</p><h4 id="åˆ©ç”¨servletContextå®ç°ä¸åŒServletä¹‹å‰çš„æ•°æ®å…±äº«">åˆ©ç”¨servletContextå®ç°ä¸åŒServletä¹‹å‰çš„æ•°æ®å…±äº«</h4><ul><li>åœ¨è¿™ä¸ªServletä¸­ä¿å­˜çš„æ•°æ®ï¼Œå¯ä»¥åœ¨å¦å¤–ä¸€ä¸ªservletä¸­æ‹¿åˆ°ï¼›</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServletContext</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">"å­¦ä¹ è¶…å¥½"</span><span class="token punctuation">;</span>   <span class="token comment">// æ•°æ®</span>        context<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GetServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServletContext</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>context<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"åå­—:"</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><h4 id="åˆ©ç”¨Servletè·å–åˆå§‹åŒ–å‚æ•°">åˆ©ç”¨Servletè·å–åˆå§‹åŒ–å‚æ•°</h4><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- é…ç½®ä¸€äº›Webåº”ç”¨åˆå§‹åŒ–å‚æ•° --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>context-param</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>url<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>jdbc:mysql://localhost:3306/mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context-param</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>gp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>com.github.servlet.ServletDemo03<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>gp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/gp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletDemo03</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServletContext</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> url <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getInitParameter</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><h4 id="å®ç°è¯·æ±‚çš„è½¬å‘">å®ç°è¯·æ±‚çš„è½¬å‘</h4><ol start="2"><li>åˆ©ç”¨ServletContextå®ç°è¯·æ±‚çš„è½¬å‘</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletDemo04</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServletContext</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        è°ƒç”¨forwardå®ç°è¯·æ±‚è½¬å‘;</span><span class="token comment">//        requestDispatcher.forward(req,resp);</span>      context<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><h4 id="ç”¨æ¥è¯»å–èµ„æºæ–‡ä»¶">ç”¨æ¥è¯»å–èµ„æºæ–‡ä»¶</h4><ul><li><p>åœ¨resourcesç›®å½•ä¸‹æ–°å»ºproperties</p></li><li><p>æ€è·¯ï¼šéœ€è¦ä¸€ä¸ªæ–‡ä»¶æµï¼›</p></li></ul><pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">username</span><span class="token punctuation">=</span><span class="token value attr-value">"æ¥¼å…°"</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletDemo05</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>       <span class="token class-name">InputStream</span> stream <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"WEB-INF/classes/db.properties"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Properties</span> prop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        prop<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">String</span> user <span class="token operator">=</span> prop<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        ä½†æ˜¯å¦‚æœé…ç½®æ–‡ä»¶ä¸­å¦‚æœåŒ…å«ä¸­æ–‡ï¼Œå°±ä¼šå‡ºç°ä¹±ç ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ä¸­è½¬çš„å½¢å¼ä¼˜åŒ–ä¸€ä¸‹ï¼š</span>        prop<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><h3 id="HttpServletResponse">HttpServletResponse</h3><ul><li>webæœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„httpè¯·æ±‚ï¼Œé’ˆå¯¹è¿™ä¸ªè¯·æ±‚ï¼Œåˆ†åˆ«åˆ›å»ºä¸€ä¸ªä»£è¡¨è¯·æ±‚çš„HttpServletRequestå¯¹è±¡ï¼Œä»£è¡¨å“åº”çš„ä¸€ä¸ªHttpServletResponseï¼›<ul><li>å¦‚æœè¦è·å–å®¢æˆ·ç«¯è¯·æ±‚è¿‡æ¥çš„å‚æ•°ï¼šæ‰¾HttpServletRequestï¼›</li><li>å¦‚æœè¦ç»™å®¢æˆ·ç«¯å“åº”ä¸€äº›ä¿¡æ¯ï¼šæ‰¾HttpServletResponseã€‚</li></ul></li></ul><h4 id="1-ç®€å•åˆ†ç±»">1.ç®€å•åˆ†ç±»</h4><ul><li>è´Ÿè´£å‘æµè§ˆå™¨å‘é€æ•°æ®çš„æ–¹æ³•ã€‚</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">ServletOutputStream</span> <span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">PrintWriter</span> <span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>è´Ÿè´£å‘æµè§ˆå™¨å‘é€å“åº”å¤´çš„æ–¹æ³•ã€‚</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token class-name">String</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">String</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>å“åº”çš„çŠ¶æ€ç ã€‚</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> <span class="token constant">SC_OK</span> <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token constant">SC_MOVED_PERMANENTLY</span> <span class="token operator">=</span> <span class="token number">301</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token constant">SC_NOT_FOUND</span> <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token constant">SC_INTERNAL_SERVER_ERROR</span> <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span></code></pre><ul><li>200 - è¯·æ±‚æˆåŠŸ</li><li>301 - èµ„æºï¼ˆç½‘é¡µç­‰ï¼‰è¢«æ°¸ä¹…è½¬ç§»åˆ°å…¶å®ƒURL</li><li>404 - è¯·æ±‚çš„èµ„æºï¼ˆç½‘é¡µç­‰ï¼‰ä¸å­˜åœ¨</li><li>500 - å†…éƒ¨æœåŠ¡å™¨é”™è¯¯</li></ul><h4 id="2-ä¸‹è½½æ–‡ä»¶">2.ä¸‹è½½æ–‡ä»¶</h4><ol><li>å‘æµè§ˆå™¨è¾“å‡ºæ¶ˆæ¯ï¼›</li><li>ä¸‹è½½æ–‡ä»¶ï¼š<ol><li>è¦è·å–ä¸‹è½½æ–‡ä»¶çš„è·¯å¾„ï¼›</li><li>ä¸‹è½½çš„æ–‡ä»¶åæ˜¯å•¥ï¼Ÿ</li><li>è®¾ç½®æƒ³åŠæ³•è®©æµè§ˆå™¨èƒ½å¤Ÿæ”¯æŒä¸‹è½½æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿ï¼›</li><li>è·å–ä¸‹è½½æ–‡ä»¶çš„è¾“å…¥æµï¼›</li><li>åˆ›å»ºç¼“å†²åŒºï¼›</li><li>è·å–OutputStreamå¯¹è±¡ï¼›</li><li>å°†FileOutputStreamæµå†™å…¥åˆ°bufferç¼“å†²åŒºï¼›</li><li>ä½¿ç”¨OutputStreamå°†ç¼“å†²åŒºä¸­çš„æ•°æ®è¾“å‡ºåˆ°å®¢æˆ·ç«¯ï¼</li></ol></li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FIleServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span><span class="token comment">//        1. è·å–ä¸‹è½½æ–‡ä»¶çš„è·¯å¾„ï¼›</span>    <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"/Users/trevorwu/Maven_03/HelloServlet/src/main/resources/Peekaboo.png"</span><span class="token punctuation">;</span><span class="token comment">//        2. è·å–æ–‡ä»¶å</span>        <span class="token class-name">String</span> fileName <span class="token operator">=</span> <span class="token string">"downFile.png"</span><span class="token punctuation">;</span><span class="token comment">//        3. è®©æµè§ˆå™¨èƒ½å¤Ÿæ”¯æŒä¸‹è½½æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿ï¼›</span><span class="token comment">//        è¿™æ®µä»£ç æ˜¯ç”¨æ¥è®¾ç½® HTTP å“åº”å¤´ï¼Œå°†æœåŠ¡å™¨è¿”å›çš„å†…å®¹ä½œä¸ºæ–‡ä»¶é™„ä»¶ï¼ˆattachmentï¼‰ä¸‹è½½ï¼Œè€Œéç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ã€‚</span><span class="token comment">//        å…·ä½“åœ°ï¼Œ`resp.setHeader()` æ–¹æ³•è®¾ç½®äº†ä¸€ä¸ªåä¸º "Content-Disposition" çš„å“åº”å¤´ï¼Œ</span><span class="token comment">//        å…¶å€¼ä¸º "attachment;filename=xxxxx"ï¼Œå…¶ä¸­ "xxxxx" æ˜¯è¦ä¸‹è½½çš„æ–‡ä»¶åã€‚</span><span class="token comment">//        è¿™ä¸ªæ–‡ä»¶åå¯ä»¥æ˜¯æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶åï¼Œä¹Ÿå¯ä»¥æ˜¯é€šè¿‡ä»£ç ç”Ÿæˆçš„æ–‡ä»¶åã€‚</span><span class="token comment">//        è¿™ä¸ªæ–‡ä»¶åå†³å®šäº†ç”¨æˆ·ä¸‹è½½å¾—åˆ°çš„æ–‡ä»¶åï¼Œ è€ŒéæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶åï¼Œ æœåŠ¡å™¨çš„æ–‡ä»¶ååœ¨ä¸‹è½½æ–‡ä»¶çš„åœ°å€ä¸­æŒ‡å®š</span>        resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span><span class="token string">"attachment;filename="</span>                <span class="token operator">+</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        4. è·å–ä¸‹è½½æ–‡ä»¶çš„è¾“å…¥æµï¼›</span>        <span class="token class-name">FileInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        5. åˆ›å»ºç¼“å†²åŒºï¼›</span>        <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span> buffer<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//        6. è·å–OutputStreamå¯¹è±¡ï¼›</span>        <span class="token class-name">ServletOutputStream</span> out <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        7. å°†FileOutputStreamæµå†™å…¥åˆ°bufferç¼“å†²åŒºï¼›</span><span class="token comment">//        è¿™æ®µä»£ç æ˜¯å°†è¾“å…¥æµ `in` ä¸­çš„æ•°æ®è¯»å–åˆ°ç¼“å†²åŒº `buffer` ä¸­ï¼Œå†é€šè¿‡è¾“å‡ºæµ `out` è¾“å‡ºåˆ°ç›®æ ‡ä½ç½®ã€‚</span><span class="token comment">//        å…·ä½“åœ°ï¼Œå¾ªç¯è¯»å–æ“ä½œä¼šåœ¨è¾“å…¥æµä¸­è¯»å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®å†™å…¥åˆ°ç¼“å†²åŒºä¸­ï¼Œ</span><span class="token comment">//        å½“è¯»å–åˆ°çš„æ•°æ®é•¿åº¦ä¸º0æ—¶ï¼Œè¯´æ˜å·²ç»è¯»å–å®Œæ¯•ï¼Œé€€å‡ºå¾ªç¯ã€‚</span><span class="token comment">//åœ¨æ¯æ¬¡å¾ªç¯ä¸­ï¼Œé€šè¿‡è°ƒç”¨ `out.write(buffer, 0, len)` æ–¹æ³•ï¼Œå°†ç¼“å†²åŒºä¸­çš„æ•°æ®å†™å…¥è¾“å‡ºæµä¸­ã€‚</span><span class="token comment">// è¿™é‡Œçš„ `buffer` æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œ`len` æ˜¯æ¯æ¬¡è¯»å–çš„å­—èŠ‚æ•°ã€‚</span><span class="token comment">// ç¬¬äºŒä¸ªå‚æ•° `0` è¡¨ç¤ºä»ç¼“å†²åŒºçš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¼€å§‹å†™å…¥ï¼Œè€Œä¸æ˜¯ä»æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹å†™å…¥ã€‚</span><span class="token comment">//é€šè¿‡è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä»è¾“å…¥æµä¸­è¯»å–æ•°æ®ï¼Œç„¶åå°†æ•°æ®è¾“å‡ºåˆ°ç›®æ ‡ä½ç½®çš„æ“ä½œï¼Œé€šå¸¸ç”¨äºæ–‡ä»¶ä¸‹è½½æˆ–æ•°æ®ä¼ è¾“ç­‰åœºæ™¯ã€‚</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len<span class="token operator">=</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token comment">//        close input output stream</span>        in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><h4 id="3-éªŒè¯ç åŠŸèƒ½">3.éªŒè¯ç åŠŸèƒ½*</h4><ul><li>éªŒè¯æ€ä¹ˆæ¥çš„ï¼Ÿ<ul><li>å‰ç«¯å®ç°ï¼›</li><li>åç«¯å®ç°ï¼Œéœ€è¦ç”¨åˆ° Java çš„å›¾ç‰‡ç±»ï¼Œç”Ÿäº§ä¸€ä¸ªå›¾ç‰‡ã€‚</li></ul></li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImageServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span><span class="token comment">//        å¦‚ä½•è®©æµè§ˆå™¨3ç§’è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡;</span>        resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"refresh"</span><span class="token punctuation">,</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªå›¾ç‰‡</span>        <span class="token class-name">BufferedImage</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedImage</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token class-name">BufferedImage</span><span class="token punctuation">.</span><span class="token constant">TYPE_INT_RGB</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        å¾—åˆ°å›¾ç‰‡,ç¬”</span>        <span class="token class-name">Graphics2D</span> g <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Graphics2D</span><span class="token punctuation">)</span> image<span class="token punctuation">.</span><span class="token function">getGraphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        è®¾ç½®å›¾ç‰‡çš„èƒŒæ™¯é¢œè‰²</span>        g<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">;</span>        g<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        ç»™å›¾ç‰‡å†™æ•°æ®</span>        g<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token constant">RED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        g<span class="token punctuation">.</span><span class="token function">setFont</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Font</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token class-name">Font</span><span class="token punctuation">.</span><span class="token constant">BOLD</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        g<span class="token punctuation">.</span><span class="token function">drawString</span><span class="token punctuation">(</span><span class="token function">makeNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        å‘Šè¯‰æµè§ˆå™¨ï¼Œè¿™ä¸ªè¯·æ±‚ç”¨å›¾ç‰‡çš„æ–¹å¼æ‰“å¼€</span>        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"image/jpeg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        ç½‘ç«™å­˜åœ¨ç¼“å­˜ï¼Œä¸è®©æµè§ˆå™¨ç¼“å­˜</span>        resp<span class="token punctuation">.</span><span class="token function">setDateHeader</span><span class="token punctuation">(</span><span class="token string">"expires"</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Cache-Control"</span><span class="token punctuation">,</span><span class="token string">"no-cache"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Pragma"</span><span class="token punctuation">,</span><span class="token string">"no-cache"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        æŠŠå›¾ç‰‡å†™ç»™æµè§ˆå™¨</span>        <span class="token class-name">ImageIO</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span><span class="token string">"jpg"</span><span class="token punctuation">,</span> resp<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">//    ç”Ÿæˆéšæœºæ•°</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">makeNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> num <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">9999999</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token class-name">StringBuffer</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token operator">-</span>num<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        num <span class="token operator">=</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> num<span class="token punctuation">;</span>        <span class="token keyword">return</span> num<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><h4 id="4-å®ç°é‡å®šå‘">4.å®ç°é‡å®šå‘</h4><p>ä¹‹å‰æˆ‘ä»¬å­¦è¿‡åˆ©ç”¨Servletå®ç°è¯·æ±‚çš„è½¬å‘, è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨responseæ¥å®ç°è¯·æ±‚é‡å®šå‘</p><ol><li>é‡å®šå‘å’Œè½¬å‘çš„åŒºåˆ«</li></ol><p>é‡å®šå‘å’Œè½¬å‘æ˜¯åœ¨Java Servletç¼–ç¨‹ä¸­å¸¸ç”¨çš„ä¸¤ç§å°†è¯·æ±‚ä»ä¸€ä¸ªServletè½¬å‘åˆ°å¦ä¸€ä¸ªServletæˆ–JSPçš„æ–¹å¼ï¼Œå®ƒä»¬æœ‰ä¸€äº›å…³é”®çš„åŒºåˆ«ã€‚</p><p>é‡å®šå‘ï¼ˆRedirectï¼‰æ˜¯æŒ‡å½“ä¸€ä¸ªServletæ”¶åˆ°ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªHTTPå“åº”å‘Šè¯‰æµè§ˆå™¨å‘é€ä¸€ä¸ªæ–°çš„è¯·æ±‚åˆ°æŒ‡å®šçš„URLã€‚è¿™ä¸ªURLå¯ä»¥æ˜¯ä¸€ä¸ªServletã€JSPã€HTMLé¡µé¢æˆ–å…¶ä»–ä»»ä½•ç±»å‹çš„èµ„æºã€‚å› æ­¤ï¼Œé‡å®šå‘ä¼šå¯¼è‡´æµè§ˆå™¨å‘æŒ‡å®šçš„URLå‘èµ·ä¸€ä¸ªå…¨æ–°çš„è¯·æ±‚ï¼Œè€Œè¿™ä¸ªæ–°è¯·æ±‚çš„è·¯å¾„æ˜¯ç”±æµè§ˆå™¨åœ¨é‡å®šå‘æ—¶è‡ªåŠ¨å‘é€çš„ï¼Œä¸å†æ˜¯åŸå§‹è¯·æ±‚çš„è·¯å¾„ã€‚åœ¨é‡å®šå‘ä¸­ï¼Œæ‰€æœ‰è¯·æ±‚å‚æ•°éƒ½ä¼šä¸¢å¤±ï¼Œå› æ­¤éœ€è¦é€šè¿‡æŸ¥è¯¢å­—ç¬¦ä¸²æˆ–Sessionç­‰æ–¹å¼ä¼ é€’å‚æ•°ã€‚é‡å®šå‘å¯ä»¥ç”¨äºå°†ç”¨æˆ·é‡å®šå‘åˆ°ä¸€ä¸ªæ–°çš„é¡µé¢ï¼Œæˆ–è€…å°†ç”¨æˆ·ä»ä¸€ä¸ªåº”ç”¨ç¨‹åºé‡å®šå‘åˆ°å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚</p><p>è½¬å‘ï¼ˆForwardï¼‰æ˜¯æŒ‡å½“ä¸€ä¸ªServletæ”¶åˆ°ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå®ƒä¼šå°†è¯·æ±‚è½¬å‘åˆ°å¦ä¸€ä¸ªServletæˆ–JSPæ¥å¤„ç†ã€‚åœ¨è½¬å‘ä¸­ï¼Œè¯·æ±‚å’Œå“åº”å¯¹è±¡æ˜¯åŒä¸€ä¸ªï¼Œåªæ˜¯Servletå®¹å™¨å°†è¯·æ±‚è½¬å‘ç»™äº†å¦ä¸€ä¸ªèµ„æºæ¥ç”Ÿæˆå“åº”ã€‚å› æ­¤ï¼Œåœ¨è½¬å‘ä¸­ï¼Œæ‰€æœ‰è¯·æ±‚å‚æ•°éƒ½ä¼šä¿ç•™ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç›®æ ‡Servletæˆ–JSPä¸­è®¿é—®ã€‚è½¬å‘é€šå¸¸ç”¨äºå°†è¯·æ±‚ä»ä¸€ä¸ªServletä¼ é€’åˆ°å¦ä¸€ä¸ªServletæˆ–JSPæ¥ç”Ÿæˆå“åº”ï¼Œä»¥ä¾¿å¯ä»¥åœ¨è¯·æ±‚å’Œå“åº”ä¹‹é—´å…±äº«æ•°æ®ã€‚</p><p>å› æ­¤ï¼Œé‡å®šå‘å’Œè½¬å‘éƒ½å¯ä»¥å°†è¯·æ±‚ä»ä¸€ä¸ªServletè½¬å‘åˆ°å¦ä¸€ä¸ªServletæˆ–JSPæ¥ç”Ÿæˆå“åº”ï¼Œä½†å®ƒä»¬çš„åŒºåˆ«åœ¨äºé‡å®šå‘ä¼šå‘é€ä¸€ä¸ªæ–°çš„è¯·æ±‚åˆ°æŒ‡å®šçš„URLï¼Œè€Œè½¬å‘åˆ™å°†è¯·æ±‚è½¬å‘åˆ°å¦ä¸€ä¸ªServletæˆ–JSPæ¥å¤„ç†ï¼Œå“åº”ç”±ç›®æ ‡Servletæˆ–JSPç”Ÿæˆã€‚é‡å®šå‘å¯¼è‡´çš„æ€§èƒ½å¼€é”€æ¯”è½¬å‘æ›´é«˜ï¼Œå› ä¸ºå®ƒéœ€è¦å‘æµè§ˆå™¨å‘é€ä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼Œè€Œè½¬å‘åˆ™åœ¨æœåŠ¡å™¨å†…éƒ¨è¿›è¡Œï¼Œæ— éœ€å‘æµè§ˆå™¨å‘é€ä»»ä½•å†…å®¹ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedirectServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/response/img"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// é‡å®šå‘</span>    <span class="token punctuation">&#125;</span></code></pre><h4 id="5-ç®€å•å®ç°ç™»å½•é‡å®šå‘">5.ç®€å•å®ç°ç™»å½•é‡å®šå‘</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Log</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>è¿™æ®µä»£ç ç”¨äºJava Servletç¼–ç¨‹ä¸­ï¼Œå°†ä¸€ä¸ªè¯·æ±‚ä»ä¸€ä¸ªServletè½¬å‘åˆ°åŒä¸€Webåº”ç”¨ç¨‹åºä¸­çš„å¦ä¸€ä¸ªServletæˆ–JSPï¼ˆJavaæœåŠ¡å™¨é¡µé¢ï¼‰ã€‚</p><p><code>getRequestDispatcher()</code>æ–¹æ³•çš„å‚æ•°æ˜¯è¯·æ±‚è½¬å‘åˆ°çš„èµ„æºçš„ç›¸å¯¹æˆ–ç»å¯¹è·¯å¾„ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè·¯å¾„ä¸ºâ€œ/helloâ€ï¼Œè¿™æ˜¯å¦ä¸€ä¸ªServlet.</p><p>ç„¶åè°ƒç”¨<code>RequestDispatcher</code>å¯¹è±¡çš„<code>forward()</code>æ–¹æ³•ï¼Œä¼ é€’<code>req</code>å’Œ<code>resp</code>å‚æ•°ã€‚è¿™äº›æ˜¯ä¼ é€’åˆ°åŸå§‹Servletçš„<code>doGet()</code>æˆ–<code>doPost()</code>æ–¹æ³•ä¸­çš„<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>å¯¹è±¡ã€‚<code>forward()</code>æ–¹æ³•å°†è¿™äº›å¯¹è±¡å‘é€åˆ°æŒ‡å®šçš„èµ„æºï¼Œå¹¶å…è®¸è¯¥èµ„æºç”Ÿæˆè¦å‘é€å›å®¢æˆ·ç«¯çš„å“åº”ã€‚</p><p>æ€»ä¹‹ï¼Œè¿™æ®µä»£ç å°†ä¸€ä¸ªè¯·æ±‚ä»å½“å‰Servletè½¬å‘åˆ°åŒä¸€Webåº”ç”¨ç¨‹åºä¸­çš„å¦ä¸€ä¸ªServletæˆ–JSPï¼ŒåŒæ—¶ä¼ é€’<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>å¯¹è±¡ã€‚ç›®æ ‡èµ„æºå°†ç”Ÿæˆè¦å‘é€å›å®¢æˆ·ç«¯çš„å“åº”ã€‚</p><h3 id="HttpServletRequest">HttpServletRequest</h3><ul><li>HttpServletRequestä»£è¡¨å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç”¨æˆ·é€šè¿‡Httpåè®®è®¿é—®æœåŠ¡å™¨ï¼ŒHTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰ä¿¡æ¯ä¼šè¢«å°è£…åˆ°HttpServletRequestï¼Œé€šè¿‡è¿™ä¸ªHttpServletRequestçš„æ–¹æ³•ï¼Œè·å¾—å®¢æˆ·ç«¯çš„æ‰€æœ‰ä¿¡æ¯ï¼›</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//        HttpServletRequestä»£è¡¨å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç”¨æˆ·é€šè¿‡Httpåè®®è®¿é—®æœåŠ¡å™¨ï¼Œ</span><span class="token comment">//        HTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰ä¿¡æ¯ä¼šè¢«å°è£…åˆ°HttpServletRequestï¼Œ</span><span class="token comment">//        é€šè¿‡è¿™ä¸ªHttpServletRequestçš„æ–¹æ³•ï¼Œè·å¾—å®¢æˆ·ç«¯çš„æ‰€æœ‰ä¿¡æ¯ï¼›</span>        <span class="token class-name">String</span> username <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> host <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"Host"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"username:"</span><span class="token operator">+</span>username<span class="token operator">+</span><span class="token string">" password:"</span><span class="token operator">+</span>password<span class="token operator">+</span><span class="token string">" host:"</span><span class="token operator">+</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        `req.getContextPath()` æ˜¯ä¸€ä¸ª Java Servlet API ä¸­çš„æ–¹æ³•ï¼Œå®ƒè¿”å›å½“å‰ Servlet çš„ä¸Šä¸‹æ–‡è·¯å¾„ã€‚</span><span class="token comment">//        ä¸Šä¸‹æ–‡è·¯å¾„æ˜¯æŒ‡ Web åº”ç”¨ç¨‹åºçš„ URL ä¸­ï¼Œä¸»æœºåå’Œç«¯å£å·åçš„ç¬¬ä¸€ä¸ªè·¯å¾„ã€‚</span><span class="token comment">//ä¾‹å¦‚ï¼Œå¦‚æœ Web åº”ç”¨ç¨‹åºçš„ URL æ˜¯ `http://example.com:8080/myapp/index.jsp`ï¼Œ</span><span class="token comment">// é‚£ä¹ˆä¸Šä¸‹æ–‡è·¯å¾„å°±æ˜¯ `/myapp`ã€‚</span>        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Context path"</span><span class="token operator">+</span>req<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       </code></pre><h3 id="ä¿å­˜ä¼šè¯çš„ä¸¤ç§æŠ€æœ¯">ä¿å­˜ä¼šè¯çš„ä¸¤ç§æŠ€æœ¯</h3><h4 id="Cookies">Cookies</h4><img src="https://cdn4.iconfinder.com/data/icons/web-hosting-pack-vol-1/512/HTTP_Cookie-512.png" alt="Cookie, http, cookies, internet cookies, web cookies icon - Download on  Iconfinder" style="zoom:25%;" loading="lazy"><p><strong>HTTP cookie</strong>ï¼Œç®€ç§°<strong>cookie</strong>ï¼Œåˆç§°â€œ<strong>ç½‘ç«™ï¼æµè§ˆï¼‹é­”é¥¼ï¼é­”ç‰‡</strong>â€ç­‰ï¼Œæ˜¯æµè§ˆ<a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E7%AB%99">ç½‘ç«™</a>æ—¶ç”±<a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%99%A8">ç½‘ç»œæœåŠ¡å™¨</a>åˆ›å»ºå¹¶ç”±<a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E9%A1%B5%E6%B5%8F%E8%A7%88%E5%99%A8">ç½‘é¡µæµè§ˆå™¨</a>å­˜æ”¾åœ¨ç”¨æˆ·è®¡ç®—æœºæˆ–å…¶ä»–è®¾å¤‡çš„å°æ–‡æœ¬æ–‡ä»¶ã€‚</p><p>Cookieä½¿WebæœåŠ¡å™¨èƒ½åœ¨ç”¨æˆ·çš„è®¾å¤‡å­˜å‚¨çŠ¶æ€ä¿¡æ¯ï¼ˆå¦‚æ·»åŠ åˆ°åœ¨çº¿å•†åº—è´­ç‰©è½¦ä¸­çš„å•†å“ï¼‰æˆ–è·Ÿè¸ªç”¨æˆ·çš„æµè§ˆæ´»åŠ¨ï¼ˆå¦‚ç‚¹å‡»ç‰¹å®šæŒ‰é’®ã€ç™»å½•æˆ–è®°å½•å†å².</p><p>cookie æ˜¯æœåŠ¡å™¨åœ¨ HTTP å“åº”ä¸­å‘é€çš„ä¸€æ®µæ•°æ®ã€‚å®¢æˆ·ç«¯ï¼ˆå¯é€‰ï¼‰å­˜å‚¨ cookie å¹¶åœ¨åç»­è¯·æ±‚ä¸­è¿”å›å®ƒã€‚è¿™å…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å…±äº«çŠ¶æ€ã€‚è¦è®¾ç½® cookieï¼ŒæœåŠ¡å™¨ä¼šåœ¨å“åº”ä¸­åŒ…å«ä¸€ä¸ª Set-Cookie æ ‡å¤´ã€‚cookie çš„æ ¼å¼æ˜¯åç§°-å€¼å¯¹ï¼Œå¸¦æœ‰å¯é€‰å±æ€§ã€‚ä¾‹å¦‚ï¼š</p><pre class="language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Set-Cookie</span>: session-id=1234567</code></pre><p>è¿™æ˜¯ä¸€ä¸ªå¸¦æœ‰å±æ€§çš„ç¤ºä¾‹ï¼š</p><pre class="language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Set-Cookie</span>: session-id=1234567<span class="token punctuation">;</span> max-age=86400<span class="token punctuation">;</span> domain=example<span class="token punctuation">.</span>com<span class="token punctuation">;</span> path=<span class="token operator">/</span><span class="token punctuation">;</span></code></pre><p>ä¸ºäº†å‘æœåŠ¡å™¨è¿”å› cookieï¼Œå®¢æˆ·ç«¯åœ¨ä»¥åçš„è¯·æ±‚ä¸­åŒ…å«ä¸€ä¸ª Cookie æ ‡å¤´ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">Cookie: session-id<span class="token operator">=</span><span class="token number">1234567</span></code></pre><p><img src="image1.png" alt="HTTP Cookies in ASP.NET Web API - ASP.NET 4.x | Microsoft Learn" loading="lazy"></p><h4 id="åˆ©ç”¨Cookiesè®°å½•ç”¨æˆ·ä¸Šä¸€æ¬¡ç™»å½•æ—¶é—´">åˆ©ç”¨Cookiesè®°å½•ç”¨æˆ·ä¸Šä¸€æ¬¡ç™»å½•æ—¶é—´</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cookie</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span><span class="token comment">//get all cookies</span>        <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>Cookie</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cookies <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>Cookie</span> cookie <span class="token operator">:</span> cookies<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> name <span class="token operator">=</span> cookie<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"lastLoginTime"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token class-name">String</span> value <span class="token operator">=</span> cookie<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">long</span> parseLong <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>cookie<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>parseLong<span class="token punctuation">)</span><span class="token punctuation">;</span>                resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"lastLoginTime: "</span><span class="token operator">+</span>date<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>Cookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>Cookie</span><span class="token punctuation">(</span><span class="token string">"lastLoginTime"</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><h4 id="session"><strong>session</strong></h4><p>åœ¨<a href="https://zh.wikipedia.org/wiki/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6">è®¡ç®—æœºç§‘å­¦</a>é¢†åŸŸæ¥è¯´ï¼Œå°¤å…¶æ˜¯åœ¨<a href="https://zh.wikipedia.org/wiki/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C">ç½‘ç»œ</a>é¢†åŸŸï¼Œ<strong>ä¼šè¯</strong>ï¼ˆè‹±è¯­ï¼šsessionï¼Œ<a href="https://zh.wikipedia.org/wiki/Microsoft_Windows">Microsoft Windows</a>è¯‘ä½œ<strong>å·¥ä½œé˜¶æ®µ</strong>ã€<strong>è¿çº¿é˜¶æ®µ</strong>ï¼‰æ˜¯ä¸€ç§æŒä¹…ç½‘ç»œåè®®ï¼Œåœ¨ç”¨æˆ·ï¼ˆæˆ–ç”¨æˆ·ä»£ç†ï¼‰ç«¯å’ŒæœåŠ¡å™¨ç«¯ä¹‹é—´åˆ›å»ºå…³è”ï¼Œä»è€Œèµ·åˆ°äº¤æ¢æ•°æ®åŒ…çš„ä½œç”¨æœºåˆ¶ï¼Œsessionåœ¨<a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE">ç½‘ç»œåè®®</a>ï¼ˆä¾‹å¦‚<a href="https://zh.wikipedia.org/wiki/Telnet">telnet</a>æˆ–<a href="https://zh.wikipedia.org/wiki/FTP">FTP</a>ï¼‰ä¸­æ˜¯éå¸¸é‡è¦çš„éƒ¨åˆ†ã€‚</p><p>åœ¨ä¸åŒ…å«<a href="https://zh.wikipedia.org/wiki/%E4%BC%9A%E8%AF%9D%E5%B1%82">ä¼šè¯å±‚</a>ï¼ˆä¾‹å¦‚<a href="https://zh.wikipedia.org/wiki/%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%8D%8F%E8%AE%AE">UDP</a>ï¼‰æˆ–è€…æ˜¯æ— æ³•é•¿æ—¶é—´é©»ç•™ä¼šè¯å±‚ï¼ˆä¾‹å¦‚<a href="https://zh.wikipedia.org/wiki/HTTP">HTTP</a>ï¼‰çš„ä¼ è¾“åè®®ä¸­ï¼Œä¼šè¯çš„ç»´æŒéœ€è¦ä¾é åœ¨ä¼ è¾“æ•°æ®ä¸­çš„é«˜çº§åˆ«ç¨‹åºã€‚ä¾‹å¦‚ï¼Œåœ¨æµè§ˆå™¨å’Œè¿œç¨‹ä¸»æœºä¹‹é—´çš„HTTPä¼ è¾“ä¸­ï¼ŒHTTP cookieå°±ä¼šè¢«ç”¨æ¥åŒ…å«ä¸€äº›ç›¸å…³çš„ä¿¡æ¯ï¼Œä¾‹å¦‚session IDï¼Œå‚æ•°å’Œæƒé™ä¿¡æ¯ç­‰ã€‚</p><ul><li><p>æœåŠ¡å™¨æŠ€æœ¯ï¼Œåˆ©ç”¨è¿™ä¸ªæŠ€æœ¯ï¼Œå¯ä»¥ä¿å­˜ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ï¼Ÿ æˆ‘ä»¬å¯ä»¥æŠŠä¿¡æ¯æˆ–è€…æ•°æ®æ”¾åœ¨Sessionä¸­ï¼</p></li><li><p>æœåŠ¡å™¨ä¼šç»™æ¯ä¸€ä¸ªç”¨æˆ·ï¼ˆæµè§ˆå™¨ï¼‰åˆ›å»ºä¸€ä¸ªSeesionå¯¹è±¡ï¼›</p></li><li><p>ä¸€ä¸ªSeesionç‹¬å ä¸€ä¸ªæµè§ˆå™¨ï¼Œåªè¦æµè§ˆå™¨æ²¡æœ‰å…³é—­ï¼Œè¿™ä¸ªSessionå°±å­˜åœ¨ï¼›</p></li><li><p>ç”¨æˆ·ç™»å½•ä¹‹åï¼Œæ•´ä¸ªç½‘ç«™å®ƒéƒ½å¯ä»¥è®¿é—®ï¼â€“&gt; ä¿å­˜ç”¨æˆ·çš„ä¿¡æ¯ï¼›ä¿å­˜è´­ç‰©è½¦çš„ä¿¡æ¯â€¦â€¦</p></li></ul><h4 id="Sessionå’Œcookieçš„åŒºåˆ«ï¼š">Sessionå’Œcookieçš„åŒºåˆ«ï¼š</h4><p>Cookieå’ŒSessionæ˜¯Webåº”ç”¨ç¨‹åºä¸­å¸¸ç”¨çš„ä¸¤ç§ç”¨äºä¿å­˜ç”¨æˆ·çŠ¶æ€ä¿¡æ¯çš„æœºåˆ¶ã€‚</p><p>ç›¸åŒç‚¹ï¼š</p><ol><li><p>éƒ½æ˜¯ç”¨äºåœ¨Webåº”ç”¨ç¨‹åºä¸­ä¿å­˜ç”¨æˆ·çŠ¶æ€ä¿¡æ¯çš„æœºåˆ¶ã€‚</p></li><li><p>éƒ½å¯ä»¥åœ¨å¤šä¸ªè¯·æ±‚ä¹‹é—´ä¿æŒç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ï¼Œä½¿ç”¨æˆ·åœ¨æµè§ˆç½‘ç«™æ—¶èƒ½å¤Ÿä¿æŒçŠ¶æ€çš„è¿ç»­æ€§ã€‚</p></li><li><p>éƒ½å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜Webåº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œå‡å°‘å¯¹æœåŠ¡å™¨çš„è´Ÿè½½ã€‚</p></li></ol><p>ä¸åŒç‚¹ï¼š</p><ol><li><p>å­˜å‚¨ä½ç½®ä¸åŒï¼šCookieä¿å­˜åœ¨å®¢æˆ·ç«¯çš„æµè§ˆå™¨ä¸­ï¼Œè€ŒSessionä¿å­˜åœ¨æœåŠ¡å™¨ç«¯çš„å†…å­˜æˆ–è€…ç¡¬ç›˜ä¸­ã€‚</p></li><li><p>å­˜å‚¨å®¹é‡ä¸åŒï¼šCookieçš„å­˜å‚¨å®¹é‡æ¯”Sessionå°ã€‚</p></li><li><p>å®‰å…¨æ€§ä¸åŒï¼šç”±äºSessionæ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œå› æ­¤ç›¸å¯¹äºCookieæ›´åŠ å®‰å…¨ï¼ŒCookieæ•°æ®å®¹æ˜“è¢«ç¯¡æ”¹æˆ–ç›—ç”¨ã€‚</p></li><li><p>è¿‡æœŸæ—¶é—´ä¸åŒï¼šSessionçš„è¿‡æœŸæ—¶é—´å¯ä»¥ç”±å¼€å‘äººå‘˜åœ¨ä»£ç ä¸­è®¾ç½®ï¼Œè€ŒCookieçš„è¿‡æœŸæ—¶é—´å¯ä»¥åœ¨åˆ›å»ºCookieæ—¶è®¾ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰‹åŠ¨åˆ é™¤ã€‚</p></li><li><p>ä½¿ç”¨åœºæ™¯ä¸åŒï¼šCookieé€‚ç”¨äºéœ€è¦é•¿æœŸä¿å­˜ç”¨æˆ·çŠ¶æ€ä¿¡æ¯çš„åœºæ™¯ï¼Œä¾‹å¦‚ä¿å­˜ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€åå¥½è®¾ç½®ç­‰ï¼›è€ŒSessioné€‚ç”¨äºéœ€è¦åœ¨çŸ­æ—¶é—´å†…ä¿å­˜ç”¨æˆ·çŠ¶æ€ä¿¡æ¯çš„åœºæ™¯ï¼Œä¾‹å¦‚è´­ç‰©è½¦ã€ä¼šè¯ä¿¡æ¯ç­‰ã€‚</p></li></ol><h4 id="åˆ©ç”¨Sessionè¿”å›å®¢æˆ·ç«¯ä¸€ä¸ªPersonå¯¹è±¡-å¹¶åœ¨æµè§ˆå™¨ä¸Šæ‰“å°">åˆ©ç”¨Sessionè¿”å›å®¢æˆ·ç«¯ä¸€ä¸ªPersonå¯¹è±¡, å¹¶åœ¨æµè§ˆå™¨ä¸Šæ‰“å°</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Session</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"person"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"Alice@gmail.com"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"Session id"</span><span class="token operator">+</span>session<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"person"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token operator">+</span>person<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>          <span class="token comment">//client æ¯æ¬¡è®¿é—®æœåŠ¡å™¨éƒ½ä¼šåœ¨æœåŠ¡å™¨ç«¯ç»´æŠ¤ä¸€ä¸ªSession, å¹¶å‘ç”¨æˆ·ä»¥Cookieçš„æ–¹å¼ï¼Œå‘é€Session id,</span><span class="token comment">//        ä½†æ˜¯å¯¹äºclientè€Œè¨€ï¼Œ è¿™ä¸ªSession id æ˜¯ä»¥Cookieçš„å½¢å¼å­˜å‚¨åœ¨æµè§ˆå™¨ä¸Šçš„ï¼Œ æ‰€ä»¥æ›´æ¢æµè§ˆå™¨è®¿é—®åCookieæ”¹å˜äº†</span><span class="token comment">//        æ‰€ä»¥ï¼ŒæœåŠ¡å™¨ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªæ–°çš„Session.</span><span class="token comment">//        ä¸‹ä¸€æ¬¡ç”¨æˆ·å†æ¬¡è®¿é—®çš„æ—¶å€™å°±ä¼šæ‹¿ç€è¿™ä¸ªSession id è®¿é—®Serveï¼Œ Serverå°±çŸ¥é“è¿™ä¸ªå®¢æˆ·çš„ä¿¡æ¯</span><span class="token comment">//        1. æ‹¿åˆ°Sessionï¼Œ è¿™ä¸ªCookieæ˜¯ç”±å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨çš„</span><span class="token comment">//        Session å¯ä»¥ä½¿ç”¨setAttributeæ–¹æ³•æ¥ä¿å­˜ä¿¡æ¯</span><span class="token comment">//        ä¸åŒäºCookieï¼ŒSession å¯ä»¥ä¿å­˜ä¸€ä¸ªå¯¹è±¡(Object)ï¼Œ è€Œä¸æ˜¯ä»…ä»…æ˜¯ä¸€ä¸ªString</span></code></pre><p><strong>ä¼šè¯è‡ªåŠ¨è¿‡æœŸï¼šweb.xmlé…ç½®</strong>ï¼</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--è®¾ç½®Sessioné»˜è®¤çš„å¤±æ•ˆæ—¶é—´--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>session-config</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--15åˆ†é’ŸåSessionè‡ªåŠ¨å¤±æ•ˆï¼Œä»¥åˆ†é’Ÿä¸ºå•ä½--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>session-timeout</span><span class="token punctuation">></span></span>15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>session-timeout</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>session-config</span><span class="token punctuation">></span></span></code></pre><h3 id="JSP-Java-Server-Pages">JSP (Java Server Pages)</h3><p><strong>JSP</strong>ï¼ˆå…¨ç§°<strong>J</strong>akarta <strong>S</strong>erver <strong>P</strong>agesï¼Œæ›¾ç§°ä¸º<strong>J</strong>ava<strong>S</strong>erver <strong>P</strong>agesï¼‰æ˜¯ç”±<a href="https://zh.wikipedia.org/wiki/Sun_Microsystems">Sun Microsystems</a>å…¬å¸ä¸»å¯¼åˆ›å»ºçš„ä¸€ç§åŠ¨æ€ç½‘é¡µæŠ€æœ¯æ ‡å‡†ã€‚</p><p><strong>Java Server Pages ï¼š JavaæœåŠ¡å™¨ç«¯é¡µé¢ï¼Œä¹Ÿå’ŒServletä¸€æ ·ï¼Œç”¨äºåŠ¨æ€WebæŠ€æœ¯ï¼</strong></p><ul><li>æœ€å¤§çš„ç‰¹ç‚¹ï¼š<ul><li>å†™JSPå°±åƒåœ¨å†™HTMLï¼›</li><li>åŒºåˆ«ï¼š<ul><li>HTMLåªç»™ç”¨æˆ·æä¾›é™æ€çš„æ•°æ®ï¼›</li><li>JSPé¡µé¢ä¸­å¯ä»¥åµŒå…¥JAVAä»£ç ï¼Œä¸ºç”¨æˆ·æä¾›åŠ¨æ€æ•°æ®ï¼›</li></ul></li></ul></li></ul><h4 id="JSPåŸç†">JSPåŸç†</h4><p>æ€è·¯ï¼šJSPåˆ°åº•æ€ä¹ˆæ‰§è¡Œçš„ï¼</p><ul><li><p>æœåŠ¡å™¨å†…éƒ¨å·¥ä½œï¼š</p><ul><li>tomcatä¸­æœ‰ä¸€ä¸ªworkç›®å½•ï¼›</li></ul></li><li><p>IDEAä¸­ä½¿ç”¨Tomcatçš„ä¼šåœ¨IDEAçš„tomcatä¸­ç”Ÿäº§ä¸€ä¸ªworkç›®å½•ï¼›</p><p>IDEAä¼šä¸ºæ¯ä¸ªTomcat Webappsåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹,ç”¨æ¥å­˜æ”¾è¿™ä¸ªAPPçš„é…ç½®æ–‡ä»¶, å·¥ä½œè·¯å¾„, åœ¨æˆ‘çš„MACè·¯å¾„<code>/Users/trevorwu/Library/Caches/JetBrains/IntelliJIdea2022.3/tomcat/47ad80c0-0fbd-41b1-a4ae-e036ca41705b</code></p><p>æˆ‘ä»¬è¿›å…¥è¿™ä¸ªè·¯å¾„çš„æœ€æ·±å¤„</p><p>`cd Catalina/localhost/ROOT/org/apache/jsp</p><p><img src="image-20230512202849320.png" alt="image-20230512202849320" loading="lazy"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œé¢æœ‰ä¸¤ä¸ªæ–‡ä»¶, ä¸€ä¸ªæ˜¯<code>index_jsp.class</code> å¦ä¸€ä¸ªæ˜¯<code>index_jsp.java` å¾ˆæ˜æ˜¾, `index_jsp.class`å°±æ˜¯</code>index_jsp.java` ç¼–è¯‘ç”Ÿæˆçš„classæ–‡ä»¶.</p><p>è¿™æ˜¯åªæœ‰ä¸€ä¸ªè¿™æ ·çš„class, ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ä¸»é¡µindex.jsp</p><img src="image-20230512203239731.png" alt="image-20230512203239731" style="zoom:33%;" loading="lazy"></li></ul><p>ä¹Ÿå°±æ˜¯è¯´, å¦‚æœæˆ‘ä»¬è®¿é—®index.jsp, ç›¸å½“äºè®¿é—®æ ¹ç›®å½•<code>localhost:8080/</code> æœåŠ¡å™¨å°±ä¼šç”Ÿæˆå¯¹åº”çš„.javaæ–‡ä»¶, ä»¥åŠ.classæ–‡ä»¶ç”¨æ¥å¤„ç†è¯·æ±‚. è¿™ä¸ª.javaæ–‡ä»¶æœ¬è´¨ä¸Šå°±æ˜¯Servlet. å¦‚æœè¿™æ—¶å€™æˆ‘ä»¬è®¿é—®åˆ«çš„é¡µé¢, å°±ä¼šç”Ÿæˆæ–°çš„Servlet.</p><ul><li><strong>æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œä¸ç®¡è®¿é—®ä»€ä¹ˆèµ„æºï¼Œå…¶å®éƒ½æ˜¯åœ¨è®¿é—®Servletï¼</strong></li><li>JSPæœ€ç»ˆä¹Ÿä¼šè¢«è½¬æ¢æˆä¸ºä¸€ä¸ªJavaç±»ï¼</li><li><strong>JSP æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªServlet</strong>ï¼</li></ul><p><img src="watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ2MTUzOTQ5,size_16,color_FFFFFF,t_70.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">// åˆå§‹åŒ–</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">_jspInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token punctuation">&#125;</span><span class="token comment">// é”€æ¯</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">_jspDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token punctuation">&#125;</span><span class="token comment">// JSPService</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">_jspService</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>HttpServletResponse</span> response<span class="token punctuation">)</span>      <span class="token keyword">throws</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>IOException</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>ServletException</span> <span class="token punctuation">&#123;</span>   </code></pre><ol><li><p>å†…ç½®ä¸€äº›å¯¹è±¡ï¼›</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span></span>PageContext</span> pageContext<span class="token punctuation">;</span>  <span class="token comment">// é¡µé¢ä¸Šä¸‹æ–‡</span><span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>HttpSession</span> session <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token comment">// session</span><span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>ServletContext</span> application<span class="token punctuation">;</span>   <span class="token comment">// applicationContext</span><span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>ServletConfig</span> config<span class="token punctuation">;</span>         <span class="token comment">// config</span><span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span></span>JspWriter</span> out <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>           <span class="token comment">// out</span><span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>               <span class="token comment">// pageï¼šå½“å‰</span><span class="token class-name">HttpServletRequest</span> request                        <span class="token comment">// è¯·æ±‚</span><span class="token class-name">HttpServletResponse</span> response                      <span class="token comment">// å“åº”</span></code></pre></li><li><p>è¾“å‡ºé¡µé¢å‰å¢åŠ çš„ä»£ç ï¼›</p><pre class="language-java" data-language="java"><code class="language-java">response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// è®¾ç½®å“åº”çš„é¡µé¢ç±»å‹</span>pageContext <span class="token operator">=</span> _jspxFactory<span class="token punctuation">.</span><span class="token function">getPageContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">,</span>                                          <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">8192</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>_jspx_page_context <span class="token operator">=</span> pageContext<span class="token punctuation">;</span>application <span class="token operator">=</span> pageContext<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>config <span class="token operator">=</span> pageContext<span class="token punctuation">.</span><span class="token function">getServletConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>session <span class="token operator">=</span> pageContext<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out <span class="token operator">=</span> pageContext<span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>_jspx_out <span class="token operator">=</span> out<span class="token punctuation">;</span></code></pre></li><li><p>ä»¥ä¸Šçš„è¿™äº›ä¸ªå¯¹è±¡æˆ‘ä»¬å¯ä»¥åœ¨JSPé¡µé¢ä¸­ç›´æ¥ä½¿ç”¨ï¼</p></li></ol><ul><li>åœ¨JSPé¡µé¢ä¸­ï¼š<ul><li>åªè¦æ˜¯ JAVAä»£ç å°±ä¼šåŸå°ä¸åŠ¨çš„è¾“å‡ºï¼›</li><li>å¦‚æœæ˜¯HTMLä»£ç ï¼Œå°±ä¼šè¢«è½¬æ¢ä¸ºï¼š</li></ul></li></ul><pre class="language-java" data-language="java"><code class="language-java">out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"&lt;html>\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"  &lt;head>\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"    &lt;title>$Title$&lt;/title>\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"  &lt;/head>\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"  &lt;body>\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"  $END$\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"  &lt;/body>\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"&lt;/html>\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>è¿™æ ·çš„æ ¼å¼ï¼Œè¾“å‡ºåˆ°å‰ç«¯ï¼</li></ul><h4 id="JSPè¯­æ³•">JSPè¯­æ³•</h4><ul><li>ä»»ä½•è¯­è¨€éƒ½æœ‰è‡ªå·±çš„è¯­æ³•ï¼ŒJAVAä¸­æœ‰ï¼ŒJSP ä½œä¸ºjavaæŠ€æœ¯çš„ä¸€ç§åº”ç”¨ï¼Œå®ƒæ‹¥æœ‰ä¸€äº›è‡ªå·±æ‰©å……çš„è¯­æ³•ï¼ˆäº†è§£ï¼ŒçŸ¥é“å³å¯ï¼ï¼‰ï¼ŒJavaæ‰€æœ‰è¯­æ³•éƒ½æ”¯æŒï¼</li><li>é…ç½®å¿…éœ€çš„mavenç¯å¢ƒï¼š</li></ul><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--        JSP ä¾èµ–   --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>javax.servlet.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>javax.servlet.jsp-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.3.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        JSTLè¡¨è¾¾å¼çš„ä¾èµ–--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>javax.servlet.jsp.jstl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jstl-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        standardæ ‡ç­¾åº“--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>taglibs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>standard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><h5 id="JSPè¡¨è¾¾å¼">JSPè¡¨è¾¾å¼</h5><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;&lt;%--JSPè¡¨è¾¾å¼            ä½œç”¨ï¼šç”¨æ¥å°†ç¨‹åºçš„è¾“å‡ºï¼Œè¾“å‡ºåˆ°å®¢æˆ·ç«¯            &lt;%&#x3D; å˜é‡æˆ–è€…è¡¨è¾¾å¼%&gt;--%&gt;&lt;%&#x3D; new java.util.Date()%&gt;&lt;&#x2F;body&gt;</code></pre><h5 id="jspè„šæœ¬ç‰‡æ®µ">jspè„šæœ¬ç‰‡æ®µ</h5><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;&lt;%--jspè„šæœ¬ç‰‡æ®µ--%&gt;&lt;%  int sum &#x3D; 0;  for (int i &#x3D; 1; i &lt;&#x3D;100 ; i++) &#123;    sum+&#x3D;i;  &#125;  out.println(&quot;&lt;h1&gt;Sum&#x3D;&quot;+sum+&quot;&lt;&#x2F;h1&gt;&quot;);%&gt;&lt;&#x2F;body&gt;</code></pre><ul><li>JSPå£°æ˜</li><li>&lt;%! code %&gt;</li></ul><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;&lt;%!  static &#123;    System.out.println(&quot;Loading Servlet!&quot;);  &#125;  private int globalVar &#x3D; 0;  public void guo()&#123;    System.out.println(&quot;è¿›å…¥äº†æ–¹æ³•guoï¼&quot;);  &#125;%&gt;&lt;&#x2F;body&gt;</code></pre><ul><li>JSPå£°æ˜ï¼šä¼šè¢«ç¼–è¯‘åˆ°JSPç”ŸæˆJavaçš„ç±»ä¸­ï¼å…¶ä»–çš„ï¼Œå°±ä¼šè¢«ç”Ÿæˆåˆ°_jspServiceæ–¹æ³•ä¸­ï¼</li></ul><p><img src="watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ2MTUzOTQ5,size_16,color_FFFFFF,t_70-20230512204121432.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p><h5 id="JSPæŒ‡ä»¤-404ä¸500é¡µé¢å®ç°">JSPæŒ‡ä»¤: 404ä¸500é¡µé¢å®ç°</h5><p><img src="image-20230512204634669.png" alt="image-20230512204634669" loading="lazy"></p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    è‡ªå®šä¹‰é”™è¯¯é¡µé¢--></span><span class="token comment">&lt;!--    é…ç½®ä¹‹åè®°å¾—é‡å¯TomcatæœåŠ¡ï¼Œ ä¿®æ”¹tomcaté…ç½®æ–‡ä»¶web.xmlçƒ­éƒ¨ç½²ä¸ç”Ÿæ•ˆ--></span><span class="token comment">&lt;!--    è‡ªç”±ä¿®æ”¹jspæ–‡ä»¶æ‰èƒ½çƒ­éƒ¨ç½²--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-page</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-code</span><span class="token punctuation">></span></span>404<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-code</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>location</span><span class="token punctuation">></span></span>/error/404.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>location</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-page</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-page</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-code</span><span class="token punctuation">></span></span>500<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-code</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>location</span><span class="token punctuation">></span></span>/error/500.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>location</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-page</span><span class="token punctuation">></span></span></code></pre><h6 id="å¤´éƒ¨å’Œå°¾éƒ¨é¡µé¢æ‹¼æ¥">å¤´éƒ¨å’Œå°¾éƒ¨é¡µé¢æ‹¼æ¥</h6><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;    &lt;%-- @includeä¼šå°†ä¸¤ä¸ªé¡µé¢åˆäºŒä¸ºä¸€ --%&gt;    &lt;%@include file&#x3D;&quot;common&#x2F;header.jsp&quot;%&gt;    &lt;h1&gt;ç½‘é¡µä¸»ä½“&lt;&#x2F;h1&gt;    &lt;%@include file&#x3D;&quot;common&#x2F;footer.jsp&quot;%&gt;    &lt;hr&gt;    &lt;%--        jspæ ‡ç­¾        jsp:includeï¼šæ‹¼æ¥é¡µé¢ï¼Œæœ¬è´¨è¿˜æ˜¯ä¸‰ä¸ª    --%&gt;    &lt;jsp:include page&#x3D;&quot;&#x2F;common&#x2F;header.jsp&quot;&#x2F;&gt;    &lt;h1&gt;ç½‘é¡µä¸»ä½“&lt;&#x2F;h1&gt;    &lt;jsp:include page&#x3D;&quot;&#x2F;common&#x2F;footer.jsp&quot;&#x2F;&gt;&lt;&#x2F;body&gt;</code></pre><h4 id="å†…ç½®å¯¹è±¡">å†…ç½®å¯¹è±¡</h4><ul><li>PageContext å­˜ä¸œè¥¿</li><li>Request å­˜ä¸œè¥¿</li><li>Response</li><li>Session å­˜ä¸œè¥¿</li><li>Application ã€SerlvetContextã€‘ å­˜ä¸œè¥¿</li><li>config ã€SerlvetConfigã€‘</li><li>out</li><li>page ï¼Œä¸ç”¨äº†è§£</li><li>exception</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token generics"><span class="token punctuation">&lt;</span>body<span class="token punctuation">></span></span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">--</span>å†…ç½®å¯¹è±¡<span class="token operator">--</span><span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>    pageContext<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"name1"</span><span class="token punctuation">,</span><span class="token string">"å¤©å¯1å·"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¿å­˜çš„æ•°æ®åªåœ¨ä¸€ä¸ªé¡µé¢ä¸­æœ‰æ•ˆ</span>    request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"name2"</span><span class="token punctuation">,</span><span class="token string">"å¤©å¯2å·"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¿å­˜çš„æ•°æ®åªåœ¨ä¸€æ¬¡è¯·æ±‚ä¸­æœ‰æ•ˆï¼Œè¯·æ±‚è½¬å‘ä¼šæºå¸¦è¿™ä¸ªæ•°æ®</span>    session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"name3"</span><span class="token punctuation">,</span><span class="token string">"å¤©å¯3å·"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¿å­˜çš„æ•°æ®åªåœ¨ä¸€æ¬¡ä¼šè¯ä¸­æœ‰æ•ˆï¼Œä»æ‰“å¼€æµè§ˆå™¨åˆ°å…³é—­æµè§ˆå™¨</span>    application<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"name4"</span><span class="token punctuation">,</span><span class="token string">"å¤©å¯4å·"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¿å­˜çš„æ•°æ®åªåœ¨æœåŠ¡å™¨ä¸­æœ‰æ•ˆï¼Œä»æ‰“å¼€æœåŠ¡å™¨åˆ°å…³é—­æœåŠ¡å™¨</span><span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">--</span>    è„šæœ¬ç‰‡æ®µä¸­çš„ä»£ç ï¼Œä¼šè¢«åŸå°ä¸åŠ¨ç”Ÿæˆåˆ°<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span>java    è¦æ±‚ï¼šè¿™é‡Œé¢çš„ä»£ç ï¼Œå¿…é¡»ä¿è¯<span class="token class-name">Java</span>è¯­æ³•çš„æ­£ç¡®æ€§<span class="token operator">--</span><span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>    <span class="token comment">// ä»pageContentå–å‡ºï¼Œæˆ‘ä»¬é€šè¿‡å¯»æ‰¾çš„æ–¹å¼æ¥</span>    <span class="token comment">// ä»åº•å±‚åˆ°é«˜å±‚ï¼ˆä½œç”¨åŸŸï¼‰:</span>    <span class="token class-name">String</span> name1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> pageContext<span class="token punctuation">.</span><span class="token function">findAttribute</span><span class="token punctuation">(</span><span class="token string">"name1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> name2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> pageContext<span class="token punctuation">.</span><span class="token function">findAttribute</span><span class="token punctuation">(</span><span class="token string">"name2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> name3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> pageContext<span class="token punctuation">.</span><span class="token function">findAttribute</span><span class="token punctuation">(</span><span class="token string">"name3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> name4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> pageContext<span class="token punctuation">.</span><span class="token function">findAttribute</span><span class="token punctuation">(</span><span class="token string">"name4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> name5 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> pageContext<span class="token punctuation">.</span><span class="token function">findAttribute</span><span class="token punctuation">(</span><span class="token string">"name5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä½œç”¨åŸŸ</span><span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">--</span>ä½¿ç”¨<span class="token constant">EL</span>è¡¨è¾¾å¼è¾“å‡º $<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token operator">--</span><span class="token operator">%</span><span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>h1<span class="token punctuation">></span></span>å–å‡ºçš„å€¼<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>h3<span class="token punctuation">></span></span>$<span class="token punctuation">&#123;</span>name1<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>h3<span class="token punctuation">></span></span>$<span class="token punctuation">&#123;</span>name2<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>h3<span class="token punctuation">></span></span>$<span class="token punctuation">&#123;</span>name3<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>h3<span class="token punctuation">></span></span>$<span class="token punctuation">&#123;</span>name4<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>h3<span class="token punctuation">></span></span> <span class="token operator">&lt;</span><span class="token operator">%=</span>name5<span class="token operator">%</span><span class="token operator">></span> <span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre><ul><li>requestï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œäº§ç”Ÿçš„æ•°æ®ï¼Œç”¨æˆ·çœ‹å®Œå°±æ²¡ç”¨äº†ï¼Œæ¯”å¦‚ï¼šæ–°é—»ï¼Œç”¨æˆ·çœ‹å®Œæ²¡ç”¨çš„ï¼</li><li>sessionï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œäº§ç”Ÿçš„æ•°æ®ï¼Œç”¨æˆ·ç”¨å®Œä¸€ä¼šè¿˜æœ‰ç”¨ï¼Œæ¯”å¦‚ï¼šè´­ç‰©è½¦ï¼›</li><li>applicationï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œäº§ç”Ÿçš„æ•°æ®ï¼Œä¸€ä¸ªç”¨æˆ·ç”¨å®Œäº†ï¼Œå…¶ä»–ç”¨æˆ·è¿˜å¯èƒ½ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼šèŠå¤©æ•°æ®ï¼›</li></ul><h4 id="JSPæ ‡ç­¾-JSTLæ ‡ç­¾-ELè¡¨è¾¾å¼">JSPæ ‡ç­¾.JSTLæ ‡ç­¾.ELè¡¨è¾¾å¼</h4><ul><li>ELè¡¨è¾¾å¼ï¼š ${ }<ul><li><strong>è·å–æ•°æ®</strong></li><li><strong>æ‰§è¡Œè¿ç®—</strong></li><li><strong>è·å–webå¼€å‘çš„å¸¸ç”¨å¯¹è±¡</strong></li></ul></li></ul><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;!-- JSTLè¡¨è¾¾å¼çš„ä¾èµ– --&gt;&lt;dependency&gt;    &lt;groupId&gt;javax.servlet.jsp.jstl&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;jstl-api&lt;&#x2F;artifactId&gt;    &lt;version&gt;1.2&lt;&#x2F;version&gt;&lt;&#x2F;dependency&gt;&lt;!-- standardæ ‡ç­¾åº“ --&gt;&lt;dependency&gt;    &lt;groupId&gt;taglibs&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;standard&lt;&#x2F;artifactId&gt;    &lt;version&gt;1.1.2&lt;&#x2F;version&gt;&lt;&#x2F;dependency&gt;</code></pre><ul><li><p><strong>JSPæ ‡ç­¾</strong></p></li><li><p>åˆ©ç”¨JSPæ ‡ç­¾å®ç°è¯·æ±‚è½¬å‘, å¹¶è®¾ç½®å‚æ•°</p><p>&lt;jsp:forward page=â€œurlâ€&gt;</p></li></ul><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;&lt;%--jsp:include--%&gt;&lt;jsp:forward page&#x3D;&quot;&#x2F;jspTag2.jsp&quot;&gt;    &lt;jsp:param name&#x3D;&quot;name&quot; value&#x3D;&quot;subeiLY&quot;&#x2F;&gt;    &lt;jsp:param name&#x3D;&quot;age&quot; value&#x3D;&quot;18&quot;&#x2F;&gt;&lt;&#x2F;jsp:forward&gt;&lt;&#x2F;body&gt;</code></pre><ul><li>å†è½¬å‘çš„ç›®æ ‡Servletå–å‚æ•°</li></ul><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;&lt;%--å–å‡ºå‚æ•°--%&gt;åå­—:&lt;%&#x3D;request.getParameter(&quot;name&quot;)%&gt;å¹´é¾„:&lt;%&#x3D;request.getParameter(&quot;age&quot;)%&gt;&lt;&#x2F;body&gt;</code></pre><ul><li><p><strong>JSTLè¡¨è¾¾å¼</strong></p><ul><li>JSTLæ ‡ç­¾åº“çš„ä½¿ç”¨å°±æ˜¯ä¸ºäº†å¼¥è¡¥HTMLæ ‡ç­¾çš„ä¸è¶³ï¼›å®ƒè‡ªå®šä¹‰è®¸å¤šæ ‡ç­¾ï¼Œå¯ä»¥ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œæ ‡ç­¾çš„åŠŸèƒ½å’ŒJavaä»£ç ä¸€æ ·ï¼</li></ul></li><li><p><strong>æ ¼å¼åŒ–æ ‡ç­¾</strong></p></li><li><p><strong>SQLæ ‡ç­¾</strong></p></li><li><p><strong>XML æ ‡ç­¾</strong></p></li><li><p><em><strong>æ ¸å¿ƒæ ‡ç­¾</strong> ï¼ˆæŒæ¡éƒ¨åˆ†ï¼‰</em></p></li><li><p><strong>JSTLæ ‡ç­¾åº“ä½¿ç”¨æ­¥éª¤</strong>ï¼š</p><ul><li>å¼•å…¥å¯¹åº”çš„ taglibï¼›</li><li>ä½¿ç”¨å…¶ä¸­çš„æ–¹æ³•ï¼›</li><li><strong>åœ¨Tomcat çš„libç›®å½•ä¸‹ä¹Ÿéœ€è¦å¼•å…¥ jstl-api-1.2.jarã€standard-1.1.2.jarçš„åŒ…ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼šJSTLè§£æé”™è¯¯</strong>ï¼›</li></ul></li><li><p>cï¼šifæ ‡ç­¾ ELè¡¨è¾¾å¼è·å–è¡¨å•ä¸­çš„æ•°æ®</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;&lt;form action&#x3D;&quot;core-if.jsp&quot; method&#x3D;&quot;get&quot;&gt;    &lt;%--        ELè¡¨è¾¾å¼è·å–è¡¨å•ä¸­çš„æ•°æ®        $&#123;param.å‚æ•°å&#125;    --%&gt;    &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; value&#x3D;&quot;$&#123;param.username&#125;&quot;&gt;    &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;ç™»å½•&quot;&gt;&lt;&#x2F;form&gt;&lt;%--åˆ¤æ–­å¦‚æœæäº¤çš„ç”¨æˆ·åæ˜¯ç®¡ç†å‘˜ï¼Œåˆ™ç™»å½•æˆåŠŸ--%&gt;&lt;c:if test&#x3D;&quot;$&#123;param.username&#x3D;&#x3D;&#39;admin&#39;&#125;&quot; var&#x3D;&quot;isAdmin&quot;&gt;    &lt;c:out value&#x3D;&quot;ç®¡ç†å‘˜æ¬¢è¿æ‚¨ï¼&quot;&#x2F;&gt;&lt;&#x2F;c:if&gt;  &lt;c:out value&#x3D;&quot;$&#123;isAdmin&#125;&quot;&#x2F;&gt;&lt;&#x2F;body&gt;</code></pre><ul><li>c:choose c:when å®ç°æˆç»©åˆ¤æ–­(Switch case)</li></ul><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;&lt;%--å®šä¹‰ä¸€ä¸ªå˜é‡scoreï¼Œå€¼ä¸º85--%&gt;&lt;c:set var&#x3D;&quot;score&quot; value&#x3D;&quot;65&quot;&#x2F;&gt;&lt;c:choose&gt;    &lt;c:when test&#x3D;&quot;$&#123;score&gt;&#x3D;90&#125;&quot;&gt;        ä½ çš„æˆç»©ä¸ºä¼˜ç§€    &lt;&#x2F;c:when&gt;    &lt;c:when test&#x3D;&quot;$&#123;score&gt;&#x3D;80&#125;&quot;&gt;        ä½ çš„æˆç»©ä¸ºä¸€èˆ¬    &lt;&#x2F;c:when&gt;    &lt;c:when test&#x3D;&quot;$&#123;score&gt;&#x3D;70&#125;&quot;&gt;        ä½ çš„æˆç»©ä¸ºè‰¯å¥½    &lt;&#x2F;c:when&gt;    &lt;c:when test&#x3D;&quot;$&#123;score&lt;&#x3D;60&#125;&quot;&gt;        ä½ çš„æˆç»©ä¸ºä¸åŠæ ¼    &lt;&#x2F;c:when&gt;&lt;&#x2F;c:choose&gt;&lt;&#x2F;body&gt;</code></pre><ul><li>c:forEach</li></ul><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;&lt;%    ArrayList&lt;String&gt; people &#x3D; new ArrayList&lt;&gt;();    people.add(0,&quot;Alice&quot;);    people.add(1,&quot;Bob&quot;);    people.add(2,&quot;æ¥¼å…°&quot;);    people.add(3,&quot;Goobus&quot;);    people.add(4,&quot;Kris&quot;);    request.setAttribute(&quot;list&quot;,people);%&gt;&lt;%--var , æ¯ä¸€æ¬¡éå†å‡ºæ¥çš„å˜é‡items, è¦éå†çš„å¯¹è±¡begin,   å“ªé‡Œå¼€å§‹end,     åˆ°å“ªé‡Œstep,   æ­¥é•¿ (i++)--%&gt;&lt;c:forEach var&#x3D;&quot;people&quot; items&#x3D;&quot;$&#123;list&#125;&quot;&gt;    &lt;c:out value&#x3D;&quot;$&#123;people&#125;&quot;&#x2F;&gt; &lt;br&gt;&lt;&#x2F;c:forEach&gt;&lt;hr&gt;&lt;c:forEach var&#x3D;&quot;people&quot; items&#x3D;&quot;$&#123;list&#125;&quot; begin&#x3D;&quot;1&quot; end&#x3D;&quot;3&quot; step&#x3D;&quot;1&quot; &gt;    &lt;c:out value&#x3D;&quot;$&#123;people&#125;&quot;&#x2F;&gt; &lt;br&gt;&lt;&#x2F;c:forEach&gt;&lt;&#x2F;body&gt;</code></pre></li></ul><h2 id="JavaBean">JavaBean</h2><p>å®ä½“ç±»ï¼ŒJavaBeanæœ‰ç‰¹å®šçš„å†™æ³•ï¼š</p><ul><li>å¿…é¡»è¦æœ‰ä¸€ä¸ªæ— å‚æ„é€ </li><li>å±æ€§å¿…é¡»ç§æœ‰åŒ–</li><li>å¿…é¡»æœ‰å¯¹åº”çš„get/setæ–¹æ³•ï¼›</li></ul><p>ä¸€èˆ¬ç”¨æ¥å’Œæ•°æ®åº“çš„å­—æ®µåšæ˜ å°„ ORMï¼›</p><p>ORM ï¼šå¯¹è±¡å…³ç³»æ˜ å°„</p><ul><li>è¡¨â€”&gt;ç±»</li><li>å­—æ®µâ€“&gt;å±æ€§</li><li>è¡Œè®°å½•----&gt;å¯¹è±¡</li></ul><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;jsp:useBean id&#x3D;&quot;people&quot; class&#x3D;&quot;cn.loulan.Bean.People&quot; &#x2F;&gt;&lt;jsp:setProperty name&#x3D;&quot;people&quot; property&#x3D;&quot;address&quot; value&#x3D;&quot;æˆéƒ½&quot;&#x2F;&gt;&lt;jsp:setProperty name&#x3D;&quot;people&quot; property&#x3D;&quot;id&quot; value&#x3D;&quot;1&quot;&#x2F;&gt;&lt;jsp:setProperty name&#x3D;&quot;people&quot; property&#x3D;&quot;age&quot; value&#x3D;&quot;2&quot;&#x2F;&gt;&lt;jsp:setProperty name&#x3D;&quot;people&quot; property&#x3D;&quot;name&quot; value&#x3D;&quot;å“‡å“ˆå“ˆADé’™&quot;&#x2F;&gt;å§“å:&lt;jsp:getProperty name&#x3D;&quot;people&quot; property&#x3D;&quot;name&quot;&#x2F;&gt; ID:&lt;jsp:getProperty name&#x3D;&quot;people&quot; property&#x3D;&quot;id&quot;&#x2F;&gt;å¹´é¾„:&lt;jsp:getProperty name&#x3D;&quot;people&quot; property&#x3D;&quot;age&quot;&#x2F;&gt;åœ°å€:&lt;jsp:getProperty name&#x3D;&quot;people&quot; property&#x3D;&quot;address&quot;&#x2F;&gt;</code></pre><h2 id="MVCä¸‰å±‚æ¶æ„">MVCä¸‰å±‚æ¶æ„</h2><ul><li>ä»€ä¹ˆæ˜¯MVCï¼š Model view Controller æ¨¡å‹.è§†å›¾.æ§åˆ¶å™¨</li></ul><h3 id="1-æ—©äº›å¹´">1.æ—©äº›å¹´</h3><p><img src="watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ2MTUzOTQ5,size_16,color_FFFFFF,t_70-20230512210458691.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p><ul><li>ç”¨æˆ·ç›´æ¥è®¿é—®æ§åˆ¶å±‚ï¼Œæ§åˆ¶å±‚å°±å¯ä»¥ç›´æ¥æ“ä½œæ•°æ®åº“ï¼›</li></ul><pre class="language-java" data-language="java"><code class="language-java">servlet<span class="token operator">--</span><span class="token constant">CRUD</span><span class="token operator">--</span><span class="token operator">></span>æ•°æ®åº“å¼Šç«¯ï¼šç¨‹åºååˆ†è‡ƒè‚¿ï¼Œä¸åˆ©äºç»´æŠ¤  servletçš„ä»£ç ä¸­ï¼šå¤„ç†è¯·æ±‚<span class="token punctuation">.</span>å“åº”<span class="token punctuation">.</span>è§†å›¾è·³è½¬<span class="token punctuation">.</span>å¤„ç†<span class="token constant">JDBC</span><span class="token punctuation">.</span>å¤„ç†ä¸šåŠ¡ä»£ç <span class="token punctuation">.</span>å¤„ç†é€»è¾‘ä»£ç æ¶æ„ï¼šæ²¡æœ‰ä»€ä¹ˆæ˜¯åŠ ä¸€å±‚è§£å†³ä¸äº†çš„ï¼ç¨‹åºçŒ¿è°ƒç”¨<span class="token operator">|</span><span class="token constant">JDBC</span><span class="token operator">|</span><span class="token class-name">Mysql</span> <span class="token class-name">Oracle</span> <span class="token class-name">SqlServer</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><h3 id="2-MVCä¸‰å±‚æ¶æ„">2.MVCä¸‰å±‚æ¶æ„</h3><p><img src="watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ2MTUzOTQ5,size_16,color_FFFFFF,t_70-20230512210458822.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p><p>Model</p><ul><li>ä¸šåŠ¡å¤„ç† ï¼šä¸šåŠ¡é€»è¾‘ï¼ˆServiceï¼‰</li><li>æ•°æ®æŒä¹…å±‚ï¼šCRUD ï¼ˆDaoï¼‰</li></ul><p>View</p><ul><li>å±•ç¤ºæ•°æ®</li><li>æä¾›é“¾æ¥å‘èµ·Servletè¯·æ±‚ ï¼ˆaï¼Œformï¼Œimgâ€¦ï¼‰</li></ul><p>Controller ï¼ˆServletï¼‰</p><ul><li><p>æ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚ ï¼šï¼ˆreqï¼šè¯·æ±‚å‚æ•°.Sessionä¿¡æ¯â€¦.ï¼‰</p></li><li><p>äº¤ç»™ä¸šåŠ¡å±‚å¤„ç†å¯¹åº”çš„ä»£ç </p></li><li><p>æ§åˆ¶è§†å›¾çš„è·³è½¬</p><pre class="language-java" data-language="java"><code class="language-java">ç™»å½•<span class="token operator">--</span><span class="token operator">-></span>æ¥æ”¶ç”¨æˆ·çš„ç™»å½•è¯·æ±‚<span class="token operator">--</span><span class="token operator">-></span>å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ï¼ˆè·å–ç”¨æˆ·ç™»å½•çš„å‚æ•°ï¼Œusernameï¼Œpasswordï¼‰<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span>äº¤ç»™ä¸šåŠ¡å±‚å¤„ç†ç™»å½•ä¸šåŠ¡ï¼ˆåˆ¤æ–­ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®ï¼šäº‹åŠ¡ï¼‰<span class="token operator">--</span><span class="token operator">-></span><span class="token class-name">Dao</span>å±‚æŸ¥è¯¢ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®<span class="token operator">--</span><span class="token operator">></span>æ•°æ®åº“</code></pre></li></ul><h2 id="Filter-é‡ç‚¹">Filter(é‡ç‚¹)</h2><p>Filterï¼šè¿‡æ»¤å™¨ ï¼Œç”¨æ¥è¿‡æ»¤ç½‘ç«™çš„æ•°æ®ï¼›</p><ul><li>å¤„ç†ä¸­æ–‡ä¹±ç </li><li>ç™»å½•éªŒè¯â€¦.</li></ul><p>Filterå¼€å‘æ­¥éª¤ï¼š</p><ol><li>å¯¼åŒ…</li><li>ç¼–å†™è¿‡æ»¤å™¨</li></ol><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--   Servlet ä¾èµ–   --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>javax.servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>servlet-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        JSP ä¾èµ–   --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>javax.servlet.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>javax.servlet.jsp-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.3.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        JSTLè¡¨è¾¾å¼çš„ä¾èµ–--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>javax.servlet.jsp.jstl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jstl-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--        standardæ ‡ç­¾åº“--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>taglibs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>standard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--    è¿æ¥æ•°æ®åº“--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.1.47<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><ol start="3"><li>å®ç°Filteræ¥å£ï¼Œé‡å†™å¯¹åº”çš„æ–¹æ³•å³å¯ï¼›</li></ol><p>ä½¿ç”¨Filterè®¾ç½®ç¼–ç , é˜²æ­¢ä¹±ç </p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Filter</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>Filter</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//é¡¹ç›®å¯åŠ¨çš„æ—¶å€™è¢«è°ƒç”¨</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"init filter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        servletRequest<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        servletResponse<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span>servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>è¿™æ®µä»£ç æ˜¯Java Servletä¸­ç”¨äºå®ç°Filterçš„æ¥å£æ–¹æ³•<code>doFilter()</code>çš„ç­¾åã€‚</p><p>Filteræ˜¯ä¸€ç§ç”¨äºåœ¨Servletå®¹å™¨ä¸­å¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œé¢„å¤„ç†å’Œåå¤„ç†çš„ç»„ä»¶ã€‚Filterå¯ä»¥æˆªå–è¯·æ±‚å’Œå“åº”ï¼Œä¿®æ”¹è¯·æ±‚å‚æ•°æˆ–å“åº”å†…å®¹ï¼Œæˆ–è€…æ ¹æ®æŸäº›æ¡ä»¶å†³å®šæ˜¯å¦å…è®¸è¯·æ±‚ç»§ç»­å¤„ç†ã€‚</p><p><code>doFilter()</code>æ–¹æ³•æ¥å—ä¸‰ä¸ªå‚æ•°ï¼š</p><p><code>ServletRequest servletRequest</code>ã€<br><code>ServletResponse servletResponse</code><br><code>FilterChain filterChain</code></p><p><code>ServletRequest</code>è¡¨ç¤ºæ¥æ”¶åˆ°çš„HTTPè¯·æ±‚ï¼Œ<code>ServletResponse</code>è¡¨ç¤ºå°†è¦å‘é€çš„HTTPå“åº”ï¼Œ<code>FilterChain</code>è¡¨ç¤ºFilteré“¾ã€‚</p><p>åœ¨<code>doFilter()</code>æ–¹æ³•ä¸­ï¼ŒFilterå¯ä»¥å¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œä»»ä½•å¿…è¦çš„æ“ä½œã€‚</p><p>ä¾‹å¦‚ï¼Œå¯ä»¥æ£€æŸ¥è¯·æ±‚å‚æ•°ã€ä¿®æ”¹è¯·æ±‚å¤´ã€è®°å½•è¯·æ±‚æ—¥å¿—ç­‰ã€‚</p><p>ç„¶åï¼ŒFilterå¿…é¡»è°ƒç”¨<code>filterChain.doFilter()</code>æ–¹æ³•ï¼Œå°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªFilteræˆ–ç›®æ ‡Servletæ¥è¿›è¡Œå¤„ç†ã€‚</p><p>å¦‚æœä¸è°ƒç”¨<code>filterChain.doFilter()</code>æ–¹æ³•ï¼Œè¯·æ±‚å°†ä¸ä¼šä¼ é€’åˆ°ä¸‹ä¸€ä¸ªç»„ä»¶ï¼Œä¹Ÿä¸ä¼šç”Ÿæˆå“åº”ã€‚åœ¨æœ€åä¸€ä¸ªFilteræˆ–ç›®æ ‡Servletä¸­ï¼Œå¿…é¡»ç”Ÿæˆå“åº”å¹¶å°†å…¶å‘é€å›å®¢æˆ·ç«¯ã€‚</p><p>åœ¨Filteré“¾ä¸­çš„æ¯ä¸ªFilteréƒ½å¿…é¡»è°ƒç”¨<code>filterChain.doFilter()</code>æ–¹æ³•ï¼Œå¦åˆ™è¯·æ±‚å°†åœæ­¢åœ¨å½“å‰Filterï¼Œä¸ä¼šä¼ é€’åˆ°åç»­çš„Filteræˆ–ç›®æ ‡Servletã€‚</p><p>å¦‚æœåœ¨Filteré“¾ä¸­çš„æŸä¸ªFilterä¸­è°ƒç”¨äº†<code>filterChain.doFilter()</code>æ–¹æ³•ä¹‹å‰æˆ–ä¹‹åç”Ÿæˆäº†å“åº”ï¼Œæˆ–è€…æ²¡æœ‰è°ƒç”¨<code>filterChain.doFilter()</code>æ–¹æ³•ï¼Œéƒ½ä¼šå¯¼è‡´è¯·æ±‚å¤±è´¥æˆ–æ— æ³•æ­£å¸¸å“åº”ã€‚</p><ol start="4"><li>åœ¨web.xmlä¸­é…ç½® Filterï¼›</li></ol><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--mapping filter--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>encode<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">></span></span>cn.loulan.servlet.Filter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>encode<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>       <span class="token comment">&lt;!--åªè¦æ˜¯ /filterçš„ä»»ä½•è¯·æ±‚ï¼Œä¼šç»è¿‡è¿™ä¸ªè¿‡æ»¤å™¨--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/filter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">></span></span></code></pre><h2 id="ç›‘å¬å™¨-Listener">ç›‘å¬å™¨(Listener)</h2><p>å®ç°ä¸€ä¸ªç›‘å¬å™¨çš„æ¥å£ï¼›ï¼ˆæœ‰Nç§ï¼‰</p><ol><li><p>ç¼–å†™ä¸€ä¸ªç›‘å¬å™¨ï¼›</p><p>å®ç°ç›‘å¬å™¨çš„æ¥å£â€¦</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OnlineCountListener</span> <span class="token keyword">implements</span> <span class="token class-name">HttpSessionListener</span> <span class="token punctuation">&#123;</span><span class="token comment">//    æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªIntegerå¯¹è±¡æ¥è¡¨ç¤ºå½“å‰åœ¨çº¿ç”¨æˆ·æ•°ï¼Œ</span><span class="token comment">//    å¹¶ä¸”åœ¨æ¯æ¬¡Sessionåˆ›å»ºæ—¶ï¼Œéƒ½å°†åœ¨çº¿ç”¨æˆ·æ•°åŠ 1ã€‚</span><span class="token comment">//    ç„¶åï¼Œæˆ‘ä»¬å°†åœ¨çº¿ç”¨æˆ·æ•°å­˜å‚¨åœ¨ServletContextä¸­ï¼Œ</span><span class="token comment">//    ä»¥ä¾¿åœ¨æ•´ä¸ªWebåº”ç”¨ç¨‹åºä¸­å…±äº«å’Œä½¿ç”¨ã€‚</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sessionCreated</span><span class="token punctuation">(</span><span class="token class-name">HttpSessionEvent</span> httpSessionEvent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServletContext</span> servletContext <span class="token operator">=</span> httpSessionEvent<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Integer</span> onlineCounter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> servletContext<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"onlineCounter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>onlineCounter <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            onlineCounter <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            onlineCounter <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>onlineCounter<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        servletContext<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"onlineCounter"</span><span class="token punctuation">,</span> onlineCounter<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sessionDestroyed</span><span class="token punctuation">(</span><span class="token class-name">HttpSessionEvent</span> httpSessionEvent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Integer</span> onlineCounter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> httpSessionEvent<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"onlineCounter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>onlineCounter <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            onlineCounter <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            onlineCounter <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>onlineCounter<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        httpSessionEvent<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"onlineCounter"</span><span class="token punctuation">,</span> onlineCounter<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><ol start="2"><li><p>æ³¨å†Œç›‘å¬å™¨</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    Listener--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener-class</span><span class="token punctuation">></span></span>cn.loulan.servlet.OnlineCountListener<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener-class</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener</span><span class="token punctuation">></span></span></code></pre></li></ol></li></ol><h3 id="è¿‡æ»¤å™¨-ç›‘å¬å™¨å¸¸è§åº”ç”¨">è¿‡æ»¤å™¨.ç›‘å¬å™¨å¸¸è§åº”ç”¨</h3><ul><li><h4 id="ç›‘å¬å™¨ï¼šGUIç¼–ç¨‹ä¸­ç»å¸¸ä½¿ç”¨ï¼›"><strong>ç›‘å¬å™¨ï¼šGUIç¼–ç¨‹ä¸­ç»å¸¸ä½¿ç”¨ï¼›</strong></h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestPanel</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// æ–°å»ºä¸€ä¸ªçª—ä½“</span>        <span class="token class-name">Frame</span> frame <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Frame</span><span class="token punctuation">(</span><span class="token string">"Happy Day"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// é¢æ¿</span>        <span class="token class-name">Panel</span> panel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Panel</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¾ç½®çª—ä½“çš„å¸ƒå±€</span>        frame<span class="token punctuation">.</span><span class="token function">setLayout</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        frame<span class="token punctuation">.</span><span class="token function">setBounds</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¾ç½®èƒŒæ™¯é¢œè‰²1</span>        frame<span class="token punctuation">.</span><span class="token function">setBackground</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>lightGray<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¾ç½®èƒŒæ™¯é¢œè‰²2</span>        panel<span class="token punctuation">.</span><span class="token function">setBackground</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>orange<span class="token punctuation">)</span><span class="token punctuation">;</span>        panel<span class="token punctuation">.</span><span class="token function">setBounds</span><span class="token punctuation">(</span>frame<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> frame<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> frame<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> frame<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        frame<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panel<span class="token punctuation">)</span><span class="token punctuation">;</span>        frame<span class="token punctuation">.</span><span class="token function">setVisible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç›‘å¬äº‹ä»¶ï¼Œç›‘å¬å…³é—­äº‹ä»¶</span>        frame<span class="token punctuation">.</span><span class="token function">addWindowListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WindowAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">windowClosing</span><span class="token punctuation">(</span><span class="token class-name">WindowEvent</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    frame<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="è¿‡æ»¤å™¨ï¼šç”¨æˆ·ç™»å½•ä¹‹åæ‰èƒ½è¿›å…¥ä¸»é¡µï¼ç”¨æˆ·æ³¨é”€åå°±ä¸èƒ½è¿›å…¥ä¸»é¡µäº†">è¿‡æ»¤å™¨ï¼šç”¨æˆ·ç™»å½•ä¹‹åæ‰èƒ½è¿›å…¥ä¸»é¡µï¼ç”¨æˆ·æ³¨é”€åå°±ä¸èƒ½è¿›å…¥ä¸»é¡µäº†</h4><ol><li>ç”¨æˆ·ç™»å½•ä¹‹åï¼Œå‘Sesisonä¸­æ”¾å…¥ç”¨æˆ·çš„æ•°æ®</li><li>è¿›å…¥ä¸»é¡µçš„æ—¶å€™è¦åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»ç™»å½•ï¼›è¦æ±‚ï¼šåœ¨è¿‡æ»¤å™¨ä¸­å®ç°ï¼</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Log</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> username <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"root"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/pages/success.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span></code></pre><p>LoginFilter</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginFilter</span> <span class="token keyword">extends</span> <span class="token class-name">Filter</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span><span class="token comment">// ServletRequest è½¬åŒ–ä¸º HttpServletRequest </span><span class="token comment">// ç›®çš„æ˜¯æ‹¿åˆ°Session, ä»¥ä¾¿è·å–Attribute</span>        <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> servletRequest<span class="token punctuation">;</span>        <span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> servletResponse<span class="token punctuation">;</span>        <span class="token class-name">Object</span> o <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>LogoutServlet</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token punctuation">,</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Logout</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>     req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span></code></pre><p>é€šè¿‡è®¾ç½®Sessionçš„Attribute(Constants.USER_SESSION)å€¼ä¸ºç©ºæ¥å®ç°ç”¨æˆ·çš„ç™»å½•, è¿™ç§æ–¹å¼ä¸éœ€è¦æœåŠ¡å™¨é‡å¤åˆ›å»ºå’Œé”€æ¯Sessionå°±å¯ä»¥å®ç°ç”¨æˆ·çš„æ³¨é”€, å‡è½»äº†æœåŠ¡å™¨è´Ÿæ‹….</p><img src="Kapture 2023-05-13 at 11.38.21-3950252.gif" alt="Kapture 2023-05-13 at 11.38.21" style="zoom:80%;" loading="lazy"></li></ul><h2 id="JDBC">JDBC</h2><ul><li>ä»€ä¹ˆæ˜¯JDBC ï¼š Javaè¿æ¥æ•°æ®åº“ï¼</li><li>éœ€è¦jaråŒ…çš„æ”¯æŒï¼š<ul><li>java.sql</li><li>javax.sql</li><li>mysql-connecter-javaâ€¦ è¿æ¥é©±åŠ¨ï¼ˆå¿…é¡»è¦å¯¼å…¥ï¼‰</li></ul></li></ul><ol><li><s>åŠ è½½é©±åŠ¨</s></li><li>è¿æ¥æ•°æ®åº“,ä»£è¡¨æ•°æ®åº“</li><li>ç¼–å†™SQL ï¼ˆæ ¹æ®ä¸šåŠ¡ï¼Œä¸åŒçš„SQLï¼‰</li><li>é¢„ç¼–è¯‘</li><li>æ‰§è¡ŒSQL</li><li>å…³é—­è¿æ¥</li></ol><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// é…ç½®ä¿¡æ¯</span>    <span class="token comment">// useUnicode=true&amp;characterEncoding=utf-8 è§£å†³ä¸­æ–‡ä¹±ç </span>    <span class="token class-name">String</span> url<span class="token operator">=</span><span class="token string">"jdbc:mysql://localhost:3307/JDBC?useUnicode=true&amp;characterEncoding=utf-8"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token comment">// 2.è¿æ¥æ•°æ®åº“,ä»£è¡¨æ•°æ®åº“</span>    <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 3.ç¼–å†™SQL</span>    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from user"</span><span class="token punctuation">;</span><span class="token comment">//     4. é¢„ç¼–è¯‘</span>    <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 5.æ‰§è¡ŒæŸ¥è¯¢SQLï¼Œè¿”å›ä¸€ä¸ª ResultSet  ï¼š ç»“æœé›†</span>    <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"email"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"role"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 6.å…³é—­è¿æ¥ï¼Œé‡Šæ”¾èµ„æºï¼ˆä¸€å®šè¦åšï¼‰ å…ˆå¼€åå…³</span>    rs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    preparedStatement<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="é¢„ç¼–è¯‘-ä½¿ç”¨å ä½ç¬¦">é¢„ç¼–è¯‘: ä½¿ç”¨å ä½ç¬¦</h4><p>åœ¨ JDBC ä¸­ï¼Œé¢„ç¼–è¯‘ SQL çš„ä¸»è¦ç›®çš„æ˜¯<strong>æé«˜æ‰§è¡Œ SQL è¯­å¥çš„æ•ˆç‡</strong>ã€‚å½“ä¸€ä¸ª SQL è¯­å¥è¢«é¢„ç¼–è¯‘åï¼ŒJDBC é©±åŠ¨ç¨‹åºä¼šå°†è¯¥è¯­å¥å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¹¶å°†å…¶ä¸ä¸€ä¸ªé¢„å®šä¹‰çš„æ‰§è¡Œè®¡åˆ’å…³è”èµ·æ¥ã€‚è¿™æ ·ï¼Œåœ¨æ‰§è¡Œè¯¥ SQL è¯­å¥æ—¶ï¼ŒJDBC é©±åŠ¨ç¨‹åºå¯ä»¥ç›´æ¥ä½¿ç”¨é¢„å®šä¹‰çš„æ‰§è¡Œè®¡åˆ’ï¼Œè€Œ<strong>ä¸å¿…é‡æ–°è§£æ SQL è¯­å¥å’Œç”Ÿæˆæ‰§è¡Œè®¡åˆ’</strong>ï¼Œä»è€Œæé«˜äº†æ‰§è¡Œæ•ˆç‡ã€‚</p><p>å¦å¤–ï¼Œé¢„ç¼–è¯‘ SQL è¿˜å¯ä»¥æé«˜ä»£ç çš„<strong>å¯ç»´æŠ¤æ€§</strong>å’Œ<strong>å®‰å…¨æ€§</strong>ã€‚é€šè¿‡ä½¿ç”¨é¢„ç¼–è¯‘ SQLï¼Œæˆ‘ä»¬å¯ä»¥å°† SQL è¯­å¥ä¸ Java ä»£ç åˆ†ç¦»å¼€æ¥ï¼Œä½¿å¾—ä»£ç æ›´æ˜“äºç»´æŠ¤ã€‚æ­¤å¤–ï¼Œé¢„ç¼–è¯‘ SQL å¯ä»¥é¿å… <strong>SQL æ³¨å…¥</strong>ç­‰å®‰å…¨é—®é¢˜ã€‚</p><p>å…·ä½“åœ°ï¼Œé¢„ç¼–è¯‘ SQL çš„è¿‡ç¨‹åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ï¼šé¦–å…ˆï¼Œä½¿ç”¨ <code>Connection</code> æ¥å£ä¸­çš„ <code>prepareStatement()</code> æ–¹æ³•åˆ›å»ºä¸€ä¸ª <code>PreparedStatement</code> å¯¹è±¡ï¼›ç„¶åï¼Œä½¿ç”¨ <code>PreparedStatement</code> å¯¹è±¡çš„ <code>setXXX()</code> æ–¹æ³•è®¾ç½® SQL è¯­å¥ä¸­çš„å‚æ•°ï¼Œå¹¶ä½¿ç”¨ <code>execute()</code> æˆ– <code>executeUpdate()</code> æ–¹æ³•æ‰§è¡Œ SQL è¯­å¥ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨é¢„ç¼–è¯‘ SQL çš„ç¤ºä¾‹ä»£ç ï¼š</p><pre class="language-none"><code class="language-none">String sql &#x3D; &quot;SELECT * FROM users WHERE name &#x3D; ?&quot;;PreparedStatement pstmt &#x3D; conn.prepareStatement(sql);pstmt.setString(1, &quot;John&quot;);ResultSet rs &#x3D; pstmt.executeQuery();while (rs.next()) &#123;    &#x2F;&#x2F; process the result set&#125;</code></pre><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨ <code>prepareStatement()</code> æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª <code>PreparedStatement</code> å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ <code>setString()</code> æ–¹æ³•è®¾ç½®äº† SQL è¯­å¥ä¸­çš„å‚æ•°ï¼Œå¹¶æœ€ç»ˆä½¿ç”¨ <code>executeQuery()</code> æ–¹æ³•æ‰§è¡Œ SQL è¯­å¥ã€‚è¿™æ ·ï¼Œåœ¨æ‰§è¡Œ SQL è¯­å¥æ—¶ï¼ŒJDBC é©±åŠ¨ç¨‹åºä¼šä½¿ç”¨é¢„å®šä¹‰çš„æ‰§è¡Œè®¡åˆ’ï¼Œä»è€Œæé«˜äº†æ‰§è¡Œæ•ˆç‡ã€‚</p><h4 id="SQLæ³¨å…¥">SQLæ³¨å…¥</h4><p>SQL æ³¨å…¥ï¼ˆSQL Injectionï¼‰æ˜¯ä¸€ç§å¸¸è§çš„ç½‘ç»œå®‰å…¨æ¼æ´ï¼Œå®ƒå…è®¸æ”»å‡»è€…åœ¨æ‰§è¡Œ SQL æŸ¥è¯¢æ—¶å‘æŸ¥è¯¢ä¸­æ’å…¥æ¶æ„ä»£ç ï¼Œä»è€Œè·å¾—å¯¹æ•°æ®åº“çš„éæˆæƒè®¿é—®ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹å®šçš„ SQL æŸ¥è¯¢è¯­å¥ï¼Œä»è€Œç»•è¿‡èº«ä»½éªŒè¯ã€çªƒå–æ•°æ®æˆ–ç ´åæ•°æ®åº“ã€‚</p><p>ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸‹é¢çš„ SQL æŸ¥è¯¢è¯­å¥ï¼š</p><pre class="language-none"><code class="language-none">SELECT * FROM users WHERE username &#x3D; &#39;&lt;input&gt;&#39;;</code></pre><p>å¦‚æœç”¨æˆ·è¾“å…¥ <code>&lt;input&gt;</code> çš„å€¼ä¸º <code>' or '1'='1</code>ï¼Œé‚£ä¹ˆæœ€ç»ˆçš„ SQL æŸ¥è¯¢è¯­å¥å°±ä¼šå˜æˆï¼š</p><pre class="language-none"><code class="language-none">SELECT * FROM users WHERE username &#x3D; &#39;&#39; or &#39;1&#39;&#x3D;&#39;1&#39;;</code></pre><p>è¿™æ ·å°±ä¼šè¿”å›æ‰€æœ‰ç”¨æˆ·çš„è®°å½•ï¼Œè€Œä¸ä»…ä»…æ˜¯æŒ‡å®šçš„ç”¨æˆ·åã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼è·å–åˆ°æ•°æ®åº“ä¸­çš„æ•æ„Ÿæ•°æ®æˆ–è€…æ‰§è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚</p><h2 id="å®æˆ˜-è¶…å¸‚è®¢å•ç®¡ç†ç³»ç»Ÿ">å®æˆ˜: è¶…å¸‚è®¢å•ç®¡ç†ç³»ç»Ÿ</h2><p>ä¸ºäº†æ–¹ä¾¿è¡¨è¿°å’Œç†è§£, åœ¨ç¼–å†™MVCä¸‰å±‚å¯¹åº”çš„ä»£ç æ—¶, ä½¿ç”¨è‡ªé¡¶å‘ä¸‹, ä½†åœ¨å®é™…çš„é¡¹ç›®ä¸­, ç¼–å†™ä»£ç å·¥ä½œå¾€å¾€æ˜¯è‡ªåº•å‘ä¸Šçš„.</p><h3 id="æ­å»ºé¡¹ç›®æ¡†æ¶">æ­å»ºé¡¹ç›®æ¡†æ¶</h3><h4 id="ç¼–å†™æ•°æ®åº“æ“ä½œçš„åŸºç¡€å…¬å…±ç±»DB">ç¼–å†™æ•°æ®åº“æ“ä½œçš„åŸºç¡€å…¬å…±ç±»DB</h4><ul><li><p>æ•°æ®åº“é…ç½®æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªèµ„æºæ–‡ä»¶ï¼Œåº”è¯¥åˆ›å»ºåœ¨mavené¡¹ç›®çš„resourcesæ–‡ä»¶ä¸­</p><pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">DRIVER</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span><span class="token key attr-name">URL</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3307/smbms?useUnicode=true&amp;characterEncoding=utf-8</span><span class="token key attr-name">USERNAME</span><span class="token punctuation">=</span><span class="token value attr-value">root</span><span class="token key attr-name">PASSWORD</span><span class="token punctuation">=</span></code></pre></li><li><p>ä½¿ç”¨é™æ€ä»£ç å—å®ç°åˆå§‹åŒ–å‚æ•°</p><p>è¯¥ç±»ä¸ºæ•°æ®åº“è®¿é—®å·¥å…·ç±»ï¼Œæä¾›äº†è·å–æ•°æ®åº“è¿æ¥ã€æ‰§è¡ŒæŸ¥è¯¢å’Œæ›´æ–°ç­‰å¸¸ç”¨æ“ä½œçš„æ–¹æ³•ã€‚</p><ol><li><p>ç±»åï¼šDB</p></li><li><p>å±æ€§ï¼š</p></li></ol><ul><li>DRIVERï¼šStringç±»å‹ï¼Œè¡¨ç¤ºæ•°æ®åº“é©±åŠ¨åã€‚</li><li>URLï¼šStringç±»å‹ï¼Œè¡¨ç¤ºæ•°æ®åº“è¿æ¥åœ°å€ã€‚</li><li>USERNAMEï¼šStringç±»å‹ï¼Œè¡¨ç¤ºè¿æ¥æ•°æ®åº“çš„ç”¨æˆ·åã€‚</li><li>PASSWORDï¼šStringç±»å‹ï¼Œè¡¨ç¤ºè¿æ¥æ•°æ®åº“çš„å¯†ç ã€‚</li></ul><ol start="3"><li>æ–¹æ³•ï¼š</li></ol><ul><li>closeï¼šç”¨äºé‡Šæ”¾æ•°æ®åº“è¿æ¥ã€é¢„å¤„ç†è¯­å¥å’Œç»“æœé›†èµ„æºã€‚</li><li>getConnectionï¼šç”¨äºè·å–æ•°æ®åº“è¿æ¥ã€‚</li><li>executeQueryï¼šç”¨äºæ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œè¿”å›ä¸€ä¸ªç»“æœé›†ã€‚</li><li>executeUpdateï¼šç”¨äºæ‰§è¡Œæ›´æ–°æ“ä½œï¼Œè¿”å›å—å½±å“çš„è¡Œæ•°ã€‚</li></ul><ol start="4"><li>æ–¹æ³•çš„å‚æ•°ï¼š</li></ol><ul><li>connï¼šConnectionç±»å‹ï¼Œè¡¨ç¤ºæ•°æ®åº“è¿æ¥ã€‚</li><li>pstmtï¼šPreparedStatementç±»å‹ï¼Œè¡¨ç¤ºé¢„å¤„ç†è¯­å¥ã€‚</li><li>resSetï¼šResultSetç±»å‹ï¼Œè¡¨ç¤ºç»“æœé›†ã€‚</li><li>queryï¼šStringç±»å‹ï¼Œè¡¨ç¤ºè¦æ‰§è¡Œçš„SQLè¯­å¥ã€‚</li><li>paramsï¼šObject[]ç±»å‹ï¼Œè¡¨ç¤ºSQLè¯­å¥ä¸­çš„å‚æ•°å€¼ã€‚</li></ul><p>åœ¨ç±»ä¸­è¿˜å®šä¹‰äº†ä¸€ä¸ªé™æ€ä»£ç å—ï¼Œè¯¥ä»£ç å—åœ¨ç±»åŠ è½½æ—¶ä¼šè¢«æ‰§è¡Œã€‚é™æ€ä»£ç å—ä¸­çš„ä¸»è¦ä½œç”¨æ˜¯è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®åº“è¿æ¥å‚æ•°ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ç±»çš„é™æ€å±æ€§ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><ul><li>åˆ›å»ºPropertieså¯¹è±¡ã€‚</li><li>é€šè¿‡ç±»åŠ è½½å™¨åŠ è½½é…ç½®æ–‡ä»¶ä¸ºå­—èŠ‚è¾“å…¥æµã€‚</li><li>ä½¿ç”¨Propertieså¯¹è±¡çš„load()æ–¹æ³•åŠ è½½å­—èŠ‚è¾“å…¥æµä¸­çš„å†…å®¹ã€‚</li><li>ä»Propertieså¯¹è±¡ä¸­è·å–æ•°æ®åº“è¿æ¥å‚æ•°ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ç±»çš„é™æ€å±æ€§ã€‚</li></ul><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥åœ¨ä¸ä¿®æ”¹Javaä»£ç çš„æƒ…å†µä¸‹ï¼Œæ›´æ”¹æ•°æ®åº“è¿æ¥å‚æ•°ï¼Œæé«˜äº†ä»£ç çš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DB</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">DRIVER</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">URL</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">USERNAME</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">PASSWORD</span><span class="token punctuation">;</span>    <span class="token comment">//é™æ€ä»£ç å—ï¼Œ ç±»åŠ è½½çš„æ—¶å€™æ‰§è¡Œ</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//è¯»å–é…ç½®æ–‡ä»¶</span>        <span class="token comment">//1ã€åˆ›å»ºpropertieså¯¹è±¡</span>        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2ã€é€šè¿‡ç±»åŠ è½½å™¨åŠ è½½èµ„æºæ–‡ä»¶ä¸ºå­—èŠ‚è¾“å…¥æµ</span>        <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"db.properties"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token constant">DRIVER</span> <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"DRIVER"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">URL</span> <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"URL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">USERNAME</span> <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"USERNAME"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token constant">PASSWORD</span> <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"PASSWORD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre></li><li><p>ç¼–å†™æ•°æ®åº“æ“ä½œçš„å…¬å…±æ–¹æ³•</p><p>è¯¥ç±»ä¸ºæ•°æ®åº“è®¿é—®å·¥å…·ç±»ï¼Œæä¾›äº†è·å–æ•°æ®åº“è¿æ¥ã€æ‰§è¡ŒæŸ¥è¯¢å’Œæ›´æ–°ç­‰å¸¸ç”¨æ“ä½œçš„æ–¹æ³•ã€‚</p><ol><li><p>ç±»åï¼šDB</p></li><li><p>å±æ€§ï¼š</p></li></ol><ul><li>DRIVERï¼šStringç±»å‹ï¼Œè¡¨ç¤ºæ•°æ®åº“é©±åŠ¨åã€‚</li><li>URLï¼šStringç±»å‹ï¼Œè¡¨ç¤ºæ•°æ®åº“è¿æ¥åœ°å€ã€‚</li><li>USERNAMEï¼šStringç±»å‹ï¼Œè¡¨ç¤ºè¿æ¥æ•°æ®åº“çš„ç”¨æˆ·åã€‚</li><li>PASSWORDï¼šStringç±»å‹ï¼Œè¡¨ç¤ºè¿æ¥æ•°æ®åº“çš„å¯†ç ã€‚</li></ul><ol start="3"><li>æ–¹æ³•ï¼š</li></ol><ul><li>closeï¼šç”¨äºé‡Šæ”¾æ•°æ®åº“è¿æ¥ã€é¢„å¤„ç†è¯­å¥å’Œç»“æœé›†èµ„æºã€‚</li><li>getConnectionï¼šç”¨äºè·å–æ•°æ®åº“è¿æ¥ã€‚</li><li>executeQueryï¼šç”¨äºæ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œè¿”å›ä¸€ä¸ªç»“æœé›†ã€‚</li><li>executeUpdateï¼šç”¨äºæ‰§è¡Œæ›´æ–°æ“ä½œï¼Œè¿”å›å—å½±å“çš„è¡Œæ•°ã€‚</li></ul><ol start="4"><li>æ–¹æ³•çš„å‚æ•°ï¼š</li></ol><ul><li>connï¼šConnectionç±»å‹ï¼Œè¡¨ç¤ºæ•°æ®åº“è¿æ¥ã€‚</li><li>pstmtï¼šPreparedStatementç±»å‹ï¼Œè¡¨ç¤ºé¢„å¤„ç†è¯­å¥ã€‚</li><li>resSetï¼šResultSetç±»å‹ï¼Œè¡¨ç¤ºç»“æœé›†ã€‚</li><li>queryï¼šStringç±»å‹ï¼Œè¡¨ç¤ºè¦æ‰§è¡Œçš„SQLè¯­å¥ã€‚</li><li>paramsï¼šObject[]ç±»å‹ï¼Œè¡¨ç¤ºSQLè¯­å¥ä¸­çš„å‚æ•°å€¼ã€‚</li></ul><p>è¯¥ç±»è¿˜åŒ…å«ä¸€ä¸ªé™æ€ä»£ç å—ï¼Œç”¨äºåˆå§‹åŒ–æ•°æ®åº“è¿æ¥å‚æ•°ï¼Œä½†ä»£ç å—çš„å†…å®¹æœªç»™å‡ºï¼Œéœ€è¦è¿›è¡Œè¡¥å……ã€‚</p><p><em>åŒæ—¶éœ€è¦æ³¨æ„ï¼Œè¯¥ç±»å¹¶æ²¡æœ‰å®ç°å•ä¾‹æ¨¡å¼ï¼Œæ¯æ¬¡è·å–æ•°æ®åº“è¿æ¥éƒ½ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚</em></p></li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DB</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">DRIVER</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">URL</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">USERNAME</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">PASSWORD</span><span class="token punctuation">;</span>     <span class="token comment">//æ’å…¥é™æ€ä»£ç å—(need to fininsh)</span>      <span class="token comment">//é‡Šæ”¾é“¾æ¥èµ„æº</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">PreparedStatement</span> pstmt<span class="token punctuation">,</span> <span class="token class-name">ResultSet</span> resSet<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>resSet <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            resSet<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>pstmt <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            pstmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//è·å–æ•°æ®åº“é“¾æ¥</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token constant">DRIVER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token constant">USERNAME</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token constant">PASSWORD</span><span class="token punctuation">;</span>        <span class="token comment">// 2.è¿æ¥æ•°æ®åº“,ä»£è¡¨æ•°æ®åº“</span>        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span>  connection<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æ‰§è¡ŒæŸ¥è¯¢, è¿”å›ç»“æœé›†</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ResultSet</span> <span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span><span class="token class-name">String</span> query<span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">&#123;</span>        <span class="token class-name">ResultSet</span> resultSet <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>query<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> params <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//é¢„å¤„ç†</span>            <span class="token class-name">PreparedStatement</span> statement <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> params<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//è®¾ç½®SQL è¯­å¥ä¸­çš„å‚æ•°</span>                statement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">//æ‰§è¡Œ</span>            resultSet <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> resultSet<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æ‰§è¡Œæ›´æ–°ï¼Œ è¿”å›å½±å“è¡Œæ•°</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span><span class="token class-name">String</span> query<span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> affectedRows <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>query<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> params <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//é¢„å¤„ç†</span>            <span class="token class-name">PreparedStatement</span> statement <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> params<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//è®¾ç½®SQL è¯­å¥ä¸­çš„å‚æ•°</span>                statement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">//æ‰§è¡Œ</span>             affectedRows <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> affectedRows<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="ç™»å½•åŠŸèƒ½å®ç°">ç™»å½•åŠŸèƒ½å®ç°</h3><h4 id="å‰ç«¯é¡µé¢ç¼–å†™">å‰ç«¯é¡µé¢ç¼–å†™</h4><p>å‰ç«¯é¡µé¢ç”±kuangæä¾›</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;%-- header--%&gt;&lt;form class&#x3D;&quot;loginForm&quot; action&#x3D;&quot;$&#123;pageContext.request.contextPath&#125;&#x2F;login.do&quot; name&#x3D;&quot;actionForm&quot; id&#x3D;&quot;actionForm&quot; method&#x3D;&quot;post&quot;&gt;  &lt;div class&#x3D;&quot;info&quot;&gt;$&#123;error&#125;&lt;&#x2F;div&gt;  &lt;div class&#x3D;&quot;inputbox&quot;&gt;      &lt;label&gt;ç”¨æˆ·åï¼š&lt;&#x2F;label&gt;      &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;input-text&quot; id&#x3D;&quot;userCode&quot; name&#x3D;&quot;userCode&quot; placeholder&#x3D;&quot;è¯·è¾“å…¥ç”¨æˆ·å&quot; required&#x2F;&gt;  &lt;&#x2F;div&gt;  &lt;div class&#x3D;&quot;inputbox&quot;&gt;      &lt;label&gt;å¯†ç ï¼š&lt;&#x2F;label&gt;      &lt;input type&#x3D;&quot;password&quot; id&#x3D;&quot;userPassword&quot; name&#x3D;&quot;userPassword&quot; placeholder&#x3D;&quot;è¯·è¾“å…¥å¯†ç &quot; required&#x2F;&gt;  &lt;&#x2F;div&gt;  &lt;div class&#x3D;&quot;subBtn&quot;&gt;      &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;ç™»å½•&quot;&#x2F;&gt;      &lt;input type&#x3D;&quot;reset&quot; value&#x3D;&quot;é‡ç½®&quot;&#x2F;&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;form&gt;&lt;%-- footer--%&gt;</code></pre><h4 id="ç™»å½•å¤„ç†Servletå®ç°">ç™»å½•å¤„ç†Servletå®ç°</h4><p>åœ¨å‰ç«¯formè¡¨å•çš„actionå±æ€§å€¼æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æäº¤çš„URL, æ‰€ä»¥, æˆ‘ä»¬éœ€è¦ç¼–å†™å¯¹åº”çš„Servletæ¥å¤„ç†è¿™ä¸ªè¯·æ±‚</p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">action&#x3D;&quot;$&#123;pageContext.request.contextPath&#125;&#x2F;login.do&quot;</code></pre><ul><li><p>åˆ›å»ºç™»å½•å¤„ç†Servlet</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªåä¸ºâ€œLoginâ€çš„Java servletç±»ï¼Œç”¨äºå¤„ç†HTTP GETè¯·æ±‚ã€‚è¯¥ç±»åŒ…æ‹¬å¯¹â€œUserServiceâ€å®ä¾‹çš„å¼•ç”¨ï¼Œè¯¥å®ä¾‹ç”¨äºä»æ•°æ®åº“ä¸­æ£€ç´¢ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>åœ¨â€œdoGetâ€æ–¹æ³•ä¸­ï¼Œservletä»HTTPè¯·æ±‚ä¸­æ£€ç´¢userCodeå’Œpasswordå‚æ•°ã€‚ç„¶åå®ƒåˆ›å»ºä¸€ä¸ªâ€œUserServiceImplâ€ç±»çš„æ–°å®ä¾‹ï¼ˆè¯¥ç±»å®ç°äº†â€œUserServiceâ€æ¥å£ï¼‰ï¼Œå¹¶è°ƒç”¨å…¶â€œfindByUserCodeâ€æ–¹æ³•ï¼Œä»¥æ ¹æ®ç»™å®šçš„ç”¨æˆ·ä»£ç ä»æ•°æ®åº“ä¸­æ£€ç´¢ç”¨æˆ·å¯¹è±¡ã€‚</p><p>å¦‚æœç”¨æˆ·å¯¹è±¡ä¸ä¸ºnullï¼Œåˆ™servletæ£€æŸ¥ç”¨æˆ·å¯†ç æ˜¯å¦ä¸ç»™å®šå¯†ç åŒ¹é…ã€‚å¦‚æœåŒ¹é…ï¼Œåˆ™servletä½¿ç”¨ç”¨æˆ·å¯¹è±¡è®¾ç½®åä¸ºâ€œUSER_SESSIONâ€çš„ä¼šè¯å±æ€§ï¼Œå¹¶å°†ç”¨æˆ·é‡å®šå‘åˆ°â€œ/jsp/frame.jspâ€ã€‚å¦‚æœå¯†ç ä¸åŒ¹é…ï¼Œåˆ™servletä½¿ç”¨é”™è¯¯æ¶ˆæ¯è®¾ç½®åä¸ºâ€œerrorâ€çš„ä¼šè¯å±æ€§ï¼Œå¹¶å°†ç”¨æˆ·é‡å®šå‘å›â€œ/login.jspâ€ã€‚</p><p><em>è¯·æ³¨æ„ï¼Œæ­¤ä»£ç ç‰‡æ®µä¸å®Œæ•´ï¼Œå› ä¸ºå®ƒç¼ºå°‘æœ‰å…³å¯¼å…¥ï¼Œå®ƒæ‰€ä¾èµ–çš„æ¥å£å’Œç±»ï¼Œä»¥åŠservleté…ç½®çš„ä¿¡æ¯ã€‚</em></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Login</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">UserService</span> service<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> userCode <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"userCode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"userPassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        user <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">findByUserCode</span><span class="token punctuation">(</span>userCode<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">,</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>                resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/jsp/frame.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span><span class="token string">"username or password incorrect"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/login.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span></code></pre></li><li><p>æ˜ å°„ servlet</p><p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ª servlet é…ç½®çš„ XML éƒ¨åˆ†ï¼Œå®ƒç”¨äºå°†è¯·æ±‚çš„ URL æ˜ å°„åˆ°ç‰¹å®šçš„ servlet ä¸Šã€‚è¿™æ®µé…ç½®æŒ‡å®šäº†ä¸€ä¸ªåä¸º â€œLoginâ€ çš„ servletï¼Œä½¿ç”¨äº†å®Œæ•´çš„ç±»å <code>servlet.Login</code>ï¼Œå¹¶å°†å®ƒæ˜ å°„åˆ° URL â€œ/login.doâ€ ä¸Šã€‚</p><p>è¿™æ„å‘³ç€ï¼Œå½“ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è®¿é—® â€œ/login.doâ€ æ—¶ï¼Œå®¹å™¨å°†è°ƒç”¨ <code>servlet.Login</code> çš„ service() æ–¹æ³•æ¥å¤„ç†è¯¥è¯·æ±‚ã€‚æ˜ å°„ servlet çš„æ“ä½œæ˜¯ web åº”ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒåœ¨ web.xml æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ã€‚</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>servlet.Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/login.do<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre></li><li><p>ç¼–å†™Serviceå±‚ä»£ç </p><p>è¯¥ä»£ç æ˜¯ä¸€ä¸ª Java ç±» <code>UserServiceImpl</code>ï¼Œå®ç°äº†ä¸€ä¸ªæ¥å£ <code>UserService</code>ã€‚è¯¥ç±»åŒ…å«äº†ä¸¤ä¸ªæ–¹æ³•ï¼š</p><ol><li><code>findByUserCode(String userCode)</code>ï¼šæŸ¥æ‰¾æ•°æ®åº“ä¸­å¯¹åº”ç”¨æˆ·çš„ä¿¡æ¯ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª <code>User</code> å¯¹è±¡ã€‚</li><li><code>updateUser(Integer id, String key, String value)</code>ï¼šæ›´æ–°æ•°æ®åº“ä¸­ç”¨æˆ·çš„ä¿¡æ¯ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª <code>boolean</code> ç±»å‹çš„å€¼ï¼Œè¡¨ç¤ºæ›´æ–°æ˜¯å¦æˆåŠŸã€‚</li></ol><p>åœ¨è¿™ä¸ªç±»ä¸­ï¼Œç§æœ‰æˆå‘˜å˜é‡ <code>dao</code> æ˜¯ä¸€ä¸ª <code>UserDao</code> ç±»å‹çš„å˜é‡ï¼Œé€šè¿‡è¯¥å˜é‡è°ƒç”¨ <code>UserDaoImpl</code> ç±»ä¸­çš„æ–¹æ³•æ¥è®¿é—®æ•°æ®åº“ã€‚åœ¨ <code>findByUserCode</code> å’Œ <code>updateUser</code> æ–¹æ³•ä¸­ï¼Œéƒ½éœ€è¦å…ˆé€šè¿‡ <code>dao</code> å®ä¾‹åŒ–ä¸€ä¸ª <code>UserDaoImpl</code> å¯¹è±¡æ¥è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> dao<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findByUserCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> userCode<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        dao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">findByUserCode</span><span class="token punctuation">(</span>userCode<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span>  user<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> value<span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>        dao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        i <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">updateUser</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> i <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre></li><li><p>DAOå±‚ä»£ç </p><p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªDaoå±‚çš„å®ç°ç±»ï¼Œç”¨äºå’Œæ•°æ®åº“äº¤äº’ï¼Œæä¾›äº†å¯¹Userè¡¨çš„æŸ¥è¯¢å’Œæ›´æ–°æ–¹æ³•ã€‚ä¸‹é¢æ˜¯ä»£ç çš„åˆ†æï¼š</p><ul><li><code>findByUserCode(String userCode)</code> æ–¹æ³•ï¼šæ ¹æ®ä¼ å…¥çš„ç”¨æˆ·åå‚æ•° <code>userCode</code> æŸ¥è¯¢å¯¹åº”çš„ç”¨æˆ·è®°å½•ï¼Œå¹¶è¿”å›ä¸€ä¸ªUserå¯¹è±¡ã€‚è¯¥æ–¹æ³•ä½¿ç”¨äº†æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯ï¼Œåœ¨æ‰§è¡Œå®ŒæŸ¥è¯¢åä¼šå…³é—­è¿æ¥ã€‚æ–¹æ³•ä¸­é¦–å…ˆåˆå§‹åŒ–å‚æ•°ï¼Œç„¶åæ‰§è¡ŒSQLè¯­å¥æŸ¥è¯¢ç»“æœé›†ï¼Œéå†ç»“æœé›†å°†æ•°æ®å°è£…åˆ°Userå¯¹è±¡ä¸­ï¼Œæœ€åå…³é—­è¿æ¥å’Œç»“æœé›†ï¼Œè¿”å›Userå¯¹è±¡ã€‚</li><li><code>updateUser(Integer id, String key,String value)</code> æ–¹æ³•ï¼šæ ¹æ®ä¼ å…¥çš„å‚æ•°æ›´æ–°Userè¡¨ä¸­çš„æ•°æ®ã€‚è¯¥æ–¹æ³•ä¹Ÿä½¿ç”¨äº†æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯ï¼Œåœ¨æ‰§è¡Œå®Œæ›´æ–°åä¼šå…³é—­è¿æ¥ã€‚æ–¹æ³•ä¸­é¦–å…ˆåˆ¤æ–­ä¼ å…¥çš„å‚æ•°æ˜¯å¦ä¸ºç©ºï¼Œç„¶åæ‰§è¡ŒSQLè¯­å¥æ›´æ–°æ•°æ®ï¼Œæœ€åå…³é—­è¿æ¥ï¼Œè¿”å›æ›´æ–°ç»“æœçš„å½±å“è¡Œæ•°ã€‚</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDao</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Connection</span> conn<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> sql<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findByUserCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> userCode<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//2. åˆå§‹åŒ–å‚æ•°</span>        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>userCode<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token class-name">ResultSet</span> set<span class="token punctuation">;</span>        sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM smbms_user Where userCode = ?"</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            conn <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            set <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">,</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>set <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    user<span class="token punctuation">.</span><span class="token function">setUserPassword</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"userPassword"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//ä¸€å¤§ä¸²èµ‹å€¼ä»£ç ...</span>                    user<span class="token punctuation">.</span><span class="token function">setWorkPicPath</span><span class="token punctuation">(</span><span class="token string">"workPicPath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">//å…³é—­é“¾æ¥å’Œç»“æœé›†</span>            <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> user<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> affectedRow <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token operator">&amp;&amp;</span> value <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            sql <span class="token operator">=</span> <span class="token string">"UPDATE smbms_user SET "</span><span class="token operator">+</span>key<span class="token operator">+</span><span class="token string">" = ? WHERE id = ? "</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>value<span class="token punctuation">,</span>id<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                conn <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                affectedRow <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token constant">DB</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> affectedRow<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre></li></ul><h3 id="å¯†ç ä¿®æ”¹å®ç°">å¯†ç ä¿®æ”¹å®ç°</h3><h4 id="å‰ç«¯é¡µé¢">å‰ç«¯é¡µé¢</h4><p><strong>JSPéƒ¨åˆ†: é¡µé¢æ˜¾ç¤º</strong></p><pre class="language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ page contentType&#x3D;&quot;text&#x2F;html;charset&#x3D;UTF-8&quot; language&#x3D;&quot;java&quot; %&gt;&lt;%@include file&#x3D;&quot;&#x2F;jsp&#x2F;common&#x2F;head.jsp&quot; %&gt;&lt;div class&#x3D;&quot;right&quot;&gt;    &lt;div class&#x3D;&quot;location&quot;&gt;        &lt;strong&gt;ä½ ç°åœ¨æ‰€åœ¨çš„ä½ç½®æ˜¯:&lt;&#x2F;strong&gt;        &lt;span&gt;å¯†ç ä¿®æ”¹é¡µé¢&lt;&#x2F;span&gt;    &lt;&#x2F;div&gt;    &lt;div class&#x3D;&quot;providerAdd&quot;&gt;        &lt;form id&#x3D;&quot;userForm&quot; name&#x3D;&quot;userForm&quot; method&#x3D;&quot;post&quot; action&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;jsp&#x2F;user.do&quot;&gt;            &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;method&quot; value&#x3D;&quot;savepwd&quot;&#x2F;&gt;            &lt;!--divçš„class ä¸ºerroræ˜¯éªŒè¯é”™è¯¯ï¼Œokæ˜¯éªŒè¯æˆåŠŸ--&gt;            &lt;div class&#x3D;&quot;info&quot;&gt;$&#123;message&#125;&lt;&#x2F;div&gt;            &lt;div class&#x3D;&quot;&quot;&gt;                &lt;label for&#x3D;&quot;oldPassword&quot;&gt;æ—§å¯†ç ï¼š&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;oldpassword&quot; id&#x3D;&quot;oldpassword&quot; value&#x3D;&quot;&quot;&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;                &lt;label for&#x3D;&quot;newPassword&quot;&gt;æ–°å¯†ç ï¼š&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;newpassword&quot; id&#x3D;&quot;newpassword&quot; value&#x3D;&quot;&quot;&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div&gt;                &lt;label for&#x3D;&quot;newPassword&quot;&gt;ç¡®è®¤æ–°å¯†ç ï¼š&lt;&#x2F;label&gt;                &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;rnewpassword&quot; id&#x3D;&quot;rnewpassword&quot; value&#x3D;&quot;&quot;&gt;                &lt;font color&#x3D;&quot;red&quot;&gt;&lt;&#x2F;font&gt;            &lt;&#x2F;div&gt;            &lt;div class&#x3D;&quot;providerAddBtn&quot;&gt;                &lt;!--&lt;a href&#x3D;&quot;#&quot;&gt;ä¿å­˜&lt;&#x2F;a&gt;--&gt;                &lt;input type&#x3D;&quot;button&quot; name&#x3D;&quot;save&quot; id&#x3D;&quot;save&quot; value&#x3D;&quot;ä¿å­˜&quot; class&#x3D;&quot;input-button&quot;&gt;            &lt;&#x2F;div&gt;        &lt;&#x2F;form&gt;    &lt;&#x2F;div&gt;&lt;&#x2F;div&gt;&lt;&#x2F;section&gt;&lt;%@include file&#x3D;&quot;&#x2F;jsp&#x2F;common&#x2F;foot.jsp&quot; %&gt;&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;$&#123;pageContext.request.contextPath &#125;&#x2F;statics&#x2F;js&#x2F;pwdmodify.js&quot;&gt;&lt;&#x2F;script&gt;</code></pre><p>è¿™æ˜¯ä¸€ä¸ªç”¨ JSPï¼ˆJavaServer Pagesï¼‰ç¼–å†™çš„ç½‘é¡µä»£ç ï¼Œç”¨äºä¿®æ”¹å¯†ç ã€‚é¡µé¢åŒ…æ‹¬ä¸€ä¸ªè¡¨å•ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­è¾“å…¥æ—§å¯†ç ã€æ–°å¯†ç å’Œç¡®è®¤æ–°å¯†ç ã€‚è¡¨å•ä½¿ç”¨POSTæ–¹æ³•æäº¤åˆ°æœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨â€œ/jsp/user.doâ€ URLã€‚</p><p>é¡µé¢åŒ…æ‹¬ä¸€ä¸ªæ¶ˆæ¯åŒºåŸŸï¼Œç”¨äºæ˜¾ç¤ºä»»ä½•é”™è¯¯æ¶ˆæ¯ã€‚é¡µé¢è¿˜åŒ…æ‹¬æŒ‡å‘åä¸ºâ€œpwdmodify.jsâ€çš„ JavaScript æ–‡ä»¶çš„é“¾æ¥ã€‚è¿™ä¸ªæ–‡ä»¶åº”è¯¥åŒ…å«è¡¨å•çš„å®¢æˆ·ç«¯éªŒè¯é€»è¾‘ã€‚</p><p>é¡µé¢ä½¿ç”¨ JSP è¡¨è¾¾å¼è¯­è¨€ï¼ˆELï¼‰å°†åŠ¨æ€å†…å®¹æ’å…¥åˆ° HTML ä¸­ã€‚ä¾‹å¦‚ï¼Œé¡µé¢ä½¿ç”¨è¡¨è¾¾å¼ â€œ${pageContext.request.contextPath}/statics/js/pwdmodify.jsâ€ æ’å…¥ä¸€ä¸ªé“¾æ¥åˆ° CSS æ–‡ä»¶ã€‚â€œ${pageContext.request.contextPath}â€ è¡¨è¾¾å¼è®¡ç®—ä¸º web åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡è·¯å¾„ï¼Œç”¨äºæ„é€  CSS æ–‡ä»¶çš„å®Œæ•´ URLã€‚</p><p><strong>JavaScript è¡¨å•çš„å®¢æˆ·ç«¯éªŒè¯é€»è¾‘</strong></p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> oldpassword <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> newpassword <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> rnewpassword <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">var</span> saveBtn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   oldpassword <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#oldpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   newpassword <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#newpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   rnewpassword <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#rnewpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   saveBtn <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#save"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   oldpassword<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>         <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span>         <span class="token literal-property property">url</span><span class="token operator">:</span>path<span class="token operator">+</span><span class="token string">"/jsp/user.do"</span><span class="token punctuation">,</span>         <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">"pwdmodify"</span><span class="token punctuation">,</span><span class="token literal-property property">oldpassword</span><span class="token operator">:</span>oldpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>         <span class="token literal-property property">dataType</span><span class="token operator">:</span><span class="token string">"json"</span><span class="token punctuation">,</span>         <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//æ—§å¯†ç æ­£ç¡®</span>               <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//æ—§å¯†ç è¾“å…¥ä¸æ­£ç¡®</span>               <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" åŸå¯†ç è¾“å…¥ä¸æ­£ç¡®"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">"sessionerror"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//å½“å‰ç”¨æˆ·sessionè¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•</span>               <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" å½“å‰ç”¨æˆ·sessionè¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result <span class="token operator">==</span> <span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//æ—§å¯†ç è¾“å…¥ä¸ºç©º</span>               <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" è¯·è¾“å…¥æ—§å¯†ç "</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>         <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>         <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//è¯·æ±‚å‡ºé”™</span>            <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" è¯·æ±‚é”™è¯¯"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>oldpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* è¯·è¾“å…¥åŸå¯†ç "</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   newpassword<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* å¯†ç é•¿åº¦å¿…é¡»æ˜¯å¤§äº6å°äº20"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">5</span>         <span class="token operator">&amp;&amp;</span> newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>newpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" å¯†ç è¾“å…¥ä¸ç¬¦åˆè§„èŒƒï¼Œè¯·é‡æ–°è¾“å…¥"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   rnewpassword<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">validateTip</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"#666666"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"* è¯·è¾“å…¥ä¸ä¸Šé¢ä¸€è‡´çš„å¯†ç "</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">5</span>         <span class="token operator">&amp;&amp;</span> rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token operator">&amp;&amp;</span> newpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> rnewpassword<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgYes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>         <span class="token function">validateTip</span><span class="token punctuation">(</span>rnewpassword<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string-property property">"color"</span><span class="token operator">:</span><span class="token string">"red"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>imgNo <span class="token operator">+</span> <span class="token string">" ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´ï¼Œè¯·é‡æ–°è¾“å…¥"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   saveBtn<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      oldpassword<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      newpassword<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      rnewpassword<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>         oldpassword<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span> <span class="token operator">&amp;&amp;</span>          newpassword<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span>         <span class="token operator">&amp;&amp;</span> rnewpassword<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"validateStatus"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">"ç¡®å®šè¦ä¿®æ”¹å¯†ç ï¼Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#userForm"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è¿™æ˜¯ä¸€ä¸ª JavaScript ä»£ç æ®µï¼Œå®ƒä½¿ç”¨ jQuery åº“ä¸ºä¸€ä¸ªåŒ…å«å¯†ç ä¿®æ”¹è¡¨å•çš„ç½‘é¡µæ·»åŠ äº†å®¢æˆ·ç«¯éªŒè¯é€»è¾‘ã€‚ä»£ç ä½¿ç”¨ AJAX æŠ€æœ¯ä»æœåŠ¡å™¨è·å– JSON æ ¼å¼çš„å“åº”æ•°æ®ï¼Œä»¥éªŒè¯ç”¨æˆ·è¾“å…¥çš„æ—§å¯†ç æ˜¯å¦æ­£ç¡®ï¼Œå¹¶åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºç›¸å…³æç¤ºä¿¡æ¯ã€‚</p><p>ä»£ç ä¸­é¦–å…ˆå®šä¹‰äº†å››ä¸ªå˜é‡ï¼Œåˆ†åˆ«æ˜¯æ—§å¯†ç ã€æ–°å¯†ç ã€ç¡®è®¤æ–°å¯†ç å’Œæäº¤æŒ‰é’®çš„ jQuery å¯¹è±¡ã€‚ç„¶åä½¿ç”¨ $() å‡½æ•°å°†ä»£ç åŒ…è£…åœ¨ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­ï¼Œç¡®ä¿ä»£ç åœ¨æ–‡æ¡£åŠ è½½å®Œæˆåæ‰æ‰§è¡Œã€‚å›è°ƒå‡½æ•°å†…éƒ¨åšäº†ä»¥ä¸‹å·¥ä½œï¼š</p><ol><li><p>é€šè¿‡é€‰æ‹©å™¨è·å–é¡µé¢ä¸Šçš„æ—§å¯†ç è¾“å…¥æ¡†ã€æ–°å¯†ç è¾“å…¥æ¡†ã€ç¡®è®¤æ–°å¯†ç è¾“å…¥æ¡†å’Œæäº¤æŒ‰é’®ï¼Œå¹¶å°†å®ƒä»¬çš„ jQuery å¯¹è±¡èµ‹å€¼ç»™å‰é¢å®šä¹‰çš„å››ä¸ªå˜é‡ã€‚</p></li><li><p>ä¸ºæ—§å¯†ç è¾“å…¥æ¡†ç»‘å®š blur äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå½“è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶ï¼Œä½¿ç”¨ $.ajax() å‡½æ•°å‘æœåŠ¡å™¨å‘é€ GET è¯·æ±‚ï¼ŒéªŒè¯ç”¨æˆ·è¾“å…¥çš„æ—§å¯†ç æ˜¯å¦æ­£ç¡®ï¼Œå¹¶æ ¹æ®æœåŠ¡å™¨è¿”å›çš„å“åº”æ•°æ®æ˜¾ç¤ºç›¸åº”çš„æç¤ºä¿¡æ¯ã€‚åœ¨æˆåŠŸå›è°ƒå‡½æ•°ä¸­ï¼Œæ ¹æ® data.result çš„å€¼åˆ¤æ–­æ—§å¯†ç æ˜¯å¦æ­£ç¡®ï¼Œå¹¶é€šè¿‡ validateTip() å‡½æ•°æ˜¾ç¤ºç›¸åº”çš„æç¤ºä¿¡æ¯ã€‚åœ¨å¤±è´¥å›è°ƒå‡½æ•°ä¸­ï¼Œæ˜¾ç¤ºè¯·æ±‚å‡ºé”™çš„æç¤ºä¿¡æ¯ã€‚</p></li><li><p>ä¸ºæ—§å¯†ç è¾“å…¥æ¡†ç»‘å®š focus äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå½“è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹æ—¶ï¼Œæ˜¾ç¤ºè¾“å…¥æç¤ºä¿¡æ¯ã€‚</p></li><li><p>ä¸ºæ–°å¯†ç è¾“å…¥æ¡†ç»‘å®š focus å’Œ blur äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå½“è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹æ—¶ï¼Œæ˜¾ç¤ºè¾“å…¥æç¤ºä¿¡æ¯ï¼›å½“è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶ï¼Œåˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„æ–°å¯†ç æ˜¯å¦ç¬¦åˆè§„èŒƒï¼Œå¦‚æœç¬¦åˆåˆ™æ˜¾ç¤ºæ­£ç¡®æç¤ºï¼Œå¦åˆ™æ˜¾ç¤ºé”™è¯¯æç¤ºã€‚</p></li><li><p>ä¸ºç¡®è®¤æ–°å¯†ç è¾“å…¥æ¡†ç»‘å®š focus å’Œ blur äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå½“è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹æ—¶ï¼Œæ˜¾ç¤ºè¾“å…¥æç¤ºä¿¡æ¯ï¼›å½“è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶ï¼Œåˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„ç¡®è®¤æ–°å¯†ç æ˜¯å¦ä¸æ–°å¯†ç ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™æ˜¾ç¤ºæ­£ç¡®æç¤ºï¼Œå¦åˆ™æ˜¾ç¤ºé”™è¯¯æç¤ºã€‚</p></li><li><p>ä¸ºæäº¤æŒ‰é’®ç»‘å®š click äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå½“æŒ‰é’®è¢«ç‚¹å‡»æ—¶ï¼Œå…ˆè®©æ—§å¯†ç ã€æ–°å¯†ç å’Œç¡®è®¤æ–°å¯†ç è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹ï¼Œç„¶ååˆ¤æ–­å®ƒä»¬çš„éªŒè¯çŠ¶æ€æ˜¯å¦éƒ½ä¸º trueï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ˜¾ç¤ºç¡®è®¤ä¿®æ”¹å¯†ç çš„æç¤ºæ¡†ï¼Œå¦‚æœç”¨æˆ·ç‚¹å‡»ç¡®å®šï¼Œåˆ™æäº¤è¡¨å•ï¼Œå°†æ–°å¯†ç ä¿å­˜åˆ°æœåŠ¡å™¨ä¸Šã€‚</p></li></ol><h4 id="ç¼–å†™å¤„ç†Servlet">ç¼–å†™å¤„ç†Servlet</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDo</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">UserService</span> service<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"savepwd"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">savePwd</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"pwdmodify"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">pwdModify</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">savePwd</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//æ‹¿åˆ°USer Session , ç”¨äºå¾—åˆ°ç”¨æˆ·id</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> newPwd <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"newpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·è¾“å…¥çš„ï¼šnew password: "</span><span class="token operator">+</span>newPwd<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Session password: "</span><span class="token operator">+</span>user<span class="token punctuation">.</span><span class="token function">getUserPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">", id: "</span><span class="token operator">+</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Integer</span> id <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">boolean</span> flag<span class="token punctuation">;</span>        <span class="token comment">//method å€¼ä¸º  savepwd, è¡¨ç¤ºç”¨æˆ·æ‰§è¡Œä¿®æ”¹å¯†ç æ“ä½œ</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>newPwd <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            flag <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">updateUser</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">"userPassword"</span><span class="token punctuation">,</span> newPwd<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//ä¿®æ”¹æˆåŠŸ</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¿®æ”¹æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span><span class="token string">"å¯†ç ä¿®æ”¹æˆåŠŸï¼Œ è¯·é‡æ–°ç™»å½•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//  ç§»é™¤Session</span>                session<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¯†ç ä¿®æ”¹å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span><span class="token string">"å¯†ç ä¿®æ”¹å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span><span class="token string">"æ–°å¯†ç æ ¼å¼é”™è¯¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//è½¬å‘åˆ°å½“å‰é¡µé¢, ä¸ç”¨é‡å®šå‘è€Œä½¿ç”¨è½¬å‘æ˜¯ä¸ºäº†ä¼ ç»Ÿå‚æ•°ï¼ˆattribute) é€šçŸ¥å‰ç«¯å¯†ç ä¿®æ”¹ç»“æœï¼ˆby attribute messageï¼‰</span>        req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"/jsp/pwdmodify.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/*    ç”±ajaxå‘èµ·çš„å¯†ç æŸ¥è¯¢è¯·æ±‚ï¼Œ ç”¨æˆ·è¿›è¡Œå¯†ç ä¿®æ”¹æ—¶è§¦å‘    æ”¾å›å‰ç«¯jsonï¼Œ ajaxç”¨äºæ¯”å¯¹æ—§å¯†ç æ­£ç¡®æ€§,     */</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">pwdModify</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> user <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUserPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> inputPwd <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"oldpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>inputPwd <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> inputPwd<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//æ—§å¯†ç æ­£ç¡®</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>inputPwd<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span><span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">//æ—§å¯†ç ä¸æ­£ç¡®</span>                    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span><span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token comment">//å¯†ç è¾“å…¥ä¸ºç©º</span>                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//session timeout</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span><span class="token string">"sessionerror"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//è¿”å›å‰ç«¯jsonæ•°æ®</span>        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">JSONArray</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªJava Webåº”ç”¨ç¨‹åºä¸­çš„Servletï¼Œç”¨äºå¤„ç†ç”¨æˆ·å¯†ç ä¿®æ”¹æ“ä½œã€‚</p><p>åœ¨doGet()æ–¹æ³•ä¸­ï¼Œæ ¹æ®è¯·æ±‚å‚æ•°&quot;method&quot;çš„å€¼è¿›è¡Œä¸åŒçš„æ“ä½œã€‚å¦‚æœ&quot;method&quot;çš„å€¼æ˜¯&quot;savepwd&quot;ï¼Œåˆ™è°ƒç”¨savePwd()æ–¹æ³•ï¼Œä¿å­˜æ–°å¯†ç ï¼›å¦‚æœ&quot;method&quot;çš„å€¼æ˜¯&quot;pwdmodify&quot;ï¼Œåˆ™è°ƒç”¨pwdModify()æ–¹æ³•ï¼Œç”¨äºæ£€æŸ¥æ—§å¯†ç æ˜¯å¦æ­£ç¡®ã€‚</p><p>åœ¨savePwd()æ–¹æ³•ä¸­ï¼Œé¦–å…ˆä»Sessionä¸­è·å–å½“å‰ç”¨æˆ·çš„ä¿¡æ¯ï¼Œç„¶åè·å–æ–°å¯†ç ï¼Œå¹¶ä½¿ç”¨UserServiceæ¥å£çš„å®ç°ç±»UserServiceImplæ¥æ›´æ–°ç”¨æˆ·å¯†ç ã€‚å¦‚æœæ›´æ–°æˆåŠŸï¼Œå°†ä¿¡æ¯å­˜å‚¨åœ¨è¯·æ±‚å±æ€§ä¸­ï¼Œå¹¶ç§»é™¤Sessionä¸­çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæœ€åå°†è¯·æ±‚è½¬å‘åˆ°å¯†ç ä¿®æ”¹é¡µé¢ã€‚</p><p>åœ¨pwdModify()æ–¹æ³•ä¸­ï¼Œé¦–å…ˆè·å–å½“å‰ç”¨æˆ·çš„ä¿¡æ¯ï¼Œç„¶åè·å–æ—§å¯†ç ã€‚å¦‚æœæ—§å¯†ç ä¸ä¸ºç©ºï¼Œåˆ™å°†è¾“å…¥çš„æ—§å¯†ç ä¸Sessionä¸­å­˜å‚¨çš„æ—§å¯†ç è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœè¾“å…¥çš„æ—§å¯†ç ä¸Sessionä¸­çš„æ—§å¯†ç ç›¸åŒï¼Œåˆ™è¿”å›å‰ç«¯JSONæ•°æ®ï¼Œè¡¨ç¤ºæ—§å¯†ç æ­£ç¡®ï¼›å¦åˆ™è¿”å›JSONæ•°æ®ï¼Œè¡¨ç¤ºæ—§å¯†ç ä¸æ­£ç¡®ã€‚</p><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿”å›JSONæ•°æ®ä¹‹å‰ï¼Œéœ€è¦è®¾ç½®å“åº”çš„Content-Typeä¸º&quot;application/json&quot;ã€‚</strong></p><h5 id="æ˜ å°„Servlet">æ˜ å°„Servlet</h5><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>userDo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>servlet.UserDo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>userDo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/jsp/user.do<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span></code></pre>]]></content>
    
    
    <summary type="html">ç‹‚ç¥è¯´JavaWebå¿«é€Ÿå…¥é—¨ç¬”è®°</summary>
    
    
    
    <category term="Java web" scheme="https://trevoewu.github.io/categories/Java-web/"/>
    
    
    <category term="JavaWeb" scheme="https://trevoewu.github.io/tags/JavaWeb/"/>
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://trevoewu.github.io/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Wireshark Lab: Ethernet and ARP</title>
    <link href="https://trevoewu.github.io/2023/05/08/Wireshark-Lab-Ethernet-and-ARP/"/>
    <id>https://trevoewu.github.io/2023/05/08/Wireshark-Lab-Ethernet-and-ARP/</id>
    <published>2023-05-08T11:02:02.000Z</published>
    <updated>2023-05-08T13:26:30.036Z</updated>
    
    <content type="html"><![CDATA[<p><strong>å®˜æ–¹è‹±æ–‡æ–‡æ¡£ï¼š<a href="Wireshark_Intro_v6.01.pdf">Wireshark_Intro_v6.01.pdf</a></strong></p><p><strong>ä»¥ä¸‹å†…å®¹ä¸ºç¬”è€…ç¿»è¯‘ï¼š</strong></p><hr><h2 id="Wireshark-å®éªŒ-Ethernet-and-ARP-v7-0">Wireshark å®éªŒ:  Ethernet and ARP v7.0</h2><p><strong>ã€Šè®¡ç®—æœºç½‘ç»œï¼šè‡ªé¡¶å‘ä¸‹æ–¹æ³•ï¼ˆç¬¬6ç‰ˆï¼‰ã€‹è¡¥å……ææ–™ï¼ŒJ.F. Kurose and K.W. Ross</strong></p><p>â€œä¸é—»ä¸è‹¥é—»ä¹‹ï¼Œé—»ä¹‹ä¸è‹¥è§ä¹‹ï¼Œè§ä¹‹ä¸è‹¥çŸ¥ä¹‹ï¼ŒçŸ¥ä¹‹ä¸è‹¥è¡Œä¹‹ã€‚â€ â€”â€”ä¸­å›½è°šè¯­</p><p>Â© 2005-2012, J.F Kurose and K.W. Ross, All Rights Reserved</p><hr><p>åœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶ä»¥å¤ªç½‘åè®®å’Œ ARP åè®®ã€‚åœ¨å¼€å§‹å®éªŒä¹‹å‰ï¼Œ æ‚¨å¯ä»¥æŸ¥çœ‹è¯¾æœ¬çš„ 6.4.1 èŠ‚ï¼ˆé“¾è·¯å±‚åœ°å€å’Œ ARPï¼‰å’Œ 6.4.2ï¼ˆä»¥å¤ªç½‘ï¼‰, æ‚¨ä¹Ÿå¯ä»¥å»çœ‹ RFC 826(<a href="ftp://ftp.rfc-editor.org/in-notes/std/std37.txt">ftp://ftp.rfc-editor.org/in-notes/std/std37.txt</a>)äº†è§£å…³äº ARP çš„åè®®è¯¦ç»†ä¿¡æ¯,è¯¥åè®®å¯ä»¥æ ¹æ® IP åœ°å€è·å–è¿œç¨‹ä¸»æœºçš„çš„ç‰©ç†åœ°å€ã€‚</p><h2 id="æ•è·å’Œåˆ†æä»¥å¤ªç½‘å¸§">æ•è·å’Œåˆ†æä»¥å¤ªç½‘å¸§</h2><p>è®©æˆ‘ä»¬ä»æ•è·ä¸€ç»„ä»¥å¤ªç½‘å¸§å¼€å§‹ç ”ç©¶ã€‚ è¯·æ‰§è¡Œä¸‹åˆ—æ“ä½œ :</p><ul><li><p>é¦–å…ˆï¼Œæ¸…é™¤æµè§ˆå™¨ç¼“å­˜ã€‚ åœ¨Firefox ä¸‹æ‰§è¡Œæ­¤æ“ä½œï¼Œè¯·é€‰æ‹© å†å²è®°å½•ï¼Œç„¶åé€‰ä¸­æ¸…é™¤å†å²è®°å½•ã€‚</p></li><li><p>ç„¶åå¯åŠ¨ Wireshark æ•°æ®åŒ…å—…æ¢å™¨</p></li><li><p>æ‰“å¼€ä»¥ä¸‹ URL <a href="http://gaia.cs.umass.edu/wireshark-labs/HTTP-ethereal-lab-file3.html">http://gaia.cs.umass.edu/wireshark-labs/HTTP-ethereal-lab-file3.html</a> æ‚¨çš„æµè§ˆå™¨åº”æ˜¾ç¤ºç›¸å½“å†—é•¿çš„ç¾å›½æƒåˆ©æ³•æ¡ˆã€‚</p></li><li><p>æ¥ä¸‹æ¥åœæ­¢ Wireshark æ•°æ®åŒ…æ•è·ï¼Œæ‰¾åˆ°æ‚¨å‘ <a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> çš„ HTTP GET æ¶ˆ æ¯çš„æ•°æ®åŒ…ç¼–å·ä»¥åŠ <a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> ç›¸åº”æ‚¨çš„ HTTP å›åº”ã€‚æ‚¨çš„æŠ“åŒ…ç»“æœåº” çœ‹èµ·æ¥å‘ä¸‹é¢ä¸€æ ·:</p></li></ul><p><img src="image-20230508193529270.png" alt="image-20230508193529270" loading="lazy"></p><ul><li><p>ç”±äºæœ¬å®éªŒæ˜¯å…³äºä»¥å¤ªç½‘å’Œ ARP çš„ï¼Œæˆ‘ä»¬å¯¹ IP æˆ–æ›´é«˜å±‚åè®®ä¸æ„Ÿå…´è¶£ã€‚ å› æ­¤ï¼Œè®©æˆ‘ä»¬æ›´æ”¹ Wireshark çš„â€œæ•è·æ•°æ®åŒ…åˆ—è¡¨â€çª—å£ï¼Œä»¥ä¾¿å®ƒä»…æ˜¾ç¤ºæœ‰å…³ IP ä»¥ä¸‹åè®®çš„ä¿¡æ¯ã€‚ è¦è®© Wireshark æ‰§è¡Œæ­¤æ“ä½œï¼Œè¯·é€‰æ‹© Analyze-&gt; Enabled Protocols(åˆ†æ-å¯ç”¨çš„åè®®)ã€‚ ç„¶åå–æ¶ˆé€‰ä¸­ IP æ¡†(è¯‘è€…æ³¨:è¿™é‡ŒæŒ‡çš„ IPV4 åè®®ï¼Œä¸‹é¢æœ‰æœç´¢)å¹¶é€‰æ‹©ç¡®å®šã€‚ æ‚¨ç°åœ¨ Wireshark çª—å£åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:</p><p><img src="image-20230508190619603.png" alt="image-20230508190619603" loading="lazy"></p></li><li><p>ä¸ºäº†å›ç­”ä»¥ä¸‹é—®é¢˜ï¼Œæ‚¨éœ€è¦æŸ¥çœ‹æ•°æ®åŒ…è¯¦ç»†ä¿¡æ¯å’Œæ•°æ®åŒ…å†…å®¹çª—å£(Wireshark ä¸­ çš„ä¸­é—´å’Œä¸‹éƒ¨æ˜¾ç¤ºçª—å£ï¼Œè¯‘è€…æ³¨: è‹¥æ‚¨çœ‹åˆ°çš„ä¸æ˜¯å¦‚æ­¤-å»ºè®®æ‚¨é‡ç½®å¸ƒå±€(è§†å›¾-é‡ ç½®å¸ƒå±€))ã€‚</p></li><li><p>é€‰æ‹©åŒ…å« HTTP GET æ¶ˆæ¯çš„ä»¥å¤ªç½‘å¸§ã€‚ (å›æƒ³ä¸€ä¸‹ï¼ŒHTTP GET è¯·æ±‚æ˜¯è¢«åŠ ä¸Š TCP å¤´å°è£…åˆ° TCP æ®µè¿›è¡Œä¼ è¾“,TCP æ®µåŠ ä¸Š IP å¤´è¢«å°è£…åˆ° IP æ•°æ®æŠ¥è¿›è¡Œä¼ è¾“,IP æ•° æ®æŠ¥åˆè¢«åŠ ä¸Šä»¥å¤ªç½‘å¤´å°è£…æˆä»¥å¤ªç½‘å¸§è¿›è¡Œä¼ è¾“;å¦‚æœä½ å‘ç°è¿™ä¸ªå°è£…æœ‰ç‚¹ä»¤äººå›° æƒ‘ï¼Œè¯·é‡è¯»æ–‡æœ¬ä¸­çš„ç¬¬ 1.5.2 èŠ‚)ã€‚ åœ¨æ•°æ®åŒ…è¯¦ç»†ä¿¡æ¯çª—å£ä¸­å±•å¼€ä»¥å¤ªç½‘ II ä¿¡æ¯ã€‚ è¯·æ³¨æ„ï¼Œä»¥å¤ªç½‘å¸§çš„å†…å®¹(æ ‡é¢˜ä»¥åŠæœ‰æ•ˆè´Ÿè½½)æ˜¾ç¤ºåœ¨æ•°æ®åŒ…å†…å®¹çª—å£ä¸­</p></li><li><p>æ ¹æ®åŒ…å« HTTP GET æ¶ˆæ¯çš„ä»¥å¤ªç½‘å¸§è¿›è¡Œåˆ†æï¼Œå¦‚æœæœ‰å¯èƒ½å»ºè®®æ‚¨ä½¿ç”¨æ ‡è®°çš„æ–¹å¼å±•ç°æ‚¨çš„ç­”æ¡ˆã€‚</p></li></ul><ol><li>ä½ çš„ç”µè„‘ 48 ä½çš„åœ°å€æ˜¯å¤šå°‘</li></ol><p><img src="image-20230508195458584.png" alt="image-20230508195458584" loading="lazy"></p><ol><li>ä»¥å¤ªç½‘å¸§ä¸­çš„ 48 ä½ç›®æ ‡åœ°å€æ˜¯ä»€ä¹ˆ?è¿™æ˜¯ <a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> çš„ä»¥å¤ªç½‘åœ°å€ å—?(æç¤º:ç­”æ¡ˆæ˜¯å¦å®šçš„)ã€‚é‚£ä¹ˆå®ƒæ˜¯ä»€ä¹ˆ?æ³¨æ„è¿™ä¸€é¢˜å¯èƒ½ä¼šçŠ¯é”™ï¼Œè¯· é˜…è¯» 468-469(ä¸­æ–‡ç‰ˆ 305-308 é¡µ)ç„¶åç†è§£å®ƒ</li></ol><p>ä¸‹ä¸€è·³è·¯ç”±å™¨çš„å¯¹åº”æ¥å£çš„MACåœ°å€.</p><p><img src="image-20230508194109036.png" alt="image-20230508194109036" loading="lazy"></p><ol><li>ä»¥å¤ªç½‘å¸§ä¸Šå±‚åè®® 16 è¿›åˆ¶å€¼æ˜¯ä»€ä¹ˆ?è¿™å¯¹åº”çš„ä¸Šå±‚åè®®æ˜¯ä»€ä¹ˆ?</li></ol><p><img src="image-20230508194227724.png" alt="image-20230508194227724" loading="lazy"></p><ol><li><p>ä»ä»¥å¤ªå¸§çš„å¼€å§‹ï¼Œä¸€ç›´åˆ°â€œGETâ€ä¸­çš„ ASCIIâ€œGâ€å‡ºç°åœ¨ä»¥å¤ªç½‘å¸§ä¸­ç‚ºæ­¢ï¼Œæœ‰å¤š</p><p>å°‘å­—èŠ‚?</p><p>G çš„asciiç ä¸º0x47, å¯¹åº”åœ°å€ä¸º0x0042, æ•…åœ¨è¿™ä¹‹å‰å…±æœ‰0x43å­—èŠ‚, å³67Byte</p><p><img src="image-20230508194758609.png" alt="image-20230508194758609" loading="lazy"></p></li></ol><p>æ¥ä¸‹æ¥ï¼Œæ ¹æ®åŒ…å« HTTP å“åº”æ¶ˆæ¯çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„ä»¥å¤ªç½‘å¸§çš„å†…å®¹ï¼Œå›ç­”ä»¥ä¸‹é—®é¢˜</p><ol start="5"><li><p>è¿™ä¸ªä»¥å¤ªç½‘å¸§ä¸­ï¼Œä»¥å¤ªç½‘æºåœ°å€çš„å€¼æ˜¯å¤šå°‘?è¿™æ˜¯ä½ çš„è®¡ç®—æœºçš„åœ°å€ï¼Œ<a href="http://xn--gaia-zi0i364s.cs.umass.edu">è¿˜æ˜¯gaia.cs.umass.edu</a> çš„åœ°å€(æç¤º:ç­”æ¡ˆæ˜¯å¦å®šçš„)ã€‚æ‹¥æœ‰è¿™ä¸ªä»¥å¤ªç½‘åœ°å€çš„è®¾å¤‡æ˜¯ä»€ä¹ˆ?</p><p>ANS: æ˜¯æœ€åä¸€è·³è·¯ç”±å™¨ç½‘å¡çš„MACåœ°å€</p><p><img src="image-20230508195637736.png" alt="image-20230508195637736" loading="lazy"></p></li><li><p>ä»¥å¤ªç½‘å¸§ä¸­çš„ç›®çš„åœ°å€æ˜¯ä»€ä¹ˆ?è¿™æ˜¯æ‚¨çš„è®¡ç®—æœºçš„ä»¥å¤ªç½‘åœ°å€å—?</p><p>ANS: æ˜¯çš„</p></li></ol><p><img src="image-20230508195734432.png" alt="image-20230508195734432" loading="lazy"></p><ol start="5"><li>ä»¥å¤ªç½‘å¸§ä¸Šå±‚åè®® 16 è¿›åˆ¶å€¼æ˜¯ä»€ä¹ˆ?è¿™å¯¹åº”çš„ä¸Šå±‚åè®®æ˜¯ä»€ä¹ˆ?</li></ol><p>ANS: 0x0800, IPv4</p><ol start="5"><li>ä»ä»¥å¤ªå¸§çš„å¼€å§‹ï¼Œä¸€ç›´åˆ°â€œOKâ€ä¸­çš„ ASCIIâ€œOâ€å‡ºç°åœ¨ä»¥å¤ªç½‘å¸§ä¸­ä¸ºæ­¢ï¼Œæœ‰å¤šå°‘å­—èŠ‚?</li></ol><p>ANS: 0x4f Byte, 79Byte</p><p><img src="image-20230508200014667.png" alt="image-20230508200014667" loading="lazy"></p><h2 id="The-Address-Resolution-Protocol-åœ°å€è§£æåè®®">The Address Resolution Protocol åœ°å€è§£æåè®®</h2><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è§‚å¯Ÿ ARP åè®®çš„ä½œç”¨ã€‚æˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨åœ¨ç»§ç»­å®éªŒä¹‹å‰é‡è¯»è¯¾æ–‡ 6.4.1 èŠ‚</p><h3 id="ARP-Caching-ARP-ç¼“å­˜">ARP Caching(ARP ç¼“å­˜)</h3><p>å›æƒ³ä¸€ä¸‹ï¼ŒARP åè®®é€šå¸¸åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šç»´æŠ¤ IP åˆ°ä»¥å¤ªç½‘åœ°å€è½¬æ¢å¯¹çš„ç¼“å­˜.arp å‘½ä»¤(åœ¨ MSDOS å’Œ Linux / Unix ä¸­)ç”¨äºæŸ¥çœ‹å’Œæ“ä½œæ­¤ç¼“å­˜çš„å†…å®¹ã€‚ç”±äº arp å‘½ ä»¤å’Œ ARP åè®®å…·æœ‰ç›¸åŒçš„åç§°ï¼Œå› æ­¤å¾ˆå®¹æ˜“æ··æ·†å®ƒä»¬ã€‚ä½†è¯·è®°ä½ï¼Œå®ƒä»¬æ˜¯ä¸åŒçš„: arp å‘½ä»¤ç”¨äºæŸ¥çœ‹å’Œæ“ä½œ ARP ç¼“å­˜å†…å®¹ï¼Œè€Œ ARP åè®®å®šä¹‰äº†å‘é€å’Œæ¥æ”¶çš„æ¶ˆæ¯çš„ æ ¼å¼å’Œå«ä¹‰ï¼Œå¹¶å®šä¹‰äº†å¯¹æ¶ˆæ¯ä¼ è¾“å’Œæ¥æ”¶æ‰€é‡‡å–çš„æ“ä½œã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹æ‚¨è®¡ç®—æœºä¸Š ARP ç¼“å­˜çš„å†…å®¹:</p><ul><li><p>MS-DOS:arp å‘½ä»¤ä½äº c:\windows\system32 ä¸­ï¼Œå› æ­¤åœ¨ MS-DOS å‘½ä»¤è¡Œä¸­</p><p>è¾“å…¥â€œarpâ€æˆ–â€œc:\windows\system32\arpâ€(æ²¡æœ‰å¼•å·)</p></li><li><p>Linux/Unix/MacOS. æ ¹æ®å®‰è£…ä½ç½®ä¸åŒè·¯å¾„è€Œä¸åŒï¼Œä¸€èˆ¬æœ‰/sbin/arp (linux)</p><p>å’Œ/usr/etc/arp (Unix)</p></li></ul><p>æ²¡æœ‰å‚æ•°çš„ Windows arp å‘½ä»¤å°†æ˜¾ç¤ºè®¡ç®—æœºä¸Š ARP ç¼“å­˜çš„å†…å®¹ã€‚è¿è¡Œ ARP å‘½ ä»¤ã€‚</p><ol start="9"><li>å†™ä¸‹è®¡ç®—æœº ARP ç¼“å­˜çš„å†…å®¹ã€‚æ¯ä¸ªåˆ—å€¼çš„å«ä¹‰æ˜¯ä»€ä¹ˆ?</li></ol><pre class="language-bash" data-language="bash"><code class="language-bash">// mac/linux arp commend by tldr - Show the current ARP table:    arp <span class="token parameter variable">-a</span>- Delete a specific entry:    arp <span class="token parameter variable">-d</span> address- Create an entry <span class="token keyword">in</span> the ARP table:    arp <span class="token parameter variable">-s</span> address mac_address</code></pre><p>IPåœ°å€, MACåœ°å€</p><p><img src="image-20230508200844492.png" alt="image-20230508200844492" loading="lazy"></p><p>ä¸ºäº†è§‚å¯Ÿæ‚¨çš„è®¡ç®—æœºå‘é€å’Œæ¥æ”¶ ARP æ¶ˆæ¯ï¼Œæˆ‘ä»¬éœ€è¦æ¸…é™¤ ARP ç¼“å­˜ï¼Œå¦åˆ™æ‚¨çš„è®¡ç®—æœºå¾ˆå¯èƒ½åœ¨å…¶ç¼“å­˜ä¸­æ‰¾åˆ°æ‰€éœ€çš„ IP-Ethernet åœ°å€è½¬æ¢å…³ç³»ï¼Œå› æ­¤ä¸ä¼šå‘é€ ARP æ¶ˆæ¯ã€‚</p><ul><li>MS-DOS:MS-DOS arp -d <em>å‘½ä»¤å°†æ¸…é™¤ ARP ç¼“å­˜ã€‚-d æ ‡å¿—æŒ‡ç¤ºåˆ é™¤æ“ä½œï¼Œ</em> *  æ˜¯è¡¨ç¤ºåˆ é™¤æ‰€æœ‰è¡¨é¡¹çš„é€šé…ç¬¦ã€‚</li><li>Linux/Unix/MacOS: æ¸…é™¤ arp ç¼“å­˜çš„ arp â€“d *éœ€è¦ root æƒé™ï¼Œå¦‚æœæ‚¨æ²¡æœ‰ä¹Ÿæ²¡åŠæ³•ä½¿ç”¨ Windows ç³»ç»Ÿè¿›è¡Œå®éªŒï¼Œè¯·ä¸‹è½½ä½œè€…çš„æŠ“åŒ…ç»“æœã€‚</li></ul><p><em>æ‰€æœ‰åœ¨Linuxç³»ç»Ÿä¸‹ <strong>arp -d $ip</strong> å‘½ä»¤åªèƒ½æ¸…é™¤ä¸€ä¸ªIPåœ°å€çš„å¯¹åº”MACåœ°å€ç¼“å­˜ï¼Œå½“ç„¶å¯ä»¥ä½¿ç”¨ç»„åˆå‘½ä»¤æ“ä½œï¼Œè¿™ä¹Ÿç®—æ˜¯Linuxçš„ä¸€ä¸ªä¼˜ç‚¹å§ã€‚</em></p><h3 id="Observing-ARP-in-action-æŠ“å–-ARP-æ¶ˆæ¯">Observing ARP in action æŠ“å– ARP æ¶ˆæ¯</h3><p>è¯·è¿›è¡Œä»¥ä¸‹æ“ä½œ:</p><ul><li><p>æ¸…é™¤ä½ çš„ ARP ç¼“å­˜ï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> arp <span class="token parameter variable">-a</span> <span class="token parameter variable">-d</span> //clear arp cahce <span class="token keyword">in</span> mac os</code></pre><p><img src="image-20230508201938321.png" alt="image-20230508201938321" loading="lazy"></p></li><li><p>æ¥ä¸‹æ¥ï¼Œç¡®ä¿æµè§ˆå™¨çš„ç¼“å­˜æ˜¯ç©ºçš„ã€‚</p></li><li><p>å¯åŠ¨ Wireshark æ•æ‰å°åŒ…</p></li><li><p>æ‰“å¼€ä»¥ä¸‹ URLï¼Œ<a href="http://gaia.cs.umass.edu/wireshark-labs/HTTP-wireshark-lab-file3.html%E3%80%82%E4%BD%A0%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8%E5%BA%94%E8%AF%A5%E5%86%8D%E6%AC%A1%E6%98%BE%E7%A4%BA%E7%9B%B8%E5%BD%93%E9%95%BF%E7%9A%84%E7%BE%8E%E5%9B%BD%E6%9D%83%E5%88%A9%E6%B3%95%E6%A1%88">http://gaia.cs.umass.edu/wireshark-labs/HTTP-wireshark-lab-file3.htmlã€‚ä½ çš„æµè§ˆå™¨åº”è¯¥å†æ¬¡æ˜¾ç¤ºç›¸å½“é•¿çš„ç¾å›½æƒåˆ©æ³•æ¡ˆ</a></p></li><li><p>åŒæ ·è®¾ç½®ä¸æ˜¾ç¤º IP å’Œæ›´é«˜å±‚åè®®ï¼Œè¯·é€‰æ‹© Analyze-&gt; Enabled Protocols(åˆ†æ -å¯ç”¨çš„åè®®)ã€‚ ç„¶åå–æ¶ˆé€‰ä¸­ IP æ¡†(è¯‘è€…æ³¨:è¿™é‡ŒæŒ‡çš„ IPV4 åè®®ï¼Œä¸‹é¢æœ‰ æœç´¢)å¹¶é€‰æ‹©ç¡®å®šã€‚ æ‚¨ç°åœ¨ Wireshark çª—å£åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:</p></li></ul><p><img src="image-20230508191216762.png" alt="image-20230508191216762" loading="lazy"></p><p>å›¾ç¤ºæ˜¯ä½œè€…çš„æŠ“åŒ…ç»“æœæˆªå›¾ï¼Œæ‚¨å¯ä»¥å‘ç°ç¬¬ 1ï¼Œ2ï¼Œ6 å¸§éƒ½åŒ…å« ARP æ¶ˆæ¯</p><p><img src="image-20230508203130494.png" alt="image-20230508203130494" loading="lazy"></p><p>Answer the following questions: (å›ç­”ä¸‹åˆ—é—®é¢˜)</p><ol start="10"><li>åŒ…å« ARP è¯·æ±‚æ¶ˆæ¯çš„ä»¥å¤ªç½‘å¸§ä¸­æºå’Œç›®æ ‡åœ°å€çš„åå…­è¿›åˆ¶å€¼æ˜¯ä»€ä¹ˆ?</li></ol><p><img src="image-20230508202533299.png" alt="image-20230508202533299" loading="lazy"></p><ol start="10"><li><p>ä»¥å¤ªç½‘å¸§ä¸Šå±‚åè®® 16 è¿›åˆ¶å€¼æ˜¯ä»€ä¹ˆ?</p><p><img src="image-20230508202601296.png" alt="image-20230508202601296" loading="lazy"></p></li><li><p>ä¸‹è½½ ARP è§„èŒƒ(<a href="ftp://ftp.rfc-editor.org/in-notes/std/std37.txt.">ftp://ftp.rfc-editor.org/in-notes/std/std37.txt.</a>),è®¨è®ºè¯·ç§»æ­¥</p><p>(<a href="http://www.erg.abdn.ac.uk/users/gorry/course/inet-pages/arp.html">http://www.erg.abdn.ac.uk/users/gorry/course/inet-pages/arp.html</a>)</p><p><img src="image-20230508204313285.png" alt="image-20230508204313285" loading="lazy"></p><p><img src="image-20230508204134165.png" alt="image-20230508204134165" loading="lazy"></p><p>a) ARP æ“ä½œç å­—æ®µå¼€å§‹ä»ä»¥å¤ªç½‘å¸§çš„æœ€å¼€å§‹æœ‰å¤šå°‘å­—èŠ‚?</p><p>0x13Byte = 19Byte,</p><p>æ“ä½œç ï¼š1ä¸ºARPè¯·æ±‚ï¼Œ2ä¸ºARPåº”ç­”ï¼Œ3ä¸º<a href="https://zh.wikipedia.org/wiki/%E9%80%86%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%E5%8D%8F%E8%AE%AE">RARP</a>è¯·æ±‚ï¼Œ4ä¸ºRARPåº”ç­”ã€‚</p><p><img src="image-20230508204930125.png" alt="image-20230508204930125" loading="lazy"></p><p>b) åœ¨è¿›è¡Œ ARP è¯·æ±‚çš„ä»¥å¤ªç½‘å¸§çš„ ARP è´Ÿè½½éƒ¨åˆ†ä¸­ï¼Œæ“ä½œç å­—æ®µçš„å€¼æ˜¯ å¤šå°‘?</p><p>æ“ä½œç 1ä¸ºARPè¯·æ±‚</p><p>c) ARP æ¶ˆæ¯æ˜¯å¦åŒ…å«å‘é€æ–¹çš„ IP åœ°å€?</p><p>ä¸åŒ…æ‹¬.</p><p>d) åœ¨ ARP è¯·æ±‚ä¸­ä»å“ªé‡Œçœ‹å‡ºæˆ‘ä»¬è¦æŸ¥è¯¢ç›¸åº” IP çš„ä»¥å¤ªç½‘åœ°å€?</p><p>å›¾ä¸­è“è‰²éƒ¨åˆ†, å¯ä»¥çœ‹åˆ°è¦æŸ¥è¯¢çš„IP(16è¿›åˆ¶), è½¬æ¢ä¸ºåè¿›åˆ¶ä¸º: 10.51.187.123</p><p><img src="image-20230508205742976.png" alt="image-20230508205742976" loading="lazy"></p></li><li><p>æ‰¾åˆ°ç›¸åº” ARP è¯·æ±‚çš„è€Œå‘é€ ARP å›å¤</p></li></ol><pre><code>1. a) ARP æ“ä½œç å­—æ®µå¼€å§‹ä»ä»¥å¤ªç½‘å¸§çš„æœ€å¼€å§‹æœ‰å¤šå°‘å­—èŠ‚?2. b)  åœ¨è¿›è¡Œ ARP å“åº”çš„ä»¥å¤ªç½‘å¸§çš„ ARP è´Ÿè½½éƒ¨åˆ†ä¸­ï¼Œæ“ä½œç å­—æ®µçš„å€¼æ˜¯   å¤šå°‘?   2, è¡¨ç¤ºARPå“åº”3. c)   åœ¨å“åº” ARP ä¸­ä»å“ªé‡Œçœ‹å‡ºç°æ—©æœŸ ARP è¯·æ±‚çš„ç­”æ¡ˆ?   å“åº”ARPä¸­çš„æºMACåœ°å€</code></pre><ol start="12"><li><p>åŒ…å« ARP å›å¤æ¶ˆæ¯çš„ä»¥å¤ªç½‘å¸§ä¸­çš„æºåœ°å€å’Œç›®æ ‡åœ°å€çš„åå…­è¿›åˆ¶å€¼æ˜¯å¤š å°‘?</p></li><li><p>åœ¨ä½œè€…æŠ“åŒ…ç»“æœä¸­ï¼Œä»–æœ‰ä¸¤å°ç”µè„‘ï¼Œä¸€å°è¿è¡Œ wireshark è¿›è¡ŒæŠ“åŒ…ï¼Œä¸€å°æ²¡ æœ‰ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿è¡Œ wireshark é‚£å°ç”µè„‘å‘é€ ARP è¯·æ±‚å¾—åˆ°äº†åº”ç­”ï¼Œå¦å¤–ä¸€ å°ç”µè„‘çš„ ARP è¯·æ±‚æ²¡æœ‰å¾—åˆ°åº”ç­”?(æ²¡æœ‰ç›¸åº”ç¬¬ 6 å¸§çš„ ARP çš„è¯·æ±‚)</p></li></ol><p>è¯·æ±‚ARPçš„ç›®æ ‡MACåœ°å€48ä½å…¨1, æ˜¯å¹¿æ’­åœ°å€, æ‰€ä»¥å±€åŸŸç½‘è®¾å¤‡éƒ½èƒ½æ”¶åˆ°, è€Œå“åº”ARPæ˜¯å•æ’­åœ°å€, ç›®æ ‡MACä¸ºè¯·æ±‚ç›®æ ‡çš„MACåœ°å€, æ•…åªæœ‰å‘èµ·å¯¹è¯¥IPè¯·æ±‚å¯¹ç”µè„‘èƒ½æ”¶åˆ°.</p><h3 id="Extra-Credit-é¢å¤–å®éªŒ">Extra Credit é¢å¤–å®éªŒ</h3><p>EX-1. The arp command: arp å‘½ä»¤:</p><pre class="language-bash" data-language="bash"><code class="language-bash">arp <span class="token parameter variable">-s</span> InetAddr EtherAddr</code></pre><p>è¿™ä¸ªå‘½ä»¤å…è®¸ä½ æ‰‹åŠ¨æ·»åŠ  arp è®°å½•åˆ°ç¼“å­˜è¡¨ä¸­ã€‚å®ƒä¼šæŠŠæ‚¨è¾“å…¥çš„ IP åœ°å€ (InetAddr)è§£æä¸ºç‰©ç†åœ°å€(EtherAddr)ï¼Œè¯·é—®æ‚¨è¾“å…¥æ­£ç¡® IP åœ°å€ä½†æ˜¯ç‰©ç†åœ° å€é”™è¯¯ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><p>æˆåŠŸå†™å…¥äº†, ç±»å‹ä¸ºpermanent, æ²¡æœ‰å‘ç”Ÿä»€ä¹ˆ, è€Œä¸”å¯ä»¥åœ¨ARP tableä¸­çœ‹åˆ°ä¸¤æ¡åŒä¸€IPåœ°å€çš„ä¸åŒMACåœ°å€æ¡ç›®.</p><p><img src="image-20230508211728737.png" alt="image-20230508211728737" loading="lazy"></p><p>EX-2. åœ¨åˆ é™¤ ARP ç¼“å­˜ä¹‹å‰ï¼Œè¯·é—®å®ƒä»¬é»˜è®¤çš„æœ‰æ•ˆæ—¶é—´æ˜¯å¤šå°‘ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä¸å®š æ—¶çš„æŸ¥çœ‹ç¼“å­˜å†…å®¹å¾—å‡ºç»“è®ºæˆ–è€…æŸ¥è¯¢ç›¸åº”çš„æ“ä½œç³»ç»Ÿæ–‡æ¡£ã€‚</p>]]></content>
    
    
    <summary type="html">åœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶ä»¥å¤ªç½‘åè®®å’ŒARPåè®®</summary>
    
    
    
    <category term="å­¦ä¹ è®°å½•" scheme="https://trevoewu.github.io/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="computer network" scheme="https://trevoewu.github.io/tags/computer-network/"/>
    
  </entry>
  
  <entry>
    <title>Wireshark Lab 802.11</title>
    <link href="https://trevoewu.github.io/2023/05/08/Wireshark-Lab-802-11/"/>
    <id>https://trevoewu.github.io/2023/05/08/Wireshark-Lab-802-11/</id>
    <published>2023-05-08T10:36:45.000Z</published>
    <updated>2023-05-08T11:01:19.094Z</updated>
    
    <content type="html"><![CDATA[<hr><h2 id="Wireshark-å®éªŒ-802-11">Wireshark å®éªŒ:  802.11</h2><p><strong>ã€Šè®¡ç®—æœºç½‘ç»œï¼šè‡ªé¡¶å‘ä¸‹æ–¹æ³•ï¼ˆç¬¬6ç‰ˆï¼‰ã€‹è¡¥å……ææ–™ï¼ŒJ.F. Kurose and K.W. Ross</strong></p><p>â€œä¸é—»ä¸è‹¥é—»ä¹‹ï¼Œé—»ä¹‹ä¸è‹¥è§ä¹‹ï¼Œè§ä¹‹ä¸è‹¥çŸ¥ä¹‹ï¼ŒçŸ¥ä¹‹ä¸è‹¥è¡Œä¹‹ã€‚â€ â€”â€”ä¸­å›½è°šè¯­</p><p>Â© 2005-2012, J.F Kurose and K.W. Ross, All Rights Reserved</p><hr><p>åœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶ 802.11 æ— çº¿åè®®ã€‚åœ¨å¼€å§‹æœ¬å®éªŒä¹‹å‰ï¼Œå»ºè®®æ‚¨é‡æ–°é˜…è¯»è¯¾æœ¬çš„ä¸­ç¬¬ 7.3 èŠ‚ã€‚å› ä¸ºæˆ‘ä»¬å°†æ¯”è¯¾æœ¬æ·±å…¥ç ”ç©¶ 802.11 åè®®å†…å®¹ï¼Œå› æ­¤æ‚¨å¯èƒ½éœ€è¦æŸ¥çœ‹ Pablo Brenner (Breezecom Communications)å†™çš„ã€Š802.11 åè®®æŠ€æœ¯æŒ‡å—ã€‹<a href="http://www.sss-mag.com/pdf/802_11tut.pdf">ATechnical Tutorial on the 802.11Protocol </a> ä»¥åŠ Jim Geier å†™çš„ã€Šäº†è§£ 802.11 å¸§ç±»å‹ã€‹<a href="http://www.wi-fiplanet.com/tutorials/article.php/1447501">Understanding 802.11 Frame Types</a> ã€‚å½“ç„¶ï¼Œæ‚¨è¿˜éœ€è¦æŸ¥é˜… 802.11 çš„åœ£ç»-å®ƒçš„æ ‡å‡†ä¹¦<a href="http://gaia.cs.umass.edu/wireshark-labs/802.11-1999.pdf">ã€ŠANSI / IEEE æ ‡å‡† 802.11,1999 ç‰ˆ(R2003)ã€‹(ANSI/IEEE Std 802.11, 1999 Edition (R2003)</a>ã€‚æ‚¨å¯èƒ½ä¼šå‘ç°æ ‡å‡†ä¹¦ç¬¬ 36 é¡µçš„è¡¨ 1 åœ¨åˆ†ææ— çº¿è·Ÿè¸ªç‰¹åˆ«æœ‰ç”¨.</p><p>åœ¨é™¤æœ¬æ¬¡å®éªŒä»¥å¤–å…¶å®ƒçš„ Wireshark å®éªŒä¸­ï¼Œæˆ‘ä»¬éƒ½æ˜¯åœ¨æœ‰çº¿ä»¥å¤ªç½‘è¿æ¥è¿›è¡ŒæŠ“åŒ…(æ•è·å¸§)ã€‚åœ¨æœ¬å®éªŒä¸­ï¼Œå› ä¸º 802.11 æ˜¯æ— çº¿é“¾è·¯å±‚åè®®ï¼Œæˆ‘ä»¬å°†åœ¨â€œç©ºä¸­â€æ•è·å¸§ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå¸¦æœ‰ 802.11 åè®®çš„æ— çº¿ç½‘å¡(NIC)è®¾å¤‡é©±åŠ¨æ— æ³•æä¾›é’©å­å°†æ•è·/æ¥æ”¶çš„ 802.11 å¸§ç”¨äº Wireshark å®éªŒåˆ†æã€‚å› æ­¤ï¼Œåœ¨æœ¬å®éªŒä¸­ï¼Œæ‚¨å¯èƒ½ä¼šä½¿ç”¨ä½œ è€…æ•è·çš„ 802.11 å¸§(æŠ“åŒ…ç»“æœ)è¿›è¡Œåˆ†æã€‚å¦‚æœæ‚¨æœ‰èƒ½åŠ›è‡ªå·±æ•è·ï¼Œæ¬¢è¿æ‚¨è‡ªå·±åŠ¨æ‰‹ã€‚å¦‚æœæ‚¨ä¹æ„è‡ªå·±è·Ÿè¸ªï¼Œæˆ–è®¸ä½ å¯ä»¥ä¹°ä¸€ä¸ªå°çš„ <a href="www.cacetech.com">USB ç½‘å¡ AirPcap ç”¨ä»¥æ•è· 802.1 å¸§</a></p><h2 id="Getting-Started-å¼€å§‹å®éªŒ">Getting Started å¼€å§‹å®éªŒ</h2><p>ä» <a href="http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip">http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip</a> ä¸‹è½½å‹ç¼©åŒ…å¹¶ä¸”å¾—åˆ° Wireshark_802_11.pcapã€‚æœ¬ç»“æœç”±å›¢é˜Ÿçš„ä¸€ä¸ªä½œè€…åœ¨å®¶åº­ç½‘ç»œä½¿ç”¨ AirPcap ä»¥åŠè¿è¡Œ Wireshark çš„è®¡ç®—æœºå¾—åˆ°ï¼Œç»“æœå…¶ä¸­åŒ…æ‹¬ Linksys 802.11g çš„ç»„åˆæ¥å…¥ç‚¹(è·¯ç”±å™¨)ï¼Œè¯¥æ¥å…¥ç‚¹ä¸ºä¸¤å°æœ‰çº¿ PC å’Œä¸€å°æ— çº¿ PC æä¾›æœåŠ¡ã€‚ä½œè€…å¹¸è¿é‚»å±…ä¹Ÿä½¿ç”¨æ— çº¿æ¥å…¥ç‚¹ã€‚åœ¨æ­¤è·Ÿè¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°åœ¨é€šé“ 6 ä¸Šæ•è·çš„å¸§ã€‚ç”±äºæˆ‘ä»¬éœ€è¦åˆ†æä¸»æœºå’Œæ¥å…¥ç‚¹ä¸æ˜¯ä½¿ç”¨é€šé“ 6 çš„å”¯ä¸€ç»„åˆï¼Œæˆ‘ä»¬ä¹Ÿä¼šçœ‹åˆ°å…¶ä»–ä¾‹å¦‚é‚»å±…æ¥å…¥ç‚¹ä½¿ç”¨é€šé“6è¢«ä½œè€…æ”¶é›†åˆ°ã€‚è·Ÿè¸ªæ–‡ä»¶ä¸­é‡‡ç”¨çš„æ— çº¿ä¸»æœºæ´»åŠ¨åŒ…æ‹¬:</p><ul><li><p>è·Ÿè¸ªå¼€å§‹æ—¶ï¼Œä¸»æœºå·²ç»ä¸ 30 Munroe St æ¥å…¥ç‚¹å…³è”(associated)ã€‚</p></li><li><p>åœ¨æ—¶é—´ 24.82 æ—¶åˆ»ï¼Œä¸»æœºå‘ IP åœ°å€ 128.119.245.12 çš„æœåŠ¡å™¨å‘é€ HTTP è¯·</p><p>æ±‚ï¼Œè¯·æ±‚å†…å®¹æ˜¯ <a href="http://gaia.cs.umass.edu/wireshark-labs/alice.txt">http://gaia.cs.umass.edu/wireshark-labs/alice.txt</a> ã€‚</p></li><li><p>åœ¨æ—¶é—´ 32.82 æ—¶åˆ»ï¼Œä¸»æœºå‘ IP åœ°å€ 128.119.240.19.çš„æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚ï¼Œè¯·æ±‚å†…å®¹æ˜¯ <a href="http://www.cs.umass.edu">http://www.cs.umass.edu</a>ã€‚</p></li><li><p>åœ¨æ—¶é—´ 49.58 çš„æ—¶åˆ»ï¼Œä¸»æœºæ–­å¼€äº†ä¸ 30 Munroe St æ¥å…¥ç‚¹çš„å…³è”ï¼Œå¹¶ä¸”å°è¯•</p></li></ul><p>è¿æ¥åˆ° linksys_ses_24086 æ¥å…¥ç‚¹ã€‚è¯¥æ¥å…¥ç‚¹ä¸æ˜¯å¼€æ”¾çš„æ¥å…¥ç‚¹ï¼Œå› æ­¤ä¸»æœºå§‹ç»ˆæ²¡æœ‰æˆåŠŸä¸è¯¥æ¥å…¥ç‚¹å…³è”æˆåŠŸã€‚</p><ul><li>åœ¨æ—¶é—´ 63.0 æ—¶åˆ»ï¼Œä¸»æœºæ”¾å¼ƒå°è¯•å…³è” linksys_ses_24086 æ¥å…¥ç‚¹ï¼Œå¹¶ä¸”å†æ¬¡è¿æ¥30 Munroe St æ¥å…¥ç‚¹å…³è”ã€‚</li></ul><ol><li><p>ä¸‹è½½ä½œè€…çš„æŠ“åŒ…ç»“æœåï¼Œä½¿ç”¨ Wireshark çš„ File èœå•æ‰“å¼€è¯¥æ–‡ä»¶</p><p>Wireshark_802_11.pcapï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ä¸å›¾ 1 æ˜¾ç¤ºç›¸åŒçš„ç»“æœ</p><p><img src="image-20230508184630447.png" alt="image-20230508184630447" loading="lazy"></p></li></ol><h2 id="Beacon-Frames-ä¿¡æ ‡å¸§">Beacon Frames ä¿¡æ ‡å¸§</h2><p>å›æƒ³ä¸€ä¸‹ï¼Œ802.11 æ¥å…¥ç‚¹ä½¿ç”¨ä¿¡æ ‡å¸§è¡¨ç¤ºå…¶å­˜åœ¨ã€‚è¦å›ç­”ä¸‹é¢çš„é—®é¢˜ï¼Œæ‚¨æˆ–è®¸åº”è¯¥ å±•å¼€ IEEE 802.11 å¸§å¹¶åœ¨ Wireshark ä¸­é—´çª—å£çœ‹åˆ°å®ƒçš„å­—æ®µè¯¦ç»†ä¿¡æ¯ã€‚è¯·å°½é‡æ¸…æ™° çš„å±•ç¤ºæ‚¨çš„ç­”æ¡ˆï¼Œå¿…è¦æ—¶æ‚¨å¯ä»¥åœ¨å›¾ä¸­ç”¨æ ‡è®°è¾…ä»¥è¯´æ˜ã€‚æ‚¨çš„ç­”æ¡ˆåº”è¯¥ç®€å•å¯è¯»ã€‚</p><ul><li><p>å‘é€æœ€å¤šä¿¡æ ‡å¸§çš„ä¸¤ä¸ªæ¥å…¥ç‚¹çš„æœåŠ¡é›†æ ‡è¯†ç¬¦æ˜¯å¤šå°‘(SSID)?</p></li><li><p>inksys_ses_24086 æ¥å…¥ç‚¹å’Œ 30 Munroe St.æ¥å…¥ç‚¹çš„ä¿¡æ ‡å¸§ä¼ è¾“æ—¶é—´æ˜¯å¤šå°‘?(æç¤º:æ­¤æ—¶é—´é—´éš”åŒ…å«åœ¨ä¿¡æ ‡å¸§æœ¬èº«ä¹‹ä¸­ã€‚)</p></li><li><p>è¯·ä»¥åå…­è¿›åˆ¶è¡¨ç¤ºæ³•æ‰¾åˆ° 30 Munroe St æ¥å…¥ç‚¹çš„æº MAC åœ°å€ã€‚å›æƒ³è¯¾æœ¬ä¸­ å›¾ 7-13ï¼Œå¹¶è¯´æ˜æºåœ°å€ï¼Œç›®çš„åœ°å€ï¼ŒåŸºæœ¬æœåŠ¡é›†(BSS)çš„åœ°å€æ˜¯ä»€ä¹ˆã€‚æœ‰ å…³ 802.11 å¸§ç»“æ„çš„è¯¦ç»†è®¨è®ºè¯´æ˜ï¼Œè¯·å‚é˜… IEEE 802.11 æ ‡å‡†æ–‡æ¡£(ä¸Šæ–‡æ‰€ æ)ä¸­çš„ç¬¬ 7 èŠ‚ã€‚</p></li><li><p>30 Munroe St æ¥å…¥ç‚¹çš„ä¿¡æ ‡å¸§ç›®çš„åœ°å€åå…­è¿›åˆ¶è¡¨ç¤ºæ˜¯ä»€ä¹ˆ?</p></li><li><p>30 Munroe St æ¥å…¥ç‚¹çš„ BSS ID åœ°å€æ˜¯ä»€ä¹ˆ?</p></li><li><p>æ¥è‡ª 30 Munroe St æ¥å…¥ç‚¹çš„ä¿¡æ ‡å¸§å®£å‘Šæ¥å…¥ç‚¹å¯ä»¥æ”¯æŒå››ç§æ•°æ®é€Ÿç‡å’Œå…«ç§</p><p>é¢å¤–çš„â€œæ‰©å±•æ”¯æŒé€Ÿç‡â€ã€‚è¿™äº›é€Ÿç‡æ˜¯å¤šå°‘?</p></li></ul><h2 id="Data-Transfer-æ•°æ®ä¼ è¾“">Data Transfer æ•°æ®ä¼ è¾“</h2><p>ç”±äºä½œè€…æŠ“åŒ…å¼€å§‹æ—¶ï¼Œä¸»æœºå·²ç»ä¸ AP å…³è”ï¼Œå› æ­¤åœ¨åšä¸‹é¢ AP å…³è”/è§£é™¤å…³è”ä¹‹ å‰ï¼Œæˆ‘ä»¬é¦–å…ˆç ”ç©¶å·²ç»ä¸»æœºä¸å…³è” 802.11 AP çš„æ•°æ®ä¼ è¾“ã€‚å›æƒ³ä¸€ä¸‹ï¼Œåœ¨ä½œè€…æŠ“åŒ… ç»“æœä¸­ï¼Œåœ¨æ—¶é—´ 24.82 çš„æ—¶åˆ»ï¼Œä¸»æœºå‘ <a href="http://gaia.cs.umass.edu/wireshark-">http://gaia.cs.umass.edu/wireshark-</a> labs/alice.txt å‘å‡º HTTP è¯·æ±‚ã€‚ <a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> çš„ IP åœ°å€æ˜¯ 128.119.245.12ã€‚ç„¶ åï¼Œåœ¨ 32.82 æ—¶åˆ»ï¼Œä¸»æœºå‘ <a href="http://www.cs.umass.edu">http://www.cs.umass.edu</a> å‘å‡º HTTP è¯·æ±‚ã€‚</p><ul><li>æ‰¾åˆ°åŒ…å«ç¬¬ä¸€ä¸ª TCP SYN TCP æŠ¥æ–‡(ä¸‹è½½ alice.txt ä¼šè¯)çš„ 802.11 å¸§ã€‚ 802.11 å¸§ä¸­ä¸‰ä¸ª MAC åœ°å€å­—æ®µåˆ†åˆ«æ˜¯ä»€ä¹ˆ?æ­¤å¸§ä¸­é‚£ä¸ª MAC åœ°å€å¯¹åº”å å…­è¿›åˆ¶çš„æ— çº¿ä¸»æœºçš„ MAC åœ°å€?é‚£ä¸ªå¯¹åº”æ¥å…¥ç‚¹ MAC åœ°å€ï¼Œç¬¬ä¸€è·³è·¯ç”± å™¨çš„ MAC åœ°å€?å‘é€æ­¤ TCP æŠ¥æ–‡çš„æ— çº¿ä¸»æœº IP æ˜¯ä»€ä¹ˆ?ç›®çš„åœ° IP åœ°å€æ˜¯ ä»€ä¹ˆ?æ­¤ç›®çš„åœ°æ˜¯å¦ä¸ä¸»æœºåœ°å€ï¼Œæ¥å…¥ç‚¹åœ°å€ï¼Œç¬¬ä¸€è·³è·¯ç”±å™¨åœ°å€æˆ–è€…æŸäº› å…¶ä»–ç½‘ç»œè®¾å¤‡ç›¸å¯¹åº”ï¼Œè§£é‡Šå¹¶ä¸”è¯´æ˜ã€‚</li><li>æ‰¾åˆ°åŒ…å«æ­¤ TCP ä¼šè¯ SYN ACK æŠ¥æ–‡çš„ 802.11 å¸§ã€‚è¯¥å¸§ä¸­ä¸‰ä¸ª MAC åœ°å€ å­—æ®µæ˜¯ä»€ä¹ˆ?é‚£ä¸ª MAC åœ°å€å¯¹åº”åå…­è¿›åˆ¶çš„æ— çº¿ä¸»æœºçš„ MAC åœ°å€?é‚£ä¸ª å¯¹åº”æ¥å…¥ç‚¹ MAC åœ°å€ï¼Œç¬¬ä¸€è·³è·¯ç”±å™¨çš„ MAC åœ°å€?å¸§ä¸­çš„å‘é€æ–¹ MAC åœ°å€æ˜¯å¦ä¸å‘é€æ­¤ TCP æŠ¥æ–‡çš„è®¾å¤‡çš„ IP åœ°å€ç›¸å¯¹åº”?</li></ul><h2 id="Association-Disassociation-å…³è”-è§£é™¤å…³è”">Association/Disassociation å…³è”/è§£é™¤å…³è”</h2><p>å›æƒ³ä¸€ä¸‹è¯¾æœ¬çš„ç¬¬ 7.3.1 èŠ‚ï¼Œä¸»æœºåœ¨å‘é€æ•°æ®ä¹‹å‰å¿…é¡»ä¸æ¥å…¥ç‚¹å…³è”ã€‚802.11 ä¸­çš„å…³è”ä½¿ç”¨ ASSOCIATE REQUEST å¸§(ä»ä¸»æœºå‘é€åˆ° APï¼Œå¸§ç±»å‹ 0 å’Œå­ç±»å‹ 0ï¼Œå‚ è§æœ¬æ–‡ä¸­çš„ç¬¬ 7.3.3 èŠ‚)å’Œ ASSOCIATE RESPONSE å¸§(ç”± AP å‘é€ç»™å…·æœ‰ä¸»æœºï¼Œ å¸§ç±»å‹ 0 å’Œå­ç±»å‹ 1ï¼Œå“åº”äºæ¥æ”¶åˆ°çš„ ASSOCIATE REQUEST)ã€‚æœ‰å…³ 802.11 å¸§ ä¸­æ¯ä¸ªå­—æ®µçš„è¯¦ç»†è¯´æ˜ï¼Œè¯·å‚é˜… <a href="http://gaia.cs.umass.edu/wireshark-labs/802.11-">http://gaia.cs.umass.edu/wireshark-labs/802.11-</a> 1999.pdf ä¸­ 802.11 è§„èŒƒçš„ç¬¬ 34 é¡µ(ç¬¬ 7 èŠ‚)ã€‚</p><ul><li><p>åœ¨æ—¶é—´ 49 çš„æ—¶åˆ»ï¼Œä¸»æœºåœ¨è·Ÿè¸ªä¸­ä½¿ç”¨é‚£ä¸¤ä¸ªåŠ¨ä½œ(ä¾‹å¦‚:å‘é€å¸§)è§£é™¤åœ¨ è·Ÿè¸ªå¼€å§‹ä¹‹å‰å°±å·²ç»è¿æ¥çš„ 30 Munroe St AP çš„å…³è”ã€‚(æç¤º:ä¸€ä¸ªæ˜¯ IP å±‚ å¤šå®—ï¼Œä¸€ä¸ªæ˜¯ 802.11 å±‚åŠ¨ä½œ)ã€‚åœ¨æŸ¥çœ‹ 802.11 è§„èŒƒä¹‹åï¼Œè¯·æ‰¾å‡ºæŠ“åŒ…ç»“æœ ä¸­æœªæ˜¾ç¤ºä¸€ä¸ªåŠ¨ä½œå¸§ã€‚</p></li><li><p>åœ¨æŠ“åŒ…ç»“æœä¸­ï¼Œæ‰¾åˆ°ä¸»æœºå‘é€ç»™æ— çº¿ AP çš„ AUTHENICATION å¸§ï¼ŒåŒæ—¶ä¹Ÿ</p><p>æ‰¾æ— çº¿ AP çš„å›å¤å“åº”å¸§ã€‚åœ¨æ—¶é—´ 49 æ—¶åˆ»ä¹‹åï¼Œæ— çº¿ä¸»æœºå‘ linksys_ses_24086 AP(MAC åœ°å€åŒ…æ‹¬ Cisco_Li_f5:ba:bb)å‘é€äº†å¤šå°‘ AUTHENTICATION æ¶ˆæ¯?</p></li><li><p>ä¸»æœºæ˜¯å¦å¸Œæœ›èº«ä»½è®¤è¯å’Œå…³è” AP?</p></li><li><p>æ‚¨æ˜¯å¦åœ¨è·Ÿè¸ªä¸­çœ‹åˆ°æ¥è‡ª linksys_ses_24086 AP å›çš„ AUTHENTICATION?</p></li><li><p>ç°åœ¨è®©æˆ‘ä»¬æ¥åˆ†æå½“ä¸»æœºæ”¾å¼ƒå°è¯•ä¸ linksys_ses_24086 AP å…³è”å¹¶ä¸”ç°åœ¨å°</p><p>è¯•ä¸ 30 Munroe St AP å…³è”å‘ç”Ÿä»€ä¹ˆã€‚æŸ¥æ‰¾ä»ä¸»æœºå‘é€åˆ° AP çš„ AUTHENICATION å¸§ï¼ŒåŒæ—¶ä¹Ÿæ‰¾æ— çº¿ AP çš„å›å¤å“åº”å¸§ã€‚åœ¨ä»€ä¹ˆæ—¶é—´æœ‰ä¸€ ä¸ªä¸»æœºåˆ° 30 Munroe St AP çš„å¸§ï¼Œåœ¨ä»€ä¹ˆæ—¶é—´æ— çº¿ AP å›ä¸»æœºè¯¥å¸§çš„å›å¤ã€‚ (æ³¨æ„:æ‚¨å¯ä»¥ä½¿ç”¨â€œ wlan.fc.subtype == 11and wlan.fc.type == 0 and wlan.addr == IntelCor_d1:b6:4f â€(ä¸å«å¼•å·)åœ¨æ­¤è·Ÿè¸ªä¸­ä»…æ˜¾ç¤ºæ— çº¿ä¸»æœºçš„ AUTHENTICATION å¸§)</p></li><li><p>ä»ä¸»æœºåˆ° AP çš„å…³è”è¯·æ±‚ï¼Œä»¥åŠç›¸åº”çš„ AP å¯¹ä¸»æœºå…³è”è¯·æ±‚çš„å“åº”ã€‚åœ¨ä»€ä¹ˆ æ—¶å€™æœ‰æ¥è‡ªä¸»æœºåˆ° AP å…³è”è¯·æ±‚ï¼Œä»€ä¹ˆæ—¶å€™ AP å¯¹ä¸»æœºå…³è”è¯·æ±‚å“åº”ã€‚(æ³¨ æ„:ä½ å¯ä»¥ä½¿ç”¨è¿‡æ»¤è¡¨è¾¾å¼â€œwlan.fc.subtype &lt; 2 and wlan.fc.type == 0 and wlan.addr == IntelCor_d1:b6:4fâ€æ¥ä»…æ˜¾ç¤º ASSOCIATE REQUEST å’Œ ASSOCIATE RESPONSE å¸§ã€‚</p></li><li><p>ä¸»æœºå’Œ AP æ„¿æ„ä½¿ç”¨ä»€ä¹ˆä¼ è¾“é€Ÿç‡?è¦å›ç­”æ­¤é—®é¢˜ï¼Œæ‚¨æˆ–è®¸è¦æŸ¥çœ‹ 802.11 æ— </p><p>çº¿ç®¡ç†å¸§çš„å­—æ®µã€‚</p></li></ul><h2 id="Other-Frame-types-å…¶ä»–å¸§ç±»å‹">Other Frame types å…¶ä»–å¸§ç±»å‹</h2><p>ä½œè€…çš„æŠ“åŒ…ç»“æœä¸­å«è®¸å¤š PROBE REQUEST å’Œ PROBE RESPONSE å¸§ã€‚</p><ul><li>è¿™äº›å¸§ä¸­çš„å‘é€æ–¹ï¼Œæ¥æ”¶æ–¹å’Œ BSS ID MAC åœ°å€æ˜¯ä»€ä¹ˆ? è¿™ä¸¤ç§å¸§çš„ç›®çš„æ˜¯ä»€ä¹ˆ? (è¦å›ç­”æœ€åä¸€ä¸ªé—®é¢˜ï¼Œæ‚¨éœ€è¦æ·±å…¥ç ”ç©¶æœ¬å®éªŒå‰é¢å¼•ç”¨è¯´æ˜çš„ åœ¨çº¿å‚è€ƒèµ„æ–™)ã€‚</li></ul>]]></content>
    
    
    <summary type="html">åœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶ 802.11 æ— çº¿åè®®ã€‚</summary>
    
    
    
    <category term="å­¦ä¹ è®°å½•" scheme="https://trevoewu.github.io/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="computer network" scheme="https://trevoewu.github.io/tags/computer-network/"/>
    
  </entry>
  
  <entry>
    <title>Wireshark Lab: ICMP</title>
    <link href="https://trevoewu.github.io/2023/05/05/Wireshark-Lab-ICMP/"/>
    <id>https://trevoewu.github.io/2023/05/05/Wireshark-Lab-ICMP/</id>
    <published>2023-05-05T02:48:32.000Z</published>
    <updated>2023-05-05T07:21:30.475Z</updated>
    
    <content type="html"><![CDATA[<p>In this lab, weâ€™ll explore several aspects of the ICMP protocol:<br>åœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ ICMP åè®®çš„å‡ ä¸ªæ–¹é¢:</p><span id="more"></span><ul><li><p>ICMP messages generating by the Ping program; Ping ç¨‹åºç”Ÿæˆçš„ ICMP æ¶ˆæ¯;</p></li><li><p>ICMP messages generated by the Traceroute program; Traceroute ç¨‹åºç”Ÿæˆçš„ ICMP æ¶ˆæ¯;</p></li><li><p>the format and contents of an ICMP message. ICMP æ¶ˆæ¯çš„æ ¼å¼å’Œå†…å®¹ã€‚</p></li></ul><p>Before attacking this lab, youâ€™re encouraged to review the ICMP material in section 5.6<br>of the text1. We present this lab in the context of the Microsoft Windows operating system. However, it is straightforward to translate the lab to a Unix or Linux environment. åœ¨å¼€å§‹æœ¬å®éªŒä¹‹å‰ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨æŸ¥çœ‹è¯¾æœ¬çš„ 5.6 èŠ‚ä¸­çš„ ICMP ç« èŠ‚ã€‚æ­¤å®éªŒæ˜¯åœ¨Windows ä¸‹å®Œæˆçš„ï¼Œå¦‚æœæ‚¨ä½¿ç”¨å…¶ä»–ç³»ç»Ÿä¹Ÿä¸ç”¨æ‹…å¿ƒï¼Œå› ä¸ºå¤§ä½“éƒ½ç›¸åŒã€‚</p><h2 id="ICMP-and-Ping-ICMP-åè®®å’Œ-Ping-ç¨‹åº">ICMP and Ping ICMP åè®®å’Œ Ping ç¨‹åº</h2><p>Letâ€™s begin our ICMP adventure by capturing the packets generated by the Ping program. You may recall that the Ping program is simple tool that allows anyone (for example, a network administrator) to verify if a host is live or not. The Ping program in the source host sends a packet to the target IP address; if the target is live, the Ping program in the target host responds by sending a packet back to the source host. As you might have guessed (given that this lab is about ICMP), both of these Ping packets are ICMP packets. è®©æˆ‘ä»¬é€šè¿‡æ•è· Ping ç¨‹åºç”Ÿæˆçš„æ•°æ®åŒ…å¼€å§‹æˆ‘ä»¬çš„ ICMP å®éªŒã€‚ æ‚¨å¯èƒ½è¿˜è®°å¾—Ping ç¨‹åºæ˜¯ä¸€ä¸ªç®€å•çš„å·¥å…·ï¼Œå…è®¸ä»»ä½•äºº(ä¾‹å¦‚:ç½‘ç»œç®¡ç†å‘˜)éªŒè¯ä¸»æœºæ˜¯å¦å­˜åœ¨ã€‚ æºä¸»æœºä¸­çš„ Ping ç¨‹åºå°†æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ IP åœ°å€; å¦‚æœç›®æ ‡æ˜¯åœ¨çº¿çš„ï¼Œåˆ™ç›®æ ‡ä¸»æœºä¸­çš„ Ping ç¨‹åºå°†ä¼šå‘é€å“åº” Ping æ•°æ®åŒ…è¯æ˜ä»–åœ¨çº¿ï¼Œè¿™ä¸¤ä¸ª Ping æ•°æ®åŒ…éƒ½æ˜¯ ICMP æ•°æ®åŒ…ã€‚ å› æ­¤æ‚¨å¯èƒ½çŒœå‡ºæˆ‘ä»¬è¿™ä¸ªå®éªŒéƒ½æ˜¯å…³äº ICMP çš„å®éªŒäº†ã€‚</p><p>Do the following: è¯·æŒ‰ç…§ä»¥ä¸‹åŠ¨ä½œåš:</p><ul><li><p>Letâ€™s begin this adventure by opening the Windows Command Prompt application (which can be found in your Accessories folder).<br>æ‰“å¼€ windows çš„å‘½ä»¤æç¤ºç¬¦ã€‚</p></li><li><p>Start up the Wireshark packet sniffer, and begin Wireshark packet capture. å¯åŠ¨ Wireshark æ•°æ®åŒ…å—…æ¢å™¨ï¼Œå¹¶å¼€å§‹ Wireshark æ•°æ®åŒ…æ•è·ã€‚</p></li><li><p>The ping command is in c:\windows\system32, so type either â€œping â€“n 10 hostnameâ€ or â€œc:\windows\system32\ping â€“n 10 hostnameâ€ in the MS-DOS command line (without quotation marks), where hostname is a host on another continent. If youâ€™re outside of Asia, you may want to enter <a href="http://www.ust.hk">www.ust.hk</a> for the Web server at Hong Kong University of Science and Technology. The argument â€œ-n 10â€ indicates that 10 ping messages should be sent. Then run the Ping program by typing return.</p></li></ul><p>Ping ç¨‹åºåœ¨ c:\windows\system32 ç›®å½•ä¸­ï¼Œæ‰€ä»¥æ‚¨åœ¨å‘½ä»¤æç¤ºç¬¦ä¸­è¾“å…¥â€œping â€“n 10 hostnameâ€ æˆ– â€œc:\windows\system32\ping â€“n 10 hostnameâ€éƒ½æ˜¯æ­£ç¡®çš„ (æ³¨æ„å‘½ä»¤æ˜¯å¼•å·é‡Œçš„å†…å®¹)ã€‚å…¶ä¸­ hostname æ˜¯å¦ä¸€ä¸ªå¤§é™†çš„ä¸»æœºåã€‚å¦‚ æ‚¨å¦‚æœåœ¨éäºšæ´²åœ°åŒºï¼Œå»ºè®®æ‚¨è®¿é—®é¦™æ¸¯ç§‘æŠ€å¤§å­¦ <a href="http://www.ust.hk">www.ust.hk</a> ï¼Œ å‚æ•°-n 10 ä»£è¡¨å‘é€ 10 ä¸ª Ping æ¶ˆæ¯ï¼Œç„¶åæŒ‰ä¸‹å›è½¦æ‰§è¡Œå‘½ä»¤ã€‚</p><ul><li>When the Ping program terminates, stop the packet capture in Wireshark. å½“ Ping ç¨‹åºç»ˆæ­¢æ—¶ï¼Œåœæ­¢åœ¨ Wireshark ä¸­æ•è·æ•°æ®åŒ…ã€‚</li></ul><p>At the end of the experiment, your Command Prompt Window should look something like Figure 1. In this example, the source ping program is in Massachusetts and the destination Ping program is in Hong Kong. From this window we see that the source ping program sent 10 query packets and received 10 responses. Note also that for each response, the source calculates the round-trip time (RTT), which for the 10 packets is on average 375 msec.</p><p>åœ¨å®éªŒç»“æŸæ—¶ï¼Œæ‚¨çš„å‘½ä»¤æç¤ºç¬¦çª—å£åº”å¦‚å›¾ 1 æ‰€ç¤ºã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæº ping ç¨‹åºä½ äºé©¬è¨è¯¸å¡å·ï¼Œç›®æ ‡ Ping ç¨‹åºä½äºé¦™æ¸¯ã€‚ ä»è¿™ä¸ªçª—å£æˆ‘ä»¬çœ‹åˆ°æº ping ç¨‹åºå‘é€äº†10 ä¸ªæŸ¥è¯¢åŒ…å¹¶æ”¶åˆ°äº† 10 ä¸ªå“åº”ã€‚ å¦è¯·æ³¨æ„ï¼Œå¯¹äºæ¯ä¸ªå“åº”ï¼Œæºè®¡ç®—å¾€è¿”æ—¶é—´ (RTT)ï¼Œå¯¹äº 10 ä¸ªæ•°æ®åŒ…å¹³å‡ä¸º 375 æ¯«ç§’ã€‚</p><p><img src="image-20230505125410545.png" alt="image-20230505125410545" loading="lazy"></p><p>Figure 2 provides a screenshot of the Wireshark output, after â€œicmpâ€ has been entered into the filter display window. Note that the packet listing shows 20 packets: the 10 Ping queries sent by the source and the 10 Ping responses received by the source. Also note that the sourceâ€™s IP address is a private address (behind a NAT) of the form 192.168/12; the destinationâ€™s IP address is that of the Web server at HKUST. Now letâ€™s zoom in on the first packet (sent by the client); in the figure below, the packet contents area provides information about this packet. We see that the IP datagram within this packet has protocol number 01, which is the protocol number for ICMP. This means that the payload of the IP datagram is an ICMP packet.<br>å¦‚å›¾ 2ï¼Œåœ¨å°†â€œicmpâ€è¾“å…¥è¿‡æ»¤å™¨æ˜¾ç¤ºçª—å£å Wireshark è¾“å‡ºçš„å±å¹•æˆªå›¾ã€‚ è¯·æ³¨æ„ï¼Œ</p><p>æ•°æ®åŒ…åˆ—è¡¨æ˜¾ç¤º 20 ä¸ªæ•°æ®åŒ…:æºå‘é€çš„ 10 ä¸ª Ping æŸ¥è¯¢å’Œæºæ¥æ”¶çš„ 10 ä¸ª Ping å“ åº”ã€‚ å¦è¯·æ³¨æ„ï¼Œæºçš„ IP åœ°å€æ˜¯ 192.168 / 12 æ ¼å¼çš„ç§æœ‰åœ°å€(é€šè¿‡ NAT åè®®è¿æ¥ äº’è”ç½‘); ç›®çš„åœ°çš„ IP åœ°å€æ˜¯é¦™æ¸¯ç§‘æŠ€å¤§å­¦ç½‘ç»œæœåŠ¡å™¨çš„ IP åœ°å€ã€‚ ç°åœ¨è®©æˆ‘ä»¬ç‚¹ å‡»æ˜¾ç¤ºç¬¬ä¸€ä¸ªç”±å®¢æˆ·ç«¯å‘é€çš„æ•°æ®åŒ…; åœ¨å›¾ä¸­çš„ä¸‹æ–¹ï¼Œæ•°æ®åŒ…å†…å®¹åŒºåŸŸæä¾›æœ‰å…³æ­¤ æ•°æ®åŒ…çš„ä¿¡æ¯ã€‚ æˆ‘ä»¬çœ‹åˆ°è¯¥æ•°æ®åŒ…ä¸­çš„ IP æ•°æ®æŠ¥å…·æœ‰åè®®å· 01ï¼Œè¿™æ˜¯ ICMP çš„å è®®å·ã€‚ è¿™æ„å‘³ç€ IP æ•°æ®æŠ¥çš„æœ‰æ•ˆè½½è·æ˜¯ ICMP æ•°æ®åŒ…</p><p><img src="image-20230505110353038.png" alt="image-20230505110353038" loading="lazy"></p><center>å›¾ 2 åœ¨ Wireshark ä¸­è¿‡æ»¤ ICMP åè®®å¹¶ä¸”é€‰ä¸­æŸä¸ª ICMP æ¶ˆæ¯<center><p>Figure 3 focuses on the same ICMP but has expanded the ICMP protocol information in the packet contents window. Observe that this ICMP packet is of Type 8 and Code 0 - a so-called ICMP â€œecho requestâ€ packet. (See Figure 5.19 of text.) Also note that this ICMP packet contains a checksum, an identifier, and a sequence number.</p><p>å›¾ 3 åŒæ ·ä½¿ç”¨ç›¸åŒçš„ ICMP è¿‡æ»¤å™¨ï¼Œå±•å¼€å¯ä»¥çœ‹åˆ°è¯¥ ICMP åŒ…çš„è¯¦æƒ…ä¿¡æ¯ã€‚ è§‚å¯Ÿåˆ° è¯¥ ICMP æ•°æ®åŒ…æ˜¯ç±»å‹ 8 å’Œä»£ç  0 â€”â€”æ‰€è°“çš„ ICMPâ€œå›åº”è¯·æ±‚â€æ•°æ®åŒ…ã€‚ (è¯·å‚è§ ä¹¦æœ¬çš„å›¾ 5.19ã€‚)æ­¤å¤–ï¼Œæ­¤ ICMP æ•°æ®åŒ…åŒ…å«æ ¡éªŒå’Œï¼Œæ ‡è¯†ç¬¦å’Œåºåˆ—å·</p><p><img src="image-20230505110809611.png" alt="image-20230505110809611" loading="lazy"></p><h2 id="What-to-Hand-In-å›ç­”é—®é¢˜">What to Hand In: å›ç­”é—®é¢˜</h2><p>You should hand in a screen shot of the Command Prompt window similar to Figure 1 above. Whenever possible, when answering a question below, you should hand in a printout of the packet(s) within the trace that you used to answer the question asked. Annotate the printout to explain your answer. To print a packet, use File-&gt;Print, choose Selected packet only, choose Packet summary line, and select the minimum amount of packet detail that you need to answer the question.</p><p>è¯·å°½é‡æ¸…æ™°çš„å±•ç¤ºæ‚¨çš„ç­”æ¡ˆï¼Œå¿…è¦æ—¶æ‚¨å¯ä»¥åœ¨å›¾ä¸­ç”¨æ ‡è®°è¾…ä»¥è¯´æ˜ã€‚æ‚¨çš„ç­”æ¡ˆåº”è¯¥<br>ç®€å•å¯è¯»ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">ping</span> <span class="token parameter variable">-c</span> <span class="token number">10</span> bing.com // <span class="token punctuation">[</span>-c count<span class="token punctuation">]</span> </code></pre><p>You should answer the following questions: è¯·å›ç­”ä»¥ä¸‹é—®é¢˜:</p><ol><li>What is the IP address of your host? What is the IP address of the destination host? æ‚¨çš„ä¸»æœºçš„ IP åœ°å€æ˜¯å¤šå°‘? ç›®æ ‡ä¸»æœºçš„ IP åœ°å€æ˜¯å¤šå°‘?</li></ol><p><img src="image-20230505125749494.png" alt="image-20230505125749494" loading="lazy"></p><ol><li>Why is it that an ICMP packet does not have source and destination port numbers? ä¸ºä»€ä¹ˆ ICMP æ•°æ®åŒ…æ²¡æœ‰æºç«¯å£å·å’Œç›®çš„ç«¯å£å·?</li></ol><p><strong>å¤§å¤šæ•°TCP/IPå®ç°ç›´æ¥åœ¨æ“ä½œç³»ç»Ÿä¸­æ”¯æŒpingæœåŠ¡å™¨, å³è¯¥æœåŠ¡å™¨ä¸æ˜¯ä¸€ä¸ªè¿›ç¨‹.</strong></p><p>ICMPï¼ˆInternet Control Message Protocolï¼‰æ•°æ®åŒ…æ²¡æœ‰æºç«¯å£å·å’Œç›®çš„ç«¯å£å·ï¼Œå› ä¸ºICMPä¸åƒTCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰æˆ–UDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰é‚£æ ·æ˜¯ä¼ è¾“å±‚åè®®ã€‚ç›¸åï¼ŒICMPæ˜¯ä¸€ç§ç›´æ¥åœ¨IPï¼ˆInternet Protocolï¼‰å±‚ä¹‹ä¸Šè¿è¡Œçš„ç½‘ç»œå±‚åè®®ã€‚</p><p>TCPå’ŒUDPä½¿ç”¨æºå’Œç›®çš„åœ°ç«¯å£å·æ¥åœ¨åŒä¸€è®¾å¤‡ä¸Šè¿è¡Œçš„ä¸åŒåº”ç”¨ç¨‹åºä¹‹é—´è¿›è¡Œå¤šè·¯å¤ç”¨å’Œè§£å¤ç”¨æ•°æ®ã€‚ç„¶è€Œï¼ŒICMPä¸ç”¨äºä¼ è¾“åº”ç”¨ç¨‹åºæ•°æ®ï¼Œè€Œæ˜¯ç”¨äºåœ¨ç½‘ç»œè®¾å¤‡ä¹‹é—´ä¼ é€’é”™è¯¯æ¶ˆæ¯å’Œç½‘ç»œçŠ¶æ€ä¿¡æ¯ã€‚å› æ­¤ï¼ŒICMPæ¶ˆæ¯å¹¶ä¸æ˜¯é’ˆå¯¹è®¾å¤‡ä¸Šçš„ç‰¹å®šç«¯å£è€Œè¨€çš„ï¼Œè€Œæ˜¯é’ˆå¯¹è®¾å¤‡æœ¬èº«çš„ã€‚</p><p>ICMPæ¶ˆæ¯åŒ…å«ç±»å‹ã€ä»£ç å’Œæ ¡éªŒå’Œç­‰å­—æ®µï¼Œè¿™äº›å­—æ®µç”¨äºæŒ‡ç¤ºæ¶ˆæ¯çš„ç›®çš„å’Œå†…å®¹ã€‚è¿™äº›å­—æ®µå…è®¸ç½‘ç»œè®¾å¤‡é€‚å½“åœ°è§£é‡Šå’Œå“åº”ICMPæ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œå½“ä»ä¸€ä¸ªè®¾å¤‡å‘é€pingå‘½ä»¤åˆ°å¦ä¸€ä¸ªè®¾å¤‡æ—¶ï¼Œpingæ•°æ®åŒ…åŒ…å«ä¸€ä¸ªICMPå›æ˜¾è¯·æ±‚æ¶ˆæ¯ï¼Œè¿™ä¿ƒä½¿æ¥æ”¶è®¾å¤‡å‘å‘é€æ–¹å‘é€ä¸€ä¸ªICMPå›æ˜¾å›å¤æ¶ˆæ¯ã€‚ICMPæ•°æ®åŒ…ä¸­ç¼ºå°‘æºå’Œç›®çš„ç«¯å£å·æ˜¯ç”±äºè¿™äº›ä¿¡æ¯å¯¹åè®®çš„è¿è¡Œä¸å¿…è¦ã€‚</p><ol><li>Examine one of the ping request packets sent by your host. What are the ICMP type and code numbers? What other fields does this ICMP packet have? How many bytes are the checksum, sequence number and identifier fields? æŸ¥çœ‹ä»»æ„çš„è¯·æ±‚ ICMP æ•°æ®åŒ…ï¼Œ ICMP ç±»å‹å’Œä»£ç æ˜¯ä»€ä¹ˆ? è¯¥ ICMP æ•°æ®åŒ…è¿˜æœ‰å“ªäº›å…¶ä»–å­—æ®µ? æ ¡éªŒå’Œï¼Œåºåˆ—å·å’Œæ ‡è¯†ç¬¦å­—æ®µæœ‰å¤šå°‘å­—èŠ‚?</li></ol><p><strong>Type: 8 code: 0 å›æ˜¾è¯·æ±‚</strong>ã€‚è¿˜åŒ…æ‹¬<strong>æ£€éªŒå’Œ(2 Byte)</strong>, <strong>id(2 Byte)</strong>, <strong>sequence number(2 Byte)</strong></p><p><img src="image-20230505131005238.png" alt="image-20230505131005238" loading="lazy"></p><p><img src="image-20230505140604234.png" alt="image-20230505140604234" loading="lazy"></p><ol><li>Examine the corresponding ping reply packet. What are the ICMP type and code numbers? What other fields does this ICMP packet have? How many bytes are the checksum, sequence number and identifier fields?<br>æŸ¥çœ‹ä»»æ„çš„å“åº” ICMP æ•°æ®åŒ…ï¼Œ ICMP ç±»å‹å’Œä»£ç æ˜¯ä»€ä¹ˆ? è¯¥ ICMP æ•°æ®åŒ…<br>è¿˜æœ‰å“ªäº›å…¶ä»–å­—æ®µ? æ ¡éªŒå’Œï¼Œåºåˆ—å·å’Œæ ‡è¯†ç¬¦å­—æ®µæœ‰å¤šå°‘å­—èŠ‚?</li></ol><p>Type: 0(Echo reply)</p><p>Code : 0</p><p>è¿˜åŒ…æ‹¬<strong>æ£€éªŒå’Œ(2 Byte)</strong>, <strong>id(2 Byte)</strong>, <strong>sequence number</strong>**(2 Byte**)</p><p><img src="image-20230505140719354.png" alt="image-20230505140719354" loading="lazy"></p><h2 id="ICMP-and-Traceroute-ICMP-åè®®å’Œ-Traceroute-å‘½ä»¤">ICMP and Traceroute ICMP åè®®å’Œ Traceroute å‘½ä»¤</h2><p>Letâ€™s now continue our ICMP adventure by capturing the packets generated by the Traceroute program. You may recall that the Traceroute program can be used to figure out the path a packet takes from source to destination. Traceroute is discussed in Section 1.4 and in Section 5.6 of the text.<br>ç°åœ¨è®©æˆ‘ä»¬é€šè¿‡æ•è· Traceroute ç¨‹åºç”Ÿæˆçš„æ•°æ®åŒ…ç»§ç»­æˆ‘ä»¬çš„ ICMP å®éªŒã€‚ æ‚¨å¯èƒ½<br>è¿˜è®°å¾— Traceroute ç¨‹åºå¯ç”¨äºç¡®å®šæ•°æ®åŒ…ä»æºåˆ°ç›®çš„åœ°çš„è·¯å¾„ã€‚ Traceroute å‘½ä»¤å¯ ä»¥åœ¨è¯¾æœ¬ä¸­çš„ 1.4 èŠ‚å’Œ 5.6 èŠ‚ä¸­æ‰¾åˆ°</p><p>Traceroute is implemented in different ways in Unix/Linux/MacOS and in Windows. In Unix/Linux, the source sends a series of UDP packets to the target destination using an unlikely destination port number; in Windows, the source sends a series of ICMP packets to the target destination. For both operating systems, the program sends the first packet with TTL=1, the second packet with TTL=2, and so on. Recall that a router will decrement a packetâ€™s TTL value as the packet passes through the router. When a packet arrives at a router with TTL=1, the router sends an ICMP error packet back to the source. In the following, weâ€™ll use the native Windows tracert program. A shareware version of a much nice Windows Traceroute program is pingplotter (<a href="http://www.pingplotter.com">www.pingplotter.com</a>). Weâ€™ll use pingplotter in our Wireshark IP lab since it provides additional functionality that weâ€™ll need there.<br>æ¯ä¸ªç³»ç»Ÿæœ‰ä¸åŒè·¯ç”±è·Ÿè¸ªå®ç°åŠæ³•ï¼Œåœ¨ Unix / Linux ä¸­ï¼Œè·¯ç”±è·Ÿè¸ª traceroute ä½¿ç”¨ å‘é€ä¸å¯åˆ°è¾¾(æ— ä½¿ç”¨çš„)ç«¯å£çš„ <strong>UDP</strong> åŒ…æ¥å®ç°ï¼Œåœ¨ Windows ä¸­ï¼Œè·¯ç”±è·Ÿè¸ª tracert ä»…ä½¿ç”¨ <strong>ICMP</strong> æ•°æ®åŒ…æ¥å®ç°ï¼Œä½†æ˜¯å¯¹äºä»–ä»¬æ¥è¯´ï¼Œéƒ½æ˜¯å‘é€ TTL å¢åŠ çš„æ•°æ® åŒ…ï¼Œä¾‹å¦‚ TTL=1,TTL=2ï¼Œå›æƒ³ä¸‹ï¼Œæ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨ï¼ŒTTL å°±ä¼šå‡ä¸€ï¼Œ<strong>å½“ TTL=1 çš„åŒ…è¾¾åˆ°è·¯ç”±å™¨ï¼Œè¯¥è·¯ç”±å™¨ä¼šå°†è¯¥åŒ…ä¸¢å¼ƒï¼Œå¹¶ä¸”å‘é€ ICMP é”™è¯¯ç»™è¯·æ±‚çš„æœºå™¨</strong>ï¼Œåœ¨ æœ¬æ¬¡å®éªŒï¼Œæˆ‘ä»¬ä½¿ç”¨ window è‡ªå¸¦çš„ tracertã€‚æœ‰ä¸€ä¸ªè·¨å¹³å° Windows Traceroute ç¨‹åºçš„æ˜¯ pingplotter(<a href="http://www.pingplotter.com">www.pingplotter.com</a>)(æ”¶è´¹ä½†å¯ä»¥è¯•ç”¨)ã€‚ æˆ‘ä»¬å°†åœ¨ Wireshark IP å®éªŒå®¤ä¸­ä½¿ç”¨ pingplotterï¼Œå› ä¸ºå®ƒæä¾›äº†æˆ‘ä»¬åœ¨é‚£é‡Œéœ€è¦çš„å…¶ä»–åŠŸèƒ½ã€‚</p><p>Do the following4: è¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤</p><ul><li><p>Letâ€™s begin by opening the Windows Command Prompt application (which can be found in your Accessories folder).<br>æ‰“å¼€ windows çš„å‘½ä»¤æç¤ºç¬¦ã€‚</p></li><li><p>Start up the Wireshark packet sniffer, and begin Wireshark packet capture. å¯åŠ¨ Wireshark æ•°æ®åŒ…å—…æ¢å™¨ï¼Œå¹¶å¼€å§‹ Wireshark æ•°æ®åŒ…æ•è·ã€‚</p></li><li><p>The tracert command is in c:\windows\system32, so type either â€œtracert hostnameâ€ or â€œc:\windows\system32\tracert hostnameâ€ in the MS-DOS command line (without quotation marks), where hostname is a host on another continent. (Note that on a Windows machine, the command is â€œtracertâ€ and not â€œtracerouteâ€.) If youâ€™re outside of Europe, you may want to enter <a href="http://www.inria.fr">www.inria.fr</a> for the Web server at INRIA, a computer science research institute in France. Then run the Traceroute program by typing return.<br>tracert ç¨‹åºåœ¨ c:\windows\system32 ç›®å½•ä¸­ï¼Œæ‰€ä»¥æ‚¨åœ¨å‘½ä»¤æç¤ºç¬¦ä¸­è¾“å…¥</p><p>â€œtracert hostnameâ€ æˆ– â€œc:\windows\system32\ tracert hostnameâ€éƒ½æ˜¯æ­£ç¡®çš„(æ³¨ æ„å‘½ä»¤æ˜¯å¼•å·é‡Œçš„å†…å®¹)ã€‚å…¶ä¸­ hostname æ˜¯å¦ä¸€ä¸ªå¤§é™†çš„ä¸»æœºåã€‚å¦‚æ‚¨å¦‚ æœåœ¨éæ¬§æ´²åœ°åŒºï¼Œå»ºè®®æ‚¨è®¿é—®æ³•å›½ INRIA(è®¡ç®—æœºç§‘å­¦ç ”ç©¶æ‰€) <a href="http://www.inria.fr">www.inria.fr</a> ç„¶åæŒ‰ä¸‹å›è½¦æ‰§è¡Œå‘½ä»¤ã€‚</p></li><li><p>When the Traceroute program terminates, stop packet capture in Wireshark. å½“ Traceroute ç¨‹åºç»ˆæ­¢æ—¶ï¼Œåœæ­¢åœ¨ Wireshark ä¸­æ•è·æ•°æ®åŒ…ã€‚</p><p>At the end of the experiment, your Command Prompt Window should look something like Figure 4. In this figure, the client Traceroute program is in Massachusetts and the target destination is in France. From this figure we see that for each TTL value, the</p></li></ul><p>source program sends three probe packets. Traceroute displays the RTTs for each of the probe packets, as well as the IP address (and possibly the name) of the router that returned the ICMP TTL-exceeded message. åœ¨å®éªŒç»“æŸæ—¶ï¼Œæ‚¨çš„å‘½ä»¤æç¤ºç¬¦çª—å£åº”å¦‚å›¾ 4 æ‰€ç¤ºã€‚åœ¨æ­¤å›¾ä¸­ï¼Œå®¢æˆ·ç«¯ Tracerouteç¨‹åºä¸»æœºä½äºé©¬è¨è¯¸å¡å·ï¼Œç›®æ ‡ä¸»æœºä½äºæ³•å›½ã€‚ ä»è¯¥å›¾ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œå¯¹äºæ¯ä¸ª TTL å€¼ï¼Œæºç¨‹åºå‘é€ä¸‰ä¸ªæ¢æµ‹åŒ…ã€‚ Traceroute æ˜¾ç¤ºæ¯ä¸ªæ¢æµ‹åŒ…çš„ RTTï¼Œä»¥åŠè¿”å› ICMP TTL è¶…å‡ºæ¶ˆæ¯çš„è·¯ç”±å™¨çš„ IP åœ°å€(å¯èƒ½è¿˜æœ‰åç§°)ã€‚</p><p><img src="image-20230505111220401.png" alt="image-20230505111220401" loading="lazy"></p><p>Figure 5 displays the Wireshark window for an ICMP packet returned by a router. Note that this ICMP error packet contains many more fields than the Ping ICMP messages.<br>å›¾ 5 æ˜¾ç¤ºäº†è·¯ç”±å™¨è¿”å›çš„ ICMP æ•°æ®åŒ…çš„ Wireshark çª—å£ã€‚ è¯·æ³¨æ„ï¼Œæ­¤ ICMP é”™è¯¯æ•°æ®åŒ…åŒ…å«çš„å­—æ®µæ¯” Ping ICMP æ¶ˆæ¯å¤šå¾—å¤šã€‚</p><h2 id="image-20230505111244920"><img src="image-20230505111244920.png" alt="image-20230505111244920" loading="lazy"></h2><p>If you are unable to run Wireshark live on a computer, you can download the zip file <a href="http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip">http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip</a> and extract the file ICMP-ethereal-trace-2. The traces in this zip file were collected by Wireshark running on one of the authorâ€™s computers, while performing the steps indicated in the Wireshark lab. Once you have downloaded the trace, you can load it into Wireshark and view the trace using the File pull down menu, choosing Open, and then selecting the ICMP-ethereal-trace-2 trace file. You can then use this trace file to answer the questions below. åŒæ ·å¦‚æœæ‚¨æ— æ³•æŠ“åŒ…ï¼Œå»ºè®®æ‚¨ä¸‹è½½ä½œè€…çš„æŠ“åŒ…ç»“æœ <a href="http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip">http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip</a> è§£å‹å¹¶ä¸”ä½¿ç”¨ Wireshark æ‰“å¼€ ICMP-ethereal-trace-2 è¿›è¡Œåˆ†æã€‚</p><hr><h2 id="What-to-Hand-In-å›ç­”é—®é¢˜-2">What to Hand In: å›ç­”é—®é¢˜</h2><p>For this part of the lab, you should hand in a screen shot of the Command Prompt window. Whenever possible, when answering a question below, you should hand in a printout of the packet(s) within the trace that you used to answer the question asked. Annotate the printout to explain your answer. To print a packet, use File-&gt;Print, choose Selected packet only, choose Packet summary line, and select the minimum amount of packet detail that you need to answer the question. è¯·å°½é‡æ¸…æ™°çš„å±•ç¤ºæ‚¨çš„ç­”æ¡ˆï¼Œå¿…è¦æ—¶æ‚¨å¯ä»¥åœ¨å›¾ä¸­ç”¨æ ‡è®°è¾…ä»¥è¯´æ˜ã€‚æ‚¨çš„ç­”æ¡ˆåº”è¯¥ç®€å•å¯è¯»</p><p>Answer the following questions: è¯·å›ç­”ä»¥ä¸‹é—®é¢˜:</p><ol><li><p>What is the IP address of your host? What is the IP address of the target destination host?<br>æ‚¨çš„ä¸»æœºçš„ IP åœ°å€æ˜¯å¤šå°‘? ç›®æ ‡ç›®æ ‡ä¸»æœºçš„ IP åœ°å€æ˜¯å¤šå°‘?</p></li><li><p>If ICMP sent UDP packets instead (as in Unix/Linux), would the IP protocol number still be 01 for the probe packets? If not, what would it be?<br>å¦‚æœ ICMP å‘é€äº† UDP æ•°æ®åŒ…(å¦‚åœ¨ Unix / Linux ä¸­)ï¼Œé‚£ä¹ˆæ¢æµ‹æ•°æ®åŒ…çš„ IP åè®®å·ä»ç„¶æ˜¯ 01 å—? å¦‚æœæ²¡æœ‰ï¼Œå®ƒä¼šæ˜¯ä»€ä¹ˆ?</p></li></ol><p><img src="image-20230505141720372.png" alt="image-20230505141720372" loading="lazy"></p><ol><li>Examine the ICMP echo packet in your screenshot. Is this different from the ICMP ping query packets in the first half of this lab? If yes, how so? æ£€æŸ¥å±å¹•æˆªå›¾ä¸­çš„ ICMP å“åº”æ•°æ®åŒ…ã€‚ è¿™ä¸æœ¬å®éªŒçš„å‰åŠéƒ¨åˆ†ä¸­çš„ ICMP ping æŸ¥è¯¢æ•°æ®åŒ…ä¸åŒå—? å¦‚æœä¸åŒï¼Œè¯·è§£é‡Šä¸ºä»€ä¹ˆ?</li></ol><p><img src="image-20230505141845947.png" alt="image-20230505141845947" loading="lazy"></p><p>è¯¥ICMP Message Type:11 Code: 0 , è·¯ç”±å™¨å‘Šè¯‰æºä¸»æœºä½ çš„åˆ†ç»„ç”±äºTTLå‡ä¸º0è¢«æˆ‘ä¸¢æ‰äº†(Time-to-live exceeded), è¿™æ˜¯Pingå’Œtreacerouteç¨‹åºçš„å·¥ä½œåŸç†ä¸åŒå¯¼è‡´çš„, Pingç¨‹åºå‘é€è¯·æ±‚å›æ˜¾æŠ¥æ–‡, ç›®æ ‡ä¸»æœºæ”¶åˆ°åå›å¤(å›æ˜¾å›ç­”), è€Œtracerouteç¨‹åºé€šè¿‡å‘é€TTLä»1é€’å¢çš„UPDæ•°æ®æŠ¥æ¥è·å¾—è·¯ç”±ä¿¡æ¯.</p><ol><li>Examine the ICMP error packet in your screenshot. It has more fields than the ICMP echo packet. What is included in those fields?<br>æ£€æŸ¥å±å¹•æˆªå›¾ä¸­çš„ ICMP é”™è¯¯æ•°æ®åŒ…ã€‚ å®ƒå…·æœ‰æ¯” ICMP å“åº”æ•°æ®åŒ…æ›´å¤šçš„å­—æ®µã€‚ è¿™ä¸ªæ•°æ®åŒ…å«å“ªäº›å†…å®¹?</li></ol><p><img src="image-20230505142419713.png" alt="image-20230505142419713" loading="lazy"></p><p>å¤šäº†IPå¤´éƒ¨, IPå¤´éƒ¨åŒ…å«äº†è¢«ä¸¢å¼ƒçš„IPæ•°æ®æŠ¥çš„å¤´éƒ¨å­—æ®µ</p><ol><li>Examine the last three ICMP packets received by the source host. How are these packets different from the ICMP error packets? Why are they different? æ£€æŸ¥æºä¸»æœºæ”¶åˆ°çš„æœ€åä¸‰ä¸ª ICMP æ•°æ®åŒ…ã€‚ è¿™äº›æ•°æ®åŒ…ä¸ ICMP é”™è¯¯æ•°æ®åŒ…æœ‰ä½•ä¸åŒ? ä»–ä»¬ä¸ºä»€ä¹ˆä¸åŒ?</li></ol><p>æ‰¾ä¸åˆ°â€¦æœ€åéƒ½æ²¡æœ‰æ”¶åˆ°, ä½†æˆ‘è¿˜æ˜¯è¯´å‡ å¥. è¿™äº›åŒä¸ºICMPæ•°æ®åŒ…, ä½†TYPEå’ŒCodeå­—æ®µçš„å­—ä¸åŒ, Type:3 Code:3 ç›®æ ‡ä¸»æœºå‘Šè¯‰æºä¸»æœºç›®æ ‡ç«¯å£ä¸å¯è¾¾, è¿™æ˜¯å› ä¸ºtreacerouteç¨‹åºå‘é€äº†ä¸å¯è¾¾çš„ç«¯å£</p><p><img src="image-20230505143521010.png" alt="image-20230505143521010" loading="lazy"></p><ol><li><p>Within the tracert measurements, is there a link whose delay is significantly longer than others? Refer to the screenshot in Figure 4, is there a link whose delay is significantly longer than others? On the basis of the router names, can you guess the location of the two routers on the end of this link?</p><p>åœ¨ tracert è·Ÿè¸ªæµ‹é‡ä¸­ï¼Œæ˜¯å¦æœ‰ä¸€ä¸ªè¿æ¥çš„å»¶è¿Ÿæ¯”å…¶ä»–è¿æ¥é•¿å¾—å¤š? è¯·å‚é˜… å›¾ 4 ä¸­çš„å±å¹•æˆªå›¾ï¼Œæ˜¯å¦æœ‰è¿æ¥çš„å»¶è¿Ÿæ˜æ˜¾é•¿äºå…¶ä»–è¿æ¥? æ ¹æ®è·¯ç”±å™¨å ç§°ï¼Œæ‚¨èƒ½çŒœå‡ºè¿™ä¸ªè¿æ¥æœ«ç«¯çš„ä¸¤ä¸ªè·¯ç”±å™¨çš„ä½ç½®å—?</p></li></ol><p>å¯ä»¥å‘ç°TTLä¸º6å’Œä¸º10æ—¶, å»¶è¿Ÿå˜åŒ–å¾ˆå¤§, é€šè¿‡best traceç¨‹åºå‘ç°, è¿™ä¸¤ä¸ªè·¯ç”±å™¨çš„ä½ç½®åˆ†åˆ«æ˜¯ä¸­å›½åŒ—äº¬å’Œå¾·å›½ï¼Œé»‘æ£®å·ï¼Œæ³•å…°å…‹ç¦ï¼Œ</p><img src="image-20230505144758780.png" alt="image-20230505144758780" style="zoom:50%;" loading="lazy"><p><img src="image-20230505145146382.png" alt="image-20230505145146382" loading="lazy"></p><h2 id="Extra-Credit-é¢å¤–é—®é¢˜">Extra Credit é¢å¤–é—®é¢˜</h2><p>For one of the programming assignments you created a UDP client ping program. This ping program, unlike the standard ping program, sends UDP probe packets rather than ICMP probe packets. Use the client program to send a UDP packet with an unusual destination port number to some live host. At the same time, use Wireshark to capture any response from the target host. Provide a Wireshark screenshot for the response as well as an analysis of the response.</p><p>å¯¹äºä¸€ä¸ªç¼–ç¨‹ä»»åŠ¡ï¼Œæ‚¨å¯èƒ½åˆ›å»ºäº†ä¸€ä¸ª UDP å®¢æˆ·ç«¯ ping ç¨‹åºã€‚ ä¸æ ‡å‡† ping ç¨‹åº ä¸åŒï¼Œæ­¤ ping ç¨‹åºå‘é€ UDP æ¢æµ‹åŒ…è€Œä¸æ˜¯ ICMP æ¢æµ‹åŒ…ã€‚ ä½¿ç”¨å®¢æˆ·ç«¯ç¨‹åºå°†å…·æœ‰ å¼‚å¸¸ç›®æ ‡ç«¯å£å·çš„ UDP æ•°æ®åŒ…å‘é€åˆ°æŸä¸ªæ´»åŠ¨ä¸»æœºã€‚ åŒæ—¶ï¼Œä½¿ç”¨ Wireshark æ•è· ç›®æ ‡ä¸»æœºçš„ä»»ä½•å“åº”ã€‚ æä¾›å“åº”çš„ Wireshark å±å¹•æˆªå›¾ä»¥åŠå“åº”åˆ†æã€‚</p></center></center>]]></content>
    
    
    <summary type="html">&lt;p&gt;In this lab, weâ€™ll explore several aspects of the ICMP protocol:&lt;br&gt;
åœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ ICMP åè®®çš„å‡ ä¸ªæ–¹é¢:&lt;/p&gt;</summary>
    
    
    
    <category term="å­¦ä¹ " scheme="https://trevoewu.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="computer network" scheme="https://trevoewu.github.io/tags/computer-network/"/>
    
    <category term="lab" scheme="https://trevoewu.github.io/tags/lab/"/>
    
  </entry>
  
  <entry>
    <title>Wireshark Lab: DNS</title>
    <link href="https://trevoewu.github.io/2023/04/21/Wireshark-Lab-DNS/"/>
    <id>https://trevoewu.github.io/2023/04/21/Wireshark-Lab-DNS/</id>
    <published>2023-04-21T13:05:21.000Z</published>
    <updated>2023-04-21T13:18:17.607Z</updated>
    
    <content type="html"><![CDATA[<p><strong>å®˜æ–¹è‹±æ–‡æ–‡æ¡£ï¼š<a href="Wireshark_Intro_v6.01.pdf">Wireshark_Intro_v6.01.pdf</a></strong></p><p><strong>ä»¥ä¸‹å†…å®¹ä¸ºç¬”è€…ç¿»è¯‘ï¼š</strong></p><hr><h2 id="Wireshark-å®éªŒ-DNS-v6-01">Wireshark å®éªŒ:  DNS v6.01</h2><p><strong>ã€Šè®¡ç®—æœºç½‘ç»œï¼šè‡ªé¡¶å‘ä¸‹æ–¹æ³•ï¼ˆç¬¬6ç‰ˆï¼‰ã€‹è¡¥å……ææ–™ï¼ŒJ.F. Kurose and K.W. Ross</strong></p><p>â€œä¸é—»ä¸è‹¥é—»ä¹‹ï¼Œé—»ä¹‹ä¸è‹¥è§ä¹‹ï¼Œè§ä¹‹ä¸è‹¥çŸ¥ä¹‹ï¼ŒçŸ¥ä¹‹ä¸è‹¥è¡Œä¹‹ã€‚â€ â€”â€”ä¸­å›½è°šè¯­</p><p>Â© 2005-2012, J.F Kurose and K.W. Ross, All Rights Reserved</p><hr><p>å¦‚ä¹¦ä¸­ç¬¬2.5èŠ‚æ‰€è¿°ï¼ŒåŸŸåç³»ç»Ÿ(DNS)å°†ä¸»æœºåè½¬æ¢ä¸ºIPåœ°å€ï¼Œåœ¨äº’è”ç½‘åŸºç¡€æ¶æ„ä¸­å‘æŒ¥å…³é”®ä½œç”¨ã€‚åœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†ä»”ç»†æŸ¥çœ‹DNSåœ¨å®¢æˆ·ç«¯çš„ç»†èŠ‚ã€‚å›æƒ³ä¸€ä¸‹ï¼Œå®¢æˆ·ç«¯åœ¨DNSä¸­çš„è§’è‰²ç›¸å¯¹ç®€å•â€”â€”å®¢æˆ·ç«¯å‘å…¶æœ¬åœ°DNSæœåŠ¡å™¨å‘é€<em>è¯·æ±‚</em>ï¼Œå¹¶æ¥æ”¶ä¸€ä¸ª<em>å“åº”</em>ã€‚å¦‚ä¹¦ä¸­çš„å›¾2.21å’Œ2.22æ‰€ç¤ºï¼Œç”±äºDNSåˆ†å±‚æœåŠ¡å™¨ä¹‹é—´ç›¸äº’é€šä¿¡ï¼Œå¯ä»¥é€’å½’åœ°æˆ–è¿­ä»£åœ°è§£æå®¢æˆ·ç«¯çš„DNSæŸ¥è¯¢è¯·æ±‚ï¼Œè€Œå¤§å¤šæ•°æ“ä½œæ˜¯ä¸å¯è§çš„ã€‚ç„¶è€Œï¼Œä»DNSå®¢æˆ·ç«¯çš„è§’åº¦æ¥çœ‹ï¼Œåè®®éå¸¸ç®€ â€”â€”å°†æŸ¥è¯¢æŒ‡å‘ä¸ºæœ¬åœ°DNSæœåŠ¡å™¨ï¼Œå¹¶ä»è¯¥æœåŠ¡å™¨æ¥æ”¶åˆ°å“åº”ã€‚</p><p>åœ¨å¼€å§‹æœ¬å®éªŒä¹‹å‰ï¼Œæ‚¨å¯èƒ½éœ€è¦é˜…è¯»ä¹¦ä¸­çš„ç¬¬2.5èŠ‚æ¥äº†è§£DNSã€‚å¦å¤–ï¼Œæ‚¨å¯èƒ½éœ€è¦æŸ¥çœ‹å…³äº<strong>æœ¬åœ°DNSæœåŠ¡å™¨ï¼ŒDNSç¼“å­˜ï¼ŒDNSè®°å½•å’Œæ¶ˆæ¯ï¼Œä»¥åŠDNSè®°å½•ä¸­çš„TYPEå­—æ®µ</strong>çš„èµ„æ–™ã€‚</p><h3 id="1-nslookup">1. nslookup</h3><p>åœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†å¤§é‡ä½¿ç”¨<em>nslookup</em>å·¥å…·ï¼Œè¿™ä¸ªå·¥å…·åœ¨ç°åœ¨çš„å¤§å¤šæ•°Linux/Unixå’ŒMicrosoftå¹³å°ä¸­éƒ½æœ‰ã€‚è¦åœ¨Linux/Unixä¸­è¿è¡Œ<em>nslookup</em>ï¼Œæ‚¨åªéœ€åœ¨å‘½ä»¤è¡Œä¸­é”®å…¥<em>nslookup</em>å‘½ä»¤å³å¯ã€‚è¦åœ¨Windowsä¸­è¿è¡Œï¼Œè¯·æ‰“å¼€å‘½ä»¤æç¤ºç¬¦å¹¶åœ¨å‘½ä»¤è¡Œä¸Šè¿è¡Œ<em>nslookup</em>ã€‚</p><p>åœ¨è¿™æ˜¯æœ€åŸºæœ¬çš„æ“ä½œï¼Œ<em>nslookup</em>å·¥å…·å…è®¸ä¸»æœºæŸ¥è¯¢ä»»ä½•æŒ‡å®šçš„DNSæœåŠ¡å™¨çš„DNSè®°å½•ã€‚DNSæœåŠ¡å™¨å¯ä»¥æ˜¯æ ¹DNSæœåŠ¡å™¨ï¼Œé¡¶çº§åŸŸDNSæœåŠ¡å™¨ï¼Œæƒå¨DNSæœåŠ¡å™¨æˆ–ä¸­é—´DNSæœåŠ¡å™¨ï¼ˆæœ‰å…³è¿™äº›æœ¯è¯­çš„å®šä¹‰ï¼Œè¯·å‚é˜…ä¹¦æœ¬ï¼‰ã€‚è¦å®Œæˆæ­¤ä»»åŠ¡ï¼Œ<em>nslookup</em>å°†DNSæŸ¥è¯¢å‘é€åˆ°æŒ‡å®šçš„DNSæœåŠ¡å™¨ï¼Œç„¶åæ¥æ”¶DNSå›å¤ï¼Œå¹¶æ˜¾ç¤ºç»“æœã€‚</p><p>ä¸Šé¢çš„å±å¹•æˆªå›¾æ˜¾ç¤ºäº†ä¸‰ä¸ªä¸åŒ<em>nslookup</em>å‘½ä»¤çš„ç»“æœï¼ˆæ˜¾ç¤ºåœ¨Windowså‘½ä»¤æç¤ºç¬¦ä¸­ï¼‰ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå®¢æˆ·ç«¯ä¸»æœºä½äºå¸ƒé²å…‹æ—ç†å·¥å¤§å­¦æ ¡å›­ï¼Œ<a href="http://xn--DNSdns-prime-1f5s760cplnk5cu61h2pa6538cej6c.poly.edu">é»˜è®¤æœ¬åœ°DNSæœåŠ¡å™¨ä¸ºdns-prime.poly.edu</a>ã€‚è¿è¡Œnslookupæ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šDNSæœåŠ¡å™¨ï¼Œåˆ™<em>nslookup</em>ä¼šå°†æŸ¥è¯¢å‘é€åˆ°é»˜è®¤çš„DNSæœåŠ¡å™¨ï¼ˆ<a href="http://xn--dnsprime-t39lfp892aj4qdp3agi7e3d7c.poly.edu">åœ¨è¿™ç§æƒ…å†µä¸‹ä¸ºdnsprime.poly.edu</a>ï¼‰ã€‚æ¥çœ‹ç¬¬ä¸€ä¸ªå‘½ä»¤ï¼š</p><p><code>nslookup www.mit.edu</code></p><p>è¯´è¿™ä¸ªå‘½ä»¤æ˜¯è¯´ï¼Œè¯·å‘Šè¯‰æˆ‘ä¸»æœº <a href="http://www.mit.edu">www.mit.edu</a> çš„IPåœ°å€ã€‚å¦‚å±å¹•æˆªå›¾æ‰€ç¤ºï¼Œæ­¤å‘½ä»¤çš„å“åº”æä¾›ä¸¤æ¡ä¿¡æ¯ï¼šï¼ˆ1ï¼‰æä¾›å“åº”çš„DNSæœåŠ¡å™¨çš„åç§°å’ŒIPåœ°å€ï¼›ï¼ˆ2ï¼‰å“åº”æœ¬èº«ï¼Œå³ <a href="http://www.mit.edu">www.mit.edu</a> çš„ä¸»æœºåå’ŒIPåœ°å€ã€‚è™½ç„¶å“åº”æ¥è‡ªç†å·¥å¤§å­¦çš„æœ¬åœ°DNSæœåŠ¡å™¨ï¼Œä½†æœ¬åœ°DNSæœåŠ¡å™¨å¾ˆå¯èƒ½ä¼šè¿­ä»£åœ°è”ç³»å…¶ä»–å‡ ä¸ªDNSæœåŠ¡å™¨æ¥è·å¾—ç»“æœï¼Œå¦‚ä¹¦ä¸­ç¬¬2.4èŠ‚æ‰€è¿°ã€‚</p><p>ç°åœ¨æ¥çœ‹ç¬¬äºŒä¸ªå‘½ä»¤ï¼š</p><p><code>nslookup -type=NS mit.edu</code></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†é€‰é¡¹&quot;-type=NS&quot;å’ŒåŸŸå&quot;<a href="http://mit.edu">mit.edu</a>&quot;ã€‚è¿™å°†ä½¿å¾—<em>nslookup</em>å°†NSè®°å½•å‘é€åˆ°é»˜è®¤çš„æœ¬åœ°DNSæœåŠ¡å™¨ã€‚æ¢å¥è¯è¯´ï¼Œâ€œè¯·ç»™æˆ‘å‘é€mit.eduçš„æƒå¨DNSçš„ä¸»æœºåâ€ ï¼ˆå½“ä¸ä½¿ç”¨-typeé€‰é¡¹æ—¶ï¼Œ<em>nslookup</em>ä½¿ç”¨é»˜è®¤å€¼ï¼Œå³æŸ¥è¯¢Aç±»è®°å½•ã€‚ï¼‰ä¸Šè¿°å±å¹•æˆªå›¾ä¸­ï¼Œé¦–å…ˆæ˜¾ç¤ºäº†æä¾›å“åº”çš„DNSæœåŠ¡å™¨ï¼ˆè¿™æ˜¯é»˜è®¤æœ¬åœ°DNSæœåŠ¡å™¨ï¼‰ä»¥åŠä¸‰ä¸ªMITåŸŸåæœåŠ¡å™¨ã€‚è¿™äº›æœåŠ¡å™¨ä¸­çš„æ¯ä¸€ä¸ªç¡®å®éƒ½æ˜¯éº»çœç†å·¥å­¦é™¢æ ¡å›­ä¸»æœºçš„æƒå¨DNSæœåŠ¡å™¨ã€‚ç„¶è€Œï¼Œ<em>nslookup</em>ä¹Ÿè¡¨æ˜è¯¥å“åº”æ˜¯éæƒå¨çš„ï¼Œè¿™æ„å‘³ç€è¿™ä¸ªå“åº”æ¥è‡ªæŸä¸ªæœåŠ¡å™¨çš„ç¼“å­˜ï¼Œè€Œä¸æ˜¯æ¥è‡ªæƒå¨MIT DNSæœåŠ¡å™¨ã€‚æœ€åï¼Œå“åº”ç»“æœè¿˜æ˜¾ç¤ºäº†éº»çœç†å·¥å­¦é™¢æƒå¨DNSæœåŠ¡å™¨çš„IPåœ°å€ã€‚ ï¼ˆå³ä½¿<em>nslookup</em>ç”Ÿæˆçš„NSç±»å‹æŸ¥è¯¢æ²¡æœ‰æ˜ç¡®è¦æ±‚IPåœ°å€ï¼Œæœ¬åœ°DNSæœåŠ¡å™¨ä¾ç„¶â€å…è´¹â€œè¿”å›äº†è¿™äº›ä¿¡æ¯ï¼Œç„¶åè¢«<em>nslookup</em>æ˜¾ç¤ºå‡ºæ¥ã€‚ï¼‰</p><p>æœ€åæ¥çœ‹ç¬¬ä¸‰ä¸ªå‘½ä»¤ï¼š</p><p><code>nslookup www.aiit.or.kr bitsy.mit.edu</code></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›å°†æŸ¥è¯¢è¯·æ±‚å‘é€åˆ°DNSæœåŠ¡å™¨ <a href="http://bitsy.mit.edu">bitsy.mit.edu</a> ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„DNSæœåŠ¡å™¨ï¼ˆ<a href="http://dns-prime.poly.edu">dns-prime.poly.edu</a>ï¼‰ã€‚å› æ­¤ï¼ŒæŸ¥è¯¢å’Œå“åº”äº‹åŠ¡ç›´æ¥å‘ç”Ÿåœ¨æˆ‘ä»¬çš„ä¸»æœºå’Œ <a href="http://bitsy.mit.edu">bitsy.mit.edu</a> ä¹‹é—´ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒDNSæœåŠ¡å™¨ <a href="http://bitsy.mit.edu">bitsy.mit.edu</a> æä¾›ä¸»æœº <a href="http://www.aiit.or.kr">www.aiit.or.kr</a> çš„IPåœ°å€ï¼Œå®ƒæ˜¯é«˜çº§ä¿¡æ¯æŠ€æœ¯ç ”ç©¶æ‰€ï¼ˆéŸ©å›½ï¼‰çš„WebæœåŠ¡å™¨ã€‚</p><p>ç°åœ¨æˆ‘ä»¬äº†è§£äº†ä¸€äº›ç¤ºä¾‹ï¼Œæ‚¨ç°åœ¨å¯èƒ½æƒ³çŸ¥é“<em>nslookup</em>å‘½ä»¤çš„ä¸€èˆ¬è¯­æ³•ã€‚è¯­æ³•æ˜¯ï¼š</p><p><code>nslookup -option1 -option2 host-to-find dns-server</code></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œ<em>nslookup</em>å¯ä»¥ä¸æ·»åŠ é€‰é¡¹ï¼Œæˆ–è€…æ·»åŠ ä¸€ä¸¤ä¸ªç”šè‡³æ›´å¤šé€‰é¡¹ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­çœ‹åˆ°çš„ï¼Œdns-serverä¹Ÿæ˜¯å¯é€‰çš„ï¼›å¦‚æœè¿™é¡¹æ²¡æœ‰æä¾›ï¼ŒæŸ¥è¯¢å°†å‘é€åˆ°é»˜è®¤çš„æœ¬åœ°DNSæœåŠ¡å™¨ã€‚</p><p>ç°åœ¨æˆ‘ä»¬æä¾›äº†æ€»è§ˆäº†<em>nslookup</em>ï¼Œç°åœ¨æ˜¯ä½ è‡ªå·±é©¾é©­å®ƒçš„æ—¶å€™äº†ã€‚æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼ˆå¹¶è®°ä¸‹ç»“æœï¼‰ï¼š</p><ol><li><p>è¿è¡Œ<em>nslookup</em>ä»¥è·å–ä¸€ä¸ªäºšæ´²çš„WebæœåŠ¡å™¨çš„IPåœ°å€ã€‚è¯¥æœåŠ¡å™¨çš„IPåœ°å€æ˜¯ä»€ä¹ˆï¼Ÿ</p><p><img src="image-20230421210837297.png" alt="image-20230421210837297" loading="lazy"></p><p>æŸ¥è¯¢äº†å“ˆå°”æ»¨ç†å·¥å¤§å­¦çš„ipåœ°å€, é€šè¿‡å¾—åˆ°çš„ä¿¡æ¯å¯ä»¥çŸ¥é“, è¯¥æœåŠ¡å™¨çš„IPåœ°å€ä¸º202.118.201.1</p><p>å¯ä»¥å‘ç°è¿™æ˜¯ä¸€ä¸ªæ¥è‡ªDNSæœåŠ¡å™¨182.254.116.116çš„åº”ç­”, æœç´¢å‘ç°, è¿™æ˜¯è…¾è®¯çš„å¤‡ç”¨åŸŸåæœåŠ¡å™¨.</p><p><img src="image-20230421210846142.png" alt="image-20230421210846142" loading="lazy"></p><p>ç»§ç»­æŸ¥è¯¢æƒå¨åå­—æœåŠ¡å™¨, å¾—åˆ°çš„æ˜¯éæƒå¨çš„, è¿™æ˜¯å› ä¸ºè…¾è®¯çš„DNSæœåŠ¡å™¨ä¸çŸ¥é“å“ˆå°”æ»¨ç†å·¥å¤§å­¦çš„æƒå¨åå­—æœåŠ¡å™¨, åªèƒ½å‘æ ¹DNSâ†’TLD(é¡¶çº§åŸŸDNS)(.cn)â†’edu.cnDNSâ†’hrbust.edu.cnDNS, è¿­ä»£æŸ¥è¯¢è·å¾—</p><p>å¦‚æœæˆ‘ä»¬ä¹‹é—´å¯¹è¿™ä¸ªDNSæœåŠ¡å™¨å‘èµ·DNSæŸ¥è¯¢:</p><p><img src="image-20230421210900650.png" alt="image-20230421210900650" loading="lazy"></p><p>å¯ä»¥å‘ç°, è¿™æ ·ä¸€æ¡æ¥è‡ªæƒå¨åå­—æœåŠ¡å™¨çš„åº”ç­”.</p></li><li><p>è¿è¡Œ<em>nslookup</em>æ¥ç¡®å®šä¸€ä¸ªæ¬§æ´²çš„å¤§å­¦çš„æƒå¨DNSæœåŠ¡å™¨ã€‚</p><p>æŸ¥è¯¢äº†è‹é»ä¸–è”é‚¦ç†å·¥å¤§å­¦çš„æƒå¨DNS</p></li></ol><p><img src="image-20230421210910755.png" alt="image-20230421210910755" loading="lazy"></p><p>å¯ä»¥å‘ç°æƒå¨åå­—æœåŠ¡å™¨ä¸º: <a href="http://ns1.ethz.ch">ns1.ethz.ch</a></p><ol><li>è¿è¡Œ<em>nslookup</em>ï¼Œä½¿ç”¨é—®é¢˜2ä¸­ä¸€ä¸ªå·²è·å¾—çš„DNSæœåŠ¡å™¨ï¼Œæ¥æŸ¥è¯¢Yahoo!é‚®ç®±çš„é‚®ä»¶æœåŠ¡å™¨ã€‚å®ƒçš„IPåœ°å€æ˜¯ä»€ä¹ˆï¼Ÿ</li></ol><p><img src="image-20230421210921960.png" alt="image-20230421210921960" loading="lazy"></p><p>æŸ¥ä¸åˆ°å¥½å§â€¦äººå®¶æ˜¯å¤§å­¦çš„æƒå¨DNS, æ²¡æœ‰é›…è™çš„é‚®ä»¶æœåŠ¡å™¨åœ°å€, åªç»´æŠ¤äº†å¤§å­¦çš„IPåœ°å€æŸ¥è¯¢, ä¸å½“ç„¶å…¬å…±DNSçš„æŒ‡è´£, å³ä¸å»è¿­ä»£çš„æŸ¥è¯¢(ä¸ªäººçŒœæµ‹)</p><p>åˆåˆ°äº†é—®èªæ˜çš„chatGPTçš„æ—¶é—´äº†:</p><p><img src="image-20230421211212041.png" alt="image-20230421211212041" loading="lazy"></p><p><img src="image-20230421210930573.png" alt="image-20230421210930573" loading="lazy"></p><p>ä½¿ç”¨è…¾è®¯çš„å…¬å…±DNSæœåŠ¡å™¨æˆ‘ä»¬å¯ä»¥å¾—åˆ°Yahooçš„é‚®ä»¶æœåŠ¡å™¨åœ°å€.</p><p>åŒæ—¶ä¸ºå‘ç°æŸ¥è¯¢<code>www.mail.yahoo.com</code>å’Œmail.yahoo.comçš„ç»“æœä¸åŒ</p><p><img src="image-20230421211245869.png" alt="image-20230421211245869" loading="lazy"></p><p>æŸ¥è¯¢chatGPTå¾—åˆ°ä»¥ä¸‹å›å¤:</p><p><img src="image-20230421211255078.png" alt="image-20230421211255078" loading="lazy"></p><h3 id="2-ipconfig">2. ipconfig</h3><p><em>ipconfig</em>ï¼ˆå¯¹äºWindowsï¼‰å’Œ<em>ifconfig</em>ï¼ˆå¯¹äºLinux / Unixï¼‰æ˜¯ä¸»æœºä¸­æœ€å®ç”¨çš„ç¨‹åºï¼Œå°¤å…¶æ˜¯ç”¨äºè°ƒè¯•ç½‘ç»œé—®é¢˜æ—¶ã€‚è¿™é‡Œæˆ‘ä»¬åªè®¨è®º<em>ipconfig</em>ï¼Œå°½ç®¡Linux / Unixçš„<em>ifconfig</em>ä¸å…¶éå¸¸ç›¸ä¼¼ã€‚ <em>ipconfig</em>å¯ç”¨äºæ˜¾ç¤ºæ‚¨å½“å‰çš„TCP/IPä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‚¨çš„åœ°å€ï¼ŒDNSæœåŠ¡å™¨åœ°å€ï¼Œé€‚é…å™¨ç±»å‹ç­‰ã€‚ä¾‹å¦‚ï¼Œæ‚¨åªéœ€è¿›å…¥å‘½ä»¤æç¤ºç¬¦ï¼Œè¾“å…¥</p><p><code>ipconfig /all</code></p><p><em>ipconfig</em>å¯¹äºç®¡ç†ä¸»æœºä¸­å­˜å‚¨çš„DNSä¿¡æ¯ä¹Ÿéå¸¸æœ‰ç”¨ã€‚åœ¨ç¬¬2.5èŠ‚ä¸­ï¼Œæˆ‘ä»¬äº†è§£åˆ°ä¸»æœºå¯ä»¥ç¼“å­˜æœ€è¿‘è·å¾—çš„DNSè®°å½•ã€‚è¦æŸ¥çœ‹è¿™äº›ç¼“å­˜è®°å½•ï¼Œåœ¨ C:\&gt; æç¤ºç¬¦åè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p><p><code>ipconfig /displaydns</code></p><p>æ¯ä¸ªæ¡ç›®æ˜¾ç¤ºå‰©ä½™çš„ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰ï¼ˆç§’ï¼‰ã€‚è¦æ¸…é™¤ç¼“å­˜ï¼Œè¯·è¾“å…¥</p><p><code>ipconfig /flushdns</code></p><p>æ¸…é™¤äº†æ‰€æœ‰æ¡ç›®å¹¶ä»hostsæ–‡ä»¶é‡æ–°åŠ è½½æ¡ç›®ã€‚</p><h3 id="3-ä½¿ç”¨Wiresharkè¿½è¸ªDNS">3. ä½¿ç”¨Wiresharkè¿½è¸ªDNS</h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰<code>nslookup</code>å’Œ<code>ipconfig</code>ï¼Œæˆ‘ä»¬å‡†å¤‡å¥½äº†ä¸€äº›æ­£ç»çš„äº‹æƒ…ã€‚é¦–å…ˆè®©æˆ‘ä»¬æ•è·ä¸€äº›ç”±å¸¸è§„ä¸Šç½‘æ´»åŠ¨ç”Ÿæˆçš„DNSæ•°æ®åŒ…ã€‚</p><ul><li>ä½¿ç”¨<em>ipconfig</em>æ¸…ç©ºä¸»æœºä¸­çš„DNSç¼“å­˜ã€‚</li><li>æ‰“å¼€æµè§ˆå™¨å¹¶æ¸…ç©ºæµè§ˆå™¨ç¼“å­˜ã€‚ ï¼ˆè‹¥ä½¿ç”¨Internet Explorerï¼Œè½¬åˆ°<strong>å·¥å…·</strong>èœå•å¹¶é€‰æ‹©<strong>Interneté€‰é¡¹</strong>ï¼›ç„¶ååœ¨<strong>å¸¸è§„</strong>é€‰é¡¹å¡ä¸­é€‰æ‹©åˆ é™¤æ–‡ä»¶ã€‚ï¼‰</li><li>æ‰“å¼€Wiresharkï¼Œç„¶ååœ¨è¿‡æ»¤å™¨ä¸­è¾“å…¥â€œip.addr==your_IP_addressâ€ï¼Œæ‚¨å¯ä»¥å…ˆä½¿ç”¨<em>ipconfig</em>è·å–ä½ çš„IPåœ°å€ã€‚æ­¤è¿‡æ»¤å™¨å°†åˆ é™¤æ—¢ä»ä½ ä¸»æœºä¸å‘å‡ºä¹Ÿä¸å‘å¾€ä½ ä¸»æœºçš„æ‰€æœ‰æ•°æ®åŒ…ã€‚</li><li>åœ¨Wiresharkä¸­å¯åŠ¨æ•°æ®åŒ…æ•è·ã€‚</li><li>ä½¿ç”¨æµè§ˆå™¨è®¿é—®ç½‘é¡µï¼š <a href="http://www.ietf.org">http://www.ietf.org</a></li><li>åœæ­¢æ•°æ®åŒ…æ•è·ã€‚</li></ul><p>å¦‚æœæ‚¨æ— æ³•åœ¨ä½ çš„ç½‘ç»œè¿æ¥ä¸Šè¿è¡ŒWiresharkï¼Œåˆ™å¯ä»¥ä¸‹è½½ä¸€ä¸ªæ•è·äº†æ•°æ®åŒ…çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯æœ¬ä¹¦ä½œè€…åœ¨è‡ªå·±è®¡ç®—æœºä¸Š æŒ‰ç…§ä¸Šè¿°æ­¥éª¤æ•è·çš„ï¼ˆåŸæ–‡æ³¨ï¼šDownload the zip file <a href="http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip">http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip</a> and extract the file dnsethereal-trace-1. The traces in this zip file were collected by Wireshark running on one of the authorâ€™s computers, while performing the steps indicated in the Wireshark lab. Once you have downloaded the trace, you can load it into Wireshark and view the trace using the File pull down menu, choosing Open, and then selecting the dns-ethereal-trace-1 trace file. ï¼‰ã€‚å›ç­”ä¸‹åˆ—é—®é¢˜ã€‚æ‚¨åº”è¯¥åœ¨è§£ç­”ä¸­å°½å¯èƒ½å±•ç¤ºä½ ä½¿ç”¨äº†å“ªäº›ä½ æ•è·åˆ°çš„æ•°æ®åŒ…ï¼Œå¹¶æ³¨é‡Šå‡ºæ¥ï¼ˆåŸæ–‡æ³¨ï¼šWhat do we mean by â€œannotateâ€? If you hand in a paper copy, please highlight where in the printout youâ€™ve found the answer and add some text (preferably with a colored pen) noting what you found in what you â€˜ve highlight. If you hand in an electronic copy, it would be great if you could also highlight and annotate. ï¼‰ã€‚è‹¥è¦æ‰“å°æ•°æ®åŒ…ï¼Œè¯·ä½¿ç”¨<em>æ–‡ä»¶</em>-&gt;<em>æ‰“å°</em>ï¼Œåªå‹¾é€‰<em>ä»…é€‰ä¸­åˆ†ç»„</em>ï¼Œå’Œ<em>æ¦‚è¦è¡Œ</em>ï¼Œå¹¶é€‰ä¸­ä½ æ‰€éœ€è¦ç”¨äºè§£ç­”é—®é¢˜çš„æ•°æ®åŒ…ã€‚</p><ol start="4"><li><p>æ‰¾åˆ°DNSæŸ¥è¯¢å’Œå“åº”æ¶ˆæ¯ã€‚å®ƒä»¬æ˜¯å¦é€šè¿‡UDPæˆ–TCPå‘é€ï¼Ÿ</p><p><img src="image-20230421211313407.png" alt="image-20230421211313407" loading="lazy"></p><p>é€šè¿‡UDPå‘é€</p></li><li><p>DNSæŸ¥è¯¢æ¶ˆæ¯çš„ç›®æ ‡ç«¯å£æ˜¯ä»€ä¹ˆï¼Ÿ DNSå“åº”æ¶ˆæ¯çš„æºç«¯å£æ˜¯ä»€ä¹ˆï¼Ÿ</p><p><img src="image-20230421211321920.png" alt="image-20230421211321920" loading="lazy"></p><p>ç›®æ ‡ç«¯å£é€šè¿‡ä¸Šä¸€é—®çš„å›¾ç‰‡å¯ä»¥å¾—åˆ°ä¸º: 53, å“åº”DNSåˆ°æºç«¯å£ä¹Ÿæ˜¯53</p></li><li><p>DNSæŸ¥è¯¢æ¶ˆæ¯å‘é€åˆ°å“ªä¸ªIPåœ°å€ï¼Ÿä½¿ç”¨ipconfigæ¥ç¡®å®šæœ¬åœ°DNSæœåŠ¡å™¨çš„IPåœ°å€ã€‚è¿™ä¸¤ä¸ªIPåœ°å€æ˜¯å¦ç›¸åŒï¼Ÿ</p><p>æœ¬åœ°IP åœ°å€: 10.51.172.226</p><p>DNSæœåŠ¡å™¨IPåœ°å€: 182.254.116.116</p><p>ç›¸åŒ</p><p><img src="image-20230421211341608.png" alt="image-20230421211341608" loading="lazy"></p></li><li><p>æ£€æŸ¥DNSæŸ¥è¯¢æ¶ˆæ¯ã€‚DNSæŸ¥è¯¢æ˜¯ä»€ä¹ˆ&quot;Type&quot;çš„ï¼ŸæŸ¥è¯¢æ¶ˆæ¯æ˜¯å¦åŒ…å«ä»»ä½•&quot;answers&quot;ï¼Ÿ</p><p><img src="image-20230421211351099.png" alt="image-20230421211351099" loading="lazy"></p><p>TYPE: A</p><p>ä¸åŒ…å«</p></li><li><p>æ£€æŸ¥DNSå“åº”æ¶ˆæ¯ã€‚æä¾›äº†å¤šå°‘ä¸ª&quot;answers&quot;ï¼Ÿè¿™äº›ç­”æ¡ˆå…·ä½“åŒ…å«ä»€ä¹ˆï¼Ÿ</p><p><img src="image-20230421211359997.png" alt="image-20230421211359997" loading="lazy"></p><p>ä¸‰ä¸ªanswer</p><p>ç¬¬ä¸€ä¸ªanswer: TYPE CNAME, ä¸»æœºåˆ«ååˆ°è§„èŒƒä¸»æœºåçš„å¯¹åº”å…³ç³»</p><p><img src="image-20230421211409785.png" alt="image-20230421211409785" loading="lazy"></p><p>åŒ…å«NAME(åŸŸå),TYPE, Class, TTL, Data. CNAME(è§„èŒƒä¸»æœºå)</p><p>ç¬¬äºŒä¸ªanswer: TYPE A, åŸŸåå’ŒIPåœ°å€</p><p><img src="image-20230421211422241.png" alt="image-20230421211422241" loading="lazy"></p><p>å¾—åˆ°äº†è§„èŒƒä¸»æœºåçš„IPåœ°å€</p><p>ç¬¬ä¸‰ä¸ªanswer:</p><p><img src="image-20230421211431684.png" alt="image-20230421211431684" loading="lazy"></p><p>å¦ä¸€ä¸ªè§„èŒƒä¸»æœºåçš„IPåœ°å€</p></li><li><p>è€ƒè™‘ä»æ‚¨ä¸»æœºå‘é€çš„åç»­TCP SYNæ•°æ®åŒ…ã€‚ SYNæ•°æ®åŒ…çš„ç›®çš„IPåœ°å€æ˜¯å¦ä¸DNSå“åº”æ¶ˆæ¯ä¸­æä¾›çš„ä»»ä½•IPåœ°å€ç›¸å¯¹åº”ï¼Ÿ</p><p>ç›´æ¥è¿‡æ»¤ip.addr==104.16.44.99</p><p>ç»“æœå¦‚ä¸‹:</p><p><img src="image-20230421211445058.png" alt="image-20230421211445058" loading="lazy"></p><p>å¯ä»¥å‘ç°æˆ‘çš„ä¸»æœºå‘è¿™ä¸ªIPåœ°å€å‘èµ·äº†TCPçš„é“¾æ¥è¯·æ±‚</p></li><li><p>è¿™ä¸ªç½‘é¡µåŒ…å«ä¸€äº›å›¾ç‰‡ã€‚åœ¨è·å–æ¯ä¸ªå›¾ç‰‡å‰ï¼Œæ‚¨çš„ä¸»æœºæ˜¯å¦éƒ½å‘å‡ºäº†æ–°çš„DNSæŸ¥è¯¢ï¼Ÿ</p><p><img src="image-20230421211456062.png" alt="image-20230421211456062" loading="lazy"></p><p>æœ‰ä¸€ä¸ªå¯¹r3.o.lencr.orgçš„DNSæŸ¥è¯¢, æœç´¢å‘ç°è¿™æ˜¯ä¸€ä¸ªæ¶æ„çš„è½¯ä»¶å‘èµ·çš„, ç›®çš„æ˜¯ç»™æµè§ˆå™¨å¸¦æ¥å¹¿å‘Š(æœäº†â€¦)</p><p><img src="image-20230421211504325.png" alt="image-20230421211504325" loading="lazy"></p></li></ol><p>ç°åœ¨è®©æˆ‘ä»¬ç©ç©<em>nslookup</em>ï¼ˆåŸæ–‡æ³¨ï¼šIf you are unable to run Wireshark and capture a trace file, use the trace file dns-ethereal-trace-2 in the zip file <a href="http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip">http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip</a>  ï¼‰ã€‚</p><ul><li>å¯åŠ¨æ•°æ®åŒ…æ•è·ã€‚</li><li>ä½¿ç”¨nslookupæŸ¥è¯¢ <a href="http://www.mit.edu">www.mit.edu</a></li><li>åœæ­¢æ•°æ®åŒ…æ•è·ã€‚</li></ul><p>æˆ‘ä»¬ä»ä¸Šé¢çš„å±å¹•æˆªå›¾çœ‹åˆ°ï¼Œ<em>nslookup</em>å®é™…ä¸Šå‘é€äº†ä¸‰ä¸ªDNSæŸ¥è¯¢ï¼Œå¹¶æ”¶åˆ°äº†ä¸‰ä¸ªDNSå“åº”ã€‚åªè€ƒè™‘æœ¬æ¬¡å®éªŒç›¸å…³ç»“æœï¼Œåœ¨å›ç­”ä»¥ä¸‹é—®é¢˜æ—¶ï¼Œè¯·å¿½ç•¥å‰ä¸¤ç»„æŸ¥è¯¢/å“åº”ï¼Œå› ä¸º<em>nslookup</em>çš„ä¸€äº›ç‰¹æ®Šæ€§ï¼Œè¿™äº›æŸ¥è¯¢é€šå¸¸ä¸æ˜¯ç”±æ ‡å‡†ç½‘ç»œåº”ç”¨ç¨‹åºç”Ÿæˆçš„ã€‚æ‚¨åº”è¯¥ä¸“æ³¨äºæœ€åä¸€ä¸ªæŸ¥è¯¢å’Œå“åº”æ¶ˆæ¯ã€‚</p><ol start="11"><li><p>DNSæŸ¥è¯¢æ¶ˆæ¯çš„ç›®æ ‡ç«¯å£æ˜¯ä»€ä¹ˆï¼Ÿ DNSå“åº”æ¶ˆæ¯çš„æºç«¯å£æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>æŸ¥è¯¢:</p><p><img src="image-20230421211516046.png" alt="image-20230421211516046" loading="lazy"></p><p>å“åº”:</p><p><img src="image-20230421211522148.png" alt="image-20230421211522148" loading="lazy"></p></li><li><p>DNSæŸ¥è¯¢æ¶ˆæ¯çš„ç›®æ ‡IPåœ°å€æ˜¯ä»€ä¹ˆï¼Ÿè¿™æ˜¯ä½ çš„é»˜è®¤æœ¬åœ°DNSæœåŠ¡å™¨çš„IPåœ°å€å—ï¼Ÿ</p><p>æ˜¯çš„</p><p><img src="image-20230421211532903.png" alt="image-20230421211532903" loading="lazy"></p></li><li><p>æ£€æŸ¥DNSæŸ¥è¯¢æ¶ˆæ¯ã€‚DNSæŸ¥è¯¢æ˜¯ä»€ä¹ˆ&quot;Type&quot;çš„ï¼ŸæŸ¥è¯¢æ¶ˆæ¯æ˜¯å¦åŒ…å«ä»»ä½•&quot;answers&quot;ï¼Ÿ</p></li><li><p>TYPE A, ä¸åŒ…å«</p><p><img src="image-20230421211545749.png" alt="image-20230421211545749" loading="lazy"></p></li><li><p>æ£€æŸ¥DNSå“åº”æ¶ˆæ¯ã€‚æä¾›äº†å¤šå°‘ä¸ª&quot;answers&quot;ï¼Ÿè¿™äº›ç­”æ¡ˆåŒ…å«ä»€ä¹ˆï¼Ÿ</p><p>ä¸‰ä¸ª</p><p><img src="image-20230421211557865.png" alt="image-20230421211557865" loading="lazy"></p><p>åŒ…å«ä¸»æœºåˆ«ååˆ°è§„èŒƒä¸»æœºåçš„è½¬åŒ–å…³ç³»(TYPE:CNAME)</p><p>è§„èŒƒä¸»æœºååˆ°IPåœ°å€åˆ°è½¬æ¢å…³ç³»</p></li></ol><p>ç°åœ¨é‡å¤ä¸Šä¸€ä¸ªå®éªŒï¼Œä½†æ¢æˆä»¥ä¸‹å‘½ä»¤ï¼š</p><p><code>nslookup -type=NS mit.edu</code></p><p>å›ç­”ä¸‹åˆ—é—®é¢˜ï¼š</p><ol start="16"><li><p>DNSæŸ¥è¯¢æ¶ˆæ¯å‘é€åˆ°çš„IPåœ°å€æ˜¯ä»€ä¹ˆï¼Ÿè¿™æ˜¯æ‚¨çš„é»˜è®¤æœ¬åœ°DNSæœåŠ¡å™¨çš„IPåœ°å€å—ï¼Ÿ</p><p>æ˜¯çš„</p><p><img src="image-20230421211610171.png" alt="image-20230421211610171" loading="lazy"></p></li><li><p>æ£€æŸ¥DNSæŸ¥è¯¢æ¶ˆæ¯ã€‚DNSæŸ¥è¯¢æ˜¯ä»€ä¹ˆ&quot;Type&quot;çš„ï¼ŸæŸ¥è¯¢æ¶ˆæ¯æ˜¯å¦åŒ…å«ä»»ä½•&quot;answers&quot;ï¼Ÿ</p><p><img src="image-20230421211621477.png" alt="image-20230421211621477" loading="lazy"></p><p>Type: NS</p><p>ä¸åŒ…å«</p></li><li><p>æ£€æŸ¥DNSå“åº”æ¶ˆæ¯ã€‚å“åº”æ¶ˆæ¯æä¾›çš„MITåŸŸåæœåŠ¡å™¨æ˜¯ä»€ä¹ˆï¼Ÿæ­¤å“åº”æ¶ˆæ¯è¿˜æä¾›äº†MITåŸŸåæœåŠ¡å™¨çš„IPåœ°å€å—ï¼Ÿ</p><p>![image-20230416184356921](/Users/trevorwu/Library/Application Support/typora-user-images/image-20230416184356921.png)</p></li></ol><p>ç°åœ¨é‡å¤ä¸Šä¸€ä¸ªå®éªŒï¼Œä½†æ¢æˆä»¥ä¸‹å‘½ä»¤ï¼š</p><p><code>nslookup www.aiit.or.kr bitsy.mit.edu</code></p><p><strong>è¯¥DNSæœåŠ¡å™¨å·²åœç”¨</strong>, ä½¿ç”¨ä½œè€…æä¾›çš„æŠ“åŒ…ç»“æœdns-ethereal-trace-4</p><p>å›ç­”ä¸‹åˆ—é—®é¢˜ï¼š</p><ol start="20"><li><p>DNSæŸ¥è¯¢æ¶ˆæ¯å‘é€åˆ°çš„IPåœ°å€æ˜¯ä»€ä¹ˆï¼Ÿè¿™æ˜¯æ‚¨çš„é»˜è®¤æœ¬åœ°DNSæœåŠ¡å™¨çš„IPåœ°å€å—ï¼Ÿå¦‚æœä¸æ˜¯ï¼Œè¿™ä¸ªIPåœ°å€æ˜¯ä»€ä¹ˆï¼Ÿ</p><p><img src="image-20230421211639835.png" alt="image-20230421211639835" loading="lazy"></p><p>ç†è®ºä¸Šä¸æ˜¯, å› ä¸ºå·²ç»æŒ‡å®šäº†å¯¹åº”çš„DNSæœåŠ¡å™¨,ç›®æ ‡IPåœ°å€åº”è¯¥æ˜¯DNSæœåŠ¡å™¨åå­—<code>bitsy.mit.edu</code> çš„IPåœ°å€</p></li><li><p>æ£€æŸ¥DNSæŸ¥è¯¢æ¶ˆæ¯ã€‚DNSæŸ¥è¯¢æ˜¯ä»€ä¹ˆ&quot;Type&quot;çš„ï¼ŸæŸ¥è¯¢æ¶ˆæ¯æ˜¯å¦åŒ…å«ä»»ä½•&quot;answers&quot;ï¼Ÿ</p><p>ç¬¬ä¸€ä¸ªæŸ¥è¯¢:</p><p><img src="image-20230421211649155.png" alt="image-20230421211649155" loading="lazy"></p><p>TYPE: PTR é€šè¿‡IPåå‘æŸ¥è¯¢åŸŸå</p><p>ç¬¬äºŒä¸ªæŸ¥è¯¢: TYPE A, æŸ¥è¯¢<code>www.aiit.or.kr.poly.edu</code>çš„IPåœ°å€, ç›®æ ‡IPåœ°å€æ˜¯18.72.0.3</p><p><img src="image-20230421211656347.png" alt="image-20230421211656347" loading="lazy"></p><p>ç¬¬ä¸‰ä¸ªæŸ¥è¯¢: TYPE A, æŸ¥è¯¢<code>www.aiit.or.kr</code>çš„IPåœ°å€, ç›®æ ‡IPå’Œä¸Šä¸€ä¸ªæŸ¥è¯¢ç›¸åŒ.</p><p><img src="image-20230421211702635.png" alt="image-20230421211702635" loading="lazy"></p></li><li><p>æ£€æŸ¥DNSå“åº”æ¶ˆæ¯ã€‚æä¾›äº†å¤šå°‘ä¸ª&quot;answers&quot;ï¼Ÿè¿™äº›ç­”æ¡ˆåŒ…å«ä»€ä¹ˆï¼Ÿ</p><p>ç¬¬ä¸€ä¸ªå“åº”: æä¾›äº†ä¸€ä¸ªanswer</p><p><img src="image-20230421211713117.png" alt="image-20230421211713117" loading="lazy"></p><p>TYPE:PTR</p><p>å›ç­”é‡ŒåŒ…å«IPåœ°å€3.0.72.18å¯¹åº”çš„åŸŸå</p><p>ç¬¬äºŒä¸ªå“åº”:</p><p><img src="image-20230421211730365.png" alt="image-20230421211730365" loading="lazy"></p><p>TYPE: SOA(Start Of a zone of Authority)</p><p><img src="image-20230421211748643.png" alt="image-20230421211748643" loading="lazy"></p><p>å“åº”ç»“æœä¸ºæ‰¾ä¸åˆ°:</p><p>ç¬¬ä¸‰ä¸ªå“åº”:</p><p><img src="image-20230421211757311.png" alt="image-20230421211757311" loading="lazy"></p><p>ansewerä¸ºç›®æ ‡åŸŸåçš„IPåœ°å€.</p></li></ol>]]></content>
    
    
    <summary type="html">åŸŸåç³»ç»Ÿ(DNS)å°†ä¸»æœºåè½¬æ¢ä¸ºIPåœ°å€ï¼Œåœ¨äº’è”ç½‘åŸºç¡€æ¶æ„ä¸­å‘æŒ¥å…³é”®ä½œç”¨ã€‚åœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†ä»”ç»†æŸ¥çœ‹DNSåœ¨å®¢æˆ·ç«¯çš„ç»†èŠ‚ã€‚å›æƒ³ä¸€ä¸‹ï¼Œå®¢æˆ·ç«¯åœ¨DNSä¸­çš„è§’è‰²ç›¸å¯¹ç®€å•â€”â€”å®¢æˆ·ç«¯å‘å…¶æœ¬åœ°DNSæœåŠ¡å™¨å‘é€*è¯·æ±‚*ï¼Œå¹¶æ¥æ”¶ä¸€ä¸ª*å“åº”*ã€‚å¦‚ä¹¦ä¸­çš„å›¾2.21å’Œ2.22æ‰€ç¤ºï¼Œç”±äºDNSåˆ†å±‚æœåŠ¡å™¨ä¹‹é—´ç›¸äº’é€šä¿¡ï¼Œå¯ä»¥é€’å½’åœ°æˆ–è¿­ä»£åœ°è§£æå®¢æˆ·ç«¯çš„DNSæŸ¥è¯¢è¯·æ±‚ï¼Œè€Œå¤§å¤šæ•°æ“ä½œæ˜¯ä¸å¯è§çš„ã€‚ç„¶è€Œï¼Œä»DNSå®¢æˆ·ç«¯çš„è§’åº¦æ¥çœ‹ï¼Œåè®®éå¸¸ç®€ â€”â€”å°†æŸ¥è¯¢æŒ‡å‘ä¸ºæœ¬åœ°DNSæœåŠ¡å™¨ï¼Œå¹¶ä»è¯¥æœåŠ¡å™¨æ¥æ”¶åˆ°å“åº”</summary>
    
    
    
    <category term="å­¦ä¹ " scheme="https://trevoewu.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="computer cetwork" scheme="https://trevoewu.github.io/tags/computer-cetwork/"/>
    
  </entry>
  
  <entry>
    <title>Wireshark Lab: TCP</title>
    <link href="https://trevoewu.github.io/2023/04/21/Wireshark-Lab-TCP/"/>
    <id>https://trevoewu.github.io/2023/04/21/Wireshark-Lab-TCP/</id>
    <published>2023-04-21T12:48:28.000Z</published>
    <updated>2023-04-21T13:04:35.920Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ç ”ç©¶è‘—åçš„ TCP åè®®çš„è¡Œä¸ºã€‚ æˆ‘ä»¬å°†é€šè¿‡ä»æ‚¨çš„ç”µè„‘å‘ è¿œç¨‹æœåŠ¡å™¨ä¼ è¾“ä¸€ä»½ 150KB çš„æ–‡ä»¶(ä¸€ä»½ Lewis Carrol çš„â€œçˆ±ä¸½ä¸æ¢¦æ¸¸ä»™å¢ƒâ€æ–‡æœ¬)ï¼Œå¹¶åˆ†æ TCP ä¼ è¾“å†…å®¹çš„å‘é€å’Œæ¥æ”¶è¿‡ç¨‹æ¥å®ç°ã€‚ æˆ‘ä»¬å°†ç ”ç©¶ TCP å¯¹åºåˆ—å’Œ ç¡®è®¤å·çš„ä½¿ç”¨ï¼Œä»¥æä¾›å¯é çš„æ•°æ®ä¼ è¾“;æˆ‘ä»¬å°†çœ‹åˆ° TCP çš„æ‹¥å¡æ§åˆ¶ç®—æ³• â€“ æ…¢å¯ åŠ¨å’Œæ‹¥å¡é¿å… â€“ åœ¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹ TCP çš„æ¥æ”¶å™¨å‘é€æµé‡æ§åˆ¶çš„æœºåˆ¶ã€‚ æˆ‘ä»¬è¿˜å°†ç®€è¦åœ°è§‚å¯Ÿ TCP è¿çº¿çš„è®¾ç½®ï¼Œæˆ‘ä»¬è¿˜ä¼šç ”ç©¶è®¡ç®—æœºå’ŒæœåŠ¡å™¨ä¹‹é—´ TCP è¿çº¿çš„æ€§èƒ½(ååé‡å’Œå¾€è¿”æ—¶é—´)ã€‚</p></blockquote><h2 id="A-first-look-at-the-captured-trace">A first look at the captured trace</h2><ul><li><p>å°†æ–‡ä»¶ä¼ è¾“åˆ° <a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> çš„å®¢æˆ·ç«¯è®¡ç®—æœºä½¿ç”¨çš„ IP åœ°å€å’Œ TCP ç«¯å£å·æ˜¯ä»€ä¹ˆ?</p></li><li><p><a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> çš„ IP åœ°å€æ˜¯ä»€ä¹ˆ? åœ¨å“ªä¸ªç«¯å£å·ä¸Šå‘é€å’Œæ¥æ”¶æ­¤è¿æ¥çš„ TCP æ®µ?</p></li></ul><p><img src="image-20230421205628132.png" alt="image-20230421205628132" loading="lazy"></p><p>Client IP Addressee: 10.51.172.226 Client Port: 61084<br><a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> IP Address: 128.119.245.12</p><ul><li>å®¢æˆ·ç«¯è®¡ç®—æœºå°†æ–‡ä»¶ä¼ è¾“åˆ° <a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> æ‰€ä½¿ç”¨çš„ IP åœ°å€å’Œ TCP ç«¯å£å·æ˜¯å¤šå°‘?</li></ul><p><img src="image-20230421205643562.png" alt="image-20230421205643562" loading="lazy"></p><p>Client IP Addressee: 10.51.172.226 Client Port: 61084</p><ul><li>ç”¨äºåœ¨å®¢æˆ·ç«¯è®¡ç®—æœºå’Œ <a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> ä¹‹é—´å¯åŠ¨ TCP è¿æ¥çš„ TCP SYN æ®µçš„åºåˆ—å·æ˜¯ä»€ä¹ˆ? æ ‡è¯†ä¸º SYN æ®µçš„æ®µæœ‰ä»€ä¹ˆåŠŸèƒ½?</li></ul><p><img src="image-20230421205702461.png" alt="image-20230421205702461" loading="lazy"></p><p>å¦‚å›¾, SYNåºåˆ—å·ä¸º<code>4095602682</code>, æ ‡è¯†ä¸ºSYNçš„segmentç”¨äºå»ºç«‹TCPé“¾æ¥</p><ul><li><a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> å‘é€ç»™å®¢æˆ·ç«¯è®¡ç®—æœºä»¥å›å¤ SYN çš„ SYNACK æ®µçš„åºåˆ—å·æ˜¯å¤šå°‘?</li></ul><p><code>2017202044</code></p><p><img src="image-20230421205716096.png" alt="image-20230421205716096" loading="lazy"></p><p>SYNACK æ®µä¸­çš„ Acknowledgment æ ä½çš„å€¼æ˜¯å¤šå°‘?</p><p>ä¸º<code>4095602683</code></p><p><img src="image-20230421205729437.png" alt="image-20230421205729437" loading="lazy"></p><p><strong>è§‚å¯Ÿåˆ°é™¤äº† SYN æ ‡å¿—ä½ï¼ŒACK(Acknoledment)æ ‡å¿—ä½ä¹Ÿè®¾ 1ï¼Œæ„æ€æœåŠ¡å™¨æ¥æ”¶åˆ°æˆ‘çº¦è¿æŒ‰è¯·æ±‚å¹¶ä¸”å‘ SYN-ACIK ç¡®è®¤ï¼Œè¿™æ˜¯ä¸‰æ¬¡æ¡æ‰‹çš„ç¬¬äºŒæ­¥ã€‚</strong></p><p><a href="http://Gaia.cs.umass.edu">Gaia.cs.umass.edu</a> æ˜¯å¦‚ä½•ç¡®å®šæ­¤ Acknowledgment çš„æ•°å€¼çš„?</p><p>æ”¶åˆ°çš„$$seqence number + Len.$$</p><p>åœ¨å°†æ®µæ ‡è¯† ä¸º SYNACK æ®µçš„æ®µåœ¨è¿çº¿ä¸­æœ‰ä»€ä¹ˆåŠŸèƒ½?</p><p><img src="image-20230421205757558.png" alt="image-20230421205757558" loading="lazy"></p><p><strong>ç”¨äºå»ºç«‹é“¾æ¥, æ˜¯ä¸‰æ¬¡æ¡æ‰‹çš„ç¬¬äºŒæ¬¡, è¡¨ç¤ºåŒæ ·è¿æ¥è¯·æ±‚</strong></p><ul><li>åŒ…å« HTTP POST å‘½ä»¤çš„ TCP åŒºæ®µçš„åºåˆ—å·æ˜¯å¤šå°‘?</li></ul><p><img src="image-20230421205811084.png" alt="image-20230421205811084" loading="lazy"></p><p>å¦‚å›¾ä¸º<code>4095602683</code>,TCP PSH å­—æ®µè®¾ä¸º1è¡¨ç¤ºè¦ä¼ é€æ•°æ®.  HTTPçš„POSTæ–¹æ³•å€ŸåŠ©äºTCPæä¾›çš„æœåŠ¡å®ç°, åœ¨TCPä¸­è¡¨ç°ä¸ºTCPçš„PUSHå­—æ®µè®¾ä¸º1.</p><ul><li>å°†åŒ…å« HTTP POST çš„ TCP åŒºæ®µè§†ä¸º TCP è¿æ¥ä¸­çš„ç¬¬ä¸€ä¸ªåŒºæ®µã€‚åœ¨è¿™ä¸ª TCP è¿çº¿ä¸­å‰å…­ä¸ª TCP åŒºæ®µçš„åºåˆ—å·æ˜¯ä»€ä¹ˆ(åŒ…æ‹¬åŒ…å« HTTP POSTçš„æ®µ æ¯åŒºæ®µå‘é€çš„æ—¶é—´æ˜¯ä»€ä¹ˆæ—¶å€™? æ”¶åˆ°çš„æ¯ä¸ªåŒºæ®µçš„ ACK æ˜¯ä»€ä¹ˆæ—¶å€™?</li></ul><p>é‰´äºå‘é€æ¯ä¸ª TCP åŒºæ®µçš„æ—¶é—´ä¸æ”¶åˆ°ç¡®è®¤çš„æ—¶é—´ä¹‹é—´çš„å·®å¼‚ï¼Œå…­ä¸ªåŒºæ®µä¸­æ¯ä¸ªåŒºæ®µçš„ RTT å€¼æ˜¯å¤šå°‘?</p><p>å¦‚å›¾æ˜¯å‰6æ®µçš„ä¿¡æ¯:</p><p><img src="image-20230421205823688.png" alt="image-20230421205823688" loading="lazy"></p><h3 id="ç¬¬ä¸€æ®µFrame1">ç¬¬ä¸€æ®µFrame1:</h3><p>(å‘é€ç¬¬ä¸€ä¸ªframe,åœ¨ Wiresharkä¸­åºå·ä¸ºframe69,è¿™æ˜¯Wiresharkæ•è·åˆ°çš„åºå·, ç”±äºè¿™æ˜¯å‘é€æ•°æ®çš„ç¬¬ä¸€å¸§è®°frame1)</p><p><img src="image-20230421205838620.png" alt="image-20230421205838620" loading="lazy"></p><p>RTT:</p><p><em>note: è¿™é‡Œçš„Timestampsæ˜¯Wiresharkæä¾›çš„é¢å¤–çš„åŠŸèƒ½, å’ŒTCPæ®µOptionfields é‡Œçš„Timestampsä¸åŒ.</em></p><p>é€šè¿‡Wiresharkçš„åˆ†æ, å¯ä»¥çŸ¥é“IRTT(initial RTT è¡¨ç¤ºæ¡æ‰‹é˜¶æ®µçš„RTT)ä¸º0.39900200s</p><p><img src="image-20230421205848826.png" alt="image-20230421205848826" loading="lazy"></p><p>ACK(å¯¹ç¬¬ä¸€ä¸ªframe)çš„ACK</p><p><img src="image-20230421205858659.png" alt="image-20230421205858659" loading="lazy"></p><p>å‘ç°è¿™é‡Œçš„ACK number = 4095603435, è€Œseq1 çš„Next sequence = 4095603298, è€Œæ°å¥½, frame2çš„Next sequence = 4095603435</p><p><img src="image-20230421205911880.png" alt="image-20230415112704099" loading="lazy"></p><p><strong>æ‰€ä»¥è¿™æ˜¯å¯¹frame1å’Œframe2çš„ç´¯è®¡ç¡®è®¤, è¿™æ˜¯å› ä¸ºTCP é‡‡ç”¨äº†å»¶è¿Ÿåˆ°ACK(delay ACK), å…·æœ‰æ‰€æœŸæœ›çš„åºå·æŠ¥æ–‡åˆ°è¾¾æ—¶, ç­‰å¾…ä¸€æ®µæ—¶é—´(é€šå¸¸ä¸º40ms), å¦‚æœä¸‹ä¸€ä¸ªæŒ‰åºæŠ¥æ–‡åˆ°è¾¾, ç«‹å³å‘é€å•ä¸ªç´¯è®¡ACK, ä»¥ç¡®è®¤ä¸¤ä¸ªæŒ‰åºåˆ°è¾¾çš„æŠ¥æ–‡æ®µ. å¦‚æœä¸‹ä¸€ä¸ªæŒ‰åºæŠ¥æ–‡æ®µæ²¡æœ‰åœ¨è¿™ä¸ªæ—¶é—´å†…åˆ°è¾¾, åˆ™å‘é€ä¸€ä¸ªACK.</strong></p><p>æˆ‘ä»¬ç»§ç»­è§‚å¯Ÿç¬¬ä¸€ä¸ªæŠ¥æ–‡æ®µæ®µTimestampså­—æ®µçš„å€¼:</p><p><img src="image-20230421205924206.png" alt="image-20230421205924206" loading="lazy"></p><p>å¯¹æ¯”ACK1çš„Timestamps:</p><p><img src="image-20230421205931912.png" alt="image-20230421205931912" loading="lazy"></p><p>å¯ä»¥å‘ç°, ç¬¬ä¸€ä¸ªæŠ¥æ–‡æ®µçš„TSvalå’ŒACK1çš„TimestampsTSercç›¸ç­‰, è¿›ä¸€æ­¥éªŒè¯äº†ä¹‹å‰çš„è¯´æ³•, å½“æ¥å—åˆ°è¿ç»­ä¸¤ä¸ªæŒ‰åºåˆ°è¾¾çš„æŠ¥æ–‡æ—¶, ç”¨äºå›å¤çš„ACKæŠ¥æ–‡æ®µæ®µTSercå€¼çš„æœ€æ—©æ¥å—åˆ°çš„æŠ¥æ–‡æ®µçš„TSval, è¿™æ˜¯ä¸ºäº†å¯¹æ–¹æ›´å¤Ÿæ›´å¥½çš„ä¼°ç®—RTT.</p><p><strong>æ—¶é—´æˆ³é€‰é¡¹ä¸»è¦çš„åŠŸèƒ½æœ‰ä¸¤ä¸ª</strong>ï¼š</p><ul><li><p><strong>ç”¨æ¥è®¡ç®—å¾€è¿”æ—¶é—´RTT</strong>ã€‚</p><p>å‘é€æ–¹åœ¨å‘é€æŠ¥æ–‡æ®µæ—¶æŠŠå½“å‰æ—¶é’Ÿçš„æ—¶é—´å€¼æ”¾å…¥æ—¶é—´æˆ³å­—æ®µï¼Œæ¥æ”¶æ–¹åœ¨ç¡®è®¤è¯¥æŠ¥æ–‡æ®µæ—¶æŠŠæ—¶é—´æˆ³å­—æ®µå€¼å¤åˆ¶åˆ°æ—¶é—´æˆ³å›é€å›ç­”å­—æ®µã€‚å› æ­¤ï¼Œå‘é€æ–¹åœ¨æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡åï¼Œå¯ä»¥å‡†ç¡®è®¡ç®—å‡ºRTTã€‚æ—¶é—´æˆ³æ˜¯ä¸€ä¸ªå•è°ƒå¢é•¿çš„å€¼ï¼Œæ¥æ”¶æ–¹åªéœ€è¦å›æ˜¾æ”¶åˆ°çš„å†…å®¹ï¼Œå› æ­¤æ˜¯ä¸éœ€è¦å…³æ³¨æ—¶é—´æˆ³çš„å•å…ƒæ˜¯ä»€ä¹ˆï¼Œä¹Ÿä¸éœ€è¦è¿æ¥åŒå‘çš„æ—¶é’ŸåŒæ­¥ã€‚</p></li><li><p><strong>PAWS:é˜²æ­¢å›ç»•çš„åºå·</strong>ã€‚</p></li></ul><p>æˆ‘ä»¬çŸ¥é“åºåˆ—å·åªæœ‰32ä½ï¼Œè€Œæ¯å¢åŠ 2^32ä¸ªåºåˆ—å·åå°±ä¼šé‡å¤ä½¿ç”¨åŸæ¥ç”¨è¿‡çš„åºåˆ—å·ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€æ¡é«˜é€Ÿç½‘ç»œï¼Œé€šä¿¡çš„ä¸»æœºåŒæ–¹æœ‰è¶³å¤Ÿå¤§çš„å¸¦å®½ç”¨æ¥å¿«é€Ÿçš„ä¼ è¾“æ•°æ®ã€‚ä¾‹å¦‚1Gb/sï¼ˆ<strong>TCP çš„çª—å£ç»è¿‡çª—å£ç¼©æ”¾å¯ä»¥æœ€é«˜åˆ° 1GBï¼ˆ2^30)</strong>ï¼‰çš„é€Ÿç‡å‘é€æŠ¥æ–‡æ®µï¼Œåˆ™ä¸åˆ°35ç§’é’Ÿæ•°æ®å­—èŠ‚çš„åºåˆ—å·å°±ä¼šé‡å¤ã€‚è¿™æ ·å¯¹TCPä¼ è¾“å¸¦æ¥æ··ä¹±çš„æƒ…å†µã€‚è¿™ç§æƒ…å†µä¹‹å‡ºç°åœ¨é«˜é€Ÿé“¾è·¯ä¸Šã€‚<strong>è€Œé‡‡ç”¨æ—¶é—´æˆ³é€‰é¡¹ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„åˆ†è¾¨å‡ºç›¸åŒåºåˆ—å·çš„æ•°æ®æŠ¥ï¼Œå“ªä¸ªæ˜¯æœ€è¿‘å‘é€ï¼Œå“ªä¸ªæ˜¯ä»¥å‰å‘é€çš„ã€‚</strong></p><p>å‚è€ƒæ–‡ç« <a href="https://switch-router.gitee.io/blog/tcp-timestamp/">TCP timestamp é€‰é¡¹é‚£ç‚¹äº‹</a></p><p>æ¥ç€æˆ‘ä»¬è§‚å¯ŸACK1æŠ¥æ–‡çš„ACKåˆ†æ(ç”±wiresharkæä¾›), RTTä¸º: 0.40989700s</p><p><img src="image-20230421205941895.png" alt="image-20230421205941895" loading="lazy"></p><h3 id="ç¬¬äºŒæ®µ"><strong>ç¬¬äºŒæ®µ:</strong></h3><p>æˆ‘ä»¬ç›´æ¥å»æ‰¾, æ”¶åˆ°çš„ç¬¬äºŒä¸ªACKæŠ¥æ–‡</p><p><img src="image-20230421210002459.png" alt="image-20230421210002459" loading="lazy"></p><p>å¯¹æ¯”sequenceçš„å€¼, å¯ä»¥å‘ç°, è¿™æ˜¯å¯¹frame75çš„ACK, ä¹Ÿå°±æ˜¯, æ”¶åˆ°äº†å¯¹ç¬¬ä¸ƒä¸ªæŠ¥æ–‡æ®µçš„ACK. è¯´æ˜æœåŠ¡å™¨å·²ç»æ”¶åˆ°äº†ç¬¬ä¸ƒä¸ªæŠ¥æ–‡æ®µä»¥åŠä¹‹å‰çš„æŠ¥æ–‡.</p><p>æˆ‘ä»¬è¿˜å‘ç°, æ”¶åˆ°äº†ä¸€æ¡[Windows Update]çš„æŠ¥æ–‡, è¿™æ˜¯TCPçš„æµé‡æ§åˆ¶, ç”¨æ¥å‘Šè¯‰å‘é€ç«¯æ ¹æ®è¿™ä¸ªå€¼é€‚å½“çš„è°ƒèŠ‚å‘é€é€Ÿç‡.</p><p><img src="image-20230421210012633.png" alt="image-20230421210012633" loading="lazy"></p><p>æ ¹æ®wiresharkçš„åˆ†æ, å¯ä»¥çŸ¥é“, RTTä¸º0.409390000s</p><p><img src="image-20230421210034300.png" alt="image-20230421210034300" loading="lazy"></p><h3 id="ç¬¬ä¸‰æ®µ">ç¬¬ä¸‰æ®µ:</h3><p><img src="image-20230421210044526.png" alt="image-20230415135344532" loading="lazy"></p><h3 id="ç¬¬å››æ®µ">ç¬¬å››æ®µ:</h3><p><img src="image-20230421210050923.png" alt="image-20230421210050923" loading="lazy"></p><h3 id="ç¬¬äº”æ®µ">ç¬¬äº”æ®µ:</h3><p><img src="image-20230421210058078.png" alt="image-20230421210058078" loading="lazy"></p><h3 id="ç¬¬å…­æ®µ">ç¬¬å…­æ®µ</h3><p><img src="image-20230421210120044.png" alt="image-20230421210120044" loading="lazy"></p><p>æ”¶åˆ°æ¯ä¸ª ACK åï¼ŒEstimatedRTT å€¼(å‚ è§æœ¬èŠ‚ä¸­çš„ç¬¬ 3.5.3 èŠ‚ï¼Œç¬¬ 242 é¡µ)æ˜¯ä»€ä¹ˆ?</p><p>å‡è®¾ç¬¬ä¸€ä¸ª EstimatedRTT çš„ å€¼ç­‰äºç¬¬ä¸€ä¸ªåŒºæ®µçš„æµ‹é‡ RTTï¼Œç„¶åä½¿ç”¨è¯¾æœ¬ç¬¬ 242 é¡µçš„ EstimatedRTT å…¬å¼è®¡ç®—æ‰€æœ‰åç»­åŒºæ®µã€‚</p><p><img src="image-20230421210135957.png" alt="image-20230421210135957" loading="lazy"></p><ul><li><p>What is the length of each of the first six TCP segments?4 å‰å…­ä¸ª TCP åŒºæ®µçš„é•¿åº¦æ˜¯å¤šå°‘?</p><p><img src="image-20230421210144892.png" alt="image-20230421210144892" loading="lazy"></p><p><img src="image-20230421210152513.png" alt="image-20230421210152513" loading="lazy"></p></li><li><p>What is the minimum amount of available buffer space advertised at the received for the entire trace? Does the lack of receiver buffer space ever throttle the sender? å¯¹äºæ•´ä¸ªè·Ÿè¸ªåŒ…ï¼Œæ”¶åˆ°çš„æœ€å°å¯ç”¨ç¼“å†²åŒºç©ºé—´é‡æ˜¯å¤šå°‘? ç¼ºå°‘æ¥æ”¶ç¼“å†²åŒºç©ºé—´æ˜¯å¦ä¼šé™åˆ¶å‘é€æ–¹ä¼ é€ TCP åŒºæ®µ?</p><p><img src="image-20230421210204402.png" alt="image-20230421210204402" loading="lazy"></p><p>å¤§éƒ¨åˆ†Winéƒ½æ˜¯å¾ˆå¤§çš„å€¼, å¤ªå¤šåŒ…äº†, æ‡’å¾—åˆ†æäº†.é€šè¿‡æ£€æŸ¥æ­¤è·Ÿè¸ªï¼Œå‘é€å™¨æ°¸è¿œä¸ä¼šå› ä¸ºæ¥æ”¶å™¨ç¼“å†²åŒºç©ºé—´ä¸è¶³è€Œå—åˆ°æŠ‘åˆ¶ã€‚</p></li><li><p>Are there any retransmitted segments in the trace file? What did you check for (in the trace) in order to answer this question?<br>åœ¨è·Ÿè¸ªæ–‡ä»¶ä¸­æ˜¯å¦æœ‰é‡ä¼ çš„æ®µ? ä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæ‚¨æ£€æŸ¥äº†ä»€ä¹ˆ(åœ¨è·Ÿè¸ªåŒ…ä¸­)?</p><p>è§‚å¯Ÿåºåˆ—å·çš„å˜åŒ–:</p><p>å¯ä»¥å‘ç°, åºåˆ—å·ä¸€ç›´åœ¨å¢åŠ , æ‰€ä»¥æ²¡æœ‰é‡ä¼ çš„æ®µ.</p><p><img src="image-20230421210221963.png" alt="image-20230421210221963" loading="lazy"></p><p>é€šå¸¸åˆ°æ”¶åˆ°äº†ä¸åŒçš„ä¸¤ä¸ªå†—ä½™ACK, ä½†è¿™ä¸ä¸€å®šæ„å‘³ç€ä¸¢åŒ…, è¿™æ˜¯å› ä¸ºåˆ†ç»„ä¹±åºåˆ°è¾¾æ¥å—æ–¹å¯¼è‡´çš„.</p><p><img src="image-20230421210234982.png" alt="image-20230421210234982" loading="lazy"></p></li><li><p>How much data does the receiver typically acknowledge in an ACK? Can you identify cases where the receiver is ACKing every other received segment (see Table 3.2 on page 250 in the text).<br>æ¥æ”¶æ–¹é€šå¸¸åœ¨ ACK ä¸­ç¡®è®¤å¤šå°‘æ•°æ®? æ‚¨æ˜¯å¦å¯ä»¥è¯†åˆ«æ¥æ”¶æ–¹æ¯éš”ä¸€ä¸ªæ¥æ”¶åˆ°çš„åŒºæ®µæ‰å‘é€ç¡®è®¤çš„æƒ…å†µ(å‚è§æœ¬æ–‡ç¬¬ 250 é¡µçš„è¡¨ 3.2)</p><p>æŒ‰ç…§è¡¨3-2çš„è¯´æ˜, æ¥å—æ–¹æœ€å¤šç¡®è®¤ä¸¤ä¸ªæ®µ, ä½†æ˜¯è§‚å¯Ÿäº†æ•è·ç»“æœ, å‘ç°å¾ˆå¤šäº‹ç¡®è®¤äº†è¶…è¿‡ä¸¤ä¸ªæ®µæ®µæƒ…å†µ, æ¯”å¦‚åœ¨ä¸‹å›¾ä¸­, æ”¶åˆ°çš„ç¬¬ä¸€ä¸ªACKç¡®è®¤äº†69,70ä¸¤æ®µ. è¿™æ˜¯ä¸€æ¬¡å…¸å‹çš„delay ACK</p><p><img src="image-20230421210252350.png" alt="image-20230421210252350" loading="lazy"></p><p>ä½†æ˜¯è§‚å¯Ÿæ”¶åˆ°çš„ç¬¬äºŒä¸ªACK, æ˜¯å¯¹75æ®µåŠä¹‹å‰æ®µçš„ç´¯ç§¯ç¡®è®¤, è¿™åŒæ—¶ç´¯ç§¯ç¡®è®¤äº†71,72,73,74,75è¿™äº”ä¸ªæ®µ. ä¸”è§‚å¯Ÿåç»­çš„ACK, é™¤äº†åœ¨ä¸Šä¸€é—®é¢˜ä¸Šå‡ºç°çš„å†—ä½™ACKå¤–, æ— å…¶ä»–å†—ä½™ACK.</p><p>å¦‚æœä¸¥æ ¼æŒ‰ç…§è¡¨3-2çš„å™è¿°æ¥çœ‹, è¿™åªå¯èƒ½æ˜¯éƒ¨åˆ†ACKä¸¢å¤±å¯¼è‡´çš„, è¿™å°±æ„å‘³ç€ç½‘ç»œæ‹¥å¡, ä½†å¾ˆæ˜æ˜¾è¿™æ˜¯ä¸å¯èƒ½çš„, å› ä¸ºæ²¡æœ‰å‘ç°ä»»ä½•ä¸€ä¸ªé‡ä¼ çš„æ®µ, ç½‘ç»œå¾ˆé€šç•….</p><p>è®©æˆ‘ä»¬é—®é—®ä¸‡èƒ½çš„chatGPTå§:</p><p><img src="image-20230421210304585.png" alt="image-20230421210304585" loading="lazy"></p><p><strong>æœ€å¤šå¯ä»¥åˆå¹¶2~5ä¸ªæŠ¥æ–‡æ®µå“¦!!! chatGPT yyds!</strong></p><p><img src="image-20230421210315184.png" alt="image-20230421210315184" loading="lazy"></p></li><li><p>What is the throughput (bytes transferred per unit time) for the TCP connection? Explain how you calculated this value.TCP è¿æ¥çš„ååé‡(æ¯å•ä½æ—¶é—´ä¼ è¾“çš„èŠ‚æ•°)æ˜¯å¤šå°‘? è§£é‡Šä½ å¦‚ä½•è®¡ç®— è¿™ä¸ªå€¼ã€‚</p><p>TCPååé‡çš„è®¡ç®—åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºå¹³å‡æ—¶é—´æ®µçš„é€‰æ‹©ã€‚ä½œä¸ºä¸€ç§å¸¸è§çš„ååé‡è®¡ç®—ï¼Œåœ¨æœ¬é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©å¹³å‡æ—¶é—´å‘¨æœŸä½œä¸ºæ•´ä¸ªè¿æ¥æ—¶é—´ã€‚ç„¶åï¼Œè¯¥TCPè¿æ¥çš„å¹³å‡ååé‡è¢«è®¡ç®—ä¸ºæ€»æ•°æ®é‡ä¸æ€»ä¼ è¾“æ—¶é—´ä¹‹é—´çš„æ¯”ç‡ã€‚å¯ä»¥é€šè¿‡ç¬¬ä¸€ä¸ªTCPæ•°æ®æ®µçš„åºåˆ—å·å’Œæœ€åä¸€ä¸ªç¡®è®¤ç¡®è®¤çš„åºåˆ—å·ä¹‹é—´çš„å·®æ¥è®¡ç®—å‘é€çš„æ€»æ•°æ®é‡ã€‚</p><p>æœ€åä¸€ä¸ªç”±æˆ‘å‘ç»™æœåŠ¡å™¨çš„æœ€åä¸€ä¸ªACKçš„seqence numerberä¸º4095755619, æˆ‘å‘é€çš„æŠ¥æ–‡æ®µç¬¬ä¸€ä¸ªåºåˆ—å·ä¸º: 4095602682</p><p>æ‰€ä»¥æ¥å—æ–¹çš„æ¥å—åˆ°çš„æ€»æ•°æ®ä¸º: 4095755619- 4095602682   =  152936Byte</p><p><img src="image-20230421210352640.png" alt="image-20230421210352640" loading="lazy"></p><p><img src="image-20230421210406967.png" alt="image-20230421210406967" loading="lazy"></p><p>æ€»ä¼ è¾“æ—¶é—´ä¸º5.455830-0.026477=2.50933ç§’ã€‚</p><p>å› æ­¤ï¼Œtcpè¿æ¥çš„ååé‡è®¡ç®—ä¸º152936/2.50933=60946.945997537191202B/s = 60KB/sã€‚</p><p><img src="image-20230421210418067.png" alt="image-20230421210418067" loading="lazy"></p></li></ul><p><em>å›¾ç”±wiresharkäº§ç”Ÿ</em></p><blockquote><p>4tcp-ethereal-trace-1 è·Ÿè¸ªæ–‡ä»¶ä¸­çš„ TCP åŒºæ®µéƒ½å°äº 1460 ô°èŠ‚ã€‚ è¿™æ˜¯å› ä¸ºæ”¶é›†è·Ÿè¸ª çš„è®¡ç®—æœºå…·æœ‰ä»¥å¤ªç½‘å¡ï¼Œè¯¥æœ€å¤§ IP æ•°æ®åŒ…çš„é•¿åº¦é™åˆ¶ä¸º 1500 ô°èŠ‚(40 ô°èŠ‚çš„ TCP / IP æŠ¥å¤´æ•°æ®å’Œ 1460 ô°èŠ‚çš„ TCP æœ‰æ•ˆè´Ÿè½½)ã€‚æ­¤ 1500 ô°èŠ‚å€¼æ˜¯ä»¥å¤ªç½‘å…è®¸ çš„æ ‡å‡†æœ€å¤§é•¿åº¦ã€‚ å¦‚æœæ‚¨çš„è·Ÿè¸ªåŒ…å†…å®¹æŒ‡ç¤º TCP åŒºæ®µé•¿åº¦å¤§äº 1500 ô°èŠ‚ï¼Œå¹¶ä¸” æ‚¨çš„è®¡ç®—æœºä½¿ç”¨ä»¥å¤ªç½‘è¿æ¥ç½‘è·¯ï¼Œåˆ™æ˜¯ Wireshark æŠ¥å‘Šäº†é”™è¯¯çš„ TCP åŒºæ®µé•¿åº¦;å®ƒ ä¹Ÿå¯èƒ½æ˜¯åªæ˜¾ç¤ºä¸€ä¸ªå¤§çš„ TCP æ®µè€Œä¸æ˜¯å¤šä¸ªè¾ƒå°çš„åŒºæ®µï¼Œè€Œæ‚¨çš„è®¡ç®—æœºç¡®å®å¯èƒ½ æ­£åœ¨å‘é€å¤šä¸ªè¾ƒå°çš„åŒºæ®µï¼Œè¿™å¯ä»¥ç”±æ”¶åˆ°çš„ ACK åŒºæ®µæ¥è¯æ˜ã€‚ æŠ¥å‘Šçš„åŒºæ®µé•¿åº¦çš„ è¿™ç§ä¸ä¸€è‡´æ˜¯ç”±äºä»¥å¤ªç½‘é©±åŠ¨ç¨‹åºå’Œ Wireshark è½¯ä»¶ä¹‹é—´çš„äº¤äº’ä½œç”¨æ‰€å¯¼è‡´ã€‚ å¦‚æœ æ‚¨æœ‰è¿™ç§ä¸ä¸€è‡´æƒ…å½¢ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨æœ¬æ–‡æ‰€æä¾›çš„è·Ÿè¸ªæ–‡ä»¶æ¥æ‰§è¡Œæœ¬å®éªŒçš„åˆ†æ å†…å®¹ã€‚</p></blockquote><h2 id="TCP-congestion-control-in-action-TCP-æ‹¥å¡æ§åˆ¶">TCP congestion control in action (TCP æ‹¥å¡æ§åˆ¶)</h2><blockquote><p>ç°åœ¨è®©æˆ‘ä»¬æ£€æŸ¥ä»å®¢æˆ·ç«¯æœåŠ¡å™¨çš„æ¯å•ä½æ—¶é—´å‘é€çš„æ•°æ®é‡ã€‚ è€Œä¸æ˜¯(ç¹ç åœ°!)ä» Wireshark çª—å£ä¸­çš„åŸå§‹æ•°æ®è®¡ç®—è¿™äº›æ•°å€¼ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Wireshark çš„ TCP å›¾å½¢å·¥å…· â€“ æ—¶åºå›¾(Stevens) - æ¥ç»˜åˆ¶æ•°æ®ã€‚</p></blockquote><ul><li><p>ä½¿ç”¨æ—¶åºå›¾(Stevens)ç»˜å›¾å·¥å…·æŸ¥çœ‹ä»å®¢æˆ·ç«¯å‘é€åˆ° <a href="http://gaia.cs.umass.edu">gaia.cs.umass.edu</a> æœåŠ¡ å™¨çš„åŒºæ®µçš„åºåˆ—å·ä¸æ—¶é—´å…³ç³»å›¾ã€‚æ‚¨èƒ½å¦ç¡®å®š TCP çš„æ…¢å¯åŠ¨é˜¶æ®µçš„å¼€å§‹å’Œ ç»“æŸä½ç½®ï¼Œä»¥åŠæ‹¥å¡é¿å…æ¥ç®¡çš„ä½ç½®? è¯„è®ºæµ‹é‡æ•°æ®ä¸æˆ‘ä»¬åœ¨æ–‡æœ¬ä¸­ç ”ç©¶ çš„ TCP çš„ç†æƒ³åŒ–è¡Œä¸ºçš„ä¸åŒä¹‹å¤„ã€‚</p><p><img src="image-20230421210435578.png" alt="image-20230421210435578" loading="lazy"></p></li></ul><p>è®¡ç®—æ¯è½®å‘é€çš„æ®µæ•°é‡åˆ†åˆ«ä¸º: 12,17,36,87 å‘ˆæŒ‡æ•°å¢é•¿, ä¸€åªåœ¨æ…¢å¯åŠ¨é˜¶æ®µ.</p>]]></content>
    
    
    <summary type="html">åœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ç ”ç©¶è‘—åçš„ TCP åè®®çš„è¡Œä¸ºã€‚ æˆ‘ä»¬å°†é€šè¿‡ä»æ‚¨çš„ç”µè„‘å‘ è¿œç¨‹æœåŠ¡å™¨ä¼ è¾“ä¸€ä»½ 150KB çš„æ–‡ä»¶ï¼Œå¹¶åˆ†æ TCP ä¼ è¾“å†…å®¹çš„å‘é€å’Œæ¥æ”¶è¿‡ç¨‹æ¥å®ç°ã€‚ æˆ‘ä»¬å°†ç ”ç©¶ TCP å¯¹åºåˆ—å’Œ ç¡®è®¤å·çš„ä½¿ç”¨ï¼Œä»¥æä¾›å¯é çš„æ•°æ®ä¼ è¾“;æˆ‘ä»¬å°†çœ‹åˆ° TCP çš„æ‹¥å¡æ§åˆ¶ç®—æ³• â€“ æ…¢å¯ åŠ¨å’Œæ‹¥å¡é¿å… â€“ åœ¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹ TCP çš„æ¥æ”¶å™¨å‘é€æµé‡æ§åˆ¶çš„æœºåˆ¶ã€‚ æˆ‘ä»¬è¿˜å°†ç®€è¦åœ°è§‚å¯Ÿ TCP è¿çº¿çš„è®¾ç½®ï¼Œæˆ‘ä»¬è¿˜ä¼šç ”ç©¶è®¡ç®—æœºå’ŒæœåŠ¡å™¨ä¹‹é—´ TCP è¿çº¿çš„æ€§èƒ½ã€‚</summary>
    
    
    
    <category term="å­¦ä¹ " scheme="https://trevoewu.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="computer network" scheme="https://trevoewu.github.io/tags/computer-network/"/>
    
  </entry>
  
  <entry>
    <title>MAC M1 å®‰è£…Oracleæ•°æ®åº“æ•™ç¨‹</title>
    <link href="https://trevoewu.github.io/2023/04/21/MAC-M1-%E5%AE%89%E8%A3%85Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%99%E7%A8%8B/"/>
    <id>https://trevoewu.github.io/2023/04/21/MAC-M1-%E5%AE%89%E8%A3%85Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%99%E7%A8%8B/</id>
    <published>2023-04-21T12:35:34.000Z</published>
    <updated>2023-04-21T12:37:22.477Z</updated>
    
    <content type="html"><![CDATA[<h1>MAC M1 å®‰è£…Oracleæ•°æ®åº“æ•™ç¨‹</h1><p><strong>oracleç›®å‰è¿˜æ²¡æœ‰æ”¯æŒM1çš„ç‰ˆæœ¬, æœ¬æ•™ç¨‹ä½¿ç”¨SSHæ¥è¿œç¨‹ç™»å½•oracleæœåŠ¡å™¨</strong></p><ol><li>åœ¨å¼€å§‹ä¹‹å‰, è¯·ç¡®ä¿ä½ çš„macå®‰è£…äº†parallels Desktop, å¹¶å®‰è£…windowsç³»ç»Ÿ</li><li>å¦‚æœä½ èº«è¾¹æœ‰windowsç¯å¢ƒ, æ¯”å¦‚ä½ çš„å®¤å‹çš„ç”µè„‘, ä½ å¯ä»¥è·³è¿‡1.</li><li>åœ¨windowsç”µè„‘ä¸­å®‰è£…Oracle Database Software.</li></ol><h2 id="å®‰è£…OpenSSHæœåŠ¡">å®‰è£…OpenSSHæœåŠ¡</h2><p>åœ¨windowè®¾ç½®ä¸­</p><p><em>é€‚ç”¨äº Windows Server 2019ã€Windows 10,11ã€Windows Server 2022</em></p><p>OpenSSH æ˜¯ä¸€æ¬¾ç”¨äºè¿œç¨‹ç™»å½•çš„è¿æ¥å·¥å…·ï¼Œå®ƒä½¿ç”¨ SSH åè®®ã€‚ å®ƒä¼šåŠ å¯†å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„æ‰€æœ‰æµé‡ï¼Œä»è€Œéæ­¢çªƒå¬ã€è¿æ¥åŠ«æŒå’Œå…¶ä»–æ”»å‡»ã€‚</p><p>OpenSSH å¯ç”¨äºå°†å®‰è£…äº† OpenSSH å®¢æˆ·ç«¯çš„ Window 10ï¼ˆç‰ˆæœ¬ 1809 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰æˆ– Windows Server 2019 è®¾å¤‡è¿æ¥åˆ°é‚£äº›å®‰è£…äº† OpenSSH æœåŠ¡å™¨çš„è®¾å¤‡ã€‚</p><h3 id="ä½¿ç”¨windousè®¾ç½®å®‰è£…OpenSSSH">ä½¿ç”¨windousè®¾ç½®å®‰è£…OpenSSSH</h3><p>å¯ä»¥ä½¿ç”¨ Windows Server 2019 å’Œ Windows 10 è®¾å¤‡ä¸Šçš„ Windows è®¾ç½®å®‰è£…è¿™ä¸¤ä¸ª OpenSSH ç»„ä»¶ã€‚</p><p>è‹¥è¦å®‰è£… OpenSSH ç»„ä»¶ï¼š</p><ol><li>æ‰“å¼€â€œè®¾ç½®â€ï¼Œé€‰æ‹©â€œåº”ç”¨â€&gt;â€œåº”ç”¨å’ŒåŠŸèƒ½â€ï¼Œç„¶åé€‰æ‹©â€œå¯é€‰åŠŸèƒ½â€ ã€‚</li><li>æ‰«æåˆ—è¡¨ï¼ŒæŸ¥çœ‹æ˜¯å¦å·²å®‰è£… OpenSSHã€‚ å¦‚æœæœªå®‰è£…ï¼Œè¯·åœ¨é¡µé¢é¡¶éƒ¨é€‰æ‹©â€œæ·»åŠ åŠŸèƒ½â€ï¼Œç„¶åï¼š<ul><li>æŸ¥æ‰¾â€œOpenSSH å®¢æˆ·ç«¯â€ï¼Œå†å•å‡»â€œå®‰è£…â€</li><li>æŸ¥æ‰¾â€œOpenSSH æœåŠ¡å™¨â€ï¼Œå†å•å‡»â€œå®‰è£…â€</li></ul></li></ol><p>è®¾ç½®å®Œæˆåï¼Œå›åˆ°â€œåº”ç”¨â€&gt;â€œåº”ç”¨å’ŒåŠŸèƒ½â€å’Œâ€œå¯é€‰åŠŸèƒ½â€ï¼Œä½ åº”ä¼šçœ‹åˆ°å·²åˆ—å‡º OpenSSH ã€‚</p><p><em>å®‰è£… OpenSSH æœåŠ¡å™¨å°†åˆ›å»ºå¹¶å¯ç”¨ä¸€ä¸ªåä¸º <code>OpenSSH-Server-In-TCP</code> çš„é˜²ç«å¢™è§„åˆ™ã€‚ è¿™å…è®¸ç«¯å£ 22 ä¸Šçš„å…¥ç«™ SSH æµé‡ã€‚ å¦‚æœæœªå¯ç”¨æ­¤è§„åˆ™ä¸”æœªæ‰“å¼€æ­¤ç«¯å£ï¼Œé‚£ä¹ˆè¿æ¥å°†è¢«æ‹’ç»æˆ–é‡ç½®ã€‚</em></p><h3 id="ä½¿ç”¨PowerShellå®‰è£…OpenSSH">ä½¿ç”¨PowerShellå®‰è£…OpenSSH</h3><p>è‹¥è¦ä½¿ç”¨ PowerShell å®‰è£… OpenSSHï¼Œè¯·å…ˆä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ PowerShellã€‚ ä¸ºäº†ç¡®ä¿ OpenSSH å¯ç”¨ï¼Œè¯·è¿è¡Œä»¥ä¸‹ cmdletï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">Get-WindowsCapability <span class="token parameter variable">-Online</span> <span class="token operator">|</span> Where-Object Name <span class="token parameter variable">-like</span> <span class="token string">'OpenSSH*'</span></code></pre><p>å¦‚æœä¸¤è€…å‡å°šæœªå®‰è£…ï¼Œåˆ™æ­¤æ“ä½œåº”è¿”å›ä»¥ä¸‹è¾“å‡ºï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">Name  <span class="token builtin class-name">:</span> OpenSSH.Client~~~~0.0.1.0State <span class="token builtin class-name">:</span> NotPresentName  <span class="token builtin class-name">:</span> OpenSSH.Server~~~~0.0.1.0State <span class="token builtin class-name">:</span> NotPresent</code></pre><p>ç„¶åï¼Œæ ¹æ®éœ€è¦å®‰è£…æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ç»„ä»¶ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Install the OpenSSH Client</span>Add-WindowsCapability <span class="token parameter variable">-Online</span> <span class="token parameter variable">-Name</span> OpenSSH.Client~~~~0.0.1.0<span class="token comment"># Install the OpenSSH Server</span>Add-WindowsCapability <span class="token parameter variable">-Online</span> <span class="token parameter variable">-Name</span> OpenSSH.Server~~~~0.0.1.0</code></pre><p>è¿™ä¸¤è€…åº”è¯¥éƒ½ä¼šè¿”å›ä»¥ä¸‹è¾“å‡ºï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">Path          <span class="token builtin class-name">:</span>Online        <span class="token builtin class-name">:</span> TrueRestartNeeded <span class="token builtin class-name">:</span> False</code></pre><h2 id="å¯åŠ¨å¹¶é…ç½®-OpenSSH-æœåŠ¡å™¨">å¯åŠ¨å¹¶é…ç½® OpenSSH æœåŠ¡å™¨</h2><p>è‹¥è¦å¯åŠ¨å¹¶é…ç½® OpenSSH æœåŠ¡å™¨æ¥å¼€å¯ä½¿ç”¨ï¼Œè¯·ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShellï¼Œç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ <code>sshd service</code>ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Start the sshd service</span>Start-Service sshd<span class="token comment"># OPTIONAL but recommended:</span>Set-Service <span class="token parameter variable">-Name</span> sshd <span class="token parameter variable">-StartupType</span> <span class="token string">'Automatic'</span><span class="token comment"># Confirm the Firewall rule is configured. It should be created automatically by setup. Run the following to verify</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>Get-NetFirewallRule <span class="token parameter variable">-Name</span> <span class="token string">"OpenSSH-Server-In-TCP"</span> <span class="token parameter variable">-ErrorAction</span> SilentlyContinue <span class="token operator">|</span> Select-Object Name, Enabled<span class="token punctuation">))</span> <span class="token punctuation">&#123;</span>    Write-Output <span class="token string">"Firewall Rule 'OpenSSH-Server-In-TCP' does not exist, creating it..."</span>    New-NetFirewallRule <span class="token parameter variable">-Name</span> <span class="token string">'OpenSSH-Server-In-TCP'</span> <span class="token parameter variable">-DisplayName</span> <span class="token string">'OpenSSH Server (sshd)'</span> <span class="token parameter variable">-Enabled</span> True <span class="token parameter variable">-Direction</span> Inbound <span class="token parameter variable">-Protocol</span> TCP <span class="token parameter variable">-Action</span> Allow <span class="token parameter variable">-LocalPort</span> <span class="token number">22</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    Write-Output <span class="token string">"Firewall rule 'OpenSSH-Server-In-TCP' has been created and exists."</span><span class="token punctuation">&#125;</span></code></pre><h2 id="è¿æ¥åˆ°-OpenSSH-æœåŠ¡å™¨">è¿æ¥åˆ° OpenSSH æœåŠ¡å™¨</h2><p>macè‡ªå¸¦SSHæœåŠ¡, æ‰€ä»¥å®‰è£…åï¼Œå¯ä»¥ä½¿ç”¨MACè¿æ¥åˆ° OpenSSH æœåŠ¡å™¨, åœ¨ç»ˆç«¯ä¸­è¿è¡Œä¸€ä¸‹å‘½ä»¤:</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> username@ipadress <span class="token comment">#usernameæ˜¯å®‰è£…äº†Oracleçš„windowsç”µè„‘çš„ç”¨æˆ·å</span><span class="token comment">#ipaddressæ˜¯è¯¥ç”µè„‘çš„ipåœ°å€</span></code></pre><p>å¯ä»¥é€šè¿‡åœ¨windowsçš„PowerShellä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹ipåœ°å€:</p><pre class="language-bash" data-language="bash"><code class="language-bash">ipconfig</code></pre><p>å®‰è£…è¦æ±‚è¾“å…¥å¯†ç , æ³¨æ„æ˜¯å¾®è½¯ç”¨æˆ·çš„å¯†ç , ä¸æ˜¯ç”µè„‘çš„å¼€æœºå¯†ç </p><p>è¿æ¥åï¼Œä½ å°†çœ‹åˆ° Windows å‘½ä»¤è¡Œç•Œé¢æç¤ºç¬¦ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">domain<span class="token punctuation">\</span>username@SERVERNAME C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>username<span class="token operator">></span></code></pre><h2 id="ç”¨æˆ·ç™»å½•Oracleæ•°æ®åº“">ç”¨æˆ·ç™»å½•Oracleæ•°æ®åº“</h2><p>cæˆåŠŸé“¾æ¥å, åœ¨ç»ˆç«¯è¾“å…¥:</p><pre class="language-bash" data-language="bash"><code class="language-bash">sqlplus / as sysdba</code></pre><p>æŒ‰ç…§æç¤ºè¾“å…¥ç”¨æˆ·å:</p><pre class="language-bash" data-language="bash"><code class="language-bash">sys as sysdba </code></pre><p>å¹¶æŒ‰ç…§æç¤ºè¾“å…¥å£ä»¤, è¿™ä¸ªå£ä»¤æ˜¯åœ¨ä½ å®‰è£…Orecleè½¯ä»¶çš„è¿‡ç¨‹ä¸­è®¾ç½®çš„.</p><p>äº§ç”Ÿä¸€ä¸‹è¾“å‡ºåˆ™é“¾æ¥æˆåŠŸ</p><pre class="language-bash" data-language="bash"><code class="language-bash">è¿æ¥åˆ°: Oracle Database 11g Enterprise Edition Release <span class="token number">11.2</span>.0.1.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing options</code></pre><p>ä½¿ç”¨<code>ctrl</code>+<code>c</code>é€€å‡ºsqlæœåŠ¡, è¾“å…¥<code>exit</code>é€€å‡ºsshé“¾æ¥</p><h2 id="ç”¨Navicatè¿œç¨‹ç™»é™†Oracleæ•°æ®åº“">ç”¨Navicatè¿œç¨‹ç™»é™†Oracleæ•°æ®åº“</h2><p>æ‰“å¼€Navicat, å·¦ä¸Šè§’é€‰æ‹©, ä¹‹åé€‰æ‹©Oracle.</p><p>é“¾æ¥åè¯·éšæ„å¡«å†™, ä¸»æœºä½ç½®å¡«å…¥localhost, ç«¯å£é»˜è®¤ä¸º1521</p><p>æœåŠ¡åé»˜è®¤ä¸ºORCL, å¦‚æœä½ åœ¨å®‰è£…Oracleä¸­æ²¡æœ‰æ›´æ”¹, åˆ™ä¿æŒä¸å˜, æˆ‘çš„æ”¹ä¸ºäº†ORACLE</p><p>è§’è‰²é€‰æ‹©SYSDBA,ç”¨æˆ·åä¸ºsys, å¯†ç å°±æ˜¯ä¹‹å‰æåˆ°çš„å£ä»¤.</p><img src="/Users/trevorwu/Library/Application Support/typora-user-images/image-20220929221736551.png" alt="image-20220929221736551" style="zoom:50%;" loading="lazy"><p>ç‚¹å‡»SSHé€‰é¡¹</p><img src="/Users/trevorwu/Library/Application Support/typora-user-images/image-20220929221807569.png" alt="image-20220929221807569" style="zoom:50%;" loading="lazy"><p>ä¸»æœºå¡«å…¥windowsä¸»æœºçš„IPåœ°å€, ç«¯å£é»˜è®¤22, ç”¨æˆ·åæ˜¯windowsè´¦æˆ·çš„ç”¨æˆ·å, å¯†ç æ˜¯è¯¥è´¦æˆ·çš„å¯†ç </p><p>ç‚¹å‡»é“¾æ¥æµ‹è¯•, æˆåŠŸé“¾æ¥åç‚¹å‡»ä¿å­˜å³å¯.</p>]]></content>
    
    
    <summary type="html">oracleç›®å‰è¿˜æ²¡æœ‰æ”¯æŒM1çš„ç‰ˆæœ¬, æœ¬æ•™ç¨‹ä½¿ç”¨SSHæ¥è¿œç¨‹ç™»å½•oracleæœåŠ¡å™¨</summary>
    
    
    
    <category term="macä½¿ç”¨æŒ‡å—" scheme="https://trevoewu.github.io/categories/mac%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
    
    
    <category term="macä½¿ç”¨æŒ‡å—" scheme="https://trevoewu.github.io/tags/mac%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
    
    <category term="oracle" scheme="https://trevoewu.github.io/tags/oracle/"/>
    
    <category term="æ•™ç¨‹" scheme="https://trevoewu.github.io/tags/%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>è®¡ç®—æœºç³»ç»Ÿæ¼«æ¸¸</title>
    <link href="https://trevoewu.github.io/2023/04/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%BC%AB%E6%B8%B8/"/>
    <id>https://trevoewu.github.io/2023/04/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%BC%AB%E6%B8%B8/</id>
    <published>2023-04-21T12:31:56.000Z</published>
    <updated>2023-04-21T12:33:26.396Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¿¡æ¯å°±æ˜¯ä½-bit-åŠ ä¸Šä¸‹æ–‡-context">ä¿¡æ¯å°±æ˜¯ä½(bit)åŠ ä¸Šä¸‹æ–‡(context)</h2><p>æˆ‘ä»¬å­¦ä¹ ä¸€é—¨æ–°çš„è¯­è¨€, å¾€å¾€æ˜¯ä»Hello worldå¼€å§‹çš„, æˆ‘æƒ³æ²¡æœ‰ä¸€ä¸ªç¨‹åºå‘˜ä¸å–œæ¬¢è¿™å¥è¯, å°±åƒä¸€ä¸ªåˆšå‡ºç”Ÿçš„å©´å„¿, å¯¹ç€è¿™ä¸ªé™Œç”Ÿçš„ä¸–ç•Œå¾®ç¬‘ä¸€æ ·.</p><p>è¿™æ¬¡å¯¹è®¡ç®—æœºç³»ç»Ÿçš„å­¦ä¹ å°±ä»ä¸€ä¸ªhello worldç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸå¼€å§‹. ä»ä»–è¢«æˆ‘ä»¬é”®å…¥ç¼–è¾‘å™¨, åˆ°åœ¨ç³»ç»Ÿè¿è¡Œ, æ‰“å°hello worldæœ€åinterminates.</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"hello world\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>æˆ‘ä»¬çš„hello worldç¨‹åºç”Ÿå‘½çš„å¼€å§‹æ˜¯æºç¨‹åº(source progam)æˆ–è€…æºæ–‡ä»¶(source file), ä»¥åç¼€ <code>.c</code> ç»“å°¾, å®ƒæ˜¯ç”±ä¸€ç³»åˆ—çš„0,1ä»£ç æ„æˆ, æˆ‘ä»¬æŠŠæ¯ä¸€ä½å«åšbit. æ¯å…«ä¸ªbitç»„æˆä¸€ä¸ªå—, æˆ‘ä»¬ç§°ä¹‹ä¸ºä¸€ä¸ªå­—èŠ‚byte. å®ƒæ˜¯è®¡ç®—æœºå¤„ç†ä¿¡æ¯çš„æœ€å°å•ä½. æ¯ä¸€ä¸ªbyteå¯¹åº”ç€ä¸€ä¸ªå­—ç¬¦.</p><p>å¤§å¤šæ•°è®¡ç®—æœºç³»ç»Ÿéƒ½é‡‡ç”¨ASCIIæ ‡å‡†æ¥è¡¨ç¤ºå­—ç¬¦, æ¯ä¸€ä¸ªASCIIç çš„å€¼éƒ½å¯¹åº”ç€ä¸€ä¸ªå”¯ä¸€çš„å­—ç¬¦. æˆ‘ä»¬å¯ä»¥åœ¨linuxæˆ–è€…like-unixç³»ç»Ÿçš„ç»ˆç«¯ä¸­é”®å…¥<code>man ascii</code>æ¥æŸ¥çœ‹å¯¹åº”å…³ç³»</p><img src="/Users/trevorwu/Library/Application Support/typora-user-images/image-20220928022041369.png" alt="image-20220928022041369" style="zoom:50%;" loading="lazy"><p>æˆ‘ä»¬æŠŠåƒ<code>hello.c</code>è¿™æ ·ç”¨ASCIIç è¡¨ç¤ºçš„æ–‡ä»¶å«åšæ–‡æœ¬æ–‡ä»¶(text files), è€Œå…¶ä»–å½¢å¼çš„æ–‡ä»¶å«åšäºŒè¿›åˆ¶æ–‡ä»¶(binary files)</p><p>åœ¨è®¡ç®—æœºä¸­, æ‰€ä»¥çš„ä¿¡æ¯éƒ½æ˜¯éƒ½æ˜¯ä¸€è¿ä¸²çš„ç”±0å’Œ1ç»„æˆ, è€Œå”¯ä¸€åŒºåˆ†è¿™äº›ä¿¡æ¯å°±æ˜¯ä¸Šä¸‹æ–‡. åœ¨ä¸åŒä¸Šä¸‹æ–‡ä¸­, ç›¸åŒçš„ä¸€æ®µæ¯”ç‰¹åºåˆ—å¯èƒ½è¡¨ç¤ºä¸€ä¸ªæ•´æ•°, æµ®ç‚¹æ•°, æˆ–è€…ä¸€æ¡æŒ‡ä»¤.</p><h2 id="ç¨‹åºè¢«ç¼–è¯‘å™¨ç¿»è¯‘æˆä¸åŒçš„æ ¼å¼">ç¨‹åºè¢«ç¼–è¯‘å™¨ç¿»è¯‘æˆä¸åŒçš„æ ¼å¼</h2><p>è®¡ç®—æœºåªè®¤è¯†äºŒè¿›åˆ¶åºåˆ—, helloworldè¿™æ ·çš„ç¨‹åºæ˜¯ä¸èƒ½è¢«è®¡ç®—æœºç†è§£çš„. ä¸ºäº†è®©è®¡ç®—æœºæ­£ç¡®çš„æ‰§è¡Œæˆ‘ä»¬çš„æŒ‡ä»¤, æˆ‘ä»¬å¿…é¡»æŠŠå®ƒç¿»è¯‘æˆä»¥äºŒè¿›åˆ¶è¡¨ç¤ºçš„å½¢å¼, æˆ‘ä»¬æŠŠè¿™æ ·ç”±äºŒè¿›åˆ¶è¡¨ç¤ºçš„è¯­è¨€å«åšæœºå™¨è¯­è¨€. è¿™äº›æŒ‡ä»¤æœ€åè¢«æ‰“åŒ…æˆåå«å¯æ‰§è¡Œç¨‹åºçš„å½¢å¼, å­˜å‚¨ä¸ºç£ç›˜ä¸­çš„äºŒè¿›åˆ¶æ–‡ä»¶.</p><p>åœ¨unixç³»ç»Ÿä¸­, è¿™ä¸ªç”±æºæ–‡ä»¶ç¿»è¯‘ä¸ºå¯æ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹æ˜¯ç”±ä¸€ä¸ªå«ç¼–è¯‘å™¨çš„ç¨‹åºå®Œæˆ.</p><p>æ•´ä¸ªè¾¹ç¼˜è¿‡ç¨‹åˆ†ä¸º4ä¸ªé˜¶æ®µ, åˆ†åˆ«æ˜¯é¢„ç¼–è¯‘å¤„ç†, ç¼–è¯‘, æ±‡ç¼–, é“¾æ¥.</p><ul><li>é¢„ç¼–è¯‘é˜¶æ®µä¿®æ”¹ç”±<code>#</code>ä¸ºå¼€å§‹çš„è¯­å¥, æ¯”å¦‚è¿™æ®µhello.cç¨‹åºä¸­çš„<code>#include&lt;stdio.h&gt;</code>, é¢„ç¼–è¯‘é˜¶æ®µä¼šåœ¨ç›®æ ‡è·¯å¾„ä¸­æ‰¾åˆ°å¯¹åº”çš„<code>stdio.h</code>æ–‡ä»¶, å¹¶ç›´æ¥æ’å…¥åˆ°ç¨‹åºä¸­, æœ‰ç‚¹å†…å®¹å¤åˆ¶ç²˜è´´åˆ°è¿‡ç¨‹.</li></ul><p>â€‹è¿™ä¸ª<code>stdio.h</code>æ–‡ä»¶ä¸­ä¸»è¦åŒ…æ‹¬å‡½æ•°å£°æ˜, å®å®šä¹‰, ä»¥åŠç»“æ„ä½“å®šä¹‰, è¿™ä¸ªé˜¶æ®µä¼šç”Ÿæˆä»¥<code>.i</code>ä¸ºåç¼€çš„æ–‡æœ¬æ–‡ä»¶.</p><p>â€‹é»˜è®¤æƒ…å†µä¸‹ï¼Œé¢„å¤„ç†å™¨çš„è¾“å‡ºä¼šè¢«å¯¼å…¥åˆ°æ ‡å‡†è¾“å‡ºæµï¼ˆä¹Ÿå°±æ˜¯æ˜¾ç¤ºå™¨ï¼‰ï¼Œå¯ä»¥åˆ©ç”¨<code>-o</code>é€‰é¡¹æŠŠå®ƒå¯¼å…¥åˆ°æŸä¸ªè¾“å‡ºæ–‡ä»¶, åœ¨shellä¸­é”®å…¥<code>gcc -E hello.c -o hello.i</code>æ¥è¾“å‡ºåˆ°hello.iæ–‡ä»¶ä¸­</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">extern</span> <span class="token keyword">int</span> <span class="token function">__vsnprintf_chk</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span> restrict<span class="token punctuation">,</span> <span class="token class-name">size_t</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token class-name">size_t</span><span class="token punctuation">,</span>       <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> restrict<span class="token punctuation">,</span> va_list<span class="token punctuation">)</span><span class="token punctuation">;</span># <span class="token number">400</span> <span class="token string">"/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/stdio.h"</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span># <span class="token number">2</span> <span class="token string">"hello.c"</span> <span class="token number">2</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"hello world\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>äº§ç”Ÿçš„ä»£ç å¾ˆé•¿å¾ˆé•¿, å¤§æ¦‚æœ‰500è¡Œ,è¿™é‡Œåªæˆªå–æœ€åä¸€éƒ¨åˆ†. å¯ä»¥å‘ç°, å³ä½¿æ˜¯æƒ³helloworldè¿™æ ·æç«¯ç®€å•çš„ç¨‹åº, ç¼–è¯‘ä¹‹åä¹Ÿä¼šæ¯”æºæ–‡ä»¶å¤§å¾ˆå¤š.</p><ul><li>ç¼–è¯‘é˜¶æ®µæŠŠé¢„ç¼–è¯‘äº§ç”Ÿçš„ä»¥<code>.i</code>ç»“å°¾çš„æ–‡ä»¶ç¿»è¯‘æˆä»¥æ±‡ç¼–è¯­è¨€è¡¨ç¤ºçš„æ–‡æœ¬æ–‡ä»¶, æ±‡ç¼–æ˜¯ä¸€ç§å¾ˆæœ‰ç”¨çš„ä½ä¸€çº§çš„è¯­è¨€, åœ¨ä¸åŒçš„ç¼–è¯‘å™¨ç¼–è¯‘ä¸åŒçš„é«˜çº§è¯­è¨€ä¸­, å®ƒå¾€å¾€ä½œä¸ºç¼–è¯‘é˜¶æ®µçš„è¾“å‡ºè¯­è¨€.</li></ul><p>æˆ‘ä»¬å¯ä»¥åœ¨shellä¸­é”®å…¥<code>gcc -S hello.c</code>ç”Ÿäº§æ±‡ç¼–ç¨‹åº<code>hello.s</code> :</p><pre class="language-assembly" data-language="assembly"><code class="language-assembly">_main:                                  ; @main.cfi_startproc; %bb.0:subsp, sp, #32                     ; &#x3D;32stpx29, x30, [sp, #16]             ; 16-byte Folded Spilladdx29, sp, #16                    ; &#x3D;16.cfi_def_cfa w29, 16.cfi_offset w30, -8.cfi_offset w29, -16movw8, #0strw8, [sp, #8]                    ; 4-byte Folded Spillsturwzr, [x29, #-4]adrpx0, l_.str@PAGEaddx0, x0, l_.str@PAGEOFFbl_printfldrw0, [sp, #8]                    ; 4-byte Folded Reloadldpx29, x30, [sp, #16]             ; 16-byte Folded Reloadaddsp, sp, #32                     ; &#x3D;32ret</code></pre><ul><li><p>æ±‡ç¼–é˜¶æ®µ</p><p>åœ¨æ±‡ç¼–é˜¶æ®µç¼–è¯‘å™¨ä¼šæŠŠä¸Šä¸€é˜¶æ®µç”¨ASCIIè¡¨ç¤ºçš„æ–‡æœ¬æ–‡ä»¶<code>hello.s</code>è½¬åŒ–ä¸ºæœºå™¨è¯­è¨€è¡¨ç¤ºçš„æŒ‡ä»¤, å¹¶æ‰“åŒ…ç”Ÿæˆå«åšå¯é‡å®šä½çš„äºŒè¿›åˆ¶æ–‡ä»¶æ–‡ä»¶, å­˜å‚¨åœ¨<code>hello.o</code>çš„æ–‡ä»¶ä¸­, å¦‚æœæˆ‘ä»¬æ‰“å¼€è¿™ä¸ªæ–‡ä»¶,  æ–‡æœ¬ç¼–è¾‘å™¨ä¼šæŒ‰ç…§ASCIIè¡¨ç¤ºæˆå¯¹åº”çš„å­—ç¬¦, æ‰€ä»¥æˆ‘ä»¬å°†ä¼šçœ‹åˆ°ä¸€å †ä¹±ç .</p></li><li><p>é“¾æ¥é˜¶æ®µ</p></li></ul><p>æ³¨æ„åˆ°æˆ‘ä»¬çš„helloworldç¨‹åºè°ƒç”¨äº†ä¸€ä¸ªåä¸ºprintfçš„å‡½æ•°, è¿™ä¸ªå‡½æ•°æ˜¯Cæ ‡å‡†åº“å‡½æ•°çš„ä¸€éƒ¨åˆ†,ç”±ç¼–è¯‘èµ·æä¾›. è¿™ä¸ªå‡½æ•°ä¿æŒåœ¨ä¸€ä¸ªå•ç‹¬çš„é¢„ç¼–è¯‘çš„ç›®æ ‡æ–‡ä»¶ä¸­, å«åš<code>printf.o</code>å®ƒå¿…é¡»å’Œæˆ‘ä»¬çš„<code>hello.o</code>åˆå¹¶, è¿™ä¸ªå·¥ä½œç”±é“¾æ¥å™¨å®Œæˆ, ç”Ÿæˆå’Œä»¥ç›´æ¥è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶<code>hello</code>.</p><p>ç°åœ¨, æˆ‘ä»¬çš„æºç¨‹åºä»¥åŠè¢«ç¿»è¯‘æˆäº†å¯æ‰§è¡Œæ–‡ä»¶, å¹¶å­˜å‚¨æ¥ç£ç›˜ä¸­. æˆ‘ä»¬å¯ä»¥åœ¨shellä¸­é”®å…¥<code>./hello</code>æ¥è¿è¡Œæˆ‘ä»¬çš„ç¨‹åº.</p>]]></content>
    
    
    <summary type="html">æˆ‘ä»¬å­¦ä¹ ä¸€é—¨æ–°çš„è¯­è¨€, å¾€å¾€æ˜¯ä»Hello worldå¼€å§‹çš„, æˆ‘æƒ³æ²¡æœ‰ä¸€ä¸ªç¨‹åºå‘˜ä¸å–œæ¬¢è¿™å¥è¯, å°±åƒä¸€ä¸ªåˆšå‡ºç”Ÿçš„å©´å„¿, å¯¹ç€è¿™ä¸ªé™Œç”Ÿçš„ä¸–ç•Œå¾®ç¬‘ä¸€æ ·.</summary>
    
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://trevoewu.github.io/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="computer system" scheme="https://trevoewu.github.io/tags/computer-system/"/>
    
  </entry>
  
  <entry>
    <title>çºªå¿µæ‹¥æœ‰äº†è‡ªå·±çš„åšå®¢</title>
    <link href="https://trevoewu.github.io/2023/04/21/%E7%BA%AA%E5%BF%B5%E6%8B%A5%E6%9C%89%E4%BA%86%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/"/>
    <id>https://trevoewu.github.io/2023/04/21/%E7%BA%AA%E5%BF%B5%E6%8B%A5%E6%9C%89%E4%BA%86%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/</id>
    <published>2023-04-21T12:28:51.000Z</published>
    <updated>2023-04-21T12:30:45.584Z</updated>
    
    <content type="html"><![CDATA[<p>å½“ä¸€ä¸ªç”±ä½ äº²æ‰‹å¡‘é€ çš„ä¸œè¥¿ç¬¬ä¸€æ¬¡å‘ˆç°åœ¨ä½ é¢å‰çš„æ—¶å€™, é‚£ç§å…´å¥‹æ„Ÿä»¥åŠæˆå°±æ„Ÿæ˜¯éš¾ä»¥æ¯”æ‹Ÿçš„.</p><span id="more"></span><p>æ¯”å¦‚å½“æˆ‘ç¬¬ä¸€æ¬¡ç”¨è‡ªå·±çš„åºŸæ—§çš„ç”µè„‘ç»„è£…æˆä¸€å°æ˜¾ç¤ºå™¨, å½“çœ‹åˆ°æ˜¾ç¤ºå™¨ä½œä¸ºswitchå‰¯å±è¢«ç‚¹äº®çš„æ—¶å€™. æ¯”å¦‚è‡ªå·±ç…§ç€æ•™ç¨‹ç»™è·¯ç”±å™¨åˆ·æ’ä»¶æ¥ç ´è§£æ ¡å›­ç½‘, çœ‹è§Wi-Fiä¿¡å·å‡ºç°, è®¾å¤‡è¿æ¥å, ç»•è¿‡è®¤è¯è¿æ¥ä¸Šäº’è”ç½‘çš„æ—¶å€™.</p><p>é‚£æ—¶å€™, æˆ‘å¥½é«˜å…´å¥½é«˜å…´, æˆ‘å¾ˆæƒ³åˆ†äº«æˆ‘çš„æˆæœ, å‘Šè¯‰å®¿èˆçš„æ¯ä¸€ä¸ªäººè®©ä»–ä»¬è¿æˆ‘çš„Wi-Fi, ä»æ­¤å®ç°Wi-Fiè‡ªç”±. å¹³æ—¶æ²‰é»˜ä¸è¯­çš„æˆ‘åœ¨è¿™æ—¶å€™çŠ¹è±«äº†. æˆ‘åªèƒ½å¼ºè¿«è‡ªå·±å»åšä¸€äº›åˆ«çš„äº‹æ¥æŠ‘åˆ¶è¿™ä»½å¿ƒæƒ….</p><p>è€Œç”¨äºè‡ªå·±çš„åšå®¢å¸¦æ¥çš„æ‚¸åŠ¨æ˜¯æ›´èƒœè¿‡è¿™ä¸¤ä»¶äº‹çš„.</p><p>æˆ‘å¾ˆå¼€å¿ƒå½“æˆ‘å‘Šè¯‰æˆ‘çš„ä¸¤ä½å¼‚æ€§æœ‹å‹æ—¶, è™½ç„¶å¥¹ä»¬å¯¹æ­¤å¹¶ä¸äº†è§£, ä»…ä»…æ˜¯çœ‹è§å¥¹ä»¬å¥½å¥‡å’Œç§°èµæˆ‘å°±å¥½å¼€å¿ƒ.</p><p>ç¬¬ä¸€æ¬¡å¬åˆ°åšå®¢è¿™ä¸ªè¯æ˜¯åœ¨åˆäºŒçš„æ—¶å€™, è€å¸ˆç»™æˆ‘ä»¬å‘äº†ä¸€ä»½è°ƒæŸ¥é—®å·, å…¶ä¸­ä¸€ä¸ªé—®é¢˜ä¾¿æ˜¯æœ‰æ²¡æœ‰è‡ªå·±çš„åšå®¢, é‚£æ—¶å€™æˆ‘è¿˜ä¸çŸ¥é“åšå®¢æ˜¯ä»€ä¹ˆ, ä¾¿ä»¥ä¸ºæ˜¯å¾®åš, äºæ˜¯å¡«ä¸Šäº†æ˜¯. æƒ³å¿…é‚£æ—¶å€™æ‹¿åˆ°æ•°æ®çš„äººä¼šä¸ä¼šæƒŠè®¶äºä¸€ä¸ªåˆäºŒå­¦ç”Ÿä¼šæ‹¥æœ‰è‡ªå·±çš„åšå®¢å‘¢.</p><p>ä¸Šå¤§å­¦å, é æœç´¢å­¦ä¹ ä¹Ÿè®©æˆ‘é‡è§äº†å¾ˆå¤šä¼˜ç§€çš„åšå®¢, æœ‰ç€ç²¾è‡´çš„é¡µé¢, å……æ»¡ä¸ªäººç‰¹è‰²çš„UI, ä»¥åŠé‚£äº›å­¦ä¹ å’Œç”Ÿæ´»çš„è®°å½•, æ¯æ¬¡ç¿»é˜…, æˆ‘éƒ½è§‰å¾—ä»–ä»¬å¥½ä¼˜ç§€.</p><p>å¥½åƒæˆä¸ºä»–ä»¬é‚£æ ·ä¼˜ç§€çš„äºº.</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å½“ä¸€ä¸ªç”±ä½ äº²æ‰‹å¡‘é€ çš„ä¸œè¥¿ç¬¬ä¸€æ¬¡å‘ˆç°åœ¨ä½ é¢å‰çš„æ—¶å€™, é‚£ç§å…´å¥‹æ„Ÿä»¥åŠæˆå°±æ„Ÿæ˜¯éš¾ä»¥æ¯”æ‹Ÿçš„.&lt;/p&gt;</summary>
    
    
    
    <category term="æ—¥å¸¸" scheme="https://trevoewu.github.io/categories/%E6%97%A5%E5%B8%B8/"/>
    
    
    <category term="æ—¥å¸¸" scheme="https://trevoewu.github.io/tags/%E6%97%A5%E5%B8%B8/"/>
    
    <category term="talk" scheme="https://trevoewu.github.io/tags/talk/"/>
    
  </entry>
  
  <entry>
    <title>hexoæ’å…¥å›¾ç‰‡é—®é¢˜</title>
    <link href="https://trevoewu.github.io/2023/04/21/hexo%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87%E9%97%AE%E9%A2%98/"/>
    <id>https://trevoewu.github.io/2023/04/21/hexo%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87%E9%97%AE%E9%A2%98/</id>
    <published>2023-04-21T03:46:44.000Z</published>
    <updated>2023-04-21T04:47:56.326Z</updated>
    
    <content type="html"><![CDATA[<p>æ˜¨å¤©åˆšæ­å»ºå®Œåšå®¢, å‘ç°ç›´æ¥å†™markdown, hexo ç”Ÿæˆåå›¾ç‰‡å…¨éƒ¨éƒ½æ²¡æ³•æ˜¾ç¤ºäº†, æ¯•ç«Ÿå›¾ç‰‡éƒ½åœ¨æœ¬åœ°, ä»¥ç»å¯¹è·¯å¾„çš„æ–¹å¼å­˜å‚¨çš„, markdownçš„è·¯å¾„çš„hexoçš„è·¯å¾„ä¸åŒ¹é….</p><span id="more"></span><p>ä»¥å‰æ­åšå®¢çš„æ—¶å€™è¿™ä¸ªå›¾ç‰‡é—®é¢˜å°±è€æ˜¯å›°æ‰°ç€æˆ‘, æˆ‘ç”¨typoraç¼–å†™çš„æ–‡ç« è½¬åˆ°htmlä¹‹å, æˆ‘è¿˜å¾—æŠŠå›¾ç‰‡ä¹Ÿå¼•åˆ°é¡¹ç›®ç›®å½•æ¥, ç„¶ååœ¨ä¸€ä¸ªä¸ªçš„è¯¥è·¯å¾„. ä½“éªŒå¯ä»¥è¯´æ˜¯å¾ˆå·®äº†, è¿™ä¹Ÿå¯¼è‡´å“ªæ€•å†™å®Œæ–‡ç« , æˆ‘ä¹Ÿæ‡’å¾—å‘å¸ƒäº†, å¤ªéº»çƒ¦.</p><p>è¿™æ¬¡ç”¨hexoæ­å»ºä¹Ÿé‡åˆ°äº†åŒæ ·çš„é—®é¢˜, æŒ‰ç…§è€æ–¹æ³•, æˆ‘èƒ½æƒ³åˆ°çš„å°±åªæœ‰æŠŠå›¾ç‰‡å…¨éƒ¨æ‹‰è¿‡æ¥äº†, æˆ‘ç›´æ¥æŠŠå…¨éƒ¨å›¾ç‰‡<code>mv</code>åˆ°äº†publicç›®å½•çš„imagç›®å½•ä¸‹, éƒ¨ç½²åˆ°githubä¸Šçš„æ—¶å€™, ç”±äºå›¾ç‰‡å¤ªå¤šäº†, è¿›åº¦æ¡è€æ˜¯å¡ä½, æˆ‘åªå¥½æ”¾å¼ƒäº†. æˆ‘ç›´æ¥<code>ctl+c</code>, <code>hexo clean</code>,<code>hexo s</code>.è¿™æ—¶å€™æˆ‘è¿˜ä¸çŸ¥é“<code>hexo clean</code>æ„å‘³è¿™ä»€ä¹ˆ, åªæ˜¯çœ‹æ•™ç¨‹å¤§å®¶éƒ½æ˜¯è¿™æ ·åšçš„, ç»“æœ, ç»“æœhexoæŠŠæˆ‘pubilcç›®å½•ä¸‹çš„æ–‡ä»¶å…¨éƒ¨åˆ äº†â€¦, æˆ‘çš„å›¾ç‰‡, ä¹Ÿå…¨æ²¡äº†.</p><p>ä»Šå¤©å‘ç°ä¸€ä¸ªç»å¥½çš„è§£å†³æ–¹æ¡ˆ, å°†Typoraå’Œhexoå®Œç¾ç»“åˆèµ·æ¥.</p><h3 id="ç¬¬ä¸€æ­¥-ä¿®æ”¹hexoçš„ç«™ç‚¹é…ç½®æ–‡ä»¶-config-yml">ç¬¬ä¸€æ­¥ ä¿®æ”¹hexoçš„ç«™ç‚¹é…ç½®æ–‡ä»¶_config.yml</h3><p>é¦–å…ˆå®‰è£…æ’ä»¶:</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-renderer-marked</code></pre><p>åœ¨_config.ymlæœç´¢<code>post_asset_folder</code>æ”¹ä¸ºtrue å¦‚ä¸‹:</p><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">post_asset_folder</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token key atrule">marked</span><span class="token punctuation">:</span>  <span class="token key atrule">prependRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">postAsset</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code></pre><p>ä¿®æ”¹ä¹‹åä¼šå¼€å¯ Hexo çš„æ–‡ç« èµ„æºæ–‡ä»¶ç®¡ç†åŠŸèƒ½ã€‚Hexo å°†ä¼šåœ¨æˆ‘ä»¬æ¯ä¸€æ¬¡é€šè¿‡ <code>hexo new &lt;title&gt;</code> å‘½ä»¤åˆ›å»ºæ–°æ–‡ç« æ—¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåŒåæ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨æ‰§è¡Œ<code>hexo g</code>çš„æ—¶å€™è¿åŒå›¾ç‰‡ä»¥å‰å¤åˆ¶åˆ°publicç›®å½•ä¸‹(ç½‘ç«™çš„æ ¹ç›®å½•).äºæ˜¯æˆ‘ä»¬ä¾¿å¯ä»¥å°†æ–‡ç« æ‰€å¼•ç”¨çš„ç›¸å…³èµ„æºæ”¾åˆ°è¿™ä¸ªåŒåæ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶åé€šè¿‡ç›¸å¯¹è·¯å¾„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ æŠŠä¸€ä¸ª <code>example.jpg</code> å›¾ç‰‡æ”¾åœ¨äº†è¿™ä¸ªåŒåæ–‡ä»¶å¤¹ä¸­ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„çš„å¸¸è§„ markdown è¯­æ³• <code>![](example/example.jpg)</code>å³å¯è®¿é—® ã€‚</p><p>ä¹Ÿå°±æ˜¯è¿™æ ·</p><p><img src="image-20230421120557507.png" alt="image-20230421120557507" loading="lazy"></p><p>ä½†æ˜¯å‘¢, æ‰§è¡Œ<code>hexo g</code>ç”Ÿæˆçš„æ—¶å€™, hexoä¼šæŠŠsourecç›®å½•ä¸‹çš„_postsæ–‡ä»¶çš„è½¬åŒ–ä¸ºæˆhtml, å¹¶ä¿å­˜åœ¨pubilcå¯¹åº”æ—¥æœŸçš„è·¯å¾„ä¸­,<img src="image-20230421121112744.png" alt="image-20230421121112744" loading="lazy"></p><p>å¯ä»¥çœ‹åˆ°, æ­¤æ—¶indexä¸­çš„å›¾ç‰‡è·¯å¾„å’Œmarkdownçš„å›¾ç‰‡è·¯å¾„æ˜¯å†²çªçš„.</p><pre class="language-markdown" data-language="markdown"><code class="language-markdown">typoraçš„è·¯å¾„ä½¿ç”¨: ![](./example/example.jpg)è¿™æ ·é¡µé¢ä¸Šçš„imgè·¯å¾„å°±ä¼šæ˜¯:/ä½ çš„æ–‡ç« æ ‡é¢˜/example/example.jpgæ­£ç¡®çš„å›¾ç‰‡åœ°å€: /example/example.jpg</code></pre><p>è¿™æ˜¯å› ä¸º<code>hexo g</code>æŠŠæ–‡ä»¶å¤¹é‡Œé¢å›¾ç‰‡å¤åˆ¶è¿‡æ¥äº†, ä½†å¹¶æ²¡æœ‰å¤åˆ¶æ•´ä¸ªå›¾ç‰‡çš„æ–‡ä»¶å¤¹.</p><p>æ‰€ä»¥æˆ‘åªéœ€è¦æ‹¿åˆ°å½“å‰åšå®¢çš„è·¯å¾„ï¼Œç›´æ¥åŠ ä¸Šå›¾ç‰‡åå­—å°±è¡Œ.</p><h3 id="ç¬¬äºŒæ­¥-ç¼–å†™è·¯å¾„æ›¿æ¢è„šæœ¬">ç¬¬äºŒæ­¥, ç¼–å†™è·¯å¾„æ›¿æ¢è„šæœ¬</h3><p>åœ¨å…¨å±€jsæ–‡ä»¶ themes\next\source\js\next-boot.jsä¸­ï¼Œç¼–å†™img è·¯å¾„æ›¿æ¢è„šæœ¬</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// è„šæœ¬æä¾›è€…</span><span class="token comment">//http://songpengpeng.com</span><span class="token keyword">var</span> images <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> loHref <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token keyword">let</span> baseHref <span class="token operator">=</span> loHref<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>loHref<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span>images<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> executeNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> src <span class="token operator">=</span> images<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'src'</span><span class="token punctuation">]</span>    <span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    img<span class="token punctuation">.</span>src <span class="token operator">=</span> src    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    img<span class="token punctuation">.</span><span class="token function-variable function">onerror</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span> <span class="token punctuation">&#123;</span>        executeNum <span class="token operator">++</span> <span class="token punctuation">;</span>        <span class="token function">handAMark</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>executeNum<span class="token operator">></span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">let</span> fileName <span class="token operator">=</span> src<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        images<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>src<span class="token operator">=</span> baseHref<span class="token operator">+</span>fileName    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span>  <span class="token function">handAMark</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> <span class="token keyword">as</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"fancybox"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token keyword">as</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> executeNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> href <span class="token operator">=</span> <span class="token keyword">as</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>href<span class="token operator">==</span>src<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            img<span class="token punctuation">.</span>src <span class="token operator">=</span> src            img<span class="token punctuation">.</span><span class="token function-variable function">onload</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span> <span class="token punctuation">&#123;</span>            <span class="token punctuation">&#125;</span>            img<span class="token punctuation">.</span><span class="token function-variable function">onerror</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span> <span class="token punctuation">&#123;</span>                executeNum <span class="token operator">++</span> <span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>executeNum<span class="token operator">></span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token keyword">return</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">let</span> fileName <span class="token operator">=</span> src<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">as</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>href<span class="token operator">=</span> baseHref<span class="token operator">+</span>fileName            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™æ ·, ä½¿ç”¨<code>hexo g</code>ç”Ÿæˆçš„æ—¶å€™, å°±ä¼šè‡ªåŠ¨å°†å›¾ç‰‡çš„è·¯å¾„æ›¿æ¢.</p><h3 id="ç¬¬ä¸‰æ­¥-æ­é…typoraæ‰æ˜¯æœ€ä½³">ç¬¬ä¸‰æ­¥, æ­é…typoraæ‰æ˜¯æœ€ä½³</h3><p>ä½†æ˜¯è¿˜æ˜¯ä¸å¤Ÿæ–¹ä¾¿å•Š, æˆ‘ä»¬å¾—å…ˆæŠŠå›¾ç‰‡æ”¾åˆ°æ–‡ç« çš„èµ„æºæ–‡ä»¶å¤¹ä¸­. Typoraå¯¹æ’å›¾ç‰‡çš„æ”¯æŒéå¸¸å¥½, å¯ä»¥åœ¨å¤åˆ¶å›¾ç‰‡çš„åŒæ—¶, æŠŠç‰©å“ä¿å­˜åœ¨å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸­</p><p>æ‰“å¼€Typora, <code>âŒ˜+,</code>è¿›å…¥ç³»ç»Ÿåå¥½è®¾ç½®, ç‚¹å‡»imageé€‰é¡¹å¡, ä¿®æ”¹ä¸ºä»¥ä¸‹æ ¼å¼:</p><p>è¿™æ ·å½“æ’å…¥å›¾ç‰‡çš„æ—¶å€™, ä¼šè‡ªåŠ¨æŠŠå›¾ç‰‡æ”¾åˆ°å½“å‰ç›®å½•çš„markdownç›¸åçš„æ–‡ä»¶å¤¹ä¸­, æ°å¥½, Hexo åœ¨æˆ‘ä»¬æ¯ä¸€æ¬¡é€šè¿‡ <code>hexo new &lt;title&gt;</code> å‘½ä»¤åˆ›å»ºæ–°æ–‡ç« æ—¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåŒåæ–‡ä»¶å¤¹.</p><p>å®Œç¾!</p><p><img src="image-20230421124001298.png" alt="image-20230421124001298" loading="lazy"></p><p>è¿™æ ·, æˆ‘ä»¬åœ¨Typoraä¸Šå†™æ–‡ç« , å®Œå…¨ä¸ç”¨æ‹…å¿ƒæ’å…¥å›¾ç‰‡é—®é¢˜, è€Œä¸”æ–‡ç« çš„å›¾ç‰‡ä¹Ÿä¼šæœ‰åºçš„å­˜æ”¾, æ–¹é¢æ—¥åçš„ç®¡ç†.</p><p>ç°åœ¨æˆ‘ä»¬åªéœ€è¦<code>hexo n 'title'</code>ç„¶ååœ¨Typoraä¸Šå†™æ–‡ç« , å°±å¯ä»¥ç›´æ¥æ¨åˆ°åšå®¢äº†, ç…§ç‰‡ä¹Ÿå¯ä»¥æ­£å¸¸æ˜¾ç¤º.</p><p>ä½ çœ‹, æˆ‘å†™å®Œè¿™ç¯‡æ–‡ç« çš„æ—¶å€™, hexoå·²ç»å®Œç¾çš„ç”Ÿæˆç½‘é¡µäº†.</p><p>è¿™å¤ªæ£’äº†, ä¸æ˜¯å—?</p><p><img src="image-20230421124655253.png" alt="image-20230421124655253" loading="lazy"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ˜¨å¤©åˆšæ­å»ºå®Œåšå®¢, å‘ç°ç›´æ¥å†™markdown, hexo ç”Ÿæˆåå›¾ç‰‡å…¨éƒ¨éƒ½æ²¡æ³•æ˜¾ç¤ºäº†, æ¯•ç«Ÿå›¾ç‰‡éƒ½åœ¨æœ¬åœ°, ä»¥ç»å¯¹è·¯å¾„çš„æ–¹å¼å­˜å‚¨çš„, markdownçš„è·¯å¾„çš„hexoçš„è·¯å¾„ä¸åŒ¹é….&lt;/p&gt;</summary>
    
    
    
    
    <category term="æ—¥å¸¸" scheme="https://trevoewu.github.io/tags/%E6%97%A5%E5%B8%B8/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨hexoé‡æ–°æ­å»ºåšå®¢</title>
    <link href="https://trevoewu.github.io/2023/04/21/%E4%BD%BF%E7%94%A8hexo%E9%87%8D%E6%96%B0%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/"/>
    <id>https://trevoewu.github.io/2023/04/21/%E4%BD%BF%E7%94%A8hexo%E9%87%8D%E6%96%B0%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/</id>
    <published>2023-04-20T16:52:00.000Z</published>
    <updated>2023-04-20T16:58:45.077Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰çš„åšå®¢æ˜¯å­¦webçš„æ—¶å€™æ‰‹æ“çš„, å¯¼è‡´åæœŸç®¡ç†å›°éš¾, æ¯æ¬¡å‘å¸ƒæ–‡ç« æˆ‘ç”šè‡³å¾—æ‰‹å†™HTML. åæ¥å‘ç°å¤§å®¶éƒ½æ˜¯ç”¨hexoæ­å»ºåšå®¢, æˆ‘ä¹Ÿå°è¯•äº†ä¸€ä¸‹.</p><p>æˆ‘çœŸçš„å¥½å–œæ¬¢è‡ªå·±ä¹‹å‰åšå®¢çš„é£æ ¼<a href="https://trevoewu.github.io/Peekaboo/">Peekabooçš„éƒ¨è½æ ¼</a></p><p>ç°åœ¨å°±å…ˆç”¨nextä¸»é¢˜å§, è¿™ä¸ªä¸»é¢˜è™½ç„¶ä¸æ€ä¹ˆå¥½çœ‹, ä½†æ˜¯å¸®åŠ©æ–‡æ¡£å¤ªå‹å¥½äº†, æ„Ÿè°¢æ„Ÿè°¢.</p>]]></content>
    
    
    <summary type="html">ä¹‹å‰çš„åšå®¢æ˜¯å­¦webçš„æ—¶å€™æ‰‹æ“çš„, å¯¼è‡´åæœŸç®¡ç†å›°éš¾, æ¯æ¬¡å‘å¸ƒæ–‡ç« æˆ‘ç”šè‡³å¾—æ‰‹å†™HTML. åæ¥å‘ç°å¤§å®¶éƒ½æ˜¯ç”¨hexoæ­å»ºåšå®¢, æˆ‘ä¹Ÿå°è¯•äº†ä¸€ä¸‹.</summary>
    
    
    
    
    <category term="Talk" scheme="https://trevoewu.github.io/tags/Talk/"/>
    
  </entry>
  
  <entry>
    <title>Wireshark lab HTTP</title>
    <link href="https://trevoewu.github.io/2023/04/20/Wireshark-lab-HTTP/"/>
    <id>https://trevoewu.github.io/2023/04/20/Wireshark-lab-HTTP/</id>
    <published>2023-04-20T15:01:49.000Z</published>
    <updated>2023-05-15T13:16:02.833Z</updated>
    
    <content type="html"><![CDATA[<h1>Wiresharkå®éªŒ - HTTP</h1><p><strong>å®˜æ–¹è‹±æ–‡æ–‡æ¡£ï¼š[<a href="http://www-net.cs.umass.edu/wireshark-labs/Wireshark_HTTP_v7.0.pdf">Wireshark_HTTP_v7.0</a>](Wireshark_HTTP_v7.0)</strong></p><p><strong>ä»¥ä¸‹å†…å®¹ä¸ºç¬”è€…ç¿»è¯‘ï¼š</strong></p><hr><p><strong>ã€Šè®¡ç®—æœºç½‘ç»œï¼šè‡ªé¡¶å‘ä¸‹æ–¹æ³•ï¼ˆç¬¬6ç‰ˆï¼‰ã€‹è¡¥å……ææ–™ï¼ŒJ.F. Kurose and K.W. Ross</strong></p><p>â€œä¸é—»ä¸è‹¥é—»ä¹‹ï¼Œé—»ä¹‹ä¸è‹¥è§ä¹‹ï¼Œè§ä¹‹ä¸è‹¥çŸ¥ä¹‹ï¼ŒçŸ¥ä¹‹ä¸è‹¥è¡Œä¹‹ã€‚â€ â€”â€”ä¸­å›½è°šè¯­</p><p>Â© 2005-2012, J.F Kurose and K.W. Ross, All Rights Reserved</p><hr><p>åœ¨ä»‹Wiresharkå®éªŒ-å…¥é—¨é‡Œï¼Œæˆ‘ä»¬å·²ç»åˆæ­¥ä½¿ç”¨äº†WiresharkåŒ…å—…æ¢å™¨ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ“ä½œWiresharkæ¥æŸ¥çœ‹ç½‘ç»œåè®®ã€‚åœ¨è¿™ä¸ªå®éªŒä¸­ï¼Œæˆ‘ä»¬ä¼šæ¢ç´¢HTTPåè®®çš„å‡ ä¸ªæ–¹é¢ï¼šåŸºæœ¬çš„GET/responseäº¤äº’ï¼ŒHTTPæ¶ˆæ¯æ ¼å¼ï¼Œæ£€ç´¢å¤§å‹HTMLæ–‡ä»¶ï¼Œæ£€ç´¢å…·æœ‰åµŒå…¥å¯¹è±¡çš„HTMLæ–‡ä»¶ï¼ŒHTTPè®¤è¯å’Œå®‰å…¨æ€§ã€‚åœ¨å¼€å§‹è¿™äº›å®éªŒä¹‹å‰ï¼Œæ‚¨å¯èƒ½æƒ³æŸ¥çœ‹ä¹¦ä¸­ç¬¬2.2èŠ‚ã€‚</p><h3 id="1-åŸºæœ¬HTTP-GET-responseäº¤äº’">1.åŸºæœ¬HTTP GET/responseäº¤äº’</h3><p>æˆ‘ä»¬å¼€å§‹æ¢ç´¢HTTPï¼Œæ–¹æ³•æ˜¯ä¸‹è½½ä¸€ä¸ªéå¸¸ç®€å•çš„HTMLæ–‡ä»¶<br>éå¸¸çŸ­ï¼Œå¹¶ä¸”ä¸åŒ…å«åµŒå…¥çš„å¯¹è±¡ã€‚æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ol><li>å¯åŠ¨æ‚¨çš„æµè§ˆå™¨ã€‚</li><li>å¯åŠ¨Wiresharkæ•°æ®åŒ…å—…æ¢å™¨ï¼Œå¦‚Wiresharkå®éªŒ-å…¥é—¨æ‰€è¿°ï¼ˆè¿˜æ²¡å¼€å§‹æ•°æ®åŒ…æ•è·ï¼‰ã€‚åœ¨display-filter-specificationçª—å£ä¸­è¾“å…¥â€œhttpâ€ï¼ˆåªæ˜¯å­—æ¯ï¼Œä¸å«å¼•å·æ ‡è®°ï¼‰ï¼Œè¿™æ ·å°±åœ¨ç¨åçš„åˆ†ç»„åˆ—è¡¨çª—å£ä¸­åªæ•è·HTTPæ¶ˆæ¯ã€‚ï¼ˆæˆ‘ä»¬åªå¯¹HTTPåè®®æ„Ÿå…´è¶£ï¼Œä¸æƒ³çœ‹åˆ°å…¶ä»–æ‰€æœ‰çš„æ··ä¹±çš„æ•°æ®åŒ…ï¼‰ã€‚</li><li>ç¨ç­‰ä¸€ä¼šå„¿ï¼ˆæˆ‘ä»¬å°†ä¼šæ˜ç™½ä¸ºä»€ä¹ˆä¸ä¹…ï¼‰ï¼Œç„¶åå¼€å§‹Wiresharkæ•°æ®åŒ…æ•è·ã€‚</li><li>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ <a href="http://gaia.cs.umass.edu/wireshark-labs/HTTP-wireshark-file1.html">http://gaia.cs.umass.edu/wireshark-labs/HTTP-wireshark-file1.html</a> æ‚¨çš„æµè§ˆå™¨åº”æ˜¾ç¤ºéå¸¸ç®€å•çš„å•è¡ŒHTMLæ–‡ä»¶ã€‚</li><li>åœæ­¢Wiresharkæ•°æ®åŒ…æ•è·ã€‚</li></ol><p>ä½ çš„Wiresharkçª—å£åº”è¯¥ç±»ä¼¼äºå›¾1æ‰€ç¤ºçš„çª—å£ã€‚å¦‚æœä½ æ— æ³•è¿æ¥ç½‘ç»œå¹¶è¿è¡ŒWiresharkï¼Œæ‚¨å¯ä»¥æ ¹æ®åé¢çš„æ­¥éª¤ä¸‹è½½å·²æ•è·çš„æ•°æ®åŒ…ï¼š</p><p>ä¸‹è½½zipæ–‡ä»¶ <a href="http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip">http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip</a></p><p>è§£å‹ç¼©æ–‡ä»¶ http-ethereal-trace-1ã€‚è¿™ä¸ªzipæ–‡ä»¶ä¸­çš„æ•°æ®æ˜¯ç”±æœ¬ä¹¦ä½œè€…ä¹‹ä¸€ä½¿ç”¨Wiresharkåœ¨ä½œè€…ç”µè„‘ä¸Šæ”¶é›†çš„ï¼Œå¹¶ä¸”æ˜¯æŒ‰ç…§Wiresharkå®éªŒä¸­çš„æ­¥éª¤åšçš„ã€‚ å¦‚æœä½ ä¸‹è½½äº†æ•°æ®æ–‡ä»¶ï¼Œä½ å¯ä»¥å°†å…¶åŠ è½½åˆ°Wiresharkä¸­ï¼Œå¹¶ä½¿ç”¨æ–‡ä»¶èœå•é€‰æ‹©æ‰“å¼€å¹¶æŸ¥çœ‹æ•°æ®ï¼Œç„¶åé€‰æ‹©http-ethereal-trace-1æ–‡ä»¶ã€‚ ç»“æœæ˜¾ç¤ºåº”ä¸å›¾1ç±»ä¼¼ã€‚ï¼ˆåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šï¼Œæˆ–ä¸åŒçš„Wiresharkç‰ˆæœ¬ä¸Šï¼ŒWiresharkçš„ç•Œé¢ä¼šä¸åŒï¼‰ã€‚</p><p><strong>å›¾1ï¼šWiresharkæ˜¾ç¤º <a href="http://gaia.cs.umass.edu/wireshark-labs/HTTPwireshark-file1.html">http://gaia.cs.umass.edu/wireshark-labs/HTTPwireshark-file1.html</a> å·²è¢«æ‚¨çš„æµè§ˆå™¨æ‰“å¼€</strong></p><p>å›¾1ä¸­çš„ç¤ºä¾‹åœ¨åˆ†ç»„åˆ—è¡¨çª—å£ä¸­æ˜¾ç¤ºäº†ä¸¤ä¸ªè¢«æ•è·çš„HTTPæ¶ˆæ¯ï¼šGETæ¶ˆæ¯ï¼ˆ<a href="http://xn--gaia-z25f82pn9csshz01ap32a0fv906c05q.cs.umass.edu">ä»æ‚¨çš„æµè§ˆå™¨å‘é€åˆ°gaia.cs.umass.edu</a> çš„webæœåŠ¡å™¨ï¼‰å’Œä»æœåŠ¡å™¨åˆ°æµè§ˆå™¨çš„å“åº”æ¶ˆæ¯ã€‚åˆ†ç»„å†…å®¹çª—å£æ˜¾ç¤ºæ‰€é€‰æ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ä¸ºHTTP OKæ¶ˆæ¯ï¼Œå…¶åœ¨åˆ†ç»„åˆ—è¡¨çª—å£ä¸­é«˜äº®æ˜¾ç¤ºï¼‰ã€‚å›æƒ³ä¸€ä¸‹ï¼Œå› ä¸ºHTTPæ¶ˆæ¯è¢«è£…è½½åœ¨TCPæŠ¥æ–‡æ®µå†…ï¼Œè¯¥æŠ¥æ–‡æ®µæ˜¯åœ¨IPåˆ†ç»„å°è£…å—ï¼Œè¿›è€Œåœ¨ä»¥å¤ªç½‘å¸§ï¼Œå’Œå¸§ä¸­å°è£…ï¼Œæ‰€ä»¥ç•Œé¢ä¸­æ˜¾ç¤ºäº†å¸§ï¼Œä»¥å¤ªç½‘ï¼ŒIPï¼ŒTCPåˆ†ç»„ä¿¡æ¯ä»¥åŠHTTPæŠ¥æ–‡ä¿¡æ¯ã€‚æˆ‘ä»¬æƒ³æœ€å°åŒ–éHTTPæ•°æ®çš„æ˜¾ç¤ºï¼ˆæˆ‘ä»¬è¿™é‡Œåªå¯¹HTTPæ„Ÿå…´è¶£ï¼Œè¿™äº›å…¶ä»–åè®®å°†åœ¨ä»¥åçš„å®éªŒä¸­ç ”ç©¶ï¼‰ï¼Œæ‰€ä»¥ç¡®ä¿å¸§ï¼Œä»¥å¤ªç½‘ï¼ŒIPå’ŒTCPè¡Œçš„ä¿¡æ¯è¢«éšè—ï¼Œæ³¨æ„å·¦è¾¹æœ‰ä¸€ä¸ªåŠ å·æˆ–ä¸€ä¸ªå‘å³çš„ä¸‰è§’å½¢ï¼ˆè¿™æ„å‘³ç€æœ‰ä¿¡æ¯è¢«éšè—ï¼‰ï¼Œè€ŒHTTPè¡Œå…·æœ‰å‡å·æˆ–å‘ä¸‹ä¸‰è§’å½¢ï¼ˆè¡¨ç¤ºæ˜¾ç¤ºæœ‰å…³HTTPæ¶ˆæ¯çš„æ‰€æœ‰ä¿¡æ¯ï¼‰ã€‚</p><p>ï¼ˆæ³¨æ„ï¼šæ‚¨åº”è¯¥å¿½ç•¥ä¸favicon.icoç›¸å…³çš„ä»»ä½•HTTP GETå’Œresponseã€‚ å¦‚æœä½ çœ‹åˆ°ä¸€ä¸ªå…³äºè¿™ä¸ªæ–‡ä»¶çš„å¼•ç”¨ï¼Œè¿™æ˜¯ä½ çš„æµè§ˆå™¨è‡ªåŠ¨è¯¢é—®æœåŠ¡å™¨æ˜¯å¦æœ‰ä¸€ä¸ªå›¾æ ‡æ–‡ä»¶åº”æ˜¾ç¤ºåœ¨æµè§ˆå™¨çš„URLæ—è¾¹ã€‚ æˆ‘ä»¬ä¼šå¿½ç•¥è¿™ä¸ªå¼•èµ·éº»çƒ¦çš„å¼•ç”¨ã€‚ï¼‰</p><p>é€šè¿‡æŸ¥çœ‹HTTP GETå’Œå“åº”æ¶ˆæ¯ä¸­çš„ä¿¡æ¯ï¼Œå›ç­”ä»¥ä¸‹é—®é¢˜ã€‚ åœ¨å›ç­”ä»¥ä¸‹é—®é¢˜æ—¶ï¼Œæ‚¨åº”è¯¥æ‰“å°å‡ºGETå’Œå“åº”æ¶ˆæ¯ï¼ˆè¯·å‚é˜…Wireshark-å…¥é—¨å®éªŒä»¥è·å–ä¿¡æ¯ï¼‰ï¼Œå¹¶æŒ‡å‡ºæ‚¨åœ¨æ¶ˆæ¯ä¸­çš„å“ªä¸ªå…·ä½“ä½ç½®æ‰¾åˆ°äº†å›ç­”ä»¥ä¸‹é—®é¢˜çš„ä¿¡æ¯ã€‚ å½“æ‚¨ä¸Šäº¤ä½œä¸šæ—¶ï¼Œè¯·æ³¨æ˜è¾“å‡ºï¼Œæ˜¾ç¤ºæ‚¨åœ¨å“ªäº›åœ°æ–¹è¡¨ç¤ºäº†æ‚¨çš„ç­”æ¡ˆï¼ˆä¾‹å¦‚ï¼Œå¯¹äºæˆ‘ä»¬çš„è¯¾ç¨‹ï¼Œæˆ‘ä»¬è¦æ±‚å­¦ç”Ÿç”¨ç¬”æ ‡è®°çº¸è´¨å‰¯æœ¬ï¼Œæˆ–ç”¨å½©è‰²å­—ä½“åœ¨ç”µå­å‰¯æœ¬çš„ä¸­æ³¨é‡Šæ–‡æœ¬ï¼‰ã€‚</p><ol><li><p>æ‚¨çš„æµè§ˆå™¨æ˜¯å¦è¿è¡ŒHTTPç‰ˆæœ¬1.0æˆ–1.1ï¼ŸæœåŠ¡å™¨è¿è¡Œä»€ä¹ˆç‰ˆæœ¬çš„HTTPï¼Ÿ</p><p>HTTP/1.1</p><p>![image-20230416143533797](/Users/trevorwu/Library/Application Support/typora-user-images/image-20230416143533797.png)</p></li><li><p>æ‚¨çš„æµè§ˆå™¨ä¼šä»æ¥æœåŠ¡å™¨æ¥å—å“ªç§è¯­è¨€ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Ÿ</p><p>![image-20230416144437584](/Users/trevorwu/Library/Application Support/typora-user-images/image-20230416144437584.png)</p></li><li><p>æ‚¨çš„è®¡ç®—æœºçš„IPåœ°å€æ˜¯ä»€ä¹ˆï¼Ÿ gaia.cs.umass.eduæœåŠ¡å™¨åœ°å€å‘¢ï¼Ÿ</p><p>![image-20230416143642203](/Users/trevorwu/Library/Application Support/typora-user-images/image-20230416143642203.png)</p></li><li><p>æœåŠ¡å™¨è¿”å›åˆ°æµè§ˆå™¨çš„çŠ¶æ€ä»£ç æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>![image-20230416144507009](/Users/trevorwu/Library/Application Support/typora-user-images/image-20230416144507009.png)</p></li><li><p>æœåŠ¡å™¨ä¸ŠHTMLæ–‡ä»¶çš„æœ€è¿‘ä¸€æ¬¡ä¿®æ”¹æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿ</p><p>![image-20230416144603595](/Users/trevorwu/Library/Application Support/typora-user-images/image-20230416144603595.png)</p></li><li><p>æœåŠ¡å™¨è¿”å›å¤šå°‘å­—èŠ‚çš„å†…å®¹åˆ°æ‚¨çš„æµè§ˆå™¨ï¼Ÿ</p><p>![image-20230416144632313](/Users/trevorwu/Library/Application Support/typora-user-images/image-20230416144632313.png)</p></li><li><p>é€šè¿‡æ£€æŸ¥æ•°æ®åŒ…å†…å®¹çª—å£ä¸­çš„åŸå§‹æ•°æ®ï¼Œä½ æ˜¯å¦çœ‹åˆ°æœ‰åè®®å¤´åœ¨æ•°æ®åŒ…åˆ—è¡¨çª—å£ä¸­æœªæ˜¾ç¤ºï¼Ÿ å¦‚æœæ˜¯ï¼Œè¯·ä¸¾ä¸€ä¸ªä¾‹å­ã€‚</p><p>æ²¡æœ‰</p></li></ol><p>åœ¨æ‚¨å¯¹ä¸Šè¿°é—®é¢˜5çš„å›ç­”ä¸­ï¼Œæ‚¨å¯èƒ½ä¼šæƒŠè®¶åœ°å‘ç°æ‚¨åˆšæ‰æ£€ç´¢çš„æ–‡æ¡£åœ¨ä¸‹è½½æ–‡æ¡£ä¹‹å‰æœ€è¿‘ä¸€æ¬¡ä¿®æ”¹æ˜¯ä¸€åˆ†é’Ÿå‰ã€‚ é‚£æ˜¯å› ä¸ºï¼ˆå¯¹äºè¿™ä¸ªç‰¹å®šæ–‡ä»¶ï¼‰ï¼Œgaia.cs.umass.eduæœåŠ¡å™¨å°†æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´è®¾ç½®ä¸ºå½“å‰æ—¶é—´ï¼Œå¹¶ä¸”æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚ å› æ­¤ï¼Œå¦‚æœæ‚¨åœ¨ä¸¤æ¬¡è®¿é—®ä¹‹é—´ç­‰å¾…ä¸€åˆ†é’Ÿï¼Œåˆ™è¯¥æ–‡ä»¶çœ‹èµ·æ¥å·²è¢«ä¿®æ”¹ï¼Œå› æ­¤æ‚¨çš„æµè§ˆå™¨å°†ä¸‹è½½æ–‡æ¡£çš„â€œæ–°â€å‰¯æœ¬ã€‚</p><h3 id="2-HTTPæ¡ä»¶Get-responseäº¤äº’">2.HTTPæ¡ä»¶Get/responseäº¤äº’</h3><p>å›é¡¾ä¹¦çš„ç¬¬2.2.5èŠ‚ï¼Œå¤§å¤šæ•°Webæµè§ˆå™¨ä½¿ç”¨å¯¹è±¡ç¼“å­˜ï¼Œä»è€Œåœ¨æ£€ç´¢HTTPå¯¹è±¡æ—¶æ‰§è¡Œæ¡ä»¶GETã€‚æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ä¹‹å‰ï¼Œè¯·ç¡®ä¿æµè§ˆå™¨çš„ç¼“å­˜ä¸ºç©ºã€‚ï¼ˆè¦åœ¨Firefoxä¸‹æ‰§è¡Œæ­¤æ“ä½œï¼Œè¯·é€‰æ‹©â€œå·¥å…·â€ - &gt; â€œæ¸…é™¤æœ€è¿‘å†å²è®°å½•â€ï¼Œç„¶åæ£€æŸ¥ç¼“å­˜æ¡†ï¼Œå¯¹äºInternet Explorerï¼Œé€‰æ‹©â€œå·¥å…·â€ - &gt;â€œInterneté€‰é¡¹â€ - &gt;â€œåˆ é™¤æ–‡ä»¶â€ï¼›è¿™äº›æ“ä½œå°†ä»æµè§ˆå™¨ç¼“å­˜ä¸­åˆ é™¤ç¼“å­˜æ–‡ä»¶ã€‚ ç°åœ¨æŒ‰ä¸‹åˆ—æ­¥éª¤æ“ä½œï¼š</p><ul><li>å¯åŠ¨æ‚¨çš„æµè§ˆå™¨ï¼Œå¹¶ç¡®ä¿æ‚¨çš„æµè§ˆå™¨çš„ç¼“å­˜è¢«æ¸…é™¤ï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚</li><li>å¯åŠ¨Wiresharkæ•°æ®åŒ…å—…æ¢å™¨ã€‚</li><li>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä»¥ä¸‹URL <a href="http://gaia.cs.umass.edu/wireshark-labs/HTTP-wireshark-file2.html">http://gaia.cs.umass.edu/wireshark-labs/HTTP-wireshark-file2.html</a> æ‚¨çš„æµè§ˆå™¨åº”æ˜¾ç¤ºä¸€ä¸ªéå¸¸ç®€å•çš„äº”è¡ŒHTMLæ–‡ä»¶ã€‚</li><li>å†æ¬¡å¿«é€Ÿåœ°å°†ç›¸åŒçš„URLè¾“å…¥åˆ°æµè§ˆå™¨ä¸­ï¼ˆæˆ–è€…åªéœ€åœ¨æµè§ˆå™¨ä¸­ç‚¹å‡»åˆ·æ–°æŒ‰é’®ï¼‰ã€‚</li><li>åœæ­¢Wiresharkæ•°æ®åŒ…æ•è·ï¼Œå¹¶åœ¨display-filter-specificationçª—å£ä¸­è¾“å…¥â€œhttpâ€ï¼Œä»¥ä¾¿åªæ•è·HTTPæ¶ˆæ¯ï¼Œå¹¶åœ¨æ•°æ®åŒ…åˆ—è¡¨çª—å£ä¸­æ˜¾ç¤ºã€‚</li><li>ï¼ˆæ³¨æ„ï¼šå¦‚æœæ— æ³•è¿æ¥ç½‘ç»œå¹¶è¿è¡ŒWiresharkï¼Œåˆ™å¯ä»¥ä½¿ç”¨http-ethereal-trace-2æ•°æ®åŒ…è·Ÿè¸ªæ¥å›ç­”ä»¥ä¸‹é—®é¢˜ï¼›è¯·å‚è§ä¸Šæ–‡æ³¨é‡Šã€‚ï¼‰</li></ul><p>å›ç­”ä¸‹åˆ—é—®é¢˜ï¼š</p><ol start="8"><li><p>æ£€æŸ¥ç¬¬ä¸€ä¸ªä»æ‚¨æµè§ˆå™¨åˆ°æœåŠ¡å™¨çš„HTTP GETè¯·æ±‚çš„å†…å®¹ã€‚æ‚¨åœ¨HTTP GETä¸­çœ‹åˆ°äº†â€œIF-MODIFIED-SINCEâ€è¡Œå—ï¼Ÿ</p><p>æ²¡æœ‰</p></li><li><p>æ£€æŸ¥æœåŠ¡å™¨å“åº”çš„å†…å®¹ã€‚æœåŠ¡å™¨æ˜¯å¦æ˜¾å¼è¿”å›æ–‡ä»¶çš„å†…å®¹ï¼Ÿ ä½ æ˜¯æ€ä¹ˆçŸ¥é“çš„ï¼Ÿ</p><p>æ˜¯çš„,![image-20230416150206500](/Users/trevorwu/Library/Application Support/typora-user-images/image-20230416150206500.png)</p></li><li><p>ç°åœ¨ï¼Œæ£€æŸ¥ç¬¬äºŒä¸ªHTTP GETè¯·æ±‚çš„å†…å®¹ã€‚ æ‚¨åœ¨HTTP GETä¸­çœ‹åˆ°äº†â€œIF-MODIFIED-SINCE:â€è¡Œå—ï¼Ÿ å¦‚æœæ˜¯ï¼Œâ€œIF-MODIFIED-SINCE:â€å¤´åé¢åŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ</p><p>çœ‹è§äº†. æ—¥æœŸ</p><p>![image-20230416151334645](/Users/trevorwu/Library/Application Support/typora-user-images/image-20230416151334645.png)</p></li><li><p>é’ˆå¯¹ç¬¬äºŒä¸ªHTTP GETï¼Œä»æœåŠ¡å™¨å“åº”çš„HTTPçŠ¶æ€ç å’ŒçŸ­è¯­æ˜¯ä»€ä¹ˆï¼ŸæœåŠ¡å™¨æ˜¯å¦æ˜ç¡®åœ°è¿”å›æ–‡ä»¶çš„å†…å®¹ï¼Ÿè¯·è§£é‡Šã€‚</p><p>![image-20230416150249214](/Users/trevorwu/Library/Application Support/typora-user-images/image-20230416150249214.png)</p></li></ol><h3 id="3-æ£€ç´¢é•¿æ–‡ä»¶">3.æ£€ç´¢é•¿æ–‡ä»¶</h3><p>åœ¨æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢çš„ä¾‹å­ä¸­ï¼Œæ£€ç´¢çš„æ–‡æ¡£æ˜¯ç®€çŸ­çš„HTMLæ–‡ä»¶ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹å½“æˆ‘ä»¬ä¸‹è½½ä¸€ä¸ªé•¿çš„HTMLæ–‡ä»¶æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p><ul><li>å¯åŠ¨æ‚¨çš„æµè§ˆå™¨ï¼Œå¹¶ç¡®ä¿æ‚¨çš„æµè§ˆå™¨ç¼“å­˜è¢«æ¸…é™¤ï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚</li><li>å¯åŠ¨Wiresharkæ•°æ®åŒ…å—…æ¢å™¨</li><li>åœ¨æ‚¨çš„æµè§ˆå™¨ä¸­è¾“å…¥ä»¥ä¸‹URL <a href="http://gaia.cs.umass.edu/wireshark-labs/HTTP-wireshark-file3.html">http://gaia.cs.umass.edu/wireshark-labs/HTTP-wireshark-file3.html</a> æ‚¨çš„æµè§ˆå™¨åº”æ˜¾ç¤ºç›¸å½“å†—é•¿çš„ç¾å›½æƒåˆ©æ³•æ¡ˆã€‚</li><li>åœæ­¢Wiresharkæ•°æ®åŒ…æ•è·ï¼Œå¹¶åœ¨display-filter-specificationçª—å£ä¸­è¾“å…¥â€œhttpâ€ï¼Œä»¥ä¾¿åªæ˜¾ç¤ºæ•è·çš„HTTPæ¶ˆæ¯ã€‚</li><li>ï¼ˆæ³¨æ„ï¼šå¦‚æœæ— æ³•è¿æ¥ç½‘ç»œå¹¶è¿è¡ŒWiresharkï¼Œåˆ™å¯ä»¥ä½¿ç”¨http-ethereal-trace-3æ•°æ®åŒ…è·Ÿè¸ªæ¥å›ç­”ä»¥ä¸‹é—®é¢˜ï¼›è¯·å‚è§ä¸Šæ–‡æ³¨é‡Šã€‚ï¼‰</li></ul><p>åœ¨åˆ†ç»„åˆ—è¡¨çª—å£ä¸­ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°æ‚¨çš„HTTP GETæ¶ˆæ¯ï¼Œç„¶åæ˜¯å¯¹æ‚¨çš„HTTP GETè¯·æ±‚çš„å¤šä¸ªåˆ†ç»„çš„TCPå“åº”ã€‚è¿™ä¸ªå¤šåˆ†ç»„å“åº”å€¼å¾—è¿›è¡Œä¸€ç‚¹è§£é‡Šã€‚å›é¡¾ç¬¬2.2èŠ‚ï¼ˆè§æ–‡ä¸­çš„å›¾2.9ï¼‰ï¼ŒHTTPå“åº”æ¶ˆæ¯ç”±çŠ¶æ€è¡Œç»„æˆï¼Œåè·Ÿæ ‡é¢˜è¡Œï¼Œåè·Ÿä¸€ä¸ªç©ºè¡Œï¼Œåè·Ÿå®ä½“ä¸»ä½“ã€‚åœ¨æˆ‘ä»¬çš„HTTP GETè¿™ç§æƒ…å†µä¸‹ï¼Œå“åº”ä¸­çš„å®ä½“ä¸»ä½“æ˜¯æ•´ä¸ªè¯·æ±‚çš„HTMLæ–‡ä»¶ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒHTMLæ–‡ä»¶ç›¸å½“é•¿ï¼Œ4500å­—èŠ‚å¤ªå¤§ï¼Œä¸€ä¸ªTCPæ•°æ®åŒ…ä¸èƒ½å®¹çº³ã€‚å› æ­¤ï¼Œå•ä¸ªHTTPå“åº”æ¶ˆæ¯ç”±TCPåˆ†æˆå‡ ä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†åŒ…å«åœ¨å•ç‹¬çš„TCPæŠ¥æ–‡æ®µä¸­ï¼ˆå‚è§ä¹¦ä¸­çš„å›¾1.24ï¼‰ã€‚åœ¨Wiresharkçš„æœ€æ–°ç‰ˆæœ¬ä¸­ï¼ŒWiresharkå°†æ¯ä¸ªTCPæŠ¥æ–‡æ®µæŒ‡å®šä¸ºç‹¬ç«‹çš„æ•°æ®åŒ…ï¼Œå¹¶ä¸”å•ä¸ªHTTPå“åº”åœ¨å¤šä¸ªTCPæ•°æ®åŒ…ä¹‹é—´åˆ†æ®µçš„äº‹å®ç”±Wiresharkæ˜¾ç¤ºçš„Infoåˆ—ä¸­çš„â€œé‡ç»„PDUçš„TCPæ®µâ€æŒ‡ç¤ºã€‚ Wiresharkçš„æ—©æœŸç‰ˆæœ¬ä½¿ç”¨â€œç»§ç»­â€çŸ­è¯­è¡¨ç¤ºHTTPæ¶ˆæ¯çš„æ•´ä¸ªå†…å®¹è¢«å¤šä¸ªTCPæ®µæ‰“æ–­ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œå¼ºè°ƒï¼ŒHTTPä¸­æ²¡æœ‰â€œç»§ç»­â€æ¶ˆæ¯ï¼</p><p>å›ç­”ä¸‹åˆ—é—®é¢˜ï¼š</p><ol start="12"><li><p>æ‚¨çš„æµè§ˆå™¨å‘é€å¤šå°‘HTTP GETè¯·æ±‚æ¶ˆæ¯ï¼Ÿå“ªä¸ªæ•°æ®åŒ…åŒ…å«äº†ç¾å›½æƒåˆ©æ³•æ¡ˆçš„æ¶ˆæ¯ï¼Ÿ</p><p>![image-20230416151626850](/Users/trevorwu/Library/Application Support/typora-user-images/image-20230416151626850.png)</p><p>ä¸¤ä¸ª, ç¬¬ä¸€ä¸ª</p></li><li><p>å“ªä¸ªæ•°æ®åŒ…åŒ…å«å“åº”HTTP GETè¯·æ±‚çš„çŠ¶æ€ç å’ŒçŸ­è¯­ï¼Ÿ</p><p>![image-20230416151652019](/Users/trevorwu/Library/Application Support/typora-user-images/image-20230416151652019.png)</p><p>ç¬¬äºŒä¸ª</p></li><li><p>å“åº”ä¸­çš„çŠ¶æ€ç å’ŒçŸ­è¯­æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>200 OK</p></li><li><p>éœ€è¦å¤šå°‘åŒ…å«æ•°æ®çš„TCPæ®µæ¥æ‰§è¡Œå•ä¸ªHTTPå“åº”å’Œæƒåˆ©æ³•æ¡ˆæ–‡æœ¬ï¼Ÿ</p><p>4ä¸ªTCPæ®µ</p><p>![image-20230416151853132](/Users/trevorwu/Library/Application Support/typora-user-images/image-20230416151853132.png)</p></li></ol><h3 id="4-å…·æœ‰åµŒå…¥å¯¹è±¡çš„HTMLæ–‡æ¡£">4.å…·æœ‰åµŒå…¥å¯¹è±¡çš„HTMLæ–‡æ¡£</h3><p>ç°åœ¨æˆ‘ä»¬å·²ç»çœ‹åˆ°Wiresharkå¦‚ä½•æ˜¾ç¤ºæ•è·çš„å¤§å‹HTMLæ–‡ä»¶çš„æ•°æ®åŒ…æµé‡ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹å½“æµè§ˆå™¨ä½¿ç”¨åµŒå…¥çš„å¯¹è±¡ä¸‹è½½æ–‡ä»¶æ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Œå³åŒ…å«å…¶ä»–å¯¹è±¡çš„æ–‡ä»¶ï¼ˆåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­æ˜¯å›¾åƒæ–‡ä»¶ï¼‰ çš„æœåŠ¡å™¨ã€‚<br>æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ul><li>å¯åŠ¨æ‚¨çš„æµè§ˆå™¨ã€‚</li><li>å¯åŠ¨Wiresharkæ•°æ®åŒ…å—…æ¢å™¨ã€‚</li><li>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä»¥ä¸‹URL <a href="http://gaia.cs.umass.edu/wireshark-labs/HTTP-wireshark-file4.html">http://gaia.cs.umass.edu/wireshark-labs/HTTP-wireshark-file4.html</a> æ‚¨çš„æµè§ˆå™¨åº”æ˜¾ç¤ºåŒ…å«ä¸¤ä¸ªå›¾åƒçš„çŸ­HTMLæ–‡ä»¶ã€‚è¿™ä¸¤ä¸ªå›¾åƒåœ¨åŸºæœ¬HTMLæ–‡ä»¶ä¸­è¢«å¼•ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå›¾åƒæœ¬èº«ä¸åŒ…å«åœ¨HTMLæ–‡ä»¶ä¸­ï¼›ç›¸åï¼Œå›¾åƒçš„URLåŒ…å«åœ¨å·²ä¸‹è½½çš„HTMLæ–‡ä»¶ä¸­ã€‚å¦‚ä¹¦ä¸­æ‰€è¿°ï¼Œæ‚¨çš„æµè§ˆå™¨å°†ä¸å¾—ä¸ä»æŒ‡å®šçš„ç½‘ç«™ä¸­æ£€ç´¢è¿™äº›å›¾æ ‡ã€‚æˆ‘ä»¬çš„å‡ºç‰ˆç¤¾çš„å›¾æ ‡æ˜¯ä» <a href="http://www.aw-bc.com">www.aw-bc.com</a> ç½‘ç«™æ£€ç´¢çš„ã€‚è€Œæˆ‘ä»¬ç¬¬5ç‰ˆï¼ˆæˆ‘ä»¬æœ€å–œæ¬¢çš„å°é¢ä¹‹ä¸€ï¼‰çš„å°é¢å›¾åƒå­˜å‚¨åœ¨manic.cs.umass.eduæœåŠ¡å™¨ã€‚</li><li>åœæ­¢Wiresharkæ•°æ®åŒ…æ•è·ï¼Œå¹¶åœ¨display-filter-specificationçª—å£ä¸­è¾“å…¥â€œhttpâ€ï¼Œä»¥ä¾¿åªæ˜¾ç¤ºæ•è·çš„HTTPæ¶ˆæ¯ã€‚</li><li>ï¼ˆæ³¨æ„ï¼šå¦‚æœæ— æ³•è¿æ¥ç½‘ç»œå¹¶è¿è¡ŒWiresharkï¼Œåˆ™å¯ä»¥ä½¿ç”¨http-ethereal-trace-4æ•°æ®åŒ…è·Ÿè¸ªæ¥å›ç­”ä»¥ä¸‹é—®é¢˜ï¼›è¯·å‚è§ä¸Šæ–‡æ³¨é‡Šã€‚ï¼‰</li></ul><p>å›ç­”ä¸‹åˆ—é—®é¢˜ï¼š</p><ol start="16"><li><p>æ‚¨çš„æµè§ˆå™¨å‘é€äº†å‡ ä¸ªHTTP GETè¯·æ±‚æ¶ˆæ¯ï¼Ÿ è¿™äº›GETè¯·æ±‚å‘é€åˆ°å“ªä¸ªIPåœ°å€ï¼Ÿ</p><p>ä¸‰ä¸ª</p><p>![image-20230416152201783](/Users/trevorwu/Library/Application Support/typora-user-images/image-20230416152201783.png)</p></li><li><p>æµè§ˆå™¨ä»ä¸¤ä¸ªç½‘ç«™ä¸²è¡Œè¿˜æ˜¯å¹¶è¡Œä¸‹è½½äº†ä¸¤å¼ å›¾ç‰‡ï¼Ÿè¯·è¯´æ˜ã€‚</p><p>çŒœæµ‹ä¸ºä¸²è¡Œ, å› ä¸ºè¿™ä¸¤ä¸ªGETè¯·æ±‚å‘é€æœ‰æ—¶é—´å·®</p><p>![image-20230416152416694](/Users/trevorwu/Library/Application Support/typora-user-images/image-20230416152416694.png)</p></li></ol><h3 id="5-HTTPè®¤è¯">5.HTTPè®¤è¯</h3><p>æœ€åï¼Œæˆ‘ä»¬å°è¯•è®¿é—®å—å¯†ç ä¿æŠ¤çš„ç½‘ç«™ï¼Œå¹¶æ£€æŸ¥ç½‘ç«™çš„HTTPæ¶ˆæ¯äº¤æ¢çš„åºåˆ—ã€‚URL <a href="http://gaia.cs.umass.edu/wireshark-labs/protected_pages/HTTP-wireshark-file5.html">http://gaia.cs.umass.edu/wireshark-labs/protected_pages/HTTP-wireshark-file5.html</a> æ˜¯å—å¯†ç ä¿æŠ¤çš„ã€‚ç”¨æˆ·åæ˜¯â€œwireshark-studentsâ€ï¼ˆä¸åŒ…å«å¼•å·ï¼‰ï¼Œå¯†ç æ˜¯â€œnetworkâ€ï¼ˆå†æ¬¡ä¸åŒ…å«å¼•å·ï¼‰ã€‚æ‰€ä»¥è®©æˆ‘ä»¬è®¿é—®è¿™ä¸ªâ€œå®‰å…¨çš„â€å—å¯†ç ä¿æŠ¤çš„ç½‘ç«™ã€‚æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ul><li>è¯·ç¡®ä¿æµè§ˆå™¨çš„ç¼“å­˜è¢«æ¸…é™¤ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œç„¶åå…³é—­ä½ çš„æµè§ˆå™¨ï¼Œå†ç„¶åå¯åŠ¨æµè§ˆå™¨</li><li>å¯åŠ¨Wiresharkæ•°æ®åŒ…å—…æ¢å™¨ã€‚</li><li>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä»¥ä¸‹URL <a href="http://gaia.cs.umass.edu/wireshark-labs/protected_pages/HTTP-wiresharkfile5.html">http://gaia.cs.umass.edu/wireshark-labs/protected_pages/HTTP-wiresharkfile5.html</a> åœ¨å¼¹å‡ºæ¡†ä¸­é”®å…¥æ‰€è¯·æ±‚çš„ç”¨æˆ·åå’Œå¯†ç ã€‚</li><li>åœæ­¢Wiresharkæ•°æ®åŒ…æ•è·ï¼Œå¹¶åœ¨display-filter-specificationçª—å£ä¸­è¾“å…¥â€œhttpâ€ï¼Œä»¥ä¾¿åªæ˜¾ç¤ºæ•è·çš„HTTPæ¶ˆæ¯ã€‚</li><li>ï¼ˆæ³¨æ„ï¼šå¦‚æœæ— æ³•è¿æ¥ç½‘ç»œå¹¶è¿è¡ŒWiresharkï¼Œåˆ™å¯ä»¥ä½¿ç”¨http-ethereal-trace-5æ•°æ®åŒ…è·Ÿè¸ªæ¥å›ç­”ä»¥ä¸‹é—®é¢˜ï¼›è¯·å‚è§ä¸Šæ–‡æ³¨é‡Šã€‚ï¼‰</li></ul><p>ç°åœ¨æ¥çœ‹çœ‹Wiresharkè¾“å‡ºã€‚ æ‚¨å¯èƒ½éœ€è¦é¦–å…ˆé˜…è¯»HTTPèº«ä»½éªŒè¯ç›¸å…³ä¿¡æ¯ï¼Œæ–¹æ³•æ˜¯åœ¨ <a href="http://frontier.userland.com/stories/storyReader$2159">http://frontier.userland.com/stories/storyReader$2159</a> ä¸ŠæŸ¥çœ‹â€œHTTP Access Authentication Framework â€ä¸Šçš„æ˜“è¯»ææ–™ã€‚</p><p>å›ç­”ä¸‹åˆ—é—®é¢˜ï¼š</p><ol start="18"><li><p>å¯¹äºæ‚¨çš„æµè§ˆå™¨çš„åˆå§‹HTTP GETæ¶ˆæ¯ï¼ŒæœåŠ¡å™¨å“åº”ï¼ˆçŠ¶æ€ç å’ŒçŸ­è¯­ï¼‰æ˜¯ä»€ä¹ˆå“åº”ï¼Ÿ</p><p>![image-20230416152712931](/Users/trevorwu/Library/Application Support/typora-user-images/image-20230416152712931.png)</p><p>æœªæˆæƒ</p></li><li><p>å½“æ‚¨çš„æµè§ˆå™¨ç¬¬äºŒæ¬¡å‘é€HTTP GETæ¶ˆæ¯æ—¶ï¼ŒHTTP GETæ¶ˆæ¯ä¸­åŒ…å«å“ªäº›æ–°å­—æ®µï¼Ÿ</p><p>![image-20230416152814670](/Users/trevorwu/Library/Application Support/typora-user-images/image-20230416152814670.png)</p><p>ä¸€ä¸ªCredentials: çš„å­—æ®µ</p></li></ol><p>æ‚¨è¾“å…¥çš„ç”¨æˆ·åï¼ˆwireshark-studentsï¼‰å’Œå¯†ç ï¼ˆnetworkï¼‰æŒ‰ç…§å®¢æˆ·ç«¯HTTP GETæ¶ˆæ¯ä¸­è¯·æ±‚å¤´çš„â€œAuthorization: Basic â€çš„å­—ç¬¦ä¸²ï¼ˆd2lyZXNoYXJrLXN0dWRlbnRzOm5ldHdvcms=ï¼‰ç¼–ç ã€‚è™½ç„¶æ‚¨çš„ç”¨æˆ·åå’Œå¯†ç å¯èƒ½åŠ å¯†ï¼Œä½†å®ƒä»¬åªæ˜¯ä»¥ä¸€ç§ç§°ä¸ºBase64æ ¼å¼çš„æ ¼å¼è¿›è¡Œç¼–ç ã€‚ç”¨æˆ·åå’Œå¯†ç å¹¶æ²¡æœ‰åŠ å¯†ï¼è¦ç¡®è®¤è¿™äº›ï¼Œè¯·è®¿é—® <a href="http://www.motobit.com/util/base64-decoder-encoder.asp">http://www.motobit.com/util/base64-decoder-encoder.asp</a> å¹¶è¾“å…¥base64ç¼–ç çš„å­—ç¬¦ä¸²d2lyZXNoYXJrLXN0dWRlbnRz å¹¶è¿›è¡Œè§£ç ã€‚ç§ï¼æ‚¨å·²ä»Base64ç¼–ç è½¬æ¢ä¸ºASCIIç¼–ç ï¼Œå› æ­¤åº”è¯¥çœ‹åˆ°æ‚¨çš„ç”¨æˆ·åï¼è¦æŸ¥çœ‹å¯†ç ï¼Œè¯·è¾“å…¥å­—ç¬¦ä¸²Om5ldHdvcms=çš„å‰©ä½™éƒ¨åˆ†ï¼Œç„¶åæŒ‰è§£ç ã€‚å› ä¸ºä»»ä½•äººéƒ½å¯ä»¥ä¸‹è½½åƒWiresharkè¿™æ ·çš„å·¥å…·ï¼Œè€Œä¸”å¯ä»¥é€šè¿‡ç½‘ç»œé€‚é…å™¨å—…æ¢æ•°æ®åŒ…ï¼ˆä¸ä»…ä»…æ˜¯è‡ªå·±çš„ï¼‰ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä»Base64è½¬æ¢ä¸ºASCIIï¼ˆä½ åˆšåˆšå°±è¿™ä¹ˆåšäº†ï¼ï¼‰ï¼Œæ‰€ä»¥ä½ åº”è¯¥å¾ˆæ¸…æ¥šï¼ŒWWWç½‘ç«™ä¸Šçš„ç®€å•å¯†ç å¹¶ä¸å®‰å…¨ï¼Œé™¤éé‡‡å–å…¶ä»–æªæ–½ã€‚</p><p>wiresharkè‡ªå¸¦è§£ç â€¦</p><p>ä¸è¦å®³æ€•ï¼ æ­£å¦‚æˆ‘ä»¬å°†åœ¨ç¬¬8ç« ä¸­çœ‹åˆ°çš„ï¼Œæœ‰ä¸€äº›æ–¹æ³•å¯ä»¥ä½¿WWWè®¿é—®æ›´åŠ å®‰å…¨ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬æ˜¾ç„¶éœ€è¦ä¸€äº›è¶…å‡ºåŸºæœ¬HTTPè®¤è¯æ¡†æ¶çš„çŸ¥è¯†ï¼</p>]]></content>
    
    
    <summary type="html">åœ¨è¿™ä¸ªå®éªŒä¸­ï¼Œæˆ‘ä»¬ä¼šæ¢ç´¢HTTPåè®®çš„å‡ ä¸ªæ–¹é¢ï¼šåŸºæœ¬çš„GET/responseäº¤äº’ï¼ŒHTTPæ¶ˆæ¯æ ¼å¼ï¼Œæ£€ç´¢å¤§å‹HTMLæ–‡ä»¶ï¼Œæ£€ç´¢å…·æœ‰åµŒå…¥å¯¹è±¡çš„HTMLæ–‡ä»¶ï¼ŒHTTPè®¤è¯å’Œå®‰å…¨æ€§</summary>
    
    
    
    
    <category term="computer network" scheme="https://trevoewu.github.io/tags/computer-network/"/>
    
  </entry>
  
</feed>
